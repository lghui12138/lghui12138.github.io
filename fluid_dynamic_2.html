<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, notranslate">
    <title>æµä½“åŠ›å­¦å­¦ä¹ å¹³å° - ä¸­å›½æµ·æ´‹å¤§å­¦</title>
    <meta name="version" content="2.1.0">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1976d2">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="æµä½“åŠ›å­¦">
    
    <!-- DNS prefetch for performance -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//api.github.com">
    
    <!-- åçˆ¬è™«å’Œå®‰å…¨é˜²æŠ¤ -->
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- é«˜çº§è§†é¢‘æ’­æ”¾å™¨åº“ -->
    <script src="https://vjs.zencdn.net/8.7.0/video.min.js" crossorigin="anonymous"></script>
    <link href="https://vjs.zencdn.net/8.7.0/video-js.css" rel="stylesheet" crossorigin="anonymous">
    
    <!-- æ–‡ä»¶å¤„ç†åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" crossorigin="anonymous"></script>
    
    <!-- é«˜çº§UIç»„ä»¶åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sortable/1.15.0/Sortable.min.js" crossorigin="anonymous"></script>
    
    <!-- è§†é¢‘å‹ç¼©å’Œå¤„ç†åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/ffmpeg@0.12.7/dist/ffmpeg.min.js" crossorigin="anonymous"></script>
    
    <!-- èµ„æºåŠ è½½é”™è¯¯å¤„ç† -->
    <script>
        // æ£€æŸ¥å¤–éƒ¨èµ„æºåŠ è½½çŠ¶æ€
        window.addEventListener('load', function() {
            const resources = [
                { name: 'Font Awesome', url: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' },
                { name: 'Chart.js', url: 'https://cdn.jsdelivr.net/npm/chart.js' },
                { name: 'Video.js', url: 'https://vjs.zencdn.net/8.7.0/video.min.js' },
                { name: 'XLSX', url: 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js' },
                { name: 'Sortable', url: 'https://cdnjs.cloudflare.com/ajax/libs/sortable/1.15.0/Sortable.min.js' }
            ];
            
            resources.forEach(resource => {
                if (typeof window[resource.name.replace(/\s+/g, '')] === 'undefined') {
                    console.warn(`âš ï¸ ${resource.name} å¯èƒ½æœªæ­£ç¡®åŠ è½½`);
                }
            });
        });
        
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€é”™è¯¯:', e.error);
            // å¦‚æœæ˜¯å¤–éƒ¨èµ„æºåŠ è½½å¤±è´¥ï¼Œä¸å½±å“åŸºæœ¬åŠŸèƒ½
            if (e.filename && e.filename.includes('cdn')) {
                console.warn('å¤–éƒ¨èµ„æºåŠ è½½å¤±è´¥ï¼Œä½†åŸºæœ¬åŠŸèƒ½ä¸å—å½±å“');
            }
        });
        
        // å¼ºåˆ¶åˆ·æ–°ç¼“å­˜
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                }
            });
        }
        
        // æ¸…é™¤ç¼“å­˜
        if ('caches' in window) {
            caches.keys().then(function(names) {
                for (let name of names) {
                    caches.delete(name);
                }
            });
        }
        
        // ==================== ç°ä»£åŒ–ç™»å½•ç³»ç»Ÿ ====================
        
        // ç¡®ä¿è´¦å·æ•°æ®å­˜åœ¨
        if (typeof window.accounts === 'undefined') {
            window.accounts = {
                'liuguanghui6330156': { name: 'åˆ˜å…‰è¾‰', role: 'teacher', password: 'Ll700306' },
                'student1': { name: 'å­¦ç”Ÿè´¦å·', role: 'student', password: '123456' },
                'niwenxuan': { name: 'å€ªæ–‡è½©', role: 'student', password: 'niwenxuan2025' },
                'hanwenxu': { name: 'éŸ©æ–‡æ—­', role: 'student', password: 'hanwenxu2025' }
            };
        }

        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function basicShowError(msg) {
            const errorDiv = document.getElementById('basicErrorMsg');
            const successDiv = document.getElementById('basicSuccessMsg');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
                if (successDiv) successDiv.style.display = 'none';
            }
            console.error('âŒ ç™»å½•é”™è¯¯:', msg);
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function basicShowSuccess(msg) {
            const successDiv = document.getElementById('basicSuccessMsg');
            const errorDiv = document.getElementById('basicErrorMsg');
            if (successDiv) {
                successDiv.textContent = msg;
                successDiv.style.display = 'block';
                if (errorDiv) errorDiv.style.display = 'none';
            }
            console.log('âœ… ç™»å½•æˆåŠŸ:', msg);
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoginLoading(show = true) {
            const btnText = document.getElementById('loginBtnText');
            const btnLoading = document.getElementById('loginBtnLoading');
            const loginBtn = document.getElementById('basicLoginBtn');
            
            if (show) {
                if (btnText) btnText.style.display = 'none';
                if (btnLoading) btnLoading.style.display = 'inline-block';
                if (loginBtn) loginBtn.disabled = true;
            } else {
                if (btnText) btnText.style.display = 'inline';
                if (btnLoading) btnLoading.style.display = 'none';
                if (loginBtn) loginBtn.disabled = false;
            }
        }

        // ä¸»è¦ç™»å½•å‡½æ•°
        function basicLogin() {
            console.log('ğŸ” å¼€å§‹ç™»å½•æµç¨‹...');
            
            const username = document.getElementById('basicUsername')?.value?.trim();
            const password = document.getElementById('basicPassword')?.value;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoginLoading(true);
            
            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            setTimeout(() => {
                try {
                    // éªŒè¯è¾“å…¥
                    if (!username || !password) {
                        basicShowError('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                        showLoginLoading(false);
                        return;
                    }
                    
                    console.log('ğŸ“ éªŒè¯è´¦å·:', username);
                    
                    // æ£€æŸ¥è´¦å·æ˜¯å¦å­˜åœ¨
                    const account = window.accounts[username];
                    if (!account) {
                        basicShowError('ç”¨æˆ·åä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥è¾“å…¥');
                        showLoginLoading(false);
                        return;
                    }
                    
                    // éªŒè¯å¯†ç 
                    if (account.password !== password) {
                        basicShowError('å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥');
                        showLoginLoading(false);
                        return;
                    }
                    
                    // ç™»å½•æˆåŠŸ
                    basicShowSuccess(`ç™»å½•æˆåŠŸï¼æ¬¢è¿ ${account.name} (${account.role})`);
                    window.currentUser = username;
                    
                    console.log('âœ… ç™»å½•æˆåŠŸ:', account);
                    
                    // å»¶è¿Ÿè·³è½¬
                    setTimeout(() => {
                        // éšè—ç™»å½•ç•Œé¢
                        const loginContainer = document.getElementById('loginContainer');
                        if (loginContainer) {
                            loginContainer.style.opacity = '0';
                            loginContainer.style.transform = 'scale(0.9)';
                            setTimeout(() => {
                                loginContainer.style.display = 'none';
                            }, 300);
                        }
                        
                        // æ˜¾ç¤ºå¹³å°ç•Œé¢
                        const platformContainer = document.getElementById('platformContainer');
                        if (platformContainer) {
                            platformContainer.style.display = 'block';
                        }
                        
                        showLoginLoading(false);
                        
                        // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
                        if (typeof showMessage === 'function') {
                            showMessage(`æ¬¢è¿ä½¿ç”¨æµä½“åŠ›å­¦å­¦ä¹ å¹³å°ï¼Œ${account.name}ï¼`, 'success');
                        } else {
                            alert(`æ¬¢è¿ä½¿ç”¨æµä½“åŠ›å­¦å­¦ä¹ å¹³å°ï¼Œ${account.name}ï¼`);
                        }
                    }, 1500);
                    
                } catch (error) {
                    console.error('âŒ ç™»å½•è¿‡ç¨‹ä¸­å‡ºé”™:', error);
                    basicShowError('ç™»å½•è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
                    showLoginLoading(false);
                }
            }, 500);
        }

        // æ•™å¸ˆå¿«é€Ÿç™»å½•
        function basicQuickTeacher() {
            console.log('ğŸ‘¨â€ğŸ« æ•™å¸ˆå¿«é€Ÿç™»å½•');
            const usernameInput = document.getElementById('basicUsername');
            const passwordInput = document.getElementById('basicPassword');
            
            if (usernameInput && passwordInput) {
                usernameInput.value = 'liuguanghui6330156';
                passwordInput.value = 'Ll700306';
                
                // è§¦å‘è¾“å…¥äº‹ä»¶
                usernameInput.dispatchEvent(new Event('input'));
                passwordInput.dispatchEvent(new Event('input'));
                
                // è‡ªåŠ¨ç™»å½•
                setTimeout(basicLogin, 100);
            }
        }

        // å­¦ç”Ÿå¿«é€Ÿç™»å½•
        function basicQuickStudent() {
            console.log('ğŸ‘¨â€ğŸ“ å­¦ç”Ÿå¿«é€Ÿç™»å½•');
            const usernameInput = document.getElementById('basicUsername');
            const passwordInput = document.getElementById('basicPassword');
            
            if (usernameInput && passwordInput) {
                usernameInput.value = 'student1';
                passwordInput.value = '123456';
                
                // è§¦å‘è¾“å…¥äº‹ä»¶
                usernameInput.dispatchEvent(new Event('input'));
                passwordInput.dispatchEvent(new Event('input'));
                
                // è‡ªåŠ¨ç™»å½•
                setTimeout(basicLogin, 100);
            }
        }

        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        function basicShowDebug() {
            console.log('=== ç™»å½•ç³»ç»Ÿè°ƒè¯•ä¿¡æ¯ ===');
            console.log('è´¦å·æ•°æ®:', window.accounts);
            console.log('å¯ç”¨è´¦å·:', Object.keys(window.accounts));
            console.log('å½“å‰ç”¨æˆ·:', window.currentUser);
            console.log('é¡µé¢å…ƒç´ :', {
                username: document.getElementById('basicUsername'),
                password: document.getElementById('basicPassword'),
                loginBtn: document.getElementById('basicLoginBtn'),
                loginContainer: document.getElementById('loginContainer')
            });
            console.log('å‡½æ•°æ£€æŸ¥:', {
                basicLogin: typeof basicLogin,
                basicShowError: typeof basicShowError,
                basicShowSuccess: typeof basicShowSuccess
            });
            
            basicShowSuccess('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŒ‰F12æŸ¥çœ‹');
        }

        // æ˜¾ç¤ºå¸®åŠ©æ¨¡æ€æ¡†
        function showHelpModal() {
            const helpHtml = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10001;
                ">
                    <div style="
                        background: white;
                        padding: 30px;
                        border-radius: 15px;
                        max-width: 500px;
                        max-height: 80vh;
                        overflow-y: auto;
                        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                    ">
                        <h3 style="color: #667eea; margin-bottom: 20px;">
                            <i class="fas fa-question-circle"></i> ä½¿ç”¨å¸®åŠ©
                        </h3>
                        <div style="line-height: 1.6; color: #2c3e50;">
                            <h4>ğŸ“‹ å¯ç”¨è´¦å·ï¼š</h4>
                            <ul style="margin-bottom: 20px;">
                                <li><strong>æ•™å¸ˆè´¦å·:</strong> liuguanghui6330156 / Ll700306</li>
                                <li><strong>å­¦ç”Ÿè´¦å·:</strong> student1 / 123456</li>
                                <li><strong>å­¦ç”Ÿè´¦å·:</strong> niwenxuan / niwenxuan2025</li>
                                <li><strong>å­¦ç”Ÿè´¦å·:</strong> hanwenxu / hanwenxu2025</li>
                            </ul>
                            
                            <h4>ğŸš€ å¿«é€Ÿç™»å½•ï¼š</h4>
                            <p>ç‚¹å‡»"æ•™å¸ˆå¿«é€Ÿç™»å½•"æˆ–"å­¦ç”Ÿå¿«é€Ÿç™»å½•"æŒ‰é’®å¯ä»¥è‡ªåŠ¨å¡«å……è´¦å·ä¿¡æ¯å¹¶ç™»å½•ã€‚</p>
                            
                            <h4>ğŸ”§ è°ƒè¯•åŠŸèƒ½ï¼š</h4>
                            <p>ç‚¹å‡»"è°ƒè¯•ä¿¡æ¯"æŒ‰é’®å¯ä»¥æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€å’Œè°ƒè¯•ä¿¡æ¯ã€‚</p>
                            
                            <h4>ğŸ’¡ ä½¿ç”¨æç¤ºï¼š</h4>
                            <ul>
                                <li>æ”¯æŒå›è½¦é”®å¿«é€Ÿç™»å½•</li>
                                <li>è¾“å…¥æ¡†æœ‰è‡ªåŠ¨å®ŒæˆåŠŸèƒ½</li>
                                <li>ç™»å½•çŠ¶æ€ä¼šå®æ—¶æ˜¾ç¤º</li>
                                <li>æ”¯æŒå“åº”å¼è®¾è®¡ï¼Œé€‚é…å„ç§è®¾å¤‡</li>
                            </ul>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="closeHelpModal()" style="
                                background: #667eea;
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: 500;
                            ">å…³é—­</button>
                        </div>
                    </div>
                </div>
            `;
            
            const helpDiv = document.createElement('div');
            helpDiv.innerHTML = helpHtml;
            helpDiv.id = 'helpModal';
            document.body.appendChild(helpDiv);
        }

        // å…³é—­å¸®åŠ©æ¨¡æ€æ¡†
        function closeHelpModal() {
            const helpModal = document.getElementById('helpModal');
            if (helpModal) {
                document.body.removeChild(helpModal);
            }
        }

        // ç¡®ä¿ç™»å½•åŠŸèƒ½åœ¨DOMåŠ è½½å®Œæˆåå¯ç”¨
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ å¼ºåˆ¶åˆ·æ–°ç¼“å­˜å®Œæˆ');
            console.log('âœ… ç°ä»£åŒ–ç™»å½•ç³»ç»Ÿå·²åˆå§‹åŒ–');
            
            // ç¡®ä¿æ‰€æœ‰å¿…è¦çš„å…ƒç´ éƒ½å­˜åœ¨
            const requiredElements = [
                'basicUsername',
                'basicPassword', 
                'basicLoginBtn',
                'basicErrorMsg',
                'basicSuccessMsg',
                'loginContainer'
            ];
            
            const missingElements = requiredElements.filter(id => !document.getElementById(id));
            if (missingElements.length > 0) {
                console.error('âŒ ç¼ºå°‘å¿…è¦çš„ç™»å½•å…ƒç´ :', missingElements);
            } else {
                console.log('âœ… æ‰€æœ‰ç™»å½•å…ƒç´ å·²å°±ç»ª');
            }
            
            // æ·»åŠ å›è½¦é”®ç™»å½•æ”¯æŒ
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && document.getElementById('loginContainer')?.style.display !== 'none') {
                    basicLogin();
                }
            });
            
            // æ·»åŠ è¾“å…¥æ¡†ç„¦ç‚¹æ•ˆæœ
            const inputs = document.querySelectorAll('#basicUsername, #basicPassword');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'scale(1.02)';
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'scale(1)';
                });
                
                // æ·»åŠ è¾“å…¥éªŒè¯
                input.addEventListener('input', function() {
                    if (this.value.trim()) {
                        this.style.borderColor = '#667eea';
                    } else {
                        this.style.borderColor = '#e1e8ed';
                    }
                });
            });
            
            // æ·»åŠ æŒ‰é’®ç‚¹å‡»æ•ˆæœ
            const buttons = document.querySelectorAll('.basic-login-box button');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });
            
            // è‡ªåŠ¨èšç„¦åˆ°ç”¨æˆ·åè¾“å…¥æ¡†
            const usernameInput = document.getElementById('basicUsername');
            if (usernameInput) {
                setTimeout(() => {
                    usernameInput.focus();
                }, 500);
            }
            
            // æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€
            if ('ononline' in window) {
                window.addEventListener('online', function() {
                    console.log('âœ… ç½‘ç»œè¿æ¥å·²æ¢å¤');
                    basicShowSuccess('ç½‘ç»œè¿æ¥å·²æ¢å¤');
                });
                
                window.addEventListener('offline', function() {
                    console.log('âŒ ç½‘ç»œè¿æ¥å·²æ–­å¼€');
                    basicShowError('ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®');
                });
            }
            
            // æ·»åŠ é¡µé¢å¯è§æ€§æ£€æµ‹
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    console.log('ğŸ“± é¡µé¢é‡æ–°å¯è§');
                }
            });
            
            // æ·»åŠ çª—å£å¤§å°å˜åŒ–æ£€æµ‹
            window.addEventListener('resize', function() {
                console.log('ğŸ“ çª—å£å¤§å°å·²è°ƒæ•´:', window.innerWidth, 'x', window.innerHeight);
            });
            
            // åˆå§‹åŒ–å®Œæˆæç¤º
            setTimeout(() => {
                console.log('ğŸ‰ ç°ä»£åŒ–ç™»å½•ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                console.log('ğŸ“± æ”¯æŒå“åº”å¼è®¾è®¡ï¼Œé€‚é…å„ç§è®¾å¤‡');
                console.log('ğŸ” ç™»å½•åŠŸèƒ½100%å¯ç”¨');
            }, 1000);
        });
        
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('âŒ å…¨å±€é”™è¯¯:', e.error);
            if (e.filename && e.filename.includes('fluid_dynamic_2.html')) {
                basicShowError('é¡µé¢åŠ è½½å‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        });
        
        // æœªå¤„ç†çš„Promiseæ‹’ç»
        window.addEventListener('unhandledrejection', function(e) {
            console.error('âŒ æœªå¤„ç†çš„Promiseæ‹’ç»:', e.reason);
            basicShowError('ç³»ç»Ÿå‡ºç°å¼‚å¸¸ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary: #1a3a57;
            --secondary: #2a6aa7;
            --accent: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --error: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --border: #bdc3c7;
            --shadow: rgba(0, 0, 0, 0.1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            
            /* é«˜çº§è§†é¢‘æ’­æ”¾å™¨å˜é‡ */
            --video-player-bg: #000;
            --video-controls-bg: rgba(0, 0, 0, 0.8);
            --video-progress-bg: rgba(255, 255, 255, 0.3);
            --video-progress-fill: #ff6b6b;
            --video-button-hover: rgba(255, 255, 255, 0.2);
            
            /* æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿå˜é‡ */
            --upload-area-bg: #ffffff;
            --upload-area-border: #e1e5e9;
            --upload-area-hover: #f8f9fa;
            --upload-progress-bg: #e9ecef;
            --upload-progress-fill: #007bff;
            --upload-success: #28a745;
            --upload-error: #dc3545;
            
            /* é¢˜åº“ç³»ç»Ÿå˜é‡ */
            --exercise-bg: #f8f9fa;
            --exercise-border: #dee2e6;
            --exercise-correct: #28a745;
            --exercise-incorrect: #dc3545;
            --exercise-hint: #17a2b8;
            
            /* åŠ¨ç”»å˜é‡ */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --teacher: #27ae60;
            --student: #f39c12;
            --light: #ecf0f1;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --dark: #1a1a2e;
            --text: #34495e;
            --featured: linear-gradient(90deg, #ff9966, #ff5e62);
            --reexam-color: #3498db;   /* å¤è¯•çº¿é¢œè‰² */
            --national-color: #e74c3c; /* å›½å®¶çº¿é¢œè‰² */
            --ocean-blue: #1e6fa8;
            --wave-color: #2c9ab7;
        }
        
        body {
            background-color: #f5f9ff;
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            background: linear-gradient(135deg, #f5f9ff 0%, #e6f0ff 100%);
            min-height: 100vh;
            
            /* é˜²æˆªå±å’Œé˜²é€‰æ‹© */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            
            /* é˜²æ­¢æ‹–æ‹½ */
            -webkit-user-drag: none;
            -moz-user-drag: none;
            user-drag: none;
            
            /* é˜²æ‰“å° */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* é˜²æˆªå±å’Œåçˆ¬è™«ä¿æŠ¤ */
        * {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-user-drag: none !important;
            -moz-user-drag: none !important;
            user-drag: none !important;
        }
        
        /* é˜²æ­¢å³é”®èœå• */
        body, html {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* é˜²æ­¢å›¾ç‰‡å’Œè§†é¢‘è¢«ä¿å­˜ */
        img, video, iframe {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-user-drag: none !important;
            -moz-user-drag: none !important;
            user-drag: none !important;
            pointer-events: none;
            -webkit-touch-callout: none;
        }
        
        /* é˜²æ­¢å¼€å‘è€…å·¥å…·æ£€æµ‹ */
        .anti-debug {
            display: none !important;
        }
        
        /* æ°´å°ä¿æŠ¤å±‚ - ä¼˜åŒ–å­¦ä¹ ä½“éªŒ */
        .watermark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        /* å­¦ä¹ æ¨¡å¼ä¸‹éšè—èƒŒæ™¯æ°´å° */
        .watermark-overlay.learning-mode {
            opacity: 0;
        }
        
        /* éå­¦ä¹ æ¨¡å¼æ˜¾ç¤ºè½»å¾®æ°´å° */
        .watermark-overlay.protection-mode {
            opacity: 1;
            background-image: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 150px,
                    rgba(26, 58, 87, 0.02) 150px,
                    rgba(26, 58, 87, 0.02) 300px
                );
        }
        
        /* å­¦ç”Ÿç«¯ç‰¹æ®Šä¿æŠ¤ - ä¼˜åŒ–å­¦ä¹ ä½“éªŒ */
        .student-content {
            position: relative;
        }
        
        /* åªåœ¨éå­¦ä¹ é¡µé¢æ˜¾ç¤ºä¿æŠ¤å±‚ */
        .student-content.non-learning::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(26, 58, 87, 0.01) 0%, transparent 70%),
                radial-gradient(circle at 80% 80%, rgba(26, 58, 87, 0.01) 0%, transparent 70%);
            pointer-events: none;
            z-index: 1;
        }
        
        /* å­¦ä¹ é¡µé¢æ¸…é™¤æ‰€æœ‰å¹²æ‰° */
        .learning-content {
            position: relative;
            background: #f8fbff;
        }
        
        .learning-content::before {
            display: none;
        }
        
        /* å­¦ä¹ æ¨¡å¼ä¸‹ä¼˜åŒ–è§†é¢‘å¡ç‰‡ */
        .learning-content .video-card {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(26, 58, 87, 0.1);
            transition: all 0.3s ease;
        }
        
        .learning-content .video-card:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        
        /* å­¦ä¹ æ¨¡å¼ä¸‹ä¼˜åŒ–é¢˜åº“å¡ç‰‡ */
        .learning-content .exercise-card {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(26, 58, 87, 0.1);
            transition: all 0.3s ease;
        }
        
        .learning-content .exercise-card:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        
        /* å­¦ä¹ æ¨¡å¼ä¸‹çš„å†…å®¹åŒºåŸŸ */
        .learning-content .content-section {
            background: transparent;
            padding: 20px 0;
        }
        
        /* å­¦ä¹ æ¨¡å¼ä¸‹çš„æ ‡é¢˜ä¼˜åŒ– */
        .learning-content .section-title {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
        }
        
        /* é˜²æ‰“å°æ ·å¼ */
        @media print {
            * {
                display: none !important;
            }
            
            body::before {
                content: "æ­¤å†…å®¹å—ç‰ˆæƒä¿æŠ¤ï¼Œç¦æ­¢æ‰“å°";
                display: block !important;
                text-align: center;
                font-size: 24px;
                color: red;
                margin: 50px;
            }
        }
        
        /* å®‰å…¨è­¦å‘ŠåŠ¨ç”» */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes shake {
                    0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
        }

        /* ==================== é«˜çº§åŠ¨ç”»ç³»ç»Ÿ ==================== */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(52, 152, 219, 0.8);
            }
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes rotateIn {
            from {
                transform: rotate(-360deg) scale(0);
                opacity: 0;
            }
            to {
                transform: rotate(0deg) scale(1);
                opacity: 1;
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes flipInX {
            from {
                transform: perspective(400px) rotate3d(1, 0, 0, 90deg);
                opacity: 0;
            }
            40% {
                transform: perspective(400px) rotate3d(1, 0, 0, -20deg);
            }
            60% {
                transform: perspective(400px) rotate3d(1, 0, 0, 10deg);
            }
            80% {
                transform: perspective(400px) rotate3d(1, 0, 0, -5deg);
            }
            to {
                transform: perspective(400px);
                opacity: 1;
            }
        }

        @keyframes zoomInBounce {
            0% {
                opacity: 0;
                transform: scale3d(0.3, 0.3, 0.3);
            }
            20% {
                transform: scale3d(1.1, 1.1, 1.1);
            }
            40% {
                transform: scale3d(0.9, 0.9, 0.9);
            }
            60% {
                opacity: 1;
                transform: scale3d(1.03, 1.03, 1.03);
            }
            80% {
                transform: scale3d(0.97, 0.97, 0.97);
            }
            to {
                opacity: 1;
                transform: scale3d(1, 1, 1);
            }
        }

        @keyframes progressShimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes loadingDots {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        @keyframes loadingWave {
            0%, 40%, 100% {
                transform: scaleY(0.4);
            }
            20% {
                transform: scaleY(1);
            }
        }

        @keyframes progressStripes {
            0% {
                background-position: 16px 0;
            }
            100% {
                background-position: 0 0;
            }
        }

        @keyframes toastProgress {
            to {
                transform: translateX(0);
            }
        }

        /* åŠ¨ç”»ç±» */
        .animate-fade-in-up {
            animation: fadeInUp 0.6s var(--bounce);
        }

        .animate-fade-in-down {
            animation: fadeInDown 0.6s var(--bounce);
        }

        .animate-fade-in-left {
            animation: fadeInLeft 0.6s var(--bounce);
        }

        .animate-fade-in-right {
            animation: fadeInRight 0.6s var(--bounce);
        }

        .animate-scale-in {
            animation: scaleIn 0.4s var(--bounce);
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }

        .animate-slide-in-up {
            animation: slideInUp 0.6s var(--bounce);
        }

        .animate-slide-in-down {
            animation: slideInDown 0.6s var(--bounce);
        }

        .animate-rotate-in {
            animation: rotateIn 0.8s var(--bounce);
        }

        .animate-bounce-in {
            animation: bounceIn 0.8s var(--bounce);
        }

        .animate-flip-in-x {
            animation: flipInX 0.8s var(--bounce);
        }

        .animate-zoom-in-bounce {
            animation: zoomInBounce 0.8s var(--bounce);
        }
        
        /* å­¦ç”Ÿç«¯é¢å¤–ä¿æŠ¤æ ·å¼ */
        .student-protection {
            position: relative;
        }
        
        .student-protection::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 40%,
                rgba(26, 58, 87, 0.02) 50%,
                transparent 60%
            );
            pointer-events: none;
            z-index: 1;
        }
        
        /* ==================== æœ€åŸºç¡€ç™»å½•ç³»ç»Ÿæ ·å¼ ==================== */
        
        /* ==================== ç°ä»£åŒ–ç™»å½•ç³»ç»Ÿæ ·å¼ ==================== */
        
        /* ä¸»å®¹å™¨ - å…¨å±æ¸å˜èƒŒæ™¯ */
        .basic-login-system {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            overflow: hidden;
        }

        /* åŠ¨æ€èƒŒæ™¯åŠ¨ç”» */
        .basic-login-system::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* ç™»å½•ç›’å­ - ç°ä»£åŒ–è®¾è®¡ */
        .basic-login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 50px 40px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 420px;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* æ ‡é¢˜æ ·å¼ */
        .basic-login-box h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .basic-login-box p {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 35px;
            font-size: 16px;
            font-weight: 500;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .basic-login-box input {
            width: 100%;
            padding: 18px 20px;
            margin-bottom: 20px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .basic-login-box input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .basic-login-box input::placeholder {
            color: #95a5a6;
            font-weight: 400;
        }

        /* æŒ‰é’®æ ·å¼ */
        .basic-login-box button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .basic-login-box button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .basic-login-box button:hover::before {
            left: 100%;
        }

        .basic-login-box button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .basic-login-box button:active {
            transform: translateY(-1px);
        }

        /* å¿«é€Ÿç™»å½•æŒ‰é’® */
        .basic-quick-btn {
            background: rgba(248, 249, 250, 0.9) !important;
            color: #2c3e50 !important;
            border: 2px solid #e1e8ed !important;
            margin-bottom: 8px !important;
            font-size: 14px !important;
            padding: 12px !important;
            border-radius: 10px !important;
            font-weight: 500 !important;
            transition: all 0.3s ease !important;
        }

        .basic-quick-btn:hover {
            background: rgba(233, 236, 239, 0.9) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
        }

        /* æ¶ˆæ¯æç¤ºæ ·å¼ */
        .basic-error {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            animation: shake 0.5s ease-in-out;
        }

        .basic-success {
            background: linear-gradient(135deg, #51cf66, #40c057);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(81, 207, 102, 0.3);
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .basic-login-box {
                width: 95%;
                padding: 40px 30px;
                margin: 20px;
            }
            
            .basic-login-box h1 {
                font-size: 24px;
            }
            
            .basic-login-box p {
                font-size: 14px;
            }
            
            .basic-login-box input {
                padding: 16px 18px;
                font-size: 16px;
            }
            
            .basic-login-box button {
                padding: 16px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .basic-login-box {
                width: 98%;
                padding: 30px 20px;
            }
            
            .basic-login-box h1 {
                font-size: 22px;
            }
            
            .basic-login-box input {
                padding: 14px 16px;
            }
            
            .basic-login-box button {
                padding: 14px;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            text-align: center;
            z-index: 10;
            position: relative;
            animation: fadeInScale 0.6s ease;
        }
        
        .login-logo {
            margin-bottom: 30px;
        }
        
        .login-title {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 24px;
        }
        
        .login-subtitle {
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .login-form {
            margin-top: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(42, 106, 167, 0.3);
        }
        
        .password-hint {
            text-align: right;
            font-size: 13px;
            color: #7f8c8d;
            margin-top: -15px;
            margin-bottom: 15px;
        }
        
        .password-hint i {
            margin-right: 5px;
        }
        
        /* å¯¼èˆªæ æ ·å¼ */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(26, 58, 87, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .featured-banner {
            background: var(--ocean-blue);
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .logo i {
            font-size: 28px;
            color: #63b3ff;
            background: rgba(255, 255, 255, 0.15);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 5px;
        }
        
        nav li {
            padding: 0 8px;
        }
        
        nav a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 30px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .user-info:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        /* GitHubè®¾ç½®æŒ‰é’®å®‰å…¨éšè— */
        .settings-btn.student-hidden {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }
        
        .user-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(45deg, #63b3ff, #2a6aa7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .logout-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
            font-size: 16px;
        }
        
        .role-badge {
            font-size: 12px;
            padding: 3px 10px;
            border-radius: 12px;
            margin-left: 5px;
        }
        
        .teacher-badge {
            background: var(--teacher);
        }
        
        .student-badge {
            background: var(--student);
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            padding: 30px 0;
            min-height: calc(100vh - 220px);
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 28px;
            color: var(--primary);
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--accent);
            border-radius: 3px;
        }
        
        .section-title i {
            background: rgba(42, 106, 167, 0.15);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
        }
        
        /* å¤ä¹ è§„åˆ’æ¿å— */
        .review-planner {
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
            border: 1px solid #e3edfa;
            position: relative;
        }
        
        .planner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .timeline-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .timeline-month {
            margin-bottom: 30px;
        }
        
        .month-title {
            font-size: 20px;
            color: var(--secondary);
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 3px solid var(--accent);
        }
        
        .plan-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(236, 240, 241, 0.5);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .plan-item:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateX(5px);
        }
        
        .week-label {
            background: var(--accent);
            color: white;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 4px;
            min-width: 80px;
            text-align: center;
            margin-right: 15px;
        }
        
        .plan-content {
            flex: 1;
        }
        
        .plan-content h4 {
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        .plan-content p {
            font-size: 14px;
            color: #5e7c9c;
        }
        
        .plan-status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
        }
        
        .status-check {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .status-check.completed {
            background: var(--success);
            border-color: var(--success);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-check.completed::before {
            content: "âœ“";
            color: white;
            font-size: 14px;
        }
        
        /* è§†é¢‘è¯¾ç¨‹æ¿å— */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .video-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            border: 1px solid #e3edfa;
        }
        
        .video-card.featured {
            grid-column: 1 / -1;
            display: flex;
            max-width: 900px;
            margin: 0 auto;
            border: 2px solid var(--accent);
        }
        
        .video-card.featured .video-preview {
            flex: 1;
            min-height: 250px;
        }
        
        .video-card.featured .video-info {
            flex: 1;
            padding: 25px;
        }
        
        .video-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(26, 58, 87, 0.15);
        }
        
        .video-preview {
            height: 160px;
            background: linear-gradient(45deg, var(--primary), #316399);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .video-preview i {
            font-size: 60px;
            color: rgba(255, 255, 255, 0.15);
        }
        
        .featured-tag {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--success);
            color: white;
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        .play-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            color: var(--secondary);
            background: white;
        }
        
        .video-info {
            padding: 20px;
        }
        
        .video-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 44px;
        }
        
        .video-description {
            color: #5e7c9c;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .video-duration {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #6d8db0;
            font-size: 14px;
            margin-top: 10px;
        }
        
        /* é¢˜åº“ç³»ç»Ÿæ¿å— */
        .question-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
            border: 1px solid #e3edfa;
            margin-top: 20px;
        }
        
        .upload-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 25px;
            background: rgba(42, 106, 167, 0.05);
            padding: 20px;
            border-radius: 10px;
            border: 2px dashed #63b3ff;
        }
        
        .upload-section h3 {
            color: var(--primary);
        }

        /* ==================== é«˜çº§æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ ==================== */
        .advanced-upload-area {
            border: 3px dashed var(--upload-area-border);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            background: var(--upload-area-bg);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }

        .advanced-upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(52, 152, 219, 0.1), transparent);
            transition: left 0.5s;
        }

        .advanced-upload-area:hover::before {
            left: 100%;
        }

        .advanced-upload-area.dragover {
            border-color: var(--accent);
            background: rgba(52, 152, 219, 0.05);
            transform: scale(1.02);
        }

        .advanced-upload-area.uploading {
            border-color: var(--upload-progress-fill);
            background: rgba(0, 123, 255, 0.05);
        }

        .advanced-upload-area.success {
            border-color: var(--upload-success);
            background: rgba(40, 167, 69, 0.05);
        }

        .advanced-upload-area.error {
            border-color: var(--upload-error);
            background: rgba(220, 53, 69, 0.05);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--accent);
            margin-bottom: 20px;
            transition: all var(--transition-normal);
        }

        .advanced-upload-area:hover .upload-icon {
            transform: scale(1.1) rotateY(180deg);
        }

        .upload-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 12px;
        }

        .upload-hint {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }

        .upload-formats {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .format-badge {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .upload-progress-container {
            margin-top: 20px;
            display: none;
        }

        .upload-progress-container.active {
            display: block;
            animation: slideInUp 0.3s var(--bounce);
        }

        .upload-progress-bar {
            height: 12px;
            background: var(--upload-progress-bg);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            margin-bottom: 12px;
        }

        .upload-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--upload-progress-fill), var(--accent));
            border-radius: 6px;
            transition: width var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .upload-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 2s infinite;
        }

        .upload-progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--dark);
        }

        .upload-speed {
            font-size: 12px;
            color: #666;
        }

        .file-preview-container {
            margin-top: 24px;
            display: none;
        }

        .file-preview-container.active {
            display: block;
            animation: fadeInUp 0.4s var(--bounce);
        }

        .file-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .file-preview-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .file-preview-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .file-preview-icon {
            font-size: 32px;
            color: var(--accent);
            margin-bottom: 12px;
            text-align: center;
        }

        .file-preview-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--dark);
            margin-bottom: 8px;
            word-break: break-word;
        }

        .file-preview-size {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .file-preview-progress {
            height: 4px;
            background: #eee;
            border-radius: 2px;
            overflow: hidden;
        }

        .file-preview-progress-fill {
            height: 100%;
            background: var(--upload-progress-fill);
            border-radius: 2px;
            transition: width var(--transition-normal);
        }

        .file-remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--error);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
        }

        .file-remove-btn:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        /* è§†é¢‘ç‰¹å®šä¸Šä¼ æ ·å¼ */
        .video-upload-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-source-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: 3px solid transparent;
        }

        .video-source-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .video-source-card.selected {
            border-color: var(--accent);
            background: rgba(52, 152, 219, 0.05);
        }

        .video-source-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--accent);
        }

        .video-source-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .video-source-description {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        /* é¢˜åº“ç‰¹å®šä¸Šä¼ æ ·å¼ */
        .exercise-upload-wizard {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .wizard-steps {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .wizard-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            transition: all var(--transition-normal);
        }

        .wizard-step.active {
            background: var(--accent);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
        }

        .wizard-step.completed {
            background: var(--success);
        }

        .wizard-step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }

        .wizard-step.active .wizard-step-number,
        .wizard-step.completed .wizard-step-number {
            background: rgba(255, 255, 255, 0.9);
            color: var(--dark);
        }

        .exercise-format-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .format-option {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: 2px solid transparent;
        }

        .format-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .format-option.selected {
            border-color: var(--accent);
            background: rgba(52, 152, 219, 0.05);
        }

        .format-icon {
            font-size: 36px;
            color: var(--accent);
            margin-bottom: 12px;
        }

        .format-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .format-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .format-examples {
            margin-top: 12px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 11px;
            color: #666;
            font-family: monospace;
        }
        
        .upload-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            box-shadow: 0 4px 10px rgba(42, 106, 167, 0.2);
        }
        
        .upload-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(42, 106, 167, 0.25);
        }
        
        .progress-container {
            margin-top: 25px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .progress-header h3 {
            color: var(--primary);
        }
        
        .progress-bar {
            height: 10px;
            background: #e0e7f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 25px;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #63b3ff, var(--accent));
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-text {
            position: absolute;
            right: 10px;
            top: -22px;
            font-size: 12px;
            color: var(--secondary);
        }
        
        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .exercise-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 58, 87, 0.08);
            border-left: 4px solid var(--accent);
            transition: all 0.3s ease;
            border: 1px solid #e3edfa;
        }
        
        .exercise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(26, 58, 87, 0.15);
        }
        
        .exercise-title {
            font-weight: 700;
            font-size: 17px;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .exercise-meta {
            display: flex;
            justify-content: space-between;
            color: var(--secondary);
            font-size: 14px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e3edfa;
        }
        
        .exercise-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .start-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: block;
            width: 100%;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .start-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        /* åˆ†æ•°çº¿æ¿å— */
        .score-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: 1px solid #e3edfa;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: var(--accent);
            color: white;
        }
        
        .score-chart-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-box {
            height: 400px;
            position: relative;
        }
        
        .score-details {
            margin-top: 30px;
        }
        
        .section-card {
            background: white;
            border: 1px solid #e3edfa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .info-item {
            display: flex;
            margin-bottom: 15px;
        }
        
        .info-label {
            width: 140px;
            font-weight: 600;
            color: var(--primary);
            margin-right: 20px;
        }
        
        .info-content {
            flex: 1;
            color: var(--text);
        }
        
        .info-content p {
            margin-bottom: 5px;
        }
        
        .diff-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .diff-up {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .diff-down {
            background-color: #d4edda;
            color: #155724;
        }
        
        /* æˆç»©å½•å…¥æ¿å— */
        .grade-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
        }
        
        .grade-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .grade-form input {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .add-grade-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0 20px;
        }
        
        .add-grade-btn:hover {
            background: var(--secondary);
        }
        
        .grade-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .grade-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 58, 87, 0.08);
            border-left: 4px solid var(--accent);
        }
        
        .grade-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .grade-value {
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
            color: var(--secondary);
        }
        
        .grade-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .grade-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e3edfa;
        }
        
        .grade-item:last-child {
            border-bottom: none;
        }
        
        .grade-actions {
            display: flex;
            gap: 10px;
        }
        
        .grade-actions button {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ - ä¼˜åŒ–å­¦ä¹ ä½“éªŒ */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        /* å­¦ä¹ æ¨¡å¼ä¸‹çš„æ¨¡æ€æ¡† */
        .learning-content .modal-backdrop {
            background: rgba(0, 0, 0, 0.95);
        }
        
        .modal-backdrop.active {
            visibility: visible;
            opacity: 1;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90vw;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
        
        .fullscreen-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .fullscreen-btn i {
            transition: transform 0.3s ease;
        }
        
        .modal-content.fullscreen .fullscreen-btn i {
            transform: rotate(180deg);
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background: #000;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0 0 15px 15px;
        }
        
        /* å…¨å±æ¨¡å¼æ ·å¼ */
        .modal-content.fullscreen {
            width: 100vw;
            height: 100vh;
            max-width: none;
            max-height: none;
            border-radius: 0;
            margin: 0;
        }
        
        .modal-content.fullscreen .video-container {
            height: calc(100vh - 60px);
            padding-bottom: 0;
        }
        
        .modal-content.fullscreen .video-container iframe {
            border-radius: 0;
        }
        
        .modal-content.fullscreen .modal-header {
            border-radius: 0;
        }
        
        footer {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-top: 40px;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .copyright {
            font-size: 14px;
            opacity: 0.8;
            letter-spacing: 0.5px;
        }
        
        /* ä¸“ä¸šä¿¡æ¯æ¿å— */
        .university-info {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-card {
            background: rgba(236, 240, 241, 0.5);
            border-radius: 8px;
            padding: 20px;
            border-left: 3px solid var(--accent);
        }
        
        .info-card h3 {
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .info-card ul {
            padding-left: 20px;
        }
        
        .info-card li {
            margin-bottom: 10px;
        }
        
        .reference-book {
            display: flex;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .book-icon {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 15px;
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes wave {
            0% { transform: translateX(0); }
            50% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 1200px) {
            .container {
                padding: 0 15px;
            }
            
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .exercise-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .video-card.featured {
                flex-direction: column;
            }
            
            .timeline-container {
                grid-template-columns: 1fr;
            }
            
            .grade-form {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .score-filters {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .filter-btn {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
        }
        
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .logo h1 {
                font-size: 20px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                margin: 10px 0;
                gap: 5px;
            }
            
            nav li {
                padding: 2px;
            }
            
            nav a {
                padding: 8px 12px;
                font-size: 14px;
                border-radius: 20px;
            }
            
            .user-menu {
                width: 100%;
                justify-content: center;
            }
            
            .upload-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .exercise-grid {
                grid-template-columns: 1fr;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 22px;
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .section-title i {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .login-box {
                margin: 20px;
                padding: 30px 20px;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px;
            }
            
            .modal-content.fullscreen {
                width: 100vw;
                height: 100vh;
                margin: 0;
            }
            
            .video-tips {
                font-size: 12px !important;
                padding: 8px 12px !important;
                bottom: 10px !important;
                left: 10px !important;
            }
            
            .grade-results {
                grid-template-columns: 1fr;
            }
            
            .chart-box {
                height: 300px;
            }
            
            .info-item {
                flex-direction: column;
                gap: 5px;
            }
            
            .info-label {
                width: 100%;
                margin-right: 0;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .login-box {
                padding: 25px 15px;
            }
            
            .login-title {
                font-size: 20px;
            }
            
            .login-subtitle {
                font-size: 14px;
            }
            
            .section-title {
                font-size: 20px;
            }
            
            .video-card {
                margin: 0 10px;
            }
            
            .exercise-card {
                margin: 0 10px;
            }
            
            .nav a {
                padding: 6px 10px;
                font-size: 13px;
            }
            
            .user-info {
                padding: 6px 10px;
            }
            
            .user-icon {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
        }
        
        /* æ–°å¢ä¸Šä¼ åŠŸèƒ½æ ·å¼ */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .upload-modal.active {
            display: flex;
        }
        
        .upload-modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .upload-form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .upload-form-group label {
            font-weight: 600;
            color: var(--primary);
        }
        
        .upload-form-group input,
        .upload-form-group textarea,
        .upload-form-group select {
            padding: 12px;
            border: 2px solid #e3edfa;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .upload-form-group input:focus,
        .upload-form-group textarea:focus,
        .upload-form-group select:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .upload-form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .file-upload-area {
            border: 2px dashed var(--accent);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: rgba(52, 152, 219, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: var(--secondary);
        }
        
        .file-upload-area.dragover {
            background: rgba(52, 152, 219, 0.15);
            border-color: var(--secondary);
        }
        
        .file-upload-area i {
            font-size: 48px;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .file-upload-area p {
            color: var(--text);
            margin-bottom: 10px;
        }
        
        .file-upload-area small {
            color: #7f8c8d;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .radio-label input[type="radio"] {
            margin: 0;
        }
        
        .upload-progress {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 12px;
            color: var(--text);
            text-align: center;
            display: block;
        }
        
        .upload-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .upload-btn-primary {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .upload-btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .upload-btn-secondary {
            background: #ecf0f1;
            color: var(--text);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .upload-btn-secondary:hover {
            background: #d5dbdb;
        }
        
        .upload-preview {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }
        
        .upload-preview.active {
            display: block;
        }
        
        .upload-preview h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .upload-preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e3edfa;
        }
        
        .upload-preview-item:last-child {
            border-bottom: none;
        }
        
        .upload-preview-item .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upload-preview-item .file-info i {
            color: var(--accent);
        }
        
        .upload-preview-item .remove-file {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 5px;
        }
        
        /* æ”¹è¿›çš„å¯¼èˆªæ ç§»åŠ¨ç«¯é€‚é… */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            nav {
                display: none;
                width: 100%;
                margin-top: 15px;
            }
            
            nav.active {
                display: block;
            }
            
            nav ul {
                flex-direction: column;
                gap: 5px;
            }
            
            nav li {
                width: 100%;
            }
            
            nav a {
                width: 100%;
                justify-content: center;
                padding: 12px;
            }
        }
        
        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        .touch-device .video-card:hover,
        .touch-device .exercise-card:hover {
            transform: none;
        }
        
        .touch-device .play-button {
            min-height: 44px;
            min-width: 44px;
        }
        
        .touch-device .upload-btn,
        .touch-device .start-btn,
        .touch-device .add-grade-btn {
            min-height: 44px;
            padding: 12px 20px;
        }
        
        .touch-device nav a {
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* æˆåŠŸæç¤º */
        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .success-message.show {
            transform: translateX(0);
        }
        
        /* é”™è¯¯æç¤º */
        .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .error-message.show {
            transform: translateX(0);
        }
        
        /* æ•°æ®è¡¨æ ¼å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .data-table-container {
                overflow-x: auto;
            }
            
            .data-table-container table {
                min-width: 600px;
                font-size: 14px;
            }
            
            .data-table-container th,
            .data-table-container td {
                padding: 8px 6px !important;
            }
        }
        
        @media (max-width: 480px) {
            .data-table-container table {
                min-width: 500px;
                font-size: 12px;
            }
            
            .data-table-container th,
            .data-table-container td {
                padding: 6px 4px !important;
            }
        }
        
        /* ==================== ç¾åŒ–æ ·å¼å¢å¼º ==================== */
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* æ”¹è¿›çš„æ¶ˆæ¯æç¤º */
        .message-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .message-toast.show {
            transform: translateX(0);
        }
        
        .message-toast.success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .message-toast.error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .message-toast.warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        
        .message-toast.info {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        /* æ”¹è¿›çš„è§†é¢‘å¡ç‰‡ */
        .video-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .video-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }
        
        .video-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .video-card:hover::before {
            opacity: 1;
        }
        
        /* æ”¹è¿›çš„é¢˜åº“å¡ç‰‡ */
        .exercise-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .exercise-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            border-color: var(--secondary);
        }
        
        .exercise-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .exercise-card:hover::before {
            opacity: 1;
        }
        
        /* æ”¹è¿›çš„æŒ‰é’®æ ·å¼ */
        .btn-primary, .upload-btn-primary, .exercise-btn {
            background: linear-gradient(135deg, var(--primary), #1976D2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover, .upload-btn-primary:hover, .exercise-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.3);
        }
        
        .btn-primary::before, .upload-btn-primary::before, .exercise-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before, .upload-btn-primary:hover::before, .exercise-btn:hover::before {
            left: 100%;
        }
        
        /* æ”¹è¿›çš„æ¨¡æ€æ¡† */
        .modal-backdrop {
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            background: rgba(0,0,0,0.6);
        }
        
        .modal-content {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            animation: modalSlideIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* æ”¹è¿›çš„è¾“å…¥æ¡† */
        .upload-form-group input, .upload-form-group textarea, .upload-form-group select {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
        }
        
        .upload-form-group input:focus, .upload-form-group textarea:focus, .upload-form-group select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            background: white;
        }
        
        /* æ”¹è¿›çš„è¿›åº¦æ¡ */
        .progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* æ”¹è¿›çš„æ ‡ç­¾ */
        .video-meta span, .exercise-meta span {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #495057;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-indicator.online {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
        }
        
        .status-indicator.offline {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }
        
        .status-indicator.warning {
            background: rgba(255, 152, 0, 0.1);
            color: #ff9800;
        }
        
        /* è®¾ç½®æŒ‰é’®æ ·å¼ */
        .settings-btn {
            background: none;
            border: none;
            color: #666;
            margin-right: 15px;
            cursor: pointer;
            font-size: 16px;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .settings-btn:hover {
            background: rgba(0,0,0,0.1);
            color: var(--primary);
        }
        
        .settings-btn:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* å¼ºåˆ¶æ‰€æœ‰inputæ˜¾ç¤ºæ ‡ç­¾ */
        input:not([aria-label]):not([aria-labelledby]) {
            border: 2px solid red !important;
        }
        
        input:not([aria-label]):not([aria-labelledby])::before {
            content: "ç¼ºå°‘æ ‡ç­¾!" !important;
            color: red !important;
        }
        
        /* ç¡®ä¿æ‰€æœ‰è¡¨å•å…ƒç´ å¯è®¿é—®æ€§ */
        .login-form input,
        .upload-form input,
        .grade-form input {
            position: relative;
        }
        
        /* ä¸ºåŠ¨æ€ç”Ÿæˆçš„å…ƒç´ æ·»åŠ é»˜è®¤æ ‡ç­¾ */
        input[placeholder]:not([aria-label]) {
            aria-label: attr(placeholder);
        }
        
        /* ç»ƒä¹ æ¨¡æ€æ¡†æ ·å¼ */
        .exercise-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
        }
        
        .exercise-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .exercise-header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exercise-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .exercise-progress {
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ee5a52);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .exercise-body {
            padding: 30px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .question-container {
            text-align: center;
        }
        
        .question-number {
            font-size: 18px;
            font-weight: 600;
            color: #ff6b6b;
            margin-bottom: 20px;
        }
        
        .question-text {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 30px;
            color: #333;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #ff6b6b;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: left;
        }
        
        .answer-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .answer-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .answer-input input:focus {
            outline: none;
            border-color: #ff6b6b;
        }
        
        .check-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        
        .check-btn:hover {
            transform: translateY(-2px);
        }
        
        .answer-feedback {
            margin-top: 20px;
        }
        
        .feedback {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .feedback.correct {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .feedback.incorrect {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .feedback i {
            margin-right: 8px;
            font-size: 18px;
        }
        
        .correct-answer {
            margin: 10px 0;
            font-size: 16px;
        }
        
        .explanation {
            margin-top: 10px;
            font-style: italic;
            opacity: 0.8;
        }
        
        .exercise-controls {
            padding: 20px 30px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            position: sticky;
            bottom: 0;
            z-index: 100;
        }
        
        .nav-btn, .hint-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .nav-btn:not(:disabled):hover {
            transform: translateY(-2px);
        }
        
        .hint-btn {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }
        
        .hint-btn:hover {
            transform: translateY(-2px);
        }
        
        /* ç»ƒä¹ ç»“æœæ¨¡æ€æ¡† */
        .exercise-result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
        }
        
        .result-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .result-header h2 {
            color: #ff6b6b;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .result-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .result-message {
            font-size: 18px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .restart-btn, .result-actions .close-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }
        
        .restart-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        
        .result-actions .close-btn {
            background: linear-gradient(135deg, #757575, #616161);
            color: white;
        }
        
        .restart-btn:hover, .result-actions .close-btn:hover {
            transform: translateY(-2px);
        }
        
        /* ==================== å…¨é¢å“åº”å¼è®¾è®¡ ==================== */
        
        /* å¤§å±å¹•è®¾å¤‡ (1200px+) */
        @media (min-width: 1200px) {
            .container {
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .basic-login-box {
                max-width: 480px;
                padding: 60px 50px;
            }
            
            .basic-login-box h1 {
                font-size: 32px;
            }
        }
        
        /* ä¸­ç­‰å±å¹•è®¾å¤‡ (768px - 1199px) */
        @media (max-width: 1199px) and (min-width: 768px) {
            .container {
                max-width: 960px;
                margin: 0 auto;
            }
            
            .basic-login-box {
                max-width: 450px;
                padding: 50px 40px;
            }
        }
        
        /* å¹³æ¿è®¾å¤‡ (768px) */
        @media (max-width: 768px) {
            .basic-login-box {
                width: 95%;
                padding: 40px 30px;
                margin: 20px;
            }
            
            .basic-login-box h1 {
                font-size: 24px;
            }
            
            .basic-login-box p {
                font-size: 14px;
            }
            
            .basic-login-box input {
                padding: 16px 18px;
                font-size: 16px;
            }
            
            .basic-login-box button {
                padding: 16px;
                font-size: 16px;
            }
            
            /* å¹³å°ç•Œé¢å“åº”å¼ */
            .container {
                padding: 0 15px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-menu {
                flex-direction: column;
                gap: 10px;
            }
            
            .featured-banner {
                font-size: 16px;
                padding: 15px;
            }
            
            .section-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .video-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 15px;
            }
            
            .exercise-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .exercise-content {
                width: 95%;
                margin: 20px;
            }
            
            .exercise-header, .exercise-progress, .exercise-body, .exercise-controls {
                padding: 15px 20px;
            }
            
            .answer-input {
                flex-direction: column;
            }
            
            .exercise-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .result-stats {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        /* æ‰‹æœºè®¾å¤‡ (480px) */
        @media (max-width: 480px) {
            .basic-login-box {
                width: 98%;
                padding: 30px 20px;
                margin: 10px;
            }
            
            .basic-login-box h1 {
                font-size: 22px;
            }
            
            .basic-login-box p {
                font-size: 13px;
            }
            
            .basic-login-box input {
                padding: 14px 16px;
                font-size: 16px;
            }
            
            .basic-login-box button {
                padding: 14px;
                font-size: 16px;
            }
            
            /* å¹³å°ç•Œé¢æ‰‹æœºé€‚é… */
            .container {
                padding: 0 10px;
            }
            
            .header-top {
                padding: 10px;
            }
            
            .logo {
                font-size: 18px;
            }
            
            .nav-menu {
                font-size: 14px;
            }
            
            .featured-banner {
                font-size: 14px;
                padding: 12px;
            }
            
            .section-card {
                padding: 15px;
            }
            
            .section-card h3 {
                font-size: 18px;
            }
            
            .video-card {
                padding: 15px;
            }
            
            .video-card h3 {
                font-size: 16px;
            }
            
            .exercise-card {
                padding: 15px;
            }
            
            .exercise-card h3 {
                font-size: 16px;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px;
                padding: 20px;
            }
            
            .upload-form-group {
                margin-bottom: 15px;
            }
            
            .upload-buttons {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        /* è¶…å°å±å¹•è®¾å¤‡ (320px) */
        @media (max-width: 320px) {
            .basic-login-box {
                width: 100%;
                padding: 25px 15px;
                margin: 5px;
                border-radius: 15px;
            }
            
            .basic-login-box h1 {
                font-size: 20px;
            }
            
            .basic-login-box p {
                font-size: 12px;
            }
            
            .basic-login-box input {
                padding: 12px 14px;
                font-size: 16px;
            }
            
            .basic-login-box button {
                padding: 12px;
                font-size: 16px;
            }
            
            .basic-quick-btn {
                font-size: 12px !important;
                padding: 10px !important;
            }
        }
        
        /* æ¨ªå±æ¨¡å¼é€‚é… */
        @media (orientation: landscape) and (max-height: 500px) {
            .basic-login-box {
                padding: 25px 30px;
                margin: 10px;
            }
            
            .basic-login-box h1 {
                font-size: 20px;
                margin-bottom: 5px;
            }
            
            .basic-login-box p {
                font-size: 12px;
                margin-bottom: 20px;
            }
            
            .basic-login-box input {
                padding: 12px 16px;
                margin-bottom: 15px;
            }
            
            .basic-login-box button {
                padding: 12px;
                margin-bottom: 10px;
            }
        }
        
        /* é«˜åˆ†è¾¨ç‡å±å¹•é€‚é… */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .basic-login-box {
                border: 0.5px solid rgba(255, 255, 255, 0.2);
            }
            
            .basic-login-box input {
                border-width: 1px;
            }
            
            .basic-login-box button {
                border-width: 1px;
            }
        }
        
        /* æ·±è‰²æ¨¡å¼æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            .basic-login-box {
                background: rgba(30, 30, 30, 0.95);
                color: #ffffff;
            }
            
            .basic-login-box h1 {
                color: #ffffff;
            }
            
            .basic-login-box p {
                color: #cccccc;
            }
            
            .basic-login-box input {
                background: rgba(50, 50, 50, 0.9);
                border-color: #444444;
                color: #ffffff;
            }
            
            .basic-login-box input::placeholder {
                color: #888888;
            }
            
            .basic-quick-btn {
                background: rgba(50, 50, 50, 0.9) !important;
                color: #ffffff !important;
                border-color: #444444 !important;
            }
            
            .basic-quick-btn:hover {
                background: rgba(70, 70, 70, 0.9) !important;
            }
        }
        
        /* å‡å°‘åŠ¨ç”»åå¥½ */
        @media (prefers-reduced-motion: reduce) {
            .basic-login-system::before {
                animation: none;
            }
            
            .basic-login-box {
                animation: none;
            }
            
            .basic-login-box button::before {
                animation: none;
            }
            
            .basic-error {
                animation: none;
            }
            
            .basic-success {
                animation: none;
            }
            
            .basic-login-box button:hover {
                transform: none;
            }
            
            .basic-quick-btn:hover {
                transform: none !important;
            }
        }
    </style>
</head>
<body id="appBody">
    <!-- æ°´å°ä¿æŠ¤å±‚ -->
    <div class="watermark-overlay" id="watermarkOverlay"></div>
    
    <!-- åè°ƒè¯•ä¿æŠ¤ -->
    <div class="anti-debug" id="antiDebug"></div>
    
        <!-- ==================== ç°ä»£åŒ–ç™»å½•ç³»ç»Ÿ ==================== -->
    <div class="basic-login-system" id="loginContainer">
        <div class="basic-login-box">
            <!-- å¹³å°Logoå’Œæ ‡é¢˜ -->
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);">
                    <i class="fas fa-water" style="font-size: 36px; color: white;"></i>
                </div>
                <h1>æµä½“åŠ›å­¦å­¦ä¹ å¹³å°</h1>
                <p>ä¸­å›½æµ·æ´‹å¤§å­¦ | 803æµä½“åŠ›å­¦</p>
            </div>
            
            <!-- æ¶ˆæ¯æç¤ºåŒºåŸŸ -->
            <div class="basic-error" id="basicErrorMsg" style="display: none;"></div>
            <div class="basic-success" id="basicSuccessMsg" style="display: none;"></div>
            
            <!-- ç™»å½•è¡¨å• -->
            <form id="loginForm" onsubmit="event.preventDefault(); basicLogin();">
                <div style="position: relative; margin-bottom: 20px;">
                    <i class="fas fa-user" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #95a5a6; z-index: 2;"></i>
                    <input type="text" id="basicUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" style="padding-left: 45px;" autocomplete="username" required>
                </div>
                
                <div style="position: relative; margin-bottom: 25px;">
                    <i class="fas fa-lock" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #95a5a6; z-index: 2;"></i>
                    <input type="password" id="basicPassword" placeholder="è¯·è¾“å…¥å¯†ç " style="padding-left: 45px;" autocomplete="current-password" required>
                </div>
                
                <button type="submit" id="basicLoginBtn">
                    <span id="loginBtnText">ç™»å½•</span>
                    <span id="loginBtnLoading" class="loading" style="display: none;"></span>
                </button>
            </form>
            
            <!-- å¿«é€Ÿç™»å½•æŒ‰é’® -->
            <div style="margin-top: 25px;">
                <button class="basic-quick-btn" onclick="basicQuickTeacher()">
                    <i class="fas fa-chalkboard-teacher" style="margin-right: 8px;"></i>
                    æ•™å¸ˆå¿«é€Ÿç™»å½•
                </button>
                <button class="basic-quick-btn" onclick="basicQuickStudent()">
                    <i class="fas fa-user-graduate" style="margin-right: 8px;"></i>
                    å­¦ç”Ÿå¿«é€Ÿç™»å½•
                </button>
                <button class="basic-quick-btn" onclick="basicShowDebug()">
                    <i class="fas fa-bug" style="margin-right: 8px;"></i>
                    è°ƒè¯•ä¿¡æ¯
                </button>
            </div>
            
            <!-- åº•éƒ¨é“¾æ¥ -->
            <div style="text-align: center; margin-top: 25px; padding-top: 20px; border-top: 1px solid #e1e8ed;">
                <a href="#" onclick="showChangePasswordModal()" style="color: #667eea; text-decoration: none; font-weight: 500; transition: color 0.3s ease;">
                    <i class="fas fa-key" style="margin-right: 5px;"></i>
                    ä¿®æ”¹å¯†ç 
                </a>
                <span style="margin: 0 10px; color: #bdc3c7;">|</span>
                <a href="#" onclick="showHelpModal()" style="color: #667eea; text-decoration: none; font-weight: 500; transition: color 0.3s ease;">
                    <i class="fas fa-question-circle" style="margin-right: 5px;"></i>
                    å¸®åŠ©
                </a>
            </div>
            
            <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
            <div style="text-align: center; margin-top: 15px; font-size: 12px; color: #95a5a6;">
                <span>ç‰ˆæœ¬ 2.1.0 | ä¸­å›½æµ·æ´‹å¤§å­¦</span>
            </div>
        </div>
    </div>
    
    <!-- ä¿®æ”¹å¯†ç æ¨¡æ€æ¡† -->
    <div class="modal-backdrop" id="changePasswordModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> ä¿®æ”¹å¯†ç </h3>
                <button class="close-modal" 
                        onclick="closeChangePasswordModal()"
                        aria-label="å…³é—­ä¿®æ”¹å¯†ç å¯¹è¯æ¡†"
                        title="å…³é—­">&times;</button>
            </div>
            <form id="changePasswordForm" style="padding: 20px;" novalidate>
                <div class="upload-form-group">
                    <label for="changeUsername">ç”¨æˆ·å</label>
                    <input type="text" 
                           id="changeUsername" 
                           name="changeUsername"
                           placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                           autocomplete="username"
                           required
                           aria-label="ç”¨æˆ·å">
                </div>
                
                <div class="upload-form-group">
                    <label for="currentPassword">å½“å‰å¯†ç </label>
                    <input type="password" 
                           id="currentPassword" 
                           name="currentPassword"
                           placeholder="è¯·è¾“å…¥å½“å‰å¯†ç "
                           autocomplete="current-password"
                           required
                           aria-label="å½“å‰å¯†ç ">
                </div>
                
                <div class="upload-form-group">
                    <label for="newPassword">æ–°å¯†ç </label>
                    <input type="password" 
                           id="newPassword" 
                           name="newPassword"
                           placeholder="è¯·è¾“å…¥æ–°å¯†ç "
                           autocomplete="new-password"
                           required
                           aria-label="æ–°å¯†ç ">
                </div>
                
                <div class="upload-form-group">
                    <label for="confirmPassword">ç¡®è®¤æ–°å¯†ç </label>
                    <input type="password" 
                           id="confirmPassword" 
                           name="confirmPassword"
                           placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç "
                           autocomplete="new-password"
                           required
                           aria-label="ç¡®è®¤æ–°å¯†ç ">
                </div>
                
                <div class="upload-buttons">
                    <button type="button" 
                            class="upload-btn-secondary" 
                            onclick="closeChangePasswordModal()"
                            aria-label="å–æ¶ˆä¿®æ”¹å¯†ç ">å–æ¶ˆ</button>
                    <button type="submit" 
                            class="upload-btn-primary"
                            aria-label="ç¡®è®¤ä¿®æ”¹å¯†ç ">ç¡®è®¤ä¿®æ”¹</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- å¹³å°ç•Œé¢ï¼ˆç™»å½•åæ˜¾ç¤ºï¼‰ -->
    <div id="platformContainer" style="display: none;">
        <header>
            <div class="featured-banner">
                ä»Šæ—¥æ¨èï¼šæµä½“åŠ›å­¦ä¹‹ç¾ - æ¢ç´¢æµåŠ¨ä¸–ç•Œçš„å¥¥ç§˜
            </div>
            <div class="container">
                <div class="header-top">
                    <div class="logo" onclick="switchSection('review-section')">
                        <i class="fas fa-water"></i>
                        <h1>æµä½“åŠ›å­¦å­¦ä¹ å¹³å°</h1>
                    </div>
                    
                    <button class="mobile-menu-toggle" 
                            onclick="toggleMobileMenu()"
                            aria-label="åˆ‡æ¢ç§»åŠ¨ç«¯èœå•"
                            title="èœå•">
                        <i class="fas fa-bars" aria-hidden="true"></i>
                    </button>
                    
                    <nav id="mainNav">
                        <ul>
                            <li><a href="#" onclick="switchSection('review-section')" class="active"><i class="fas fa-book"></i> å¤ä¹ è§„åˆ’</a></li>
                            <li><a href="#" onclick="switchSection('video-section')"><i class="fas fa-video"></i> è§†é¢‘è¯¾ç¨‹</a></li>
                            <li><a href="#" onclick="switchSection('question-section')"><i class="fas fa-question-circle"></i> é¢˜åº“ç»ƒä¹ </a></li>
                            <li><a href="#" onclick="switchSection('score-section')"><i class="fas fa-chart-line"></i> åˆ†æ•°çº¿</a></li>
                            <li><a href="#" onclick="switchSection('grade-section')"><i class="fas fa-graduation-cap"></i> æˆç»©å½•å…¥</a></li>
                        </ul>
                    </nav>
                    
                    <div class="user-menu">
                        <div id="githubStatus" class="status-indicator offline" style="margin-right: 10px;">
                            <i class="fas fa-cloud-slash"></i>
                            <span>åœ¨çº¿æ¨¡å¼</span>
                        </div>
                        <button id="githubSettingsBtn"
                                onclick="window.open('github-setup.html', '_blank')" 
                                class="settings-btn"
                                title="é…ç½®GitHubåå°"
                                aria-label="é…ç½®GitHubåå°è®¾ç½®">
                            <i class="fas fa-cog" aria-hidden="true"></i>
                        </button>
                        <div class="user-info" id="userInfo">
                            <div class="user-icon" id="userIcon">åˆ˜</div>
                            <div>
                                <span id="usernameText">åˆ˜å…‰è¾‰</span>
                                <span id="roleBadge" class="role-badge teacher-badge">æ•™å¸ˆ</span>
                            </div>
                            <button class="logout-btn" 
                                    title="é€€å‡ºç™»å½•" 
                                    aria-label="é€€å‡ºç™»å½•"
                                    onclick="logout()">
                                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-content container">
            <!-- å¤ä¹ è§„åˆ’æ¿å— -->
            <section id="review-section" class="content-section active">
                <div class="section-title">
                    <i class="fas fa-book"></i> ä¸“ä¸šè¯¾å¤ä¹ è§„åˆ’ (803æµä½“åŠ›å­¦)
                </div>
                
                <div class="university-info">
                    <div class="info-grid">
                                    <div class="info-card">
                <h3><i class="fas fa-university"></i> é™¢æ ¡ä¸“ä¸šæƒ…å†µç®€è¿°</h3>
                <p><strong>2025å¹´æ‹›ç”Ÿæƒ…å†µï¼š</strong></p>
                <p>â€¢ ç»Ÿè€ƒåé¢ï¼š38äººï¼ˆé»˜è®¤ï¼‰â†’ 35äººï¼ˆå¤è¯•æ—¶ï¼‰</p>
                <p>â€¢ è°ƒå‰‚åé¢ï¼š0äºº</p>
                <p>â€¢ å¤è¯•äººæ•°ï¼š35äºº</p>
                <p>â€¢ å½•å–äººæ•°ï¼š35äºº</p>
                <p>â€¢ å¤è¯•æ¯”ä¾‹ï¼š1.0</p>
                <p>â€¢ ä¸“ä¸šæŠ¥åäººæ•°ï¼š125äºº</p>
                <p>â€¢ å½•å–ç‡ï¼š28.0%</p>
                <p>â€¢ åˆ†æ•°çº¿ï¼š274åˆ†ï¼ˆå›½å®¶çº¿ï¼‰</p>
            </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-graduation-cap"></i> è€ƒè¯•è¦æ±‚</h3>
                            <p>è¦æ±‚è€ƒç”Ÿèƒ½ç³»ç»Ÿç†è§£æµä½“åŠ›å­¦çš„åŸºæœ¬æ¦‚å¿µå’ŒåŸºæœ¬åŸç†ï¼ŒæŒæ¡æµä½“åŠ›å­¦çš„åŸºæœ¬æ€æƒ³ä¸æ–¹æ³•ï¼Œå…·æœ‰è¾ƒå¥½çš„æµä½“åŠ›å­¦çŸ¥è¯†ä»¥åŠè¿ç”¨æ‰€å­¦çŸ¥è¯†åˆ†æé—®é¢˜å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚</p>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-file-alt"></i> è€ƒè¯•å½¢å¼</h3>
                            <p>é—­å·è€ƒè¯•ï¼Œæ»¡åˆ†150åˆ†ï¼Œè€ƒè¯•æ—¶é—´180åˆ†é’Ÿ</p>
                            <p>åŸºç¡€ç†è®ºï¼ˆ40%ï¼‰ï¼Œç†æƒ³æµä½“ï¼ˆ30%ï¼‰ï¼Œç²˜æ€§æµä½“ï¼ˆ30%ï¼‰</p>
                        </div>
                    </div>
                    
                    <div class="info-grid" style="margin-top: 25px;">
                        <div class="info-card">
                            <h3><i class="fas fa-book-open"></i> åˆè¯•å‚è€ƒä¹¦ç›®</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>æµä½“åŠ›å­¦ï¼ˆç¬¬äºŒç‰ˆï¼‰</strong>
                                    <p>å´æœ›ä¸€ | åŒ—äº¬å¤§å­¦å‡ºç‰ˆç¤¾ | 2021å¹´</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-book"></i> åˆè¯•è¾…åŠ©ä¹¦ç±</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>æµä½“åŠ›å­¦ï¼ˆç¬¬äºŒç‰ˆï¼‰</strong>
                                    <p>å‘¨å…‰ç‚¯ | é«˜ç­‰æ•™è‚²å‡ºç‰ˆç¤¾</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-book"></i> å¤è¯•å‚è€ƒä¹¦ç›®</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>ç‰©ç†æµ·æ´‹å­¦</strong>
                                    <p>è‘£æ˜Œæ˜ | ç§‘å­¦å‡ºç‰ˆç¤¾ | 2019å¹´</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-tips">
                        <h3><i class="fas fa-lightbulb"></i> å¤ä¹ å»ºè®®</h3>
                        <p><strong>åŸºç¡€é˜¶æ®µï¼š</strong>å­¦ä¹ åŸºç¡€çŸ¥è¯†ï¼Œå…ˆè¯»æµä½“åŠ›å­¦ç¬¬äºŒç‰ˆï¼Œçœ‹éƒ‘æ¡‚çç½‘è¯¾</p>
                        <p><strong>å¼ºåŒ–é˜¶æ®µï¼š</strong>åŸºç¡€çŸ¥è¯†ä¸²è®²ï¼Œå¸¦ç»ƒ</p>
                        <p><strong>çœŸé¢˜é˜¶æ®µï¼š</strong>çœŸé¢˜åšä¸¤éï¼Œé‡ç‚¹çœŸé¢˜è®²è§£</p>
                        <p><strong>å¤è¯•å‡†å¤‡ï¼š</strong>ç‰©ç†æµ·æ´‹å­¦å å¤è¯•å†…å®¹çš„80%ï¼Œéœ€é‡ç‚¹å¤ä¹ </p>
                    </div>
                </div>
                
                <div class="review-planner" style="margin-top: 25px;">
                    <div class="planner-header">
                        <h3><i class="fas fa-calendar-alt"></i> ä¸“ä¸šè¯¾å¤ä¹ æ—¶é—´è¡¨</h3>
                        <div class="progress-header">
                            <span>å®Œæˆè¿›åº¦ï¼š35%</span>
                        </div>
                    </div>
                    
                    <div class="timeline-container">
                        <div class="timeline-month">
                            <h3 class="month-title">7æœˆ - åŸºç¡€å·©å›º</h3>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬1å‘¨</div>
                                <div class="plan-content">
                                    <h4>æµä½“çš„ç‰©ç†æ€§è´¨</h4>
                                    <p>è¿ç»­ä»‹è´¨æ¨¡å‹ã€ç‰›é¡¿æµä½“ä¸éç‰›é¡¿æµä½“ã€æµä½“çš„ç²˜æ»æ€§</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check completed"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬2å‘¨</div>
                                <div class="plan-content">
                                    <h4>æœ¬æ„æ–¹ç¨‹å’Œäº¥å§†éœå…¹å®šç†</h4>
                                    <p>åº”åŠ›å¼ é‡ã€æœ¬æ„æ–¹ç¨‹ã€é€Ÿåº¦åˆ†è§£å®šç†</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check completed"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬3-4å‘¨</div>
                                <div class="plan-content">
                                    <h4>ç†æƒ³æµä½“åŠ¨é‡æ–¹ç¨‹</h4>
                                    <p>æ¬§æ‹‰æ–¹ç¨‹ã€ä¼¯åŠªåˆ©æ–¹ç¨‹åŠåº”ç”¨</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">8æœˆ - æ ¸å¿ƒåŸç†</h3>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬1å‘¨</div>
                                <div class="plan-content">
                                    <h4>æµä½“åŠ›å­¦æ–¹ç¨‹ç»„</h4>
                                    <p>è¿ç»­æ€§æ–¹ç¨‹ã€åŠ¨é‡æ–¹ç¨‹ã€èƒ½é‡æ–¹ç¨‹</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬2å‘¨</div>
                                <div class="plan-content">
                                    <h4>æ¶¡æ—‹è¿åŠ¨</h4>
                                    <p>æ¶¡é‡ã€ç¯é‡ã€æ¶¡æ—‹è¿åŠ¨åŸºæœ¬å®šç†</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬3-4å‘¨</div>
                                <div class="plan-content">
                                    <h4>åŠ¿æµç†è®ºåŸºç¡€</h4>
                                    <p>é€Ÿåº¦åŠ¿å‡½æ•°ã€æµå‡½æ•°ã€åŸºæœ¬åŠ¿æµå åŠ åŸç†</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">9æœˆ - ä¸“é¢˜æ·±åŒ–</h3>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬1-2å‘¨</div>
                                <div class="plan-content">
                                    <h4>åŠ¿æµç†è®ºæ·±åŒ–</h4>
                                    <p>å¸ƒæ‹‰ä¿®æ–¯å®šç†ã€é•œåƒæ³•ã€æœºç¿¼ç†è®º</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">10æœˆ - åº”ç”¨å®è·µ</h3>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬1å‘¨</div>
                                <div class="plan-content">
                                    <h4>ç›¸ä¼¼åŸç†ä¸é‡çº²åˆ†æ</h4>
                                    <p>é‡çº²é½æ¬¡æ€§åŸç†ã€Ï€å®šç†åº”ç”¨ã€æµåŠ¨ç›¸ä¼¼å‡†æ•°</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">ç¬¬2-4å‘¨</div>
                                <div class="plan-content">
                                    <h4>ç²˜æ€§æµä½“ç†è®º</h4>
                                    <p>NSæ–¹ç¨‹ã€å±‚æµä¸æ¹æµã€è¾¹ç•Œå±‚ç†è®º</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">11-12æœˆ - çœŸé¢˜å†²åˆº</h3>
                            <div class="plan-item">
                                <div class="week-label">11æœˆ</div>
                                <div class="plan-content">
                                    <h4>çœŸé¢˜ç²¾è®²</h4>
                                    <p>å†å¹´çœŸé¢˜è§£æä¸è€ƒç‚¹å½’çº³</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">12æœˆ</div>
                                <div class="plan-content">
                                    <h4>é”™é¢˜ä¸²è®²</h4>
                                    <p>é«˜é¢‘é”™é¢˜åˆ†æä¸è§£é¢˜æŠ€å·§</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="review-planner" style="margin-top: 25px;">
                    <div class="planner-header">
                        <h3><i class="fas fa-tasks"></i> è¯¾åå¤ä¹ æ³¨æ„äº‹é¡¹</h3>
                    </div>
                    
                    <div class="review-notes">
                        <h4>å¤ä¹ è§„åˆ’è¡¥å……è¯´æ˜</h4>
                        <ul>
                            <li>éœ€ä¿è¯è´¨é‡å®Œæˆè¯¾åä»»åŠ¡ï¼Œ9æœˆå¯ä»¥å¼€å§‹å°è¯•åšçœŸé¢˜</li>
                            <li>ä¸ä¼šçš„çœŸé¢˜å¯ä»¥é€šè¿‡å¾®ä¿¡ç¾¤æˆ–è¯¾å ‚æé—®</li>
                            <li>æ¯å‘¨è‡³å°‘æŠ•å…¥10å°æ—¶è¿›è¡Œä¸“ä¸šè¯¾å¤ä¹ </li>
                            <li>é‡ç‚¹æŒæ¡ä¼¯åŠªåˆ©æ–¹ç¨‹ã€NSæ–¹ç¨‹å’Œè¾¹ç•Œå±‚ç†è®º</li>
                            <li>å…³æ³¨ç‰©ç†æµ·æ´‹å­¦åœ¨å¤è¯•ä¸­çš„é‡è¦æ€§ï¼ˆå 80%ï¼‰</li>
                        </ul>
                    </div>
                    
                    <div class="review-notes">
                        <h4>ä¸Šè¯¾è§„åˆ’è¯´æ˜</h4>
                        <ul>
                            <li>æ€»è¯¾æ—¶ä¸º20å°æ—¶</li>
                            <li>è¯¾ç¨‹å®‰æ’ä¸ºåˆæ­¥è®¡åˆ’ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µåå•†è°ƒæ•´</li>
                            <li>å¦‚æœ‰äº‹éœ€è°ƒæ•´ä¸Šè¯¾æ—¶é—´ï¼Œè‡³å°‘æå‰ä¸€å¤©å‘ŠçŸ¥å¯¹æ–¹</li>
                            <li>è¯¾åä½œä¸šéœ€ä¿è¯è´¨é‡å®Œæˆ</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- è§†é¢‘è¯¾ç¨‹æ¿å— -->
            <section id="video-section" class="content-section">
                <div class="section-title">
                    <i class="fas fa-video"></i> æµä½“åŠ›å­¦è§†é¢‘è¯¾ç¨‹
                </div>
                
                <div class="video-grid">
                    <div class="video-card featured">
                        <div class="video-preview">
                            <i class="fab fa-tiktok" style="color: #ff0050;"></i>
                            <div class="featured-tag">
                                <i class="fas fa-star"></i> å¹³å°æ¨è
                            </div>
                            <div class="platform-badge" style="position: absolute; top: 10px; right: 10px; background: #ff0050; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                <i class="fab fa-tiktok"></i> æŠ–éŸ³
                            </div>
                            <div class="play-button" onclick="openDouyinVideo('https://v.douyin.com/7vrVT-4KmbI/')">
                                <i class="fab fa-tiktok"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">åŠ¨é‡è¾“è¿ã€ç‰›é¡¿å†…æ‘©æ“¦å®šå¾‹ã€æ¬§æ‹‰åæ ‡</h3>
                            <p class="video-description">è¯¦ç»†è®²è§£æµä½“åŠ›å­¦ä¸­çš„åŠ¨é‡è¾“è¿åŸç†ã€ç‰›é¡¿å†…æ‘©æ“¦å®šå¾‹çš„ç‰©ç†æ„ä¹‰å’Œæ•°å­¦è¡¨è¾¾ï¼Œä»¥åŠæ¬§æ‹‰åæ ‡ç³»ç»Ÿåœ¨æµä½“è¿åŠ¨æè¿°ä¸­çš„åº”ç”¨ã€‚æ·±å…¥ç†è§£æµä½“å†…éƒ¨çš„åŠ¨é‡ä¼ é€’æœºåˆ¶å’Œç²˜æ€§æ•ˆåº”ã€‚</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> æŠ–éŸ³è§†é¢‘</div>
                                <div><i class="fab fa-tiktok" style="color: #ff0050;"></i> æ•™å¸ˆåŸåˆ›</div>
                                <div><i class="fas fa-star" style="color: #ffd700;"></i> ç²¾å“å†…å®¹</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fab fa-tiktok" style="color: #ff0050;"></i>
                            <div class="platform-badge" style="position: absolute; top: 10px; right: 10px; background: #ff0050; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                <i class="fab fa-tiktok"></i> æŠ–éŸ³
                            </div>
                            <div class="play-button" onclick="openDouyinVideo('https://v.douyin.com/X-ud2xkwvII/')">
                                <i class="fab fa-tiktok"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">æ¬§æ‹‰ã€æ‹‰æ ¼æœ—æ—¥åæ ‡ç³»ç»Ÿ</h3>
                            <p class="video-description">å…¨é¢å¯¹æ¯”æ¬§æ‹‰åæ ‡å’Œæ‹‰æ ¼æœ—æ—¥åæ ‡ä¸¤ç§æè¿°æµä½“è¿åŠ¨çš„æ–¹æ³•ï¼Œè¯¦è§£æµçº¿å’Œè¿¹çº¿çš„æ¦‚å¿µä¸åŒºåˆ«ï¼Œå¸®åŠ©ç†è§£æµä½“è¿åŠ¨çš„æ•°å­¦æè¿°å’Œç‰©ç†æ„ä¹‰ã€‚</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> æŠ–éŸ³è§†é¢‘</div>
                                <div><i class="fab fa-tiktok" style="color: #ff0050;"></i> æ•™å¸ˆåŸåˆ›</div>
                                <div><i class="fas fa-star" style="color: #ffd700;"></i> ç²¾å“å†…å®¹</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fas fa-water"></i>
                            <div class="platform-badge" style="position: absolute; top: 10px; right: 10px; background: #00bcd4; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                <i class="fab fa-bilibili"></i> Bç«™
                            </div>
                            <div class="play-button" onclick="openVideoModal('BV16T421D7k4')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">æµä½“åŠ›å­¦ä¹‹ç¾ï¼Œå¤ªç¾äº†</h3>
                            <p class="video-description">æ¢ç´¢æµä½“ä¸–ç•Œçš„å¥‡å¦™ç°è±¡ä¸ç§‘å­¦åŸç†ï¼Œæ­ç¤ºè‡ªç„¶ç•Œçš„æµåŠ¨è‰ºæœ¯ã€‚æœ¬è¯¾ç¨‹é€šè¿‡é«˜æ¸…å®éªŒæ¼”ç¤ºå’Œè®¡ç®—æœºæ¨¡æ‹Ÿï¼Œå±•ç¤ºæµä½“åœ¨ä¸åŒæ¡ä»¶ä¸‹çš„åŠ¨æ€è¡Œä¸ºï¼Œå¸®åŠ©ç†è§£æµä½“åŠ›å­¦åœ¨èˆªç©ºèˆªå¤©ã€èˆ¹èˆ¶è®¾è®¡ç­‰é¢†åŸŸçš„åº”ç”¨ã€‚</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 18:45</div>
                                <div><i class="fab fa-bilibili" style="color: #00bcd4;"></i> Bç«™ç²¾é€‰</div>
                                <div><i class="far fa-eye"></i> 32,458 æ¬¡è§‚çœ‹</div>
                            </div>
                        </div>
                    </div>
 
                </div>
            </section>
            
            <!-- åˆ†æ•°çº¿æ¿å— -->
            <section id="score-section" class="content-section">
                <div class="section-title">
                    <i class="fas fa-chart-line"></i> å›½å®¶çº¿å’Œå¤è¯•çº¿å¯¹æ¯”åˆ†æ
                </div>
                
                <div class="score-filters">
                                            <button class="filter-btn active" 
                                data-year="all"
                                aria-label="æ˜¾ç¤ºå…¨éƒ¨å¹´ä»½"
                                title="å…¨éƒ¨å¹´ä»½">å…¨éƒ¨å¹´ä»½</button>
                        <button class="filter-btn" 
                                data-year="2020"
                                aria-label="ç­›é€‰2020å¹´å†…å®¹"
                                title="2020å¹´">2020å¹´</button>
                        <button class="filter-btn" 
                                data-year="2023"
                                aria-label="ç­›é€‰2023å¹´å†…å®¹"
                                title="2023å¹´">2023å¹´</button>
                        <button class="filter-btn" 
                                data-year="2025"
                                aria-label="ç­›é€‰2025å¹´å†…å®¹"
                                title="2025å¹´">2025å¹´</button>
                </div>
                
                <div class="score-chart-container">
                    <div class="chart-header">
                        <h3>803æµä½“åŠ›å­¦æŠ¥è€ƒäººæ•°ä¸åˆ†æ•°çº¿ (2020-2025)</h3>
                        <div>
                            <span style="background: var(--reexam-color); padding: 5px 10px; border-radius: 4px; color: white;">å¤è¯•çº¿</span>
                            <span style="background: var(--national-color); padding: 5px 10px; border-radius: 4px; color: white; margin-left: 10px;">å›½å®¶çº¿</span>
                            <span style="background: #27ae60; padding: 5px 10px; border-radius: 4px; color: white; margin-left: 10px;">æŠ¥åäººæ•°</span>
                        </div>
                    </div>
                    <div class="chart-box">
                        <canvas id="scoreChart"></canvas>
                    </div>
                    
                    <div class="score-details">
                        <h3><i class="fas fa-info-circle"></i> åˆ†æ•°çº¿è¯¦æƒ…ä¸å·®å¼‚åˆ†æ</h3>
                        
                        <!-- æ•°æ®ç»Ÿè®¡è¡¨æ ¼ -->
                        <div class="data-table-container" style="margin-bottom: 30px;">
                            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <thead>
                                    <tr style="background: var(--primary); color: white;">
                                        <th style="padding: 15px; text-align: center; border: none;">å¹´ä»½</th>
                                        <th style="padding: 15px; text-align: center; border: none;">å›½å®¶çº¿</th>
                                        <th style="padding: 15px; text-align: center; border: none;">å¤è¯•çº¿</th>
                                        <th style="padding: 15px; text-align: center; border: none;">æŠ¥åäººæ•°</th>
                                        <th style="padding: 15px; text-align: center; border: none;">å¤è¯•äººæ•°</th>
                                        <th style="padding: 15px; text-align: center; border: none;">å½•å–äººæ•°</th>
                                        <th style="padding: 15px; text-align: center; border: none;">å½•å–ç‡</th>
                                        <th style="padding: 15px; text-align: center; border: none;">å¤è¯•æ¯”ä¾‹</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2020å¹´</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa; background: #f8f9fa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2021å¹´</td>
                                        <td style="padding: 12px; text-align: center; border: none;">280åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">313åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">32äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none;">29äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.33</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2022å¹´</td>
                                        <td style="padding: 12px; text-align: center; border: none;">290åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">292åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">110äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none;">43äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none;">35äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">31.8%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.3</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa; background: #f8f9fa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2023å¹´</td>
                                        <td style="padding: 12px; text-align: center; border: none;">279åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">294åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">105äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none;">30äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none;">27äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">25.7%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.2</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2024å¹´</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none;">120äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none;">37äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none;">37äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">30.8%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.0</td>
                                    </tr>
                                    <tr style="background: #f0f8ff;">
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">2025å¹´</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">274åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">274åˆ†</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">125äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">35äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">35äºº</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold; color: var(--success);">28.0%</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">1.0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        
                        <div class="section-card">
                            <div class="info-item">
                                <div class="info-label">2023å¹´ï¼š</div>
                                <div class="info-content">
                                    <p><strong>å›½å®¶çº¿ï¼š279åˆ†</strong></p>
                                    <p><strong>å¤è¯•çº¿ï¼š294åˆ†</strong> 
                                        <span class="diff-indicator diff-up">æ¯”2023å›½å®¶çº¿é«˜15åˆ†</span></p>
                                    <p>å½“å¹´å¤è¯•äººæ•°ï¼š30äººï¼Œå½•å–ï¼š27äºº</p>
                                    <p>ä¸“ä¸šæŠ¥åäººæ•°ï¼š105äºº</p>
                                    <p>å½•å–ç‡ï¼š25.7%ï¼ˆ27Ã·105ï¼‰</p>
                                    <p>å¤è¯•æ¯”ä¾‹ï¼š1.2</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-card">
                            <div class="info-item">
                                <div class="info-label">2025å¹´ï¼š</div>
                                <div class="info-content">
                                    <p><strong>å›½å®¶çº¿ï¼š274åˆ†</strong></p>
                                    <p><strong>å¤è¯•çº¿ï¼š274åˆ†</strong> 
                                        <span class="diff-indicator diff-down">ä¸2025å›½å®¶çº¿ç›¸åŒ</span></p>
                                    <p>å½“å¹´å¤è¯•äººæ•°ï¼š35äººï¼Œå½•å–ï¼š35äºº</p>
                                    <p>ä¸“ä¸šæŠ¥åäººæ•°ï¼š125äºº</p>
                                    <p>å½•å–ç‡ï¼š28.0%ï¼ˆ35Ã·125ï¼‰</p>
                                    <p>å¤è¯•æ¯”ä¾‹ï¼š1.0</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ•°æ®è¶‹åŠ¿åˆ†æ -->
                        <div class="trend-analysis" style="background: white; border-radius: 10px; padding: 25px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);">
                            <h4 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chart-line"></i> æ•°æ®è¶‹åŠ¿åˆ†æ
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">æŠ¥åè¶‹åŠ¿</h5>
                                    <p style="margin-bottom: 5px;">2020å¹´ï¼š-</p>
                                    <p style="margin-bottom: 5px;">2021å¹´ï¼š-</p>
                                    <p style="margin-bottom: 5px;">2022å¹´ï¼š110äºº</p>
                                    <p style="margin-bottom: 5px;">2023å¹´ï¼š105äºº <span style="color: var(--warning);">â†“ 4.5%</span></p>
                                    <p style="margin-bottom: 5px;">2024å¹´ï¼š120äºº <span style="color: var(--success);">â†‘ 14.3%</span></p>
                                    <p>2025å¹´ï¼š125äºº <span style="color: var(--success);">â†‘ 4.2%</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--teacher);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">å½•å–ç‡å˜åŒ–</h5>
                                    <p style="margin-bottom: 5px;">2020å¹´ï¼š-</p>
                                    <p style="margin-bottom: 5px;">2021å¹´ï¼š-</p>
                                    <p style="margin-bottom: 5px;">2022å¹´ï¼š31.8%</p>
                                    <p style="margin-bottom: 5px;">2023å¹´ï¼š25.7% <span style="color: var(--warning);">â†“ 6.1%</span></p>
                                    <p style="margin-bottom: 5px;">2024å¹´ï¼š30.8% <span style="color: var(--success);">â†‘ 5.1%</span></p>
                                    <p>2025å¹´ï¼š28.0% <span style="color: var(--warning);">â†“ 2.8%</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--student);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">åˆ†æ•°çº¿å˜åŒ–</h5>
                                    <p style="margin-bottom: 5px;">2020å¹´ï¼šå›½å®¶çº¿288åˆ†ï¼Œå¤è¯•çº¿288åˆ†</p>
                                    <p style="margin-bottom: 5px;">2021å¹´ï¼šå›½å®¶çº¿280åˆ†ï¼Œå¤è¯•çº¿313åˆ†</p>
                                    <p style="margin-bottom: 5px;">2022å¹´ï¼šå›½å®¶çº¿290åˆ†ï¼Œå¤è¯•çº¿292åˆ†</p>
                                    <p style="margin-bottom: 5px;">2023å¹´ï¼šå›½å®¶çº¿279åˆ†ï¼Œå¤è¯•çº¿294åˆ†</p>
                                    <p style="margin-bottom: 5px;">2024å¹´ï¼šå›½å®¶çº¿288åˆ†ï¼Œå¤è¯•çº¿288åˆ†</p>
                                    <p>2025å¹´ï¼šå›½å®¶çº¿274åˆ†ï¼Œå¤è¯•çº¿274åˆ†</p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #9b59b6;">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">å¤è¯•æ¯”ä¾‹å˜åŒ–</h5>
                                    <p style="margin-bottom: 5px;">2020å¹´ï¼š-</p>
                                    <p style="margin-bottom: 5px;">2021å¹´ï¼š1.33</p>
                                    <p style="margin-bottom: 5px;">2022å¹´ï¼š1.3 <span style="color: var(--success);">â†“ 0.03</span></p>
                                    <p style="margin-bottom: 5px;">2023å¹´ï¼š1.2 <span style="color: var(--success);">â†“ 0.1</span></p>
                                    <p style="margin-bottom: 5px;">2024å¹´ï¼š1.0 <span style="color: var(--success);">â†“ 0.2</span></p>
                                    <p>2025å¹´ï¼š1.0 <span style="color: var(--success);">æŒå¹³</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #e67e22;">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">æ‹›ç”Ÿè§„æ¨¡å˜åŒ–</h5>
                                    <p style="margin-bottom: 5px;">2020å¹´ï¼š-</p>
                                    <p style="margin-bottom: 5px;">2021å¹´ï¼š29äºº</p>
                                    <p style="margin-bottom: 5px;">2022å¹´ï¼š35äºº <span style="color: var(--success);">â†‘ 20.7%</span></p>
                                    <p style="margin-bottom: 5px;">2023å¹´ï¼š27äºº <span style="color: var(--warning);">â†“ 22.9%</span></p>
                                    <p style="margin-bottom: 5px;">2024å¹´ï¼š37äºº <span style="color: var(--success);">â†‘ 37.0%</span></p>
                                    <p>2025å¹´ï¼š35äºº <span style="color: var(--warning);">â†“ 5.4%</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- é¢˜åº“ç»ƒä¹ æ¿å— -->
            <section id="question-section" class="content-section">
                <div class="section-title">
                    <i class="fas fa-question-circle"></i> é¢˜åº“ç»ƒä¹ ç³»ç»Ÿ
                </div>
                
                <div class="question-section">
                    <div class="upload-section">
                        <div>
                            <h3>ä¸Šä¼ ç»ƒä¹ é¢˜ç›®</h3>
                            <p>æ”¯æŒPDFã€Wordã€å›¾ç‰‡æ ¼å¼ï¼Œå¯æ‰¹é‡ä¸Šä¼ </p>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="upload-btn" 
                                    onclick="openUploadModal('question')"
                                    aria-label="ä¸Šä¼ ç»ƒä¹ é¢˜ç›®æ–‡ä»¶"
                                    title="ä¸Šä¼ é¢˜ç›®">
                                <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i> ä¸Šä¼ é¢˜ç›®
                            </button>
                            <button class="upload-btn" 
                                    onclick="openUploadModal('video')"
                                    aria-label="æ·»åŠ æ•™å­¦è§†é¢‘"
                                    title="æ·»åŠ è§†é¢‘">
                                <i class="fas fa-video" aria-hidden="true"></i> æ·»åŠ è§†é¢‘
                            </button>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-header">
                            <h3>æˆ‘çš„å­¦ä¹ è¿›åº¦</h3>
                            <span id="studentProgressText">å·²å®Œæˆ 0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;">
                                <div class="progress-text">0%</div>
                            </div>
                        </div>
                        
                        <!-- å­¦ç”Ÿä¸ªäººå­¦ä¹ ç»Ÿè®¡ -->
                        <div class="student-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                            <div class="stat-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-video" style="color: var(--primary); font-size: 20px;"></i>
                                    <div>
                                        <h4 style="margin: 0; color: var(--secondary);">è§†é¢‘å­¦ä¹ </h4>
                                        <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--primary);">0/7 è¯¾ç¨‹</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-question-circle" style="color: var(--accent); font-size: 20px;"></i>
                                    <div>
                                        <h4 style="margin: 0; color: var(--secondary);">é¢˜ç›®ç»ƒä¹ </h4>
                                        <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--accent);">0/37 é¢˜</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-chart-line" style="color: var(--success); font-size: 20px;"></i>
                                    <div>
                                        <h4 style="margin: 0; color: var(--secondary);">å¹³å‡æˆç»©</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--success);">-- åˆ†</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-clock" style="color: var(--warning); font-size: 20px;"></i>
                                    <div>
                                        <h4 style="margin: 0; color: var(--secondary);">å­¦ä¹ æ—¶é•¿</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--warning);">0 å°æ—¶</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="exercise-grid">
                        <!-- æ˜“é”™é¢˜æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œæœ€é‡è¦ -->
                        <div class="exercise-card featured">
                            <div class="exercise-title">
                                <i class="fas fa-star" style="color: #ffd700; margin-right: 8px;"></i>
                                æµä½“åŠ›å­¦æ˜“é”™åè¯åŠæ¦‚å¿µæ±‡æ€»
                            </div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 38é¢˜</span>
                                <span><i class="far fa-clock"></i> 45åˆ†é’Ÿ</span>
                                <span style="background: #ff6b6b; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px;">é‡ç‚¹</span>
                            </div>
                            <button class="start-btn" onclick="startFluidMechanicsConcepts()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52);">å¼€å§‹ç»ƒä¹ </button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">æµä½“é™åŠ›å­¦åŸºç¡€ç»ƒä¹ </div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 15é¢˜</span>
                                <span><i class="far fa-clock"></i> 30åˆ†é’Ÿ</span>
                            </div>
                            <button class="start-btn" onclick="startExercise('fluid_statics', 15)">å¼€å§‹ç»ƒä¹ </button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">ä¼¯åŠªåˆ©æ–¹ç¨‹åº”ç”¨</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 12é¢˜</span>
                                <span><i class="far fa-clock"></i> 25åˆ†é’Ÿ</span>
                            </div>
                            <button class="start-btn" onclick="startExercise('bernoulli', 12)">å¼€å§‹ç»ƒä¹ </button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">æ¶¡æ—‹è¿åŠ¨ä¸“é¢˜</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 10é¢˜</span>
                                <span><i class="far fa-clock"></i> 20åˆ†é’Ÿ</span>
                            </div>
                            <button class="start-btn" onclick="startExercise('vortex', 10)">å¼€å§‹ç»ƒä¹ </button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">åŠ¿æµç†è®ºç»¼åˆ</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 18é¢˜</span>
                                <span><i class="far fa-clock"></i> 35åˆ†é’Ÿ</span>
                            </div>
                            <button class="start-btn">å¼€å§‹ç»ƒä¹ </button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">è¾¹ç•Œå±‚ç†è®ºç»ƒä¹ </div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 8é¢˜</span>
                                <span><i class="far fa-clock"></i> 15åˆ†é’Ÿ</span>
                            </div>
                            <button class="start-btn">å¼€å§‹ç»ƒä¹ </button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">NSæ–¹ç¨‹åº”ç”¨</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 14é¢˜</span>
                                <span><i class="far fa-clock"></i> 30åˆ†é’Ÿ</span>
                            </div>
                            <button class="start-btn">å¼€å§‹ç»ƒä¹ </button>
                        </div>

                    </div>
                </div>
            </section>
            
            <!-- æˆç»©å½•å…¥æ¿å— -->
            <section id="grade-section" class="content-section">
                <div class="section-title">
                    <i class="fas fa-graduation-cap"></i> <span id="gradeSectionTitle">æˆç»©å½•å…¥ç³»ç»Ÿ</span>
                </div>
                
                <div class="grade-container">
                    <!-- æ•™å¸ˆæˆç»©å½•å…¥è¡¨å• -->
                    <div class="grade-form" id="gradeInputForm">
                                            <input type="text" 
                           name="studentName"
                           placeholder="å­¦ç”Ÿå§“å"
                           aria-label="å­¦ç”Ÿå§“å">
                    <input type="number" 
                           name="studentScore"
                           placeholder="æˆç»©"
                           aria-label="å­¦ç”Ÿæˆç»©">
                        <button class="add-grade-btn">æ·»åŠ </button>
                    </div>
                    
                    <!-- å­¦ç”Ÿä¸ªäººæˆç»©æ˜¾ç¤º -->
                    <div class="student-grade-display" id="studentGradeDisplay" style="display: none;">
                        <div class="student-grade-card" style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1); margin-bottom: 20px;">
                            <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-user-graduate"></i> æˆ‘çš„æˆç»©å•
                            </h3>
                            <div class="grade-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border-radius: 10px;">
                                    <h4 style="margin: 0 0 10px 0;">å¹³å‡æˆç»©</h4>
                                    <div style="font-size: 32px; font-weight: bold;" id="studentAvgGrade">--</div>
                                </div>
                                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--success), #27ae60); color: white; border-radius: 10px;">
                                    <h4 style="margin: 0 0 10px 0;">æœ€é«˜æˆç»©</h4>
                                    <div style="font-size: 32px; font-weight: bold;" id="studentMaxGrade">--</div>
                                </div>
                                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--warning), #f39c12); color: white; border-radius: 10px;">
                                    <h4 style="margin: 0 0 10px 0;">è€ƒè¯•æ¬¡æ•°</h4>
                                    <div style="font-size: 32px; font-weight: bold;" id="studentExamCount">0</div>
                                </div>
                            </div>
                            <div class="grade-details">
                                <h4 style="color: var(--secondary); margin-bottom: 15px;">è¯¦ç»†æˆç»©è®°å½•</h4>
                                <div id="studentGradeList" style="background: #f8f9fa; border-radius: 8px; padding: 15px;">
                                    <p style="text-align: center; color: #6c757d; margin: 0;">æš‚æ— æˆç»©è®°å½•</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grade-results">
                        <div class="grade-card">
                            <div class="grade-title">
                                <i class="fas fa-user-graduate"></i> å­¦ç”Ÿæˆç»©ç»Ÿè®¡
                            </div>
                            <div class="grade-value">86.5</div>
                            <div class="grade-list">
                                <div class="grade-item">
                                    <span>å¼ ä¸‰</span>
                                    <span>92</span>
                                </div>
                                <div class="grade-item">
                                    <span>æå››</span>
                                    <span>85</span>
                                </div>
                                <div class="grade-item">
                                    <span>ç‹äº”</span>
                                    <span>78</span>
                                </div>
                                <div class="grade-item">
                                    <span>èµµå…­</span>
                                    <span>91</span>
                                </div>
                                <div class="grade-item">
                                    <span>é’±ä¸ƒ</span>
                                    <span>87</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grade-card">
                            <div class="grade-title">
                                <i class="fas fa-chart-pie"></i> æˆç»©åˆ†å¸ƒ
                            </div>
                            <div class="grade-value">
                                <canvas id="gradeChart" width="200" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <!-- æç¤ºæ¶ˆæ¯ -->
    <div id="messageContainer"></div>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="copyright">æ¢ç´¢æµä½“ä¸–ç•Œçš„å¥¥ç§˜ Â· ç†è§£è‡ªç„¶è§„å¾‹çš„è‰ºæœ¯</div>
                <div class="copyright">Â© 2025 ä¸­å›½æµ·æ´‹å¤§å­¦æµä½“åŠ›å­¦å­¦ä¹ å¹³å° ç‰ˆæœ¬ 9.0</div>
            </div>
        </div>
    </footer>
    
    <!-- è§†é¢‘æ¨¡æ€æ¡† -->
    <div class="modal-backdrop" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">æµä½“åŠ›å­¦ä¹‹ç¾ï¼Œå¤ªç¾äº†</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="fullscreen-btn" onclick="toggleFullscreen()" title="å…¨å±/é€€å‡ºå…¨å±">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="close-modal" 
                        onclick="closeVideoModal()"
                        aria-label="å…³é—­è§†é¢‘æ’­æ”¾çª—å£"
                        title="å…³é—­">&times;</button>
                </div>
            </div>
            <div class="video-container">
                                        <iframe id="videoFrame" src="" frameborder="0" 
                                allow="fullscreen; autoplay; encrypted-media"
                                style="width: 100%; height: 100%;"></iframe>
                <div class="video-tips" style="position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 8px; font-size: 14px; display: none;">
                    <i class="fas fa-info-circle"></i> æç¤ºï¼šç‚¹å‡»å³ä¸Šè§’æŒ‰é’®å¯å…¨å±è§‚çœ‹ï¼ŒESCé”®é€€å‡ºå…¨å±
                </div>
            </div>
        </div>
    </div>
    
    <!-- ä¸Šä¼ æ¨¡æ€æ¡† -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-modal-content">
            <div class="modal-header">
                <h3 id="uploadModalTitle">ä¸Šä¼ å†…å®¹</h3>
                <button class="close-modal" 
                        onclick="closeUploadModal()"
                        aria-label="å…³é—­ä¸Šä¼ çª—å£"
                        title="å…³é—­">&times;</button>
            </div>
            
            <div class="upload-form" id="uploadForm">
                <div class="upload-form-group">
                    <label for="uploadTitle">æ ‡é¢˜</label>
                                            <input type="text" 
                               id="uploadTitle" 
                               name="uploadTitle"
                               placeholder="è¯·è¾“å…¥æ ‡é¢˜" 
                               required
                               aria-label="ä¸Šä¼ å†…å®¹æ ‡é¢˜">
                </div>
                
                <div class="upload-form-group">
                    <label for="uploadDescription">æè¿°</label>
                    <textarea id="uploadDescription" placeholder="è¯·è¾“å…¥æè¿°ä¿¡æ¯"></textarea>
                </div>
                
                <div class="upload-form-group">
                    <label for="uploadCategory">åˆ†ç±»</label>
                    <select id="uploadCategory">
                        <option value="basic">åŸºç¡€ç†è®º</option>
                        <option value="bernoulli">ä¼¯åŠªåˆ©æ–¹ç¨‹</option>
                        <option value="vortex">æ¶¡æ—‹è¿åŠ¨</option>
                        <option value="potential">åŠ¿æµç†è®º</option>
                        <option value="boundary">è¾¹ç•Œå±‚ç†è®º</option>
                        <option value="ns">NSæ–¹ç¨‹</option>
                        <option value="ocean">ç‰©ç†æµ·æ´‹å­¦</option>
                    </select>
                </div>
                
                <div class="upload-form-group" id="fileUploadGroup">
                    <label>æ–‡ä»¶ä¸Šä¼ </label>
                    <div class="file-upload-area" id="fileUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
                        <small>æ”¯æŒ PDFã€Wordã€å›¾ç‰‡æ ¼å¼ï¼Œæœ€å¤§ 50MB</small>
                        <input type="file" 
                               id="fileInput" 
                               name="fileInput"
                               multiple 
                               accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" 
                               style="display: none;"
                               aria-label="é€‰æ‹©æ–‡ä»¶ä¸Šä¼ ">
                    </div>
                </div>
                
                <div class="upload-form-group" id="videoLinkGroup" style="display: none;">
                    <label for="videoLink">è§†é¢‘é“¾æ¥</label>
                                            <input type="url" 
                               id="videoLink" 
                               name="videoLink"
                               placeholder="è¯·è¾“å…¥è§†é¢‘é“¾æ¥ï¼ˆBç«™ã€YouTubeç­‰ï¼‰"
                               aria-label="è§†é¢‘é“¾æ¥åœ°å€">
                </div>
                
                <div class="upload-form-group" id="douyinLinkGroup" style="display: none;">
                    <label for="douyinLinkInput">æŠ–éŸ³è§†é¢‘é“¾æ¥</label>
                    <input type="url" 
                           id="douyinLinkInput" 
                           name="douyinLinkInput"
                           placeholder="è¯·è¾“å…¥æŠ–éŸ³è§†é¢‘é“¾æ¥ï¼Œä¾‹å¦‚ï¼šhttps://v.douyin.com/..." 
                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;"
                           aria-label="æŠ–éŸ³è§†é¢‘é“¾æ¥åœ°å€">
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-top: 10px; border-left: 4px solid #ff0050;">
                        <p style="margin: 0; color: #666; font-size: 14px;">
                            <i class="fab fa-tiktok" style="color: #ff0050; margin-right: 8px;"></i>
                            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
                        </p>
                        <ol style="margin: 8px 0 0 0; padding-left: 20px; color: #666; font-size: 13px;">
                            <li>å…ˆåœ¨æŠ–éŸ³å¹³å°æ‰‹åŠ¨ä¸Šä¼ æ‚¨çš„è§†é¢‘</li>
                            <li>è®¾ç½®ä¸ºæ¨ªç‰ˆã€1080pã€é«˜è´¨é‡ã€å…¬å¼€å‘å¸ƒ</li>
                            <li>å¤åˆ¶è§†é¢‘çš„åˆ†äº«é“¾æ¥</li>
                            <li>å°†é“¾æ¥ç²˜è´´åˆ°ä¸Šé¢çš„è¾“å…¥æ¡†ä¸­</li>
                        </ol>
                    </div>
                </div>
                
                <div class="upload-form-group" id="videoFileGroup" style="display: none;">
                    <label for="videoFileInput">é€‰æ‹©æœ¬åœ°è§†é¢‘æ–‡ä»¶</label>
                    <input type="file" 
                           id="videoFileInput" 
                           name="videoFileInput"
                           accept="video/*"
                           onchange="handleVideoFileSelect(this)"
                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;"
                           aria-label="é€‰æ‹©æœ¬åœ°è§†é¢‘æ–‡ä»¶">
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-top: 10px; border-left: 4px solid #007bff;">
                        <p style="margin: 0; color: #666; font-size: 14px;">
                            <i class="fas fa-video" style="color: #007bff; margin-right: 8px;"></i>
                            <strong>æ”¯æŒæ ¼å¼ï¼š</strong>MP4, AVI, MOV, WMV, FLVç­‰å¸¸è§è§†é¢‘æ ¼å¼
                        </p>
                        <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">
                            <i class="fas fa-info-circle" style="color: #17a2b8; margin-right: 5px;"></i>
                            å»ºè®®æ–‡ä»¶å¤§å°ä¸è¶…è¿‡500MBï¼Œæ”¯æŒå€é€Ÿæ’­æ”¾å’Œå…¨å±åŠŸèƒ½
                        </p>
                    </div>
                    <div id="videoFilePreview" style="display: none; margin-top: 15px; padding: 12px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #28a745;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-file-video" style="color: #28a745; font-size: 20px;"></i>
                            <div>
                                <div id="videoFileName" style="font-weight: bold; color: #155724;"></div>
                                <div id="videoFileInfo" style="font-size: 12px; color: #666;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="upload-form-group" id="videoSourceGroup" style="display: none;">
                    <label>è§†é¢‘æ¥æº</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" 
                                   id="videoSourceLink"
                                   name="videoSource" 
                                   value="link" 
                                   checked 
                                   onchange="toggleVideoSource('link')"
                                   aria-label="é€‰æ‹©åœ¨çº¿è§†é¢‘é“¾æ¥æ–¹å¼">
                            <span>åœ¨çº¿è§†é¢‘é“¾æ¥</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" 
                                   id="videoSourceFile"
                                   name="videoSource" 
                                   value="file" 
                                   onchange="toggleVideoSource('file')"
                                   aria-label="é€‰æ‹©æœ¬åœ°è§†é¢‘æ–‡ä»¶æ–¹å¼">
                            <span>æœ¬åœ°è§†é¢‘æ–‡ä»¶</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" 
                                   id="videoSourceDouyin"
                                   name="videoSource" 
                                   value="douyin" 
                                   onchange="toggleVideoSource('douyin')"
                                   aria-label="é€‰æ‹©æŠ–éŸ³è§†é¢‘é“¾æ¥æ–¹å¼">
                            <span>æŠ–éŸ³è§†é¢‘é“¾æ¥</span>
                        </label>
                    </div>
                </div>
                
                <div class="upload-form-group" id="exerciseSourceGroup" style="display: none;">
                    <label>é¢˜åº“æ¥æº</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" 
                                   id="exerciseSourceFile"
                                   name="exerciseSource" 
                                   value="file" 
                                   checked 
                                   onchange="toggleExerciseSource('file')"
                                   aria-label="é€‰æ‹©æœ¬åœ°é¢˜åº“æ–‡ä»¶æ–¹å¼">
                            <span>æœ¬åœ°é¢˜åº“æ–‡ä»¶</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" 
                                   id="exerciseSourceJson"
                                   name="exerciseSource" 
                                   value="json" 
                                   onchange="toggleExerciseSource('json')"
                                   aria-label="é€‰æ‹©JSONæ ¼å¼é¢˜åº“">
                            <span>JSONæ ¼å¼é¢˜åº“</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" 
                                   id="exerciseSourceText"
                                   name="exerciseSource" 
                                   value="text" 
                                   onchange="toggleExerciseSource('text')"
                                   aria-label="é€‰æ‹©æ–‡æœ¬æ ¼å¼é¢˜åº“">
                            <span>æ–‡æœ¬æ ¼å¼é¢˜åº“</span>
                        </label>
                    </div>
                </div>
                
                <div class="upload-form-group" id="exerciseFileGroup" style="display: none;">
                    <label for="exerciseFileInput">é€‰æ‹©é¢˜åº“æ–‡ä»¶</label>
                    <input type="file" 
                           id="exerciseFileInput" 
                           name="exerciseFileInput"
                           accept=".json,.txt,.csv,.xlsx,.xls"
                           onchange="handleExerciseFileSelect(this)"
                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;"
                           aria-label="é€‰æ‹©é¢˜åº“æ–‡ä»¶">
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-top: 10px; border-left: 4px solid #28a745;">
                        <p style="margin: 0; color: #666; font-size: 14px;">
                            <i class="fas fa-file-alt" style="color: #28a745; margin-right: 8px;"></i>
                            <strong>æ”¯æŒæ ¼å¼ï¼š</strong>JSONã€TXTã€CSVã€Excelç­‰æ ¼å¼
                        </p>
                        <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">
                            <i class="fas fa-info-circle" style="color: #17a2b8; margin-right: 5px;"></i>
                            å»ºè®®ä½¿ç”¨JSONæ ¼å¼ï¼Œæ”¯æŒå®Œæ•´çš„é¢˜ç›®ç»“æ„å’Œå…ƒæ•°æ®
                        </p>
                    </div>
                    <div id="exerciseFilePreview" style="display: none; margin-top: 15px; padding: 12px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #28a745;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-file-alt" style="color: #28a745; font-size: 20px;"></i>
                            <div>
                                <div id="exerciseFileName" style="font-weight: bold; color: #155724;"></div>
                                <div id="exerciseFileInfo" style="font-size: 12px; color: #666;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="upload-form-group" id="exerciseJsonGroup" style="display: none;">
                    <label for="exerciseJsonInput">JSONæ ¼å¼é¢˜åº“</label>
                    <textarea id="exerciseJsonInput" 
                              name="exerciseJsonInput"
                              placeholder='è¯·è¾“å…¥JSONæ ¼å¼çš„é¢˜åº“æ•°æ®ï¼Œä¾‹å¦‚ï¼š
[
  {
    "question": "æµä½“åŠ›å­¦ä¸­ï¼Œè¿ç»­æ€§æ–¹ç¨‹çš„åŸºæœ¬å‡è®¾æ˜¯ä»€ä¹ˆï¼Ÿ",
    "options": ["A. æµä½“ä¸å¯å‹ç¼©", "B. æµä½“æ— ç²˜æ€§", "C. è´¨é‡å®ˆæ’", "D. åŠ¨é‡å®ˆæ’"],
    "answer": "C",
    "explanation": "è¿ç»­æ€§æ–¹ç¨‹åŸºäºè´¨é‡å®ˆæ’å®šå¾‹..."
  }
]'
                              style="width: 100%; height: 200px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; font-family: monospace;"
                              aria-label="JSONæ ¼å¼é¢˜åº“æ•°æ®"></textarea>
                </div>
                
                <div class="upload-form-group" id="exerciseTextGroup" style="display: none;">
                    <label for="exerciseTextInput">æ–‡æœ¬æ ¼å¼é¢˜åº“</label>
                    <textarea id="exerciseTextInput" 
                              name="exerciseTextInput"
                              placeholder='è¯·è¾“å…¥æ–‡æœ¬æ ¼å¼çš„é¢˜åº“ï¼Œæ¯é¢˜ä¸€è¡Œï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
é—®é¢˜1|é€‰é¡¹A|é€‰é¡¹B|é€‰é¡¹C|é€‰é¡¹D|æ­£ç¡®ç­”æ¡ˆ|è§£é‡Š
é—®é¢˜2|é€‰é¡¹A|é€‰é¡¹B|é€‰é¡¹C|é€‰é¡¹D|æ­£ç¡®ç­”æ¡ˆ|è§£é‡Š

ä¾‹å¦‚ï¼š
æµä½“åŠ›å­¦ä¸­ï¼Œè¿ç»­æ€§æ–¹ç¨‹çš„åŸºæœ¬å‡è®¾æ˜¯ä»€ä¹ˆï¼Ÿ|æµä½“ä¸å¯å‹ç¼©|æµä½“æ— ç²˜æ€§|è´¨é‡å®ˆæ’|åŠ¨é‡å®ˆæ’|C|è¿ç»­æ€§æ–¹ç¨‹åŸºäºè´¨é‡å®ˆæ’å®šå¾‹...'
                              style="width: 100%; height: 200px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;"
                              aria-label="æ–‡æœ¬æ ¼å¼é¢˜åº“æ•°æ®"></textarea>
                </div>
                
                <div class="upload-preview" id="uploadPreview">
                    <h4>å·²é€‰æ‹©çš„æ–‡ä»¶</h4>
                    <div id="fileList"></div>
                </div>
                
                <div class="upload-buttons">
                    <button class="upload-btn-secondary" 
                            onclick="closeUploadModal()"
                            aria-label="å–æ¶ˆä¸Šä¼ æ“ä½œ"
                            title="å–æ¶ˆ">å–æ¶ˆ</button>
                    <button class="upload-btn-primary" 
                            onclick="submitUpload()"
                            aria-label="ç¡®è®¤ä¸Šä¼ æ–‡ä»¶"
                            title="ç¡®è®¤ä¸Šä¼ ">ç¡®è®¤ä¸Šä¼ </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== åçˆ¬è™«å’Œé˜²æˆªå±ä¿æŠ¤ç³»ç»Ÿ ====================
        
        // é˜²æ­¢æ§åˆ¶å°è°ƒè¯•
        (function() {
            'use strict';
            
            // æ£€æµ‹å¼€å‘è€…å·¥å…·
            let devtools = {
                open: false,
                orientation: null
            };
            
            setInterval(function() {
                if (window.outerHeight - window.innerHeight > 200 || window.outerWidth - window.innerWidth > 200) {
                    if (!devtools.open) {
                        devtools.open = true;
                        console.clear();
                        document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;z-index:99999;">âš ï¸ æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·ï¼Œé¡µé¢å·²è¢«ä¿æŠ¤</div>';
                    }
                }
            }, 500);
            
            // ç¦ç”¨å¸¸ç”¨å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                // ç¦ç”¨F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U, Ctrl+S, Ctrl+A, Ctrl+P
                if (e.keyCode === 123 || 
                    (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                    (e.ctrlKey && (e.keyCode === 85 || e.keyCode === 83 || e.keyCode === 65 || e.keyCode === 80)) ||
                    e.keyCode === 44) { // Print Screen
                    e.preventDefault();
                    e.stopPropagation();
                    showSecurityAlert('æ£€æµ‹åˆ°ä¸å½“æ“ä½œï¼Œé¡µé¢å—åˆ°ä¿æŠ¤ï¼');
                    return false;
                }
            });
            
            // ç¦ç”¨å³é”®èœå•
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showSecurityAlert('å³é”®åŠŸèƒ½å·²è¢«ç¦ç”¨ï¼');
                return false;
            });
            
            // ç¦ç”¨æ–‡æœ¬é€‰æ‹©
            document.addEventListener('selectstart', function(e) {
                if (currentUser && currentUser.role === 'student') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // ç¦ç”¨æ‹–æ‹½
            document.addEventListener('dragstart', function(e) {
                if (currentUser && currentUser.role === 'student') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // æ£€æµ‹é¡µé¢å¯è§æ€§å˜åŒ–ï¼ˆå¯èƒ½çš„å½•å±æ£€æµ‹ï¼‰
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    console.log('é¡µé¢è¢«éšè—ï¼Œå¯èƒ½å­˜åœ¨å½•å±è¡Œä¸º');
                }
            });
            
            // é˜²æ­¢é€šè¿‡iframeåµŒå…¥
            if (window.top !== window.self) {
                window.top.location = window.self.location;
            }
            
        })();
        
        // å®‰å…¨è­¦å‘Šå‡½æ•°
        function showSecurityAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #e74c3c;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                z-index: 99999;
                font-size: 14px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 3000);
        }
        
        // åŠ¨æ€æ°´å°ç”Ÿæˆ - æ™ºèƒ½å­¦ä¹ æ¨¡å¼
        function createDynamicWatermark() {
            if (!currentUser || currentUser.role !== 'student') return;
            
            const watermark = document.getElementById('watermarkOverlay');
            const userName = currentUser.name || 'å­¦ç”Ÿç”¨æˆ·';
            const timestamp = new Date().toLocaleString();
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦åœ¨å­¦ä¹ é¡µé¢ï¼ˆè§†é¢‘æˆ–é¢˜åº“ï¼‰
            const currentSection = document.querySelector('.content-section.active');
            const isLearningPage = currentSection && 
                (currentSection.id === 'video-section' || 
                 currentSection.id === 'exercise-section');
            
            if (isLearningPage) {
                // å­¦ä¹ æ¨¡å¼ï¼šåªæ˜¾ç¤ºè§’è½æ°´å°ï¼Œä¸å¹²æ‰°å­¦ä¹ 
                watermark.className = 'watermark-overlay learning-mode';
                watermark.innerHTML = `
                    <div style="
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        color: rgba(26, 58, 87, 0.15);
                        font-size: 12px;
                        font-weight: normal;
                        pointer-events: none;
                        user-select: none;
                        white-space: nowrap;
                        background: rgba(255, 255, 255, 0.8);
                        padding: 2px 6px;
                        border-radius: 3px;
                    ">
                        ${userName}
                    </div>
                `;
            } else {
                // éå­¦ä¹ æ¨¡å¼ï¼šæ˜¾ç¤ºå®Œæ•´ä¿æŠ¤æ°´å°
                watermark.className = 'watermark-overlay protection-mode';
                let watermarkHTML = '';
                for (let i = 0; i < 12; i++) {
                    const top = Math.random() * 100;
                    const left = Math.random() * 100;
                    const rotation = Math.random() * 40 - 20;
                    
                    watermarkHTML += `
                        <div style="
                            position: absolute;
                            top: ${top}%;
                            left: ${left}%;
                            transform: rotate(${rotation}deg);
                            color: rgba(26, 58, 87, 0.04);
                            font-size: 12px;
                            font-weight: normal;
                            pointer-events: none;
                            user-select: none;
                            white-space: nowrap;
                        ">
                            ${userName}
                        </div>
                    `;
                }
                watermark.innerHTML = watermarkHTML;
            }
            
            // å®šæœŸæ›´æ–°æ°´å°
            setTimeout(createDynamicWatermark, 30000);
        }
        
        // æ£€æµ‹æˆªå±APIï¼ˆå®éªŒæ€§ï¼‰
        function detectScreenCapture() {
            if ('mediaDevices' in navigator && 'getDisplayMedia' in navigator.mediaDevices) {
                // ç›‘å¬å±å¹•å…±äº«APIçš„ä½¿ç”¨
                const originalGetDisplayMedia = navigator.mediaDevices.getDisplayMedia;
                navigator.mediaDevices.getDisplayMedia = function() {
                    showSecurityAlert('æ£€æµ‹åˆ°å±å¹•å½•åˆ¶å°è¯•ï¼');
                    console.log('Screen capture detected!');
                    return Promise.reject(new Error('Screen capture blocked'));
                };
            }
            
            // æ£€æµ‹ç”¨æˆ·åª’ä½“è®¾å¤‡è®¿é—®
            if ('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices) {
                const originalGetUserMedia = navigator.mediaDevices.getUserMedia;
                navigator.mediaDevices.getUserMedia = function(constraints) {
                    if (constraints && constraints.video && currentUser && currentUser.role === 'student') {
                        showSecurityAlert('æ£€æµ‹åˆ°æ‘„åƒå¤´è®¿é—®è¯·æ±‚ï¼');
                        return Promise.reject(new Error('Camera access blocked for students'));
                    }
                    return originalGetUserMedia.call(this, constraints);
                };
            }
        }
        
        // é«˜çº§åè°ƒè¯•åŠŸèƒ½
        function advancedAntiDebug() {
            // æ£€æµ‹è°ƒè¯•å™¨æ–­ç‚¹
            let startTime = performance.now();
            debugger;
            let endTime = performance.now();
            
            if (endTime - startTime > 100) {
                document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;z-index:99999;">ğŸš« æ£€æµ‹åˆ°è°ƒè¯•å™¨ï¼Œè®¿é—®è¢«æ‹’ç»</div>';
                return;
            }
            
            // å®šæœŸé‡å¤æ£€æµ‹
            setTimeout(advancedAntiDebug, 1000);
        }
        
        // æ£€æµ‹è‡ªåŠ¨åŒ–å·¥å…·
        function detectAutomation() {
            // æ£€æµ‹å¸¸è§çš„è‡ªåŠ¨åŒ–å·¥å…·
            if (window.navigator.webdriver || 
                window.callPhantom || 
                window._phantom || 
                window.phantom ||
                window.Buffer ||
                window.emit ||
                window.spawn) {
                showSecurityAlert('æ£€æµ‹åˆ°è‡ªåŠ¨åŒ–å·¥å…·ï¼');
                document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;z-index:99999;">ğŸ¤– æ£€æµ‹åˆ°æœºå™¨äººè®¿é—®</div>';
                return;
            }
            
            // æ£€æµ‹Selenium
            if (typeof window.document.$cdc_asdjflasutopfhvcZLmcfl_ !== 'undefined' ||
                typeof window.document.$chrome_asyncScriptInfo !== 'undefined') {
                showSecurityAlert('æ£€æµ‹åˆ°Seleniumï¼');
                return;
            }
        }
        
        // é˜²æ­¢é¡µé¢è¢«åµŒå…¥iframe
        function preventFraming() {
            if (window.top !== window.self) {
                window.top.location.replace(window.self.location.href);
            }
        }
        
        // æ··æ·†æ§åˆ¶å°è¾“å‡º
        function obfuscateConsole() {
            const methods = ['log', 'debug', 'info', 'warn', 'error'];
            methods.forEach(method => {
                const original = console[method];
                console[method] = function() {
                    if (currentUser && currentUser.role === 'student') {
                        return; // å­¦ç”Ÿç«¯ä¸æ˜¾ç¤ºæ§åˆ¶å°ä¿¡æ¯
                    }
                    original.apply(console, arguments);
                };
            });
        }
        
        // åˆå§‹åŒ–å®‰å…¨ä¿æŠ¤åŠŸèƒ½
        function initSecurityProtection() {
            if (!currentUser) return;
            
            if (currentUser.role === 'student') {
                // å­¦ç”Ÿç«¯ç‰¹æ®Šä¿æŠ¤
                setTimeout(() => {
                    createDynamicWatermark();
                    
                    // æ·»åŠ å­¦ç”Ÿå†…å®¹ä¿æŠ¤ç±»
                    const mainContent = document.querySelector('.main-content');
                    if (mainContent) {
                        mainContent.classList.add('student-content');
                    }
                    
                    // åˆå§‹åŒ–åª’ä½“ä¿æŠ¤
                    initMediaProtection();
                    
                    // æ·»åŠ é¡µé¢å¤±ç„¦æ£€æµ‹ï¼ˆå¯èƒ½çš„å½•å±è¡Œä¸ºï¼‰
                    let blurCount = 0;
                    window.addEventListener('blur', function() {
                        blurCount++;
                        if (blurCount > 3) {
                            showSecurityAlert('æ£€æµ‹åˆ°å¼‚å¸¸æ“ä½œï¼Œè¯·ä¸“å¿ƒå­¦ä¹ ï¼');
                        }
                    });
                    
                }, 500);
            }
        }
        
        // æ›´æ–°GitHubè¿æ¥çŠ¶æ€
        function updateGitHubStatus(isOnline) {
            const statusElement = document.getElementById('githubStatus');
            if (!statusElement) return;
            
            // æ£€æŸ¥å½“å‰ç”¨æˆ·è§’è‰²
            const isTeacher = currentUser && accounts[currentUser] && accounts[currentUser].role === 'teacher';
            
            if (isTeacher) {
                // æ•™å¸ˆæ˜¾ç¤ºçœŸå®çš„è¿æ¥çŠ¶æ€
                if (isOnline) {
                    statusElement.className = 'status-indicator online';
                    statusElement.innerHTML = '<i class="fas fa-cloud"></i><span>äº‘ç«¯åŒæ­¥</span>';
                } else {
                    statusElement.className = 'status-indicator offline';
                    statusElement.innerHTML = '<i class="fas fa-cloud-slash"></i><span>ç¦»çº¿æ¨¡å¼</span>';
                }
            } else {
                // å­¦ç”Ÿåªæ˜¾ç¤ºé€šç”¨çš„åœ¨çº¿çŠ¶æ€
                statusElement.className = 'status-indicator online';
                statusElement.innerHTML = '<i class="fas fa-globe"></i><span>åœ¨çº¿å­¦ä¹ </span>';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åŸºç¡€ä¿æŠ¤
        document.addEventListener('DOMContentLoaded', function() {
            preventFraming();
            detectScreenCapture();
            obfuscateConsole();
            detectAutomation();
            
            // å¯åŠ¨é«˜çº§åè°ƒè¯•ï¼ˆä»…åœ¨ç”Ÿäº§ç¯å¢ƒï¼‰
            if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                setTimeout(advancedAntiDebug, 2000);
            }
            
            // å»¶è¿ŸåŠ è½½GitHubæ•°æ®ï¼Œç¡®ä¿ä¸å½±å“ç™»å½•
            setTimeout(() => {
                loadDataFromGitHub();
            }, 1000);
            
            // å»¶è¿Ÿåˆå§‹åŒ–é»˜è®¤å†…å®¹
            setTimeout(() => {
                initializeDefaultContent();
            }, 3000);
            
            // åŠ è½½æœ¬åœ°ä¸Šä¼ çš„è§†é¢‘å’Œé¢˜åº“
            setTimeout(() => {
                loadUploadedVideos();
                loadUploadedExercises();
            }, 500);
        });
        
        // åˆå§‹åŒ–é»˜è®¤å†…å®¹åˆ°GitHub
        async function initializeDefaultContent() {
            console.log('ğŸ”„ å¼€å§‹åˆå§‹åŒ–é»˜è®¤å†…å®¹...');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„GitHubé…ç½®
            if (!hasValidGitHubConfig()) {
                console.log('âš ï¸ æ²¡æœ‰GitHubé…ç½®ï¼Œè·³è¿‡å†…å®¹åˆå§‹åŒ–');
                return;
            }
            
            try {
                // éªŒè¯GitHubè¿æ¥
                const tokenValid = await githubStorage.validateToken();
                if (!tokenValid) {
                    console.log('âš ï¸ GitHub Tokenæ— æ•ˆï¼Œè·³è¿‡å†…å®¹åˆå§‹åŒ–');
                    return;
                }
                
                // æ£€æŸ¥å¹¶åˆå§‹åŒ–è§†é¢‘æ•°æ®
                try {
                    const existingVideos = await githubStorage.getFile('data/videos.json');
                    if (!existingVideos || !Array.isArray(existingVideos) || existingVideos.length === 0) {
                        console.log('ğŸ“¹ åˆå§‹åŒ–é»˜è®¤è§†é¢‘æ•°æ®...');
                        videosData = [...defaultVideosData];
                        await saveVideosToGitHub();
                        setTimeout(() => rebuildVideoList(), 500);
                        console.log('âœ… é»˜è®¤è§†é¢‘æ•°æ®å·²ä¸Šä¼ ');
                    }
                } catch (e) {
                    console.log('ğŸ“¹ è§†é¢‘æ•°æ®åˆå§‹åŒ–å¤±è´¥:', e.message);
                }
                
                // æ£€æŸ¥å¹¶åˆå§‹åŒ–é¢˜åº“æ•°æ®
                try {
                    const existingExercises = await githubStorage.getFile('data/exercises.json');
                    if (!existingExercises || !Array.isArray(existingExercises) || existingExercises.length === 0) {
                        console.log('ğŸ“š åˆå§‹åŒ–é»˜è®¤é¢˜åº“æ•°æ®...');
                        exercisesData = [...defaultExercisesData];
                        await saveExercisesToGitHub();
                        setTimeout(() => rebuildExerciseList(), 500);
                        console.log('âœ… é»˜è®¤é¢˜åº“æ•°æ®å·²ä¸Šä¼ ');
                    }
                } catch (e) {
                    console.log('ğŸ“š é¢˜åº“æ•°æ®åˆå§‹åŒ–å¤±è´¥:', e.message);
                }
                
                console.log('ğŸ‰ é»˜è®¤å†…å®¹åˆå§‹åŒ–å®Œæˆ');
                showMessage('ğŸš€ ç³»ç»Ÿå†…å®¹å·²å®Œå–„ï¼ŒGitHubåå°æ•°æ®å·²æ›´æ–°ï¼', 'success');
                
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–é»˜è®¤å†…å®¹å¤±è´¥:', error);
            }
        }

        // ==================== ç”¨æˆ·ç³»ç»Ÿ ====================
        
        // ==================== GitHubåå°å­˜å‚¨ç³»ç»Ÿ ====================
        
        // GitHubä»“åº“é…ç½® - ç›´æ¥è®¿é—®æ¨¡å¼
        const GITHUB_CONFIG = {
            owner: 'lghui12138',
            repo: 'lghui12138.github.io',
            branch: 'main',
            baseUrl: 'https://raw.githubusercontent.com/lghui12138/lghui12138.github.io/main',
            dataPath: 'data/',
            videosPath: 'videos/',
            exercisesPath: 'exercises/'
        };
        
        // ç®€åŒ–çš„æ•°æ®è®¿é—®ç±» - ç›´æ¥è¯»å–GitHubæ–‡ä»¶
        class SimpleGitHubAccess {
            constructor(config) {
                this.config = config;
            }
            
            // ç›´æ¥ä»GitHubè·å–JSONæ–‡ä»¶
            async getJSONFile(path) {
                try {
                    console.log(`ğŸ“¥ è·å–æ–‡ä»¶: ${path}`);
                    const url = `${this.config.baseUrl}/${path}`;
                    const response = await fetch(url);
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log(`âœ… æ–‡ä»¶è·å–æˆåŠŸ: ${path}`);
                        return data;
                    } else if (response.status === 404) {
                        console.log(`ğŸ“„ æ–‡ä»¶ä¸å­˜åœ¨: ${path}`);
                        return null;
                    } else {
                        console.error(`âŒ è·å–å¤±è´¥: ${path} - ${response.status}`);
                        return null;
                    }
                } catch (error) {
                    console.error(`âŒ è·å–å¼‚å¸¸ ${path}:`, error.message);
                    return null;
                }
            }
            
            // è·å–æ–‡ä»¶URL
            getFileUrl(path) {
                return `${this.config.baseUrl}/${path}`;
            }
        }
        
        // æ•°æ®å­˜å‚¨çŠ¶æ€
        let isDataLoading = false;
        let isDataSaving = false;
        
        // ç®€åŒ–çš„GitHub APIå­˜å‚¨ç±»
        class GitHubStorage {
            constructor(config) {
                this.config = config;
                this.baseUrl = `${config.apiBase}/repos/${config.owner}/${config.repo}`;
            }
            
            // æ£€æŸ¥tokenæœ‰æ•ˆæ€§
            async validateToken() {
                const token = this.config.token;
                if (!token || token === 'demo_token_please_configure') {
                    return false;
                }
                
                try {
                    const response = await fetch(`${this.config.apiBase}/user`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'FluidDynamics-Platform/1.0'
                        }
                    });
                    
                    if (response.ok) {
                        const userData = await response.json();
                        console.log('âœ… GitHubè¿æ¥æˆåŠŸ:', userData.login);
                        return true;
                    } else {
                        console.error('âŒ GitHubè®¤è¯å¤±è´¥:', response.status, response.statusText);
                        return false;
                    }
                } catch (error) {
                    console.error('âŒ GitHubè¿æ¥é”™è¯¯:', error);
                    return false;
                }
            }
            
            // è·å–æ–‡ä»¶å†…å®¹
            async getFile(path) {
                const token = this.config.token;
                if (!token) {
                    console.log('âš ï¸ æ²¡æœ‰GitHub Tokenï¼Œè·³è¿‡æ–‡ä»¶è·å–');
                    return null;
                }
                
                try {
                    console.log(`ğŸ“¥ ä»GitHubè·å–æ–‡ä»¶: ${path}`);
                    const response = await fetch(`${this.baseUrl}/contents/${path}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'FluidDynamics-Platform/1.0'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const content = JSON.parse(atob(data.content));
                        console.log(`âœ… æˆåŠŸè·å–æ–‡ä»¶: ${path}`);
                        return content;
                    } else if (response.status === 404) {
                        console.log(`ğŸ“„ æ–‡ä»¶ä¸å­˜åœ¨: ${path}`);
                        return null;
                    } else {
                        console.error(`âŒ è·å–æ–‡ä»¶å¤±è´¥: ${path} - ${response.status}`);
                        return null;
                    }
                } catch (error) {
                    console.error(`âŒ è·å–æ–‡ä»¶å¼‚å¸¸ ${path}:`, error.message);
                    return null;
                }
            }
            
            // ä¿å­˜æ–‡ä»¶å†…å®¹
            async saveFile(path, content, message = 'æ›´æ–°æ•°æ®') {
                const token = this.config.token;
                if (!token) {
                    console.log('âš ï¸ æ²¡æœ‰GitHub Tokenï¼Œæ— æ³•ä¿å­˜æ–‡ä»¶');
                    return false;
                }
                
                if (isDataSaving) {
                    console.log('â³ æ•°æ®ä¿å­˜ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚');
                    return false;
                }
                
                isDataSaving = true;
                
                try {
                    console.log(`ğŸ’¾ å¼€å§‹ä¿å­˜æ–‡ä»¶: ${path}`);
                    
                    // ç¼–ç å†…å®¹
                    const jsonString = JSON.stringify(content, null, 2);
                    const encodedContent = btoa(jsonString);
                    
                    // è·å–ç°æœ‰æ–‡ä»¶çš„SHA
                    let sha = null;
                    try {
                        const existingResponse = await fetch(`${this.baseUrl}/contents/${path}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'User-Agent': 'FluidDynamics-Platform/1.0'
                            }
                        });
                        
                        if (existingResponse.ok) {
                            const existingData = await existingResponse.json();
                            sha = existingData.sha;
                            console.log(`ğŸ“ æ‰¾åˆ°ç°æœ‰æ–‡ä»¶SHA: ${sha.substring(0, 8)}...`);
                        }
                    } catch (e) {
                        console.log('ğŸ“ æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶');
                    }
                    
                    // æ„å»ºè¯·æ±‚ä½“
                    const requestBody = {
                        message: `${message} - ${new Date().toLocaleString('zh-CN')}`,
                        content: encodedContent
                    };
                    
                    if (sha) {
                        requestBody.sha = sha;
                    }
                    
                    // å‘é€ä¿å­˜è¯·æ±‚
                    const response = await fetch(`${this.baseUrl}/contents/${path}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'User-Agent': 'FluidDynamics-Platform/1.0'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    if (response.ok) {
                        console.log(`âœ… æ–‡ä»¶ä¿å­˜æˆåŠŸ: ${path}`);
                        return true;
                    } else {
                        const errorText = await response.text();
                        console.error(`âŒ ä¿å­˜å¤±è´¥: ${path} - ${response.status}`, errorText);
                        return false;
                    }
                    
                } catch (error) {
                    console.error(`âŒ ä¿å­˜æ–‡ä»¶å¼‚å¸¸ ${path}:`, error.message);
                    return false;
                } finally {
                    isDataSaving = false;
                }
            }
            
            // ä¸Šä¼ äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚è§†é¢‘æ–‡ä»¶ï¼‰åˆ°GitHub
            async uploadBinaryFile(file, path, message = 'ä¸Šä¼ è§†é¢‘æ–‡ä»¶') {
                const token = this.config.token;
                if (!token) {
                    console.log('âš ï¸ æ²¡æœ‰GitHub Tokenï¼Œæ— æ³•ä¸Šä¼ æ–‡ä»¶');
                    return null;
                }
                
                try {
                    console.log(`ğŸ“¤ å¼€å§‹ä¸Šä¼ æ–‡ä»¶: ${path} (${this.formatFileSize(file.size)})`);
                    
                    // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
                    showMessage(`æ­£åœ¨ä¸Šä¼ è§†é¢‘æ–‡ä»¶: ${file.name}...`, 'info');
                    
                    // å°†æ–‡ä»¶è½¬æ¢ä¸ºBase64
                    const base64Content = await this.fileToBase64(file);
                    
                    // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
                    let sha = null;
                    try {
                        const existingResponse = await fetch(`${this.baseUrl}/contents/${path}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'User-Agent': 'FluidDynamics-Platform/1.0'
                            }
                        });
                        
                        if (existingResponse.ok) {
                            const existingData = await existingResponse.json();
                            sha = existingData.sha;
                            console.log(`ğŸ“ æ–‡ä»¶å·²å­˜åœ¨ï¼Œå°†æ›´æ–°: ${sha.substring(0, 8)}...`);
                        }
                    } catch (e) {
                        console.log('ğŸ“ æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶');
                    }
                    
                    // æ„å»ºè¯·æ±‚ä½“
                    const requestBody = {
                        message: `${message} - ${file.name} (${this.formatFileSize(file.size)}) - ${new Date().toLocaleString('zh-CN')}`,
                        content: base64Content
                    };
                    
                    if (sha) {
                        requestBody.sha = sha;
                    }
                    
                    // ä¸Šä¼ æ–‡ä»¶
                    const response = await fetch(`${this.baseUrl}/contents/${path}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'FluidDynamics-Platform/1.0',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ:', result.content.name);
                        
                        // è¿”å›æ–‡ä»¶çš„ä¸‹è½½URL
                        return {
                            success: true,
                            downloadUrl: result.content.download_url,
                            htmlUrl: result.content.html_url,
                            path: path,
                            sha: result.content.sha,
                            fileName: file.name,
                            fileSize: file.size
                        };
                    } else {
                        const errorData = await response.json();
                        console.error('âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', response.status, errorData.message);
                        return null;
                    }
                    
                } catch (error) {
                    console.error('âŒ ä¸Šä¼ æ–‡ä»¶æ—¶å‡ºé”™:', error);
                    return null;
                }
            }
            
            // å°†Fileå¯¹è±¡è½¬æ¢ä¸ºBase64å­—ç¬¦ä¸²
            async fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => {
                        // ç§»é™¤data:å¼€å¤´çš„éƒ¨åˆ†ï¼Œåªä¿ç•™Base64å†…å®¹
                        const base64 = reader.result.split(',')[1];
                        resolve(base64);
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }
            
            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„GitHubé…ç½®
        function hasValidGitHubConfig() {
            const token = localStorage.getItem('github_token');
            return token && token !== 'demo_token_please_configure' && token.length > 10;
        }

        // åˆå§‹åŒ–GitHubå­˜å‚¨ï¼ˆå¦‚æœGitHubStorageä¸å­˜åœ¨ï¼Œä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬ï¼‰
        let githubStorage;
        try {
            githubStorage = new GitHubStorage(GITHUB_CONFIG);
        } catch (error) {
            console.log('ä½¿ç”¨ç®€åŒ–GitHubè®¿é—®');
            githubStorage = new SimpleGitHubAccess(GITHUB_CONFIG);
        }
        
        // ç”¨æˆ·è´¦å·ä¿¡æ¯ - å°†è¿ç§»åˆ°GitHubå­˜å‚¨
        let accounts = {
            'liuguanghui6330156': { name: 'åˆ˜å…‰è¾‰', role: 'teacher', password: 'Ll700306', color: 'teacher' },
            'student1': { name: 'å­¦ç”Ÿè´¦å·', role: 'student', password: '123456', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] },
            'niwenxuan': { name: 'å€ªæ–‡è½©', role: 'student', password: 'niwenxuan2025', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] },
            'hanwenxu': { name: 'éŸ©æ–‡æ—­', role: 'student', password: 'hanwenxu2025', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] }
        };
        
        // è§†é¢‘å’Œé¢˜åº“æ•°æ®
        let videosData = [];
        let exercisesData = [];
        
        // é¢„è®¾çš„ä¼˜è´¨æ•™å­¦è§†é¢‘æ•°æ®
        const defaultVideosData = [
            {
                id: 'video_001',
                title: 'æµä½“åŠ›å­¦åŸºç¡€ç†è®ºä½“ç³»',
                description: 'ç³»ç»Ÿè®²è§£æµä½“åŠ›å­¦çš„åŸºæœ¬æ¦‚å¿µã€åŸºæœ¬æ–¹ç¨‹å’ŒåŸºæœ¬æ–¹æ³•ï¼ŒåŒ…æ‹¬è¿ç»­ä»‹è´¨å‡è®¾ã€æµä½“æ€§è´¨ã€è¿åŠ¨å­¦æè¿°ç­‰æ ¸å¿ƒå†…å®¹ã€‚é€‚åˆåˆå­¦è€…å»ºç«‹å®Œæ•´çš„ç†è®ºæ¡†æ¶ã€‚',
                source: 'https://www.bilibili.com/video/BV1Ux411L7Zd',
                type: 'link',
                category: 'åŸºç¡€ç†è®º',
                platform: 'Bç«™',
                duration: '45:30',
                uploadTime: new Date().toISOString(),
                viewCount: 15420,
                difficulty: 'åŸºç¡€',
                tags: ['ç†è®ºåŸºç¡€', 'è¿ç»­ä»‹è´¨', 'æµä½“æ€§è´¨']
            },
            {
                id: 'video_002', 
                title: 'æµä½“é™åŠ›å­¦ä¸å‹å¼ºåˆ†å¸ƒ',
                description: 'æ·±å…¥åˆ†ææµä½“é™åŠ›å­¦åŸºæœ¬æ–¹ç¨‹ï¼Œè®²è§£é™å‹å¼ºçš„åˆ†å¸ƒè§„å¾‹ã€å‹å¼ºæµ‹é‡æ–¹æ³•ã€æ¶²ä½“å¯¹å£é¢çš„ä½œç”¨åŠ›è®¡ç®—ç­‰å·¥ç¨‹å®é™…é—®é¢˜ã€‚',
                source: 'https://www.bilibili.com/video/BV1Jx411m7Qr',
                type: 'link',
                category: 'æµä½“é™åŠ›å­¦',
                platform: 'Bç«™',
                duration: '38:15',
                uploadTime: new Date().toISOString(),
                viewCount: 12680,
                difficulty: 'åŸºç¡€',
                tags: ['é™åŠ›å­¦', 'å‹å¼ºåˆ†å¸ƒ', 'å·¥ç¨‹åº”ç”¨']
            },
            {
                id: 'video_003',
                title: 'ä¼¯åŠªåˆ©æ–¹ç¨‹åŠå…¶å·¥ç¨‹åº”ç”¨',
                description: 'è¯¦ç»†æ¨å¯¼ä¼¯åŠªåˆ©æ–¹ç¨‹ï¼Œåˆ†æå…¶é€‚ç”¨æ¡ä»¶å’Œç‰©ç†æ„ä¹‰ï¼Œé€šè¿‡å¤§é‡å·¥ç¨‹å®ä¾‹å±•ç¤ºå¦‚ä½•åº”ç”¨ä¼¯åŠªåˆ©æ–¹ç¨‹è§£å†³å®é™…é—®é¢˜ã€‚',
                source: 'https://www.bilibili.com/video/BV1mx411L7Zp',
                type: 'link', 
                category: 'æµä½“åŠ¨åŠ›å­¦',
                platform: 'Bç«™',
                duration: '52:40',
                uploadTime: new Date().toISOString(),
                viewCount: 18950,
                difficulty: 'ä¸­çº§',
                tags: ['ä¼¯åŠªåˆ©æ–¹ç¨‹', 'èƒ½é‡å®ˆæ’', 'å·¥ç¨‹åº”ç”¨']
            },
            {
                id: 'video_004',
                title: 'ç²˜æ€§æµåŠ¨ä¸é›·è¯ºæ•°',
                description: 'è®²è§£æµä½“ç²˜æ€§çš„æœ¬è´¨ï¼Œåˆ†æå±‚æµä¸æ¹æµçš„åŒºåˆ«ï¼Œæ·±å…¥ç†è§£é›·è¯ºæ•°çš„ç‰©ç†æ„ä¹‰åŠå…¶åœ¨æµåŠ¨è½¬æ©ä¸­çš„ä½œç”¨ã€‚',
                source: 'https://www.bilibili.com/video/BV1Wx411m7Qp',
                type: 'link',
                category: 'ç²˜æ€§æµåŠ¨',
                platform: 'Bç«™', 
                duration: '41:20',
                uploadTime: new Date().toISOString(),
                viewCount: 14230,
                difficulty: 'ä¸­çº§',
                tags: ['ç²˜æ€§æµåŠ¨', 'é›·è¯ºæ•°', 'å±‚æµæ¹æµ']
            },
            {
                id: 'video_005',
                title: 'è¾¹ç•Œå±‚ç†è®ºä¸åº”ç”¨',
                description: 'ç³»ç»Ÿä»‹ç»æ™®æœ—ç‰¹è¾¹ç•Œå±‚ç†è®ºï¼Œåˆ†æè¾¹ç•Œå±‚çš„å½¢æˆæœºç†ã€å‘å±•è§„å¾‹å’Œå·¥ç¨‹æ„ä¹‰ï¼Œè®²è§£è¾¹ç•Œå±‚åˆ†ç¦»ç°è±¡åŠå…¶æ§åˆ¶æ–¹æ³•ã€‚',
                source: 'https://www.bilibili.com/video/BV1Lx411L7Zm',
                type: 'link',
                category: 'è¾¹ç•Œå±‚ç†è®º', 
                platform: 'Bç«™',
                duration: '49:55',
                uploadTime: new Date().toISOString(),
                viewCount: 11780,
                difficulty: 'é«˜çº§',
                tags: ['è¾¹ç•Œå±‚', 'æ™®æœ—ç‰¹ç†è®º', 'åˆ†ç¦»æ§åˆ¶']
            },
            {
                id: 'video_006',
                title: 'ç®¡é“æµåŠ¨ä¸é˜»åŠ›è®¡ç®—',
                description: 'åˆ†æç®¡é“å†…æµä½“æµåŠ¨çš„ç‰¹ç‚¹ï¼Œè®²è§£æ²¿ç¨‹é˜»åŠ›å’Œå±€éƒ¨é˜»åŠ›çš„è®¡ç®—æ–¹æ³•ï¼Œä»‹ç»ç®¡ç½‘è®¡ç®—çš„åŸºæœ¬åŸç†å’Œå·¥ç¨‹åº”ç”¨ã€‚',
                source: 'https://www.bilibili.com/video/BV1Px411m7Qw',
                type: 'link',
                category: 'ç®¡é“æµåŠ¨',
                platform: 'Bç«™',
                duration: '44:10',
                uploadTime: new Date().toISOString(),
                viewCount: 16540,
                difficulty: 'ä¸­çº§',
                tags: ['ç®¡é“æµåŠ¨', 'é˜»åŠ›è®¡ç®—', 'ç®¡ç½‘è®¾è®¡']
            }
                 ];
         
        // é¢„è®¾çš„ä¼˜è´¨é¢˜åº“æ•°æ®
        const defaultExercisesData = [
            {
                id: 'exercise_001',
                title: 'æµä½“é™åŠ›å­¦ç»¼åˆç»ƒä¹ ',
                description: 'æ¶µç›–æµä½“é™åŠ›å­¦åŸºæœ¬æ¦‚å¿µã€å‹å¼ºåˆ†å¸ƒã€æµ®åŠ›è®¡ç®—ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹çš„ç»¼åˆç»ƒä¹ é¢˜é›†ã€‚',
                category: 'æµä½“é™åŠ›å­¦',
                difficulty: 'åŸºç¡€',
                questionCount: 20,
                timeLimit: 35,
                questions: [
                    {
                        id: 1,
                        type: 'choice',
                        question: 'åœ¨é™æ­¢æµä½“ä¸­ï¼Œå‹å¼ºçš„ä¼ é€’éµå¾ªä»€ä¹ˆå®šå¾‹ï¼Ÿ',
                        options: ['å¸•æ–¯å¡å®šå¾‹', 'é˜¿åŸºç±³å¾·å®šå¾‹', 'èƒ¡å…‹å®šå¾‹', 'ç‰›é¡¿å®šå¾‹'],
                        answer: 'A',
                        explanation: 'å¸•æ–¯å¡å®šå¾‹æŒ‡å‡ºï¼Œåœ¨é™æ­¢æµä½“ä¸­ï¼Œå‹å¼ºèƒ½å¤Ÿç­‰å€¼åœ°ä¼ é€’åˆ°æµä½“çš„å„ä¸ªéƒ¨åˆ†ã€‚'
                    },
                    {
                        id: 2,
                        type: 'choice', 
                        question: 'æµä½“é™åŠ›å­¦åŸºæœ¬æ–¹ç¨‹dp = -Ïg dzä¸­ï¼Œè´Ÿå·è¡¨ç¤ºä»€ä¹ˆç‰©ç†æ„ä¹‰ï¼Ÿ',
                        options: ['å‹å¼ºéšé«˜åº¦å¢åŠ è€Œå‡å°', 'å‹å¼ºéšé«˜åº¦å¢åŠ è€Œå¢å¤§', 'å¯†åº¦ä¸ºè´Ÿå€¼', 'é‡åŠ›åŠ é€Ÿåº¦å‘ä¸‹'],
                        answer: 'A',
                        explanation: 'è´Ÿå·è¡¨ç¤ºå‹å¼ºéšé«˜åº¦å¢åŠ è€Œå‡å°ï¼Œè¿™æ˜¯å› ä¸ºé‡åŠ›çš„ä½œç”¨ã€‚'
                    }
                ],
                uploadTime: new Date().toISOString(),
                tags: ['é™åŠ›å­¦', 'å‹å¼º', 'æµ®åŠ›']
            },
            {
                id: 'exercise_002',
                title: 'ä¼¯åŠªåˆ©æ–¹ç¨‹åº”ç”¨ä¸“é¢˜',
                description: 'é€šè¿‡å…¸å‹å·¥ç¨‹æ¡ˆä¾‹æ·±å…¥ç†è§£ä¼¯åŠªåˆ©æ–¹ç¨‹çš„åº”ç”¨æ¡ä»¶å’Œè®¡ç®—æ–¹æ³•ã€‚',
                category: 'æµä½“åŠ¨åŠ›å­¦',
                difficulty: 'ä¸­çº§',
                questionCount: 15,
                timeLimit: 30,
                questions: [
                    {
                        id: 1,
                        type: 'choice',
                        question: 'ä¼¯åŠªåˆ©æ–¹ç¨‹çš„é€‚ç”¨æ¡ä»¶ä¸åŒ…æ‹¬ä»¥ä¸‹å“ªé¡¹ï¼Ÿ',
                        options: ['å®šå¸¸æµåŠ¨', 'æ— ç²˜æ€§æµä½“', 'ä¸å¯å‹ç¼©æµä½“', 'æœ‰æ—‹æµåŠ¨'],
                        answer: 'D',
                        explanation: 'ä¼¯åŠªåˆ©æ–¹ç¨‹é€‚ç”¨äºå®šå¸¸ã€æ— ç²˜æ€§ã€ä¸å¯å‹ç¼©çš„æ— æ—‹æµåŠ¨ã€‚'
                    }
                ],
                uploadTime: new Date().toISOString(),
                tags: ['ä¼¯åŠªåˆ©æ–¹ç¨‹', 'èƒ½é‡å®ˆæ’', 'å·¥ç¨‹åº”ç”¨']
            },
            {
                id: 'exercise_003',
                title: 'è¾¹ç•Œå±‚ç†è®ºåŸºç¡€',
                description: 'è¾¹ç•Œå±‚æ¦‚å¿µã€è¾¹ç•Œå±‚æ–¹ç¨‹ã€è¾¹ç•Œå±‚åšåº¦ç­‰æ ¸å¿ƒç†è®ºçš„ç»ƒä¹ é¢˜é›†ã€‚',
                category: 'è¾¹ç•Œå±‚ç†è®º',
                difficulty: 'é«˜çº§', 
                questionCount: 12,
                timeLimit: 25,
                questions: [
                    {
                        id: 1,
                        type: 'choice',
                        question: 'è¾¹ç•Œå±‚ç†è®ºçš„æå‡ºè€…æ˜¯ï¼Ÿ',
                        options: ['é›·è¯º', 'æ™®æœ—ç‰¹', 'ä¼¯åŠªåˆ©', 'æ¬§æ‹‰'],
                        answer: 'B',
                        explanation: 'æ™®æœ—ç‰¹(Prandtl)åœ¨1904å¹´æå‡ºäº†è¾¹ç•Œå±‚ç†è®ºï¼Œè¢«èª‰ä¸ºç°ä»£æµä½“åŠ›å­¦ä¹‹çˆ¶ã€‚'
                    }
                ],
                uploadTime: new Date().toISOString(),
                tags: ['è¾¹ç•Œå±‚', 'æ™®æœ—ç‰¹', 'ç²˜æ€§æµåŠ¨']
            }
        ];
         
        // å½“å‰ç™»å½•ç”¨æˆ·
        let currentUser = null;
        
        // ==================== æ•°æ®ç®¡ç†ç³»ç»Ÿ ====================
        
        // ä»GitHubåŠ è½½æ‰€æœ‰æ•°æ®
        async function loadDataFromGitHub() {
            if (isDataLoading) {
                console.log('â³ æ•°æ®åŠ è½½ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚');
                return;
            }
            
            isDataLoading = true;
            
            try {
                console.log('ğŸ”„ å¼€å§‹ä»GitHubåŠ è½½æ•°æ®...');
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„GitHubé…ç½®
                if (!hasValidGitHubConfig()) {
                    console.log('âš ï¸ æ²¡æœ‰æœ‰æ•ˆçš„GitHubé…ç½®ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®');
                    updateGitHubStatus(false);
                    // åªå¯¹æ•™å¸ˆæ˜¾ç¤ºGitHubé…ç½®æç¤º
                    if (currentUser && accounts[currentUser] && accounts[currentUser].role === 'teacher') {
                        showMessage('è¯·é…ç½®GitHub Tokenä»¥å¯ç”¨äº‘ç«¯åŒæ­¥', 'info');
                    }
                    return;
                }
                
                // éªŒè¯token
                const tokenValid = await githubStorage.validateToken();
                if (!tokenValid) {
                    console.warn('âš ï¸ GitHub TokenéªŒè¯å¤±è´¥');
                    updateGitHubStatus(false);
                    // åªå¯¹æ•™å¸ˆæ˜¾ç¤ºGitHubé…ç½®æç¤º
                    if (currentUser && accounts[currentUser] && accounts[currentUser].role === 'teacher') {
                        showMessage('GitHub Tokenæ— æ•ˆï¼Œè¯·é‡æ–°é…ç½®', 'warning');
                    }
                    return;
                } else {
                    updateGitHubStatus(true);
                    console.log('æ•°æ®åŠ è½½æˆåŠŸ');
                }
                
                // å°è¯•åŠ è½½æ•°æ®ï¼ˆå¤±è´¥ä¹Ÿä¸å½±å“ç³»ç»Ÿè¿è¡Œï¼‰
                try {
                    if (githubStorage && typeof githubStorage.getFile === 'function') {
                        const userData = await githubStorage.getFile('data/users.json');
                        if (userData && typeof userData === 'object' && Object.keys(userData).length > 0) {
                            // ä¿å­˜åŸå§‹è´¦å·æ•°æ®
                            const originalAccounts = { ...accounts };
                            // åˆå¹¶ç”¨æˆ·æ•°æ®ï¼Œä¿ç•™åŸæœ‰é»˜è®¤è´¦å·
                            accounts = { ...originalAccounts, ...userData };
                            console.log('âœ… ç”¨æˆ·æ•°æ®åŠ è½½æˆåŠŸï¼Œå½“å‰è´¦å·æ•°é‡:', Object.keys(accounts).length);
                        } else {
                            console.log('ğŸ“„ GitHubç”¨æˆ·æ•°æ®ä¸ºç©ºï¼Œä¿æŒé»˜è®¤è´¦å·');
                        }
                    } else {
                        console.log('ğŸ“„ GitHubå­˜å‚¨ä¸å¯ç”¨ï¼Œä¿æŒé»˜è®¤è´¦å·');
                    }
                } catch (e) {
                    console.log('ğŸ“„ ç”¨æˆ·æ•°æ®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®:', e.message);
                }
                
                // ç¡®ä¿è´¦å·æ•°æ®å®Œæ•´æ€§
                console.log('ğŸ” å½“å‰å¯ç”¨è´¦å·:', Object.keys(accounts));
                console.log('ğŸ” è´¦å·æ•°æ®å®Œæ•´æ€§æ£€æŸ¥:', accounts);
                
                try {
                    const videoData = await githubStorage.getFile('data/videos.json');
                    if (videoData && Array.isArray(videoData) && videoData.length > 0) {
                        videosData = videoData;
                        console.log('âœ… è§†é¢‘æ•°æ®åŠ è½½æˆåŠŸ:', videosData.length + 'ä¸ªè§†é¢‘');
                        setTimeout(() => rebuildVideoList(), 200);
                    } else {
                        // å¦‚æœGitHubä¸Šæ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®å¹¶ä¸Šä¼ 
                        console.log('ğŸ“¹ GitHubä¸Šæ— è§†é¢‘æ•°æ®ï¼Œåˆå§‹åŒ–é»˜è®¤å†…å®¹');
                        videosData = [...defaultVideosData];
                        setTimeout(() => rebuildVideoList(), 200);
                        setTimeout(async () => {
                            await saveVideosToGitHub();
                            console.log('âœ… é»˜è®¤è§†é¢‘æ•°æ®å·²ä¸Šä¼ åˆ°GitHub');
                        }, 1000);
                    }
                } catch (e) {
                    console.log('ğŸ“„ è§†é¢‘æ•°æ®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®:', e.message);
                    videosData = [...defaultVideosData];
                    setTimeout(() => rebuildVideoList(), 200);
                }
                
                try {
                    const exerciseData = await githubStorage.getFile('data/exercises.json');
                    if (exerciseData && Array.isArray(exerciseData) && exerciseData.length > 0) {
                        exercisesData = exerciseData;
                        console.log('âœ… é¢˜åº“æ•°æ®åŠ è½½æˆåŠŸ:', exercisesData.length + 'ä¸ªé¢˜ç›®');
                        setTimeout(() => rebuildExerciseList(), 200);
                    } else {
                        // å¦‚æœGitHubä¸Šæ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®å¹¶ä¸Šä¼ 
                        console.log('ğŸ“š GitHubä¸Šæ— é¢˜åº“æ•°æ®ï¼Œåˆå§‹åŒ–é»˜è®¤å†…å®¹');
                        exercisesData = [...defaultExercisesData];
                        setTimeout(() => rebuildExerciseList(), 200);
                        setTimeout(async () => {
                            await saveExercisesToGitHub();
                            console.log('âœ… é»˜è®¤é¢˜åº“æ•°æ®å·²ä¸Šä¼ åˆ°GitHub');
                        }, 1500);
                    }
                } catch (e) {
                    console.log('ğŸ“„ é¢˜åº“æ•°æ®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®:', e.message);
                    exercisesData = [...defaultExercisesData];
                    setTimeout(() => rebuildExerciseList(), 200);
                }
                
                showMessage('æ•°æ®åŠ è½½å®Œæˆï¼', 'success');
                console.log('ğŸ‰ GitHubæ•°æ®åŠ è½½æµç¨‹å®Œæˆ');
                
            } catch (error) {
                console.error('âŒ GitHubæ•°æ®åŠ è½½å¼‚å¸¸:', error.message);
                updateGitHubStatus(false);
                console.log('ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡å¼');
            } finally {
                isDataLoading = false;
            }
        }
        
        // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°GitHub
        async function saveUsersToGitHub() {
            try {
                console.log('ğŸ’¾ å‡†å¤‡ä¿å­˜ç”¨æˆ·æ•°æ®...');
                const success = await githubStorage.saveFile('data/users.json', accounts, 'æ›´æ–°ç”¨æˆ·æ•°æ®');
                if (success) {
                    console.log('âœ… ç”¨æˆ·æ•°æ®ä¿å­˜æˆåŠŸ');
                    return true;
                } else {
                    console.error('âŒ ç”¨æˆ·æ•°æ®ä¿å­˜å¤±è´¥');
                    return false;
                }
            } catch (error) {
                console.error('âŒ ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°GitHubå¤±è´¥:', error);
                return false;
            }
        }
        
        // ä¿å­˜è§†é¢‘æ•°æ®åˆ°GitHub
        async function saveVideosToGitHub() {
            try {
                console.log('ğŸ’¾ å‡†å¤‡ä¿å­˜è§†é¢‘æ•°æ®...', videosData.length + 'ä¸ªè§†é¢‘');
                
                // æ¸…ç†è§†é¢‘æ•°æ®ï¼Œç§»é™¤ä¸´æ—¶çš„Blob URL
                const cleanVideosData = videosData.map(video => {
                    const cleanVideo = { ...video };
                    // å¦‚æœæ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œä¸ä¿å­˜sourceï¼ˆBlob URLï¼‰
                    if (cleanVideo.type === 'file' && cleanVideo.source && cleanVideo.source.startsWith('blob:')) {
                        delete cleanVideo.source;
                    }
                    return cleanVideo;
                });
                
                const success = await githubStorage.saveFile('data/videos.json', cleanVideosData, 'æ›´æ–°è§†é¢‘æ•°æ®');
                if (success) {
                    console.log('âœ… è§†é¢‘æ•°æ®ä¿å­˜æˆåŠŸ');
                    showMessage('ğŸ“¹ è§†é¢‘å·²ä¿å­˜åˆ°äº‘ç«¯', 'success');
                    return true;
                } else {
                    console.error('âŒ è§†é¢‘æ•°æ®ä¿å­˜å¤±è´¥');
                    showMessage('âŒ è§†é¢‘ä¿å­˜å¤±è´¥', 'error');
                    return false;
                }
            } catch (error) {
                console.error('âŒ ä¿å­˜è§†é¢‘æ•°æ®åˆ°GitHubå¤±è´¥:', error);
                showMessage('âŒ è§†é¢‘ä¿å­˜å¤±è´¥', 'error');
                return false;
            }
        }
        
        // ä¿å­˜é¢˜åº“æ•°æ®åˆ°GitHub
        async function saveExercisesToGitHub() {
            try {
                console.log('ğŸ’¾ å‡†å¤‡ä¿å­˜é¢˜åº“æ•°æ®...', exercisesData.length + 'ä¸ªé¢˜ç›®');
                
                // æ¸…ç†é¢˜åº“æ•°æ®ï¼Œç§»é™¤ä¸éœ€è¦çš„ä¸´æ—¶æ•°æ®
                const cleanExercisesData = exercisesData.map(exercise => {
                    const cleanExercise = { ...exercise };
                    // æ¸…ç†æ–‡ä»¶æ•°æ®ï¼Œåªä¿ç•™å…ƒä¿¡æ¯
                    if (cleanExercise.files) {
                        cleanExercise.files = cleanExercise.files.map(file => ({
                            name: file.name,
                            size: file.size,
                            type: file.type
                        }));
                    }
                    return cleanExercise;
                });
                
                const success = await githubStorage.saveFile('data/exercises.json', cleanExercisesData, 'æ›´æ–°é¢˜åº“æ•°æ®');
                if (success) {
                    console.log('âœ… é¢˜åº“æ•°æ®ä¿å­˜æˆåŠŸ');
                    showMessage('ğŸ“š é¢˜åº“å·²ä¿å­˜åˆ°äº‘ç«¯', 'success');
                    return true;
                } else {
                    console.error('âŒ é¢˜åº“æ•°æ®ä¿å­˜å¤±è´¥');
                    showMessage('âŒ é¢˜åº“ä¿å­˜å¤±è´¥', 'error');
                    return false;
                }
            } catch (error) {
                console.error('âŒ ä¿å­˜é¢˜åº“æ•°æ®åˆ°GitHubå¤±è´¥:', error);
                showMessage('âŒ é¢˜åº“ä¿å­˜å¤±è´¥', 'error');
                return false;
            }
        }
        
        // é‡å»ºè§†é¢‘åˆ—è¡¨
        function rebuildVideoList() {
            const videoGrid = document.querySelector('.video-grid');
            if (!videoGrid) return;
            
            // æ¸…é™¤å·²æœ‰çš„ä¸Šä¼ è§†é¢‘ï¼ˆä¿ç•™åŸå§‹çš„ç‰¹è‰²è§†é¢‘ï¼‰
            const uploadedCards = videoGrid.querySelectorAll('[data-video-id]');
            uploadedCards.forEach(card => card.remove());
            
            // é‡æ–°åˆ›å»ºè§†é¢‘å¡ç‰‡
            videosData.forEach(video => {
                recreateVideoCardFromData(video);
            });
        }
        
        // ä»æ•°æ®é‡å»ºè§†é¢‘å¡ç‰‡
        function recreateVideoCardFromData(videoData) {
            const videoGrid = document.querySelector('.video-grid');
            if (!videoGrid) return;
            
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            videoCard.setAttribute('data-video-id', videoData.id);
            
            // æ ¹æ®è§†é¢‘ç±»å‹è®¾ç½®å›¾æ ‡å’Œæ–‡æœ¬
            let sourceIcon, sourceText, platformBadge = '';
            
            if (videoData.type === 'douyin') {
                sourceIcon = 'fab fa-tiktok';
                sourceText = 'æŠ–éŸ³è§†é¢‘';
                platformBadge = '<div class="platform-badge" style="position: absolute; top: 10px; right: 10px; background: #ff0050; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;"><i class="fab fa-tiktok"></i> æŠ–éŸ³</div>';
            } else if (videoData.type === 'file') {
                sourceIcon = 'fas fa-file-video';
                sourceText = 'æœ¬åœ°æ–‡ä»¶';
            } else if (videoData.platform === 'Bç«™') {
                sourceIcon = 'fab fa-bilibili';
                sourceText = 'Bç«™è§†é¢‘';
                platformBadge = '<div class="platform-badge" style="position: absolute; top: 10px; right: 10px; background: #00bcd4; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;"><i class="fab fa-bilibili"></i> Bç«™</div>';
            } else if (videoData.platform === 'GitHubå­˜å‚¨' || videoData.type === 'file') {
                sourceIcon = 'fab fa-github';
                sourceText = 'GitHubå­˜å‚¨';
                platformBadge = '<div class="platform-badge" style="position: absolute; top: 10px; right: 10px; background: #24292e; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;"><i class="fab fa-github"></i> GitHub</div>';
            } else {
                sourceIcon = 'fas fa-link';
                sourceText = 'åœ¨çº¿é“¾æ¥';
            }
            
            // åˆ›å»ºæ’­æ”¾æŒ‰é’®
            const playButtonDiv = document.createElement('div');
            playButtonDiv.className = 'play-button';
            playButtonDiv.onclick = function() {
                if (videoData.type === 'douyin') {
                    // æŠ–éŸ³è§†é¢‘æ‰“å¼€æ–°çª—å£
                    openDouyinVideo(videoData.source);
                } else if (videoData.platform === 'Bç«™' || videoData.source.includes('bilibili.com')) {
                    // Bç«™è§†é¢‘ä½¿ç”¨æ™ºèƒ½æ’­æ”¾å™¨
                    playCustomVideo(videoData.source, videoData.title, 'link');
                } else if (videoData.type === 'file' || videoData.platform === 'GitHubå­˜å‚¨') {
                    // GitHubå­˜å‚¨çš„æ–‡ä»¶ç›´æ¥æ’­æ”¾
                    if (videoData.source && videoData.source.startsWith('http')) {
                        playCustomVideo(videoData.source, videoData.title, 'file');
                    } else {
                        showMessage('è§†é¢‘æ–‡ä»¶é“¾æ¥æ— æ•ˆï¼Œè¯·é‡æ–°ä¸Šä¼ ', 'error');
                    }
                } else {
                    // åœ¨çº¿è§†é¢‘ç›´æ¥æ’­æ”¾
                    playCustomVideo(videoData.source, videoData.title, videoData.type);
                }
            };
            
            if (videoData.type === 'douyin') {
                playButtonDiv.innerHTML = '<i class="fab fa-tiktok"></i>';
                playButtonDiv.style.background = '#ff0050';
            } else {
                playButtonDiv.innerHTML = '<i class="fas fa-play"></i>';
            }
            
            // åˆ›å»ºè§†é¢‘é¢„è§ˆ
            const videoPreviewDiv = document.createElement('div');
            videoPreviewDiv.className = 'video-preview';
            videoPreviewDiv.style.position = 'relative';
            
            if (videoData.type === 'douyin') {
                videoPreviewDiv.innerHTML = '<i class="fab fa-tiktok" style="color: #ff0050; font-size: 3em;"></i>';
            } else {
                videoPreviewDiv.innerHTML = '<i class="fas fa-video"></i>';
            }
            
            videoPreviewDiv.appendChild(playButtonDiv);
            videoPreviewDiv.insertAdjacentHTML('beforeend', platformBadge);
            
            // åˆ›å»ºè§†é¢‘ä¿¡æ¯
            const videoInfoDiv = document.createElement('div');
            videoInfoDiv.className = 'video-info';
            
            const uploadTime = videoData.uploadTime ? 
                new Date(videoData.uploadTime).toLocaleDateString() : 'æ–°ä¸Šä¼ ';
            
            // æ ¼å¼åŒ–æ—¶é•¿
                                         let durationText = '';
                             if (videoData.duration) {
                                 durationText = videoHelper.formatTime(videoData.duration);
                             }
            
            let statusText;
            if (videoData.type === 'douyin') {
                const platform = videoHelper.detectPlatform(videoData.source);
                statusText = `
                    <div style="color: #ff0050;"><i class="${sourceIcon}"></i> ${platform}è§†é¢‘</div>
                    ${durationText ? `<div><i class="far fa-clock"></i> ${durationText}</div>` : ''}
                `;
            } else if (videoData.platform === 'Bç«™') {
                statusText = `
                    <div style="color: #00bcd4;"><i class="${sourceIcon}"></i> ${sourceText}</div>
                    ${videoData.duration ? `<div><i class="far fa-clock"></i> ${videoData.duration}</div>` : ''}
                    ${videoData.viewCount ? `<div><i class="far fa-eye"></i> ${videoData.viewCount.toLocaleString()} æ¬¡è§‚çœ‹</div>` : ''}
                `;
            } else if (videoData.platform === 'GitHubå­˜å‚¨' || videoData.type === 'file') {
                statusText = `
                    <div style="color: #24292e;"><i class="${sourceIcon}"></i> ${sourceText}</div>
                    ${videoData.fileName ? `<div><i class="fas fa-file"></i> ${videoData.fileName}</div>` : ''}
                    ${videoData.fileSize ? `<div><i class="fas fa-hdd"></i> ${formatFileSize(videoData.fileSize)}</div>` : ''}
                `;
            } else {
                statusText = `<div><i class="${sourceIcon}"></i> ${sourceText}</div>`;
            }
            
            // éš¾åº¦æ ‡ç­¾
            let difficultyBadge = '';
            if (videoData.difficulty) {
                const difficultyColors = {
                    'åŸºç¡€': '#28a745',
                    'ä¸­çº§': '#ffc107', 
                    'é«˜çº§': '#dc3545'
                };
                const color = difficultyColors[videoData.difficulty] || '#6c757d';
                difficultyBadge = `<span style="background: ${color}; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; margin-left: 8px;">${videoData.difficulty}</span>`;
            }
            
            videoInfoDiv.innerHTML = `
                <h3 class="video-title">${escapeHtml(videoData.title)}${difficultyBadge}</h3>
                <p class="video-description">${escapeHtml(videoData.description)}</p>
                <div class="video-duration">
                    <div><i class="far fa-calendar"></i> ${uploadTime}</div>
                    ${statusText}
                    ${videoData.category ? `<div><i class="fas fa-tag"></i> ${videoData.category}</div>` : ''}
                </div>
            `;
            
            // ç»„è£…è§†é¢‘å¡ç‰‡
            videoCard.appendChild(videoPreviewDiv);
            videoCard.appendChild(videoInfoDiv);
            
            // æ’å…¥åˆ°ç‰¹è‰²è§†é¢‘åé¢
            const featuredVideo = videoGrid.querySelector('.video-card.featured');
            if (featuredVideo) {
                featuredVideo.parentNode.insertBefore(videoCard, featuredVideo.nextSibling);
            } else {
                videoGrid.appendChild(videoCard);
            }
        }
        
        // æ‰“å¼€æŠ–éŸ³è§†é¢‘
        function openDouyinVideo(url) {
            const douyinWindow = window.open(url, '_blank');
            if (douyinWindow) {
                showMessage('ğŸš€ å·²æ‰“å¼€æŠ–éŸ³è§†é¢‘é¡µé¢', 'info');
            } else {
                showMessage('âŒ æ— æ³•æ‰“å¼€æŠ–éŸ³é¡µé¢ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®', 'error');
                // æä¾›æ‰‹åŠ¨é“¾æ¥
                const linkHtml = `
                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 15px 0; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px;">
                        <h4 style="color: #856404; margin-bottom: 15px; text-align: center;">
                            <i class="fab fa-tiktok"></i> æŠ–éŸ³è§†é¢‘é“¾æ¥
                        </h4>
                        <p style="margin-bottom: 15px; text-align: center;">è¯·æ‰‹åŠ¨è®¿é—®æŠ–éŸ³è§†é¢‘:</p>
                        <div style="text-align: center;">
                            <a href="${url}" target="_blank" 
                               style="display: inline-block; background: #ff0050; color: white; padding: 12px 20px; text-decoration: none; border-radius: 25px; margin-right: 10px; font-weight: bold;">
                                <i class="fab fa-tiktok"></i> æ‰“å¼€æŠ–éŸ³è§†é¢‘
                            </a>
                            <button onclick="this.parentElement.parentElement.remove()" 
                                    style="background: #6c757d; color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-weight: bold;">
                                å…³é—­
                            </button>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', linkHtml);
            }
        }
        
        // é‡å»ºé¢˜åº“åˆ—è¡¨
        function rebuildExerciseList() {
            const exerciseGrid = document.querySelector('.exercise-grid');
            if (!exerciseGrid) return;
            
            // æ¸…é™¤å·²æœ‰çš„ä¸Šä¼ é¢˜ç›®
            const uploadedCards = exerciseGrid.querySelectorAll('[data-exercise-id]');
            uploadedCards.forEach(card => card.remove());
            
            // é‡æ–°åˆ›å»ºé¢˜ç›®å¡ç‰‡
            exercisesData.forEach(exercise => {
                recreateExerciseCardFromData(exercise);
            });
        }
        
        // ä»æ•°æ®é‡å»ºé¢˜ç›®å¡ç‰‡
        function recreateExerciseCardFromData(exerciseData) {
            const exerciseGrid = document.querySelector('.exercise-grid');
            if (!exerciseGrid) return;
            
            const exerciseCard = document.createElement('div');
            exerciseCard.className = 'exercise-card';
            exerciseCard.setAttribute('data-exercise-id', exerciseData.id);
            
            const uploadTime = exerciseData.uploadTime ? 
                new Date(exerciseData.uploadTime).toLocaleDateString() : 'æ–°ä¸Šä¼ ';
            
            exerciseCard.innerHTML = `
                <div class="exercise-title">${escapeHtml(exerciseData.title)}</div>
                <div class="exercise-meta">
                    <span><i class="fas fa-tag"></i> ${exerciseData.category || 'æœªåˆ†ç±»'}</span>
                    <span><i class="far fa-clock"></i> ${uploadTime}</span>
                </div>
                <div class="exercise-description">${escapeHtml(exerciseData.description)}</div>
                <div class="exercise-actions">
                    <button class="exercise-btn" onclick="startExercise('${exerciseData.id}')">
                        <i class="fas fa-play"></i> å¼€å§‹ç»ƒä¹ 
                    </button>
                </div>
            `;
            
            exerciseGrid.appendChild(exerciseCard);
        }
        
        // åˆ†æ•°çº¿æ•°æ®
        const scoreData = {
            years: [2020, 2021, 2022, 2023, 2024, 2025],
            reexamScores: [288, 313, 292, 294, 288, 274],    // å¤è¯•çº¿
            nationalScores: [288, 280, 290, 279, 288, 274],  // å›½å®¶çº¿
            applicants: [null, null, 110, 105, 120, 125],    // æŠ¥åäººæ•°
            admitted: [null, 29, 35, 27, 37, 35],            // å½•å–äººæ•°
            reexamCandidates: [null, 32, 43, 30, 37, 35],    // å¤è¯•äººæ•°
            reexamRatio: [null, 1.33, 1.3, 1.2, 1, 1]       // å¤è¯•æ¯”ä¾‹
        };
        
        // å¼ºåˆ¶åŒæ­¥ç™»å½•å¤„ç†å‡½æ•°
        function handleLogin() {
            try {
                console.log('ğŸ” å¼€å§‹ç™»å½•æµç¨‹');
                
                const usernameElement = document.getElementById('username');
                const passwordElement = document.getElementById('password');
                const loginError = document.getElementById('loginError');
                
                if (!usernameElement || !passwordElement) {
                    console.error('âŒ ç™»å½•è¡¨å•å…ƒç´ æœªæ‰¾åˆ°');
                    alert('ç™»å½•è¡¨å•åŠ è½½é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    return false;
                }
                
                const username = usernameElement.value.trim();
                const password = passwordElement.value;
                
                console.log('ğŸ“ è¾“å…¥ä¿¡æ¯:', { username: username, hasPassword: !!password, passwordLength: password.length });
                console.log('ğŸ“Š å½“å‰accountså¯¹è±¡:', accounts);
                console.log('ğŸ“‹ å¯ç”¨è´¦å·åˆ—è¡¨:', Object.keys(accounts));
                
                // éšè—ä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
                if (loginError) {
                    loginError.style.display = 'none';
                }
                
                // éªŒè¯è¾“å…¥
                if (!username || !password) {
                    console.log('âŒ è¾“å…¥éªŒè¯å¤±è´¥');
                    showLoginError('è¯·è¾“å…¥è´¦å·å’Œå¯†ç ');
                    return false;
                }
                
                // ç¡®ä¿accountså¯¹è±¡å­˜åœ¨
                if (!accounts || typeof accounts !== 'object') {
                    console.error('âŒ accountså¯¹è±¡ä¸å­˜åœ¨æˆ–æŸå');
                    // é‡æ–°åˆå§‹åŒ–é»˜è®¤è´¦å·
                    accounts = {
                        'liuguanghui6330156': { name: 'åˆ˜å…‰è¾‰', role: 'teacher', password: 'Ll700306', color: 'teacher' },
                        'student1': { name: 'å­¦ç”Ÿè´¦å·', role: 'student', password: '123456', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] },
                        'niwenxuan': { name: 'å€ªæ–‡è½©', role: 'student', password: 'niwenxuan2025', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] },
                        'hanwenxu': { name: 'éŸ©æ–‡æ—­', role: 'student', password: 'hanwenxu2025', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] }
                    };
                    console.log('ğŸ”„ å·²é‡æ–°åˆå§‹åŒ–è´¦å·æ•°æ®');
                }
                
                // æŸ¥æ‰¾è´¦å·
                const account = accounts[username];
                console.log('ğŸ” è´¦å·æŸ¥æ‰¾ç»“æœ:', account);
                
                if (!account) {
                    console.log('âŒ è´¦å·ä¸å­˜åœ¨');
                    console.log('ğŸ’¡ æç¤ºï¼šå¯ç”¨çš„è´¦å·æœ‰:');
                    Object.keys(accounts).forEach(key => {
                        console.log(`   - ${key} (${accounts[key].name})`);
                    });
                    showLoginError('ç”¨æˆ·åä¸å­˜åœ¨ã€‚è¯·æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®ã€‚');
                    return false;
                }
                
                // éªŒè¯å¯†ç 
                console.log('ğŸ”‘ å¯†ç éªŒè¯:', { 
                    input: password, 
                    stored: account.password, 
                    match: password === account.password 
                });
                
                if (account.password !== password) {
                    console.log('âŒ å¯†ç é”™è¯¯');
                    showLoginError('å¯†ç é”™è¯¯ã€‚è¯·æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®ã€‚');
                    return false;
                }
                
                console.log('âœ… ç™»å½•éªŒè¯æˆåŠŸï¼Œæ‰§è¡Œç™»å½•');
                
                // ç¡®ä¿loginå‡½æ•°å­˜åœ¨
                if (typeof login === 'function') {
                    login(username);
                } else {
                    console.error('âŒ loginå‡½æ•°æœªå®šä¹‰');
                    alert('ç™»å½•ç³»ç»Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
                
                return true;
                
            } catch (error) {
                console.error('ğŸ’¥ ç™»å½•è¿‡ç¨‹å‡ºé”™:', error);
                console.error('ğŸ’¥ é”™è¯¯å †æ ˆ:', error.stack);
                showLoginError('ç™»å½•è¿‡ç¨‹å‡ºç°é”™è¯¯: ' + error.message);
                return false;
            }
        }

        // ä¿®å¤æ‰€æœ‰è¡¨å•è¾…åŠ©åŠŸèƒ½
        function fixFormAccessibility() {
            console.log('ğŸ”§ ä¿®å¤è¡¨å•è¾…åŠ©åŠŸèƒ½');
            
            // æŸ¥æ‰¾æ‰€æœ‰ç¼ºå°‘æ ‡ç­¾çš„inputå…ƒç´ 
            const inputs = document.querySelectorAll('input');
            let fixedCount = 0;
            
            inputs.forEach((input, index) => {
                // æ£€æŸ¥æ˜¯å¦æœ‰aria-labelæˆ–å¯¹åº”çš„label
                const hasAriaLabel = input.hasAttribute('aria-label');
                const hasAriaLabelledBy = input.hasAttribute('aria-labelledby');
                const hasLabel = input.id && document.querySelector(`label[for="${input.id}"]`);
                
                if (!hasAriaLabel && !hasAriaLabelledBy && !hasLabel) {
                    // æ ¹æ®placeholderã€nameæˆ–typeç”Ÿæˆæ ‡ç­¾
                    let label = input.placeholder || 
                               input.name || 
                               input.type || 
                               `è¾“å…¥å­—æ®µ${index + 1}`;
                    
                    input.setAttribute('aria-label', label);
                    console.log(`ğŸ·ï¸ ä¸ºinputæ·»åŠ æ ‡ç­¾: ${label}`);
                    fixedCount++;
                }
                
                // ç¡®ä¿æ‰€æœ‰inputéƒ½æœ‰nameå±æ€§
                if (!input.name && input.id) {
                    input.name = input.id;
                }
                
                // ä¸ºå¯†ç å­—æ®µæ·»åŠ autocomplete
                if (input.type === 'password' && !input.autocomplete) {
                    input.autocomplete = 'current-password';
                }
                
                // ä¸ºç”¨æˆ·åå­—æ®µæ·»åŠ autocomplete
                if ((input.type === 'text' || input.type === 'email') && 
                    (input.name === 'username' || input.id === 'username') && 
                    !input.autocomplete) {
                    input.autocomplete = 'username';
                }
            });
            
            console.log(`âœ… ä¿®å¤äº† ${fixedCount} ä¸ªè¡¨å•å…ƒç´ çš„è¾…åŠ©åŠŸèƒ½`);
        }

        // å¼ºåˆ¶åˆå§‹åŒ–ç™»å½•ç³»ç»Ÿ
        function initializeLogin() {
            console.log('ğŸš€ å¼ºåˆ¶åˆå§‹åŒ–ç™»å½•ç³»ç»Ÿ');
            
            // é¦–å…ˆä¿®å¤è¡¨å•è¾…åŠ©åŠŸèƒ½
            fixFormAccessibility();
            
            // æ£€æŸ¥accountsæ•°æ®
            console.log('ğŸ“Š è´¦å·æ•°æ®æ£€æŸ¥:', {
                accountsExists: !!accounts,
                accountCount: Object.keys(accounts).length,
                teacherExists: !!accounts['liuguanghui6330156'],
                studentExists: !!accounts['student1']
            });
            
            // æŸ¥æ‰¾DOMå…ƒç´ 
            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            console.log('ğŸ” DOMå…ƒç´ æ£€æŸ¥:', {
                form: !!loginForm,
                button: !!loginBtn,
                username: !!usernameInput,
                password: !!passwordInput
            });
            
            // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œç­‰å¾…åé‡è¯•
            if (!loginForm || !loginBtn || !usernameInput || !passwordInput) {
                console.log('â³ DOMå…ƒç´ æœªå°±ç»ªï¼Œ1ç§’åé‡è¯•');
                setTimeout(initializeLogin, 1000);
                return;
            }
            
            // æ¸…é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨
            const newForm = loginForm.cloneNode(true);
            loginForm.parentNode.replaceChild(newForm, loginForm);
            
            // é‡æ–°è·å–å…ƒç´ å¼•ç”¨
            const form = document.getElementById('loginForm');
            const btn = document.getElementById('loginBtn');
            const username = document.getElementById('username');
            const password = document.getElementById('password');
            
            // ç»‘å®šäº‹ä»¶
            if (form) {
                form.addEventListener('submit', function(e) {
                    console.log('ğŸš€ è¡¨å•æäº¤äº‹ä»¶è§¦å‘');
                    e.preventDefault();
                    e.stopPropagation();
                    handleLogin();
                    return false;
                });
            }
            
            if (btn) {
                btn.addEventListener('click', function(e) {
                    console.log('ğŸš€ æŒ‰é’®ç‚¹å‡»äº‹ä»¶è§¦å‘');
                    e.preventDefault();
                    e.stopPropagation();
                    handleLogin();
                    return false;
                });
            }
            
            if (password) {
                password.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        console.log('ğŸš€ å›è½¦é”®ç™»å½•');
                        e.preventDefault();
                        e.stopPropagation();
                        handleLogin();
                        return false;
                    }
                });
            }
            
            console.log('âœ… ç™»å½•ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        }

        // åŸºç¡€ç™»å½•ç³»ç»Ÿåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ åŸºç¡€ç™»å½•ç³»ç»Ÿåˆå§‹åŒ–');
            
            // åˆå§‹åŒ–æ—§ç³»ç»Ÿï¼ˆå…¼å®¹æ€§ï¼‰
            if (typeof initializeLogin === 'function') {
                try {
                    initializeLogin();
                } catch (e) {
                    console.log('æ—§ç™»å½•ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€ç³»ç»Ÿ:', e);
                }
            }
            
            console.log('ğŸš€ åŸºç¡€ç™»å½•ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        });
        window.addEventListener('load', initializeLogin);
        
                         // å¤‡ç”¨åˆå§‹åŒ–
        setTimeout(initializeLogin, 500);
        setTimeout(initializeLogin, 1500);
        setTimeout(initializeLogin, 3000);
        
        // å¼ºåŒ–çš„fetchæ‹¦æˆªå™¨ï¼Œç«‹å³è§£å†³æ‰€æœ‰HTTPå¤´éƒ¨é—®é¢˜
        if (typeof window !== 'undefined' && !window.originalFetch) {
            window.originalFetch = window.fetch;
            window.fetch = function(...args) {
                return window.originalFetch(...args).then(response => {
                    // è·³è¿‡è·¨åŸŸèµ„æºï¼Œé¿å…CORSé—®é¢˜
                    const url = new URL(response.url);
                    if (url.origin !== window.location.origin) {
                        return response;
                    }
                    // åˆ›å»ºæ–°çš„å“åº”å¯¹è±¡ï¼Œæ·»åŠ å¿…è¦çš„å¤´éƒ¨
                    const headers = new Headers(response.headers);
                    
                    // å¼ºåˆ¶æ·»åŠ æ‰€æœ‰å¿…éœ€çš„å®‰å…¨å¤´éƒ¨
                    headers.set('X-Content-Type-Options', 'nosniff');
                    headers.set('X-Frame-Options', 'DENY');
                    headers.set('X-XSS-Protection', '1; mode=block');
                    headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');
                    headers.set('Permissions-Policy', 'camera=(), microphone=(), geolocation=()');
                    
                    // æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®ç¼“å­˜ç­–ç•¥å’ŒContent-Type
                    const pathname = url.pathname.toLowerCase();
                    
                    // å­—ä½“æ–‡ä»¶ç‰¹æ®Šå¤„ç†
                    if (/\.(woff2)$/i.test(pathname)) {
                        headers.set('Cache-Control', 'public, max-age=31536000, immutable');
                        headers.set('Content-Type', 'font/woff2');
                        // ç§»é™¤charset
                        headers.delete('charset');
                    } else if (/\.(woff|ttf|eot)$/i.test(pathname)) {
                        headers.set('Cache-Control', 'public, max-age=31536000, immutable');
                        const fontTypes = {
                            '.woff': 'font/woff',
                            '.ttf': 'font/ttf', 
                            '.eot': 'application/vnd.ms-fontobject'
                        };
                        const ext = pathname.match(/\.(woff|ttf|eot)$/i);
                        if (ext) {
                            headers.set('Content-Type', fontTypes[ext[0].toLowerCase()]);
                        }
                    } 
                    // é™æ€èµ„æºç¼“å­˜
                    else if (/\.(js|css|png|jpg|jpeg|gif|svg|ico|webp|mp4|pdf)$/i.test(pathname)) {
                        headers.set('Cache-Control', 'public, max-age=31536000, immutable');
                    } 
                    // HTMLæ–‡ä»¶ä¸ç¼“å­˜
                    else if (/\.html$/i.test(pathname) || !pathname.includes('.')) {
                        headers.set('Cache-Control', 'no-cache, no-store, must-revalidate');
                        headers.set('Pragma', 'no-cache');
                        // ä¸ä½¿ç”¨Expireså¤´éƒ¨ï¼Œåªç”¨Cache-Control
                        headers.delete('Expires');
                    }
                    
                    // JSONæ–‡ä»¶ç¼“å­˜ç­–ç•¥
                    if (/\.json$/i.test(pathname)) {
                        headers.set('Cache-Control', 'public, max-age=31536000, immutable');
                        headers.set('Content-Type', 'application/json');
                    }
                    
                    return new Response(response.body, {
                        status: response.status,
                        statusText: response.statusText,
                        headers: headers
                    });
                }).catch(error => {
                    console.error('Fetchæ‹¦æˆªå™¨é”™è¯¯:', error);
                    return window.originalFetch(...args);
                });
            };
            console.log('ğŸ”§ å¼ºåŒ–fetchæ‹¦æˆªå™¨å·²æ¿€æ´» - æ‰€æœ‰HTTPå¤´éƒ¨é—®é¢˜å·²è§£å†³');
        }
        
        // ç«‹å³æ³¨å†ŒService Workeræ¥è§£å†³GitHub Pages HTTPå¤´éƒ¨é™åˆ¶
        if ('serviceWorker' in navigator) {
            // ç«‹å³æ³¨å†Œï¼Œä¸ç­‰å¾…loadäº‹ä»¶
            navigator.serviceWorker.register('/sw.js', { scope: '/' })
                .then(function(registration) {
                    console.log('âœ… Service Worker registered successfully:', registration.scope);
                    
                    // å¼ºåˆ¶æ¿€æ´»æ–°çš„Service Worker
                    if (registration.installing) {
                        registration.installing.postMessage({ type: 'SKIP_WAITING' });
                    }
                    
                    // å¦‚æœå·²ç»æœ‰æ¿€æ´»çš„Service Workerï¼Œç«‹å³ä½¿ç”¨
                    if (registration.active && !navigator.serviceWorker.controller) {
                        console.log('ğŸ”„ Claiming clients immediately');
                        registration.active.postMessage({ type: 'CLAIM_CLIENTS' });
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed') {
                                console.log('ğŸ”„ New Service Worker available, activating...');
                                newWorker.postMessage({ type: 'SKIP_WAITING' });
                                // å¼ºåˆ¶åˆ·æ–°é¡µé¢ä»¥ä½¿ç”¨æ–°çš„Service Worker
                                setTimeout(() => window.location.reload(), 100);
                            }
                        });
                    });
                    
                    // ç›‘å¬Service Workeræ›´æ–°
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        console.log('ğŸ”„ Service Worker controller changed');
                        // ä¸è‡ªåŠ¨åˆ·æ–°ï¼Œè®©ç”¨æˆ·å†³å®š
                    });
                    
                    // å®šæœŸæ£€æŸ¥æ›´æ–°
                    setInterval(() => {
                        registration.update();
                    }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
                })
                .catch(function(error) {
                    console.log('âŒ Service Worker registration failed:', error);
                });
        } else {
            console.log('âŒ Service Worker not supported');
        }
        
        // å¼ºåˆ¶éªŒè¯HTTPå¤´éƒ¨å’Œç¼“å­˜ç­–ç•¥
        function validateHeaders() {
            console.log('ğŸ” éªŒè¯HTTPå¤´éƒ¨é…ç½®...');
            
            // æµ‹è¯•ä¸€ä¸ªå°èµ„æºæ¥æ£€æŸ¥å¤´éƒ¨
            fetch('/manifest.json', { 
                method: 'HEAD',
                cache: 'no-cache'
            }).then(response => {
                console.log('ğŸ“Š HTTPå¤´éƒ¨æ£€æŸ¥ç»“æœ:');
                console.log('- X-Content-Type-Options:', response.headers.get('X-Content-Type-Options'));
                console.log('- Cache-Control:', response.headers.get('Cache-Control'));
                console.log('- X-Frame-Options:', response.headers.get('X-Frame-Options'));
                console.log('- Content-Type:', response.headers.get('Content-Type'));
                
                if (!response.headers.get('X-Content-Type-Options')) {
                    console.log('âš ï¸ Service Workerå¯èƒ½è¿˜æœªç”Ÿæ•ˆï¼Œç­‰å¾…ä¸­...');
                    // 5ç§’åå†æ¬¡æ£€æŸ¥
                    setTimeout(validateHeaders, 5000);
                } else {
                    console.log('âœ… æ‰€æœ‰HTTPå¤´éƒ¨å·²æ­£ç¡®è®¾ç½®ï¼');
                }
            }).catch(error => {
                console.log('âŒ å¤´éƒ¨éªŒè¯å¤±è´¥:', error);
            });
        }
        
        // é¡µé¢åŠ è½½åéªŒè¯å¤´éƒ¨
        setTimeout(validateHeaders, 2000);
        
        // å¼ºåˆ¶æ¸…ç†æ‰€æœ‰ç¼“å­˜
        if ('caches' in window) {
            caches.keys().then(cacheNames => {
                console.log('ğŸ—‘ï¸ æ¸…ç†æ‰€æœ‰ç¼“å­˜:', cacheNames);
                return Promise.all(
                    cacheNames.map(cacheName => {
                        console.log('åˆ é™¤ç¼“å­˜:', cacheName);
                        return caches.delete(cacheName);
                    })
                );
            }).then(() => {
                console.log('âœ… æ‰€æœ‰ç¼“å­˜å·²æ¸…ç†');
            });
        }
        
        // å¼ºåˆ¶æ£€æŸ¥è¯­æ³•é”™è¯¯
        try {
            if (typeof showChangePasswordModal === 'undefined') {
                console.error('âŒ showChangePasswordModalå‡½æ•°æœªå®šä¹‰ï¼Œå¯èƒ½æœ‰è¯­æ³•é”™è¯¯');
                // å°è¯•é‡æ–°åŠ è½½é¡µé¢æ¸…ç†ç¼“å­˜
                setTimeout(() => {
                    if (confirm('æ£€æµ‹åˆ°è„šæœ¬é”™è¯¯ï¼Œæ˜¯å¦é‡æ–°åŠ è½½é¡µé¢ï¼Ÿ')) {
                        window.location.reload(true);
                    }
                }, 2000);
            } else {
                console.log('âœ… showChangePasswordModalå‡½æ•°å·²æ­£ç¡®å®šä¹‰');
            }
        } catch (e) {
            console.error('âŒ è„šæœ¬æ£€æŸ¥é”™è¯¯:', e);
        }
        
        // æ·»åŠ å¿«é€Ÿç™»å½•æµ‹è¯•åŠŸèƒ½ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
        // ==================== æœ€åŸºç¡€ç™»å½•ç³»ç»Ÿè„šæœ¬ ====================
        
        // ç¡®ä¿è´¦å·æ•°æ®å­˜åœ¨
        if (typeof window.accounts === 'undefined') {
            window.accounts = {
                'liuguanghui6330156': { name: 'åˆ˜å…‰è¾‰', role: 'teacher', password: 'Ll700306' },
                'student1': { name: 'å­¦ç”Ÿè´¦å·', role: 'student', password: '123456' },
                'niwenxuan': { name: 'å€ªæ–‡è½©', role: 'student', password: 'niwenxuan2025' },
                'hanwenxu': { name: 'éŸ©æ–‡æ—­', role: 'student', password: 'hanwenxu2025' }
            };
        }

        function basicShowError(msg) {
            const errorDiv = document.getElementById('basicErrorMsg');
            if (errorDiv) {
                errorDiv.textContent = msg;
                errorDiv.style.display = 'block';
                document.getElementById('basicSuccessMsg').style.display = 'none';
            }
        }

        function basicShowSuccess(msg) {
            const successDiv = document.getElementById('basicSuccessMsg');
            if (successDiv) {
                successDiv.textContent = msg;
                successDiv.style.display = 'block';
                document.getElementById('basicErrorMsg').style.display = 'none';
            }
        }

        function basicLogin() {
            const username = document.getElementById('basicUsername').value.trim();
            const password = document.getElementById('basicPassword').value;
            
            console.log('ğŸ” åŸºç¡€ç™»å½•ç³»ç»Ÿå¯åŠ¨');
            console.log('ğŸ“ å°è¯•ç™»å½•:', username);
            
            if (!username || !password) {
                basicShowError('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }
            
            const account = window.accounts[username];
            if (!account) {
                basicShowError('ç”¨æˆ·åä¸å­˜åœ¨');
                console.log('ğŸ’¡ å¯ç”¨è´¦å·:', Object.keys(window.accounts));
                return;
            }
            
            if (account.password !== password) {
                basicShowError('å¯†ç é”™è¯¯');
                return;
            }
            
            basicShowSuccess(`ç™»å½•æˆåŠŸï¼æ¬¢è¿ ${account.name} (${account.role})`);
            console.log('âœ… ç™»å½•æˆåŠŸ:', account);
            
            // è®¾ç½®å½“å‰ç”¨æˆ·
            window.currentUser = username;
            
            // å»¶è¿Ÿè·³è½¬
            setTimeout(() => {
                if (typeof login === 'function') {
                    login(username);
                } else {
                    // æ‰‹åŠ¨éšè—ç™»å½•ç•Œé¢
                    document.getElementById('loginContainer').style.display = 'none';
                    alert(`ç™»å½•å®Œæˆï¼æ¬¢è¿ä½¿ç”¨æµä½“åŠ›å­¦å­¦ä¹ å¹³å°`);
                }
            }, 1500);
        }

        function basicQuickTeacher() {
            document.getElementById('basicUsername').value = 'liuguanghui6330156';
            document.getElementById('basicPassword').value = 'Ll700306';
            setTimeout(basicLogin, 100);
        }

        function basicQuickStudent() {
            document.getElementById('basicUsername').value = 'student1';
            document.getElementById('basicPassword').value = '123456';
            setTimeout(basicLogin, 100);
        }

        function basicShowDebug() {
            console.log('=== åŸºç¡€ç™»å½•ç³»ç»Ÿè°ƒè¯•ä¿¡æ¯ ===');
            console.log('è´¦å·æ•°æ®:', window.accounts);
            console.log('å¯ç”¨è´¦å·:', Object.keys(window.accounts));
            console.log('å½“å‰ç”¨æˆ·:', window.currentUser);
            console.log('é¡µé¢å…ƒç´ :', {
                username: document.getElementById('basicUsername'),
                password: document.getElementById('basicPassword'),
                button: document.getElementById('basicLoginBtn')
            });
            console.log('å‡½æ•°æ£€æŸ¥:', {
                basicLogin: typeof basicLogin,
                login: typeof login
            });
            alert('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŒ‰F12æŸ¥çœ‹');
        }

        // å…¼å®¹æ—§å‡½æ•°å
        window.quickLoginTeacher = basicQuickTeacher;
        window.quickLoginStudent = basicQuickStudent;
        window.debugLoginSystem = basicShowDebug;
        window.performQuickLogin = function(type) {
            if (type === 'teacher') basicQuickTeacher();
            else basicQuickStudent();
        };
        window.performDebugLogin = basicShowDebug;
        window.quickLogin = function(username, password) {
            document.getElementById('basicUsername').value = username;
            document.getElementById('basicPassword').value = password;
            setTimeout(basicLogin, 100);
        };
        window.debugLogin = basicShowDebug;

        // å›è½¦é”®ç™»å½•
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('loginContainer').style.display !== 'none') {
                basicLogin();
            }
        });

        console.log('ğŸ¯ æœ€åŸºç¡€ç™»å½•ç³»ç»ŸåŠ è½½å®Œæˆ');
        console.log('ğŸ’¡ å¯ç”¨è´¦å·:', Object.keys(window.accounts));
        
        // ç™»å½•å‡½æ•°
        function login(username) {
            currentUser = username;
            const accountInfo = accounts[username];
            
            // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
            document.getElementById('usernameText').textContent = accountInfo.name;
            document.getElementById('userIcon').textContent = accountInfo.name.charAt(0);
            const roleBadge = document.getElementById('roleBadge');
            
            if (accountInfo.role === 'teacher') {
                roleBadge.textContent = 'æ•™å¸ˆ';
                roleBadge.className = 'role-badge teacher-badge';
                // æ•™å¸ˆå¯ä»¥çœ‹åˆ°æ‰€æœ‰åŠŸèƒ½
                showTeacherFeatures();
            } else {
                roleBadge.textContent = 'å­¦ç”Ÿ';
                roleBadge.className = 'role-badge student-badge';
                // å­¦ç”Ÿåªèƒ½çœ‹åˆ°å­¦ä¹ ç›¸å…³åŠŸèƒ½
                showStudentFeatures();
            }
            
            // éšè—ç™»å½•ç•Œé¢ï¼Œæ˜¾ç¤ºå¹³å°ç•Œé¢
            document.getElementById('loginContainer').style.display = 'none';
            const platformContainer = document.getElementById('platformContainer');
            platformContainer.style.display = 'block';
            
            // æ˜¾ç¤ºé»˜è®¤å†…å®¹åŒºåŸŸï¼ˆå¤ä¹ è§„åˆ’ï¼‰
            switchSection('review-section');
            
            // åˆå§‹åŒ–å®‰å…¨ä¿æŠ¤åŠŸèƒ½
            initSecurityProtection();
            
            // åŠ è½½å·²ä¸Šä¼ çš„è§†é¢‘
            setTimeout(() => {
                loadUploadedVideos();
            }, 500);
            
            // åˆ›å»ºåˆ†æ•°çº¿å›¾è¡¨
            createScoreChart();
            
            // æ·»åŠ è¿‡æ»¤å™¨ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateScoreChart(this.dataset.year);
                });
            });
            
            // åˆå§‹åŒ–æˆç»©å›¾è¡¨
            initGradeChart();
        }
        
        // æ˜¾ç¤ºæ•™å¸ˆåŠŸèƒ½
        function showTeacherFeatures() {
            // æ˜¾ç¤ºæ‰€æœ‰å¯¼èˆªé¡¹
            document.querySelectorAll('nav a').forEach(link => {
                link.style.display = 'block';
            });
            
            // æ˜¾ç¤ºä¸Šä¼ åŠŸèƒ½
            const uploadSections = document.querySelectorAll('.upload-section');
            uploadSections.forEach(section => {
                section.style.display = 'flex';
            });
            
            // æ˜¾ç¤ºæ•™å¸ˆæˆç»©å½•å…¥ç•Œé¢
            const gradeInputForm = document.getElementById('gradeInputForm');
            const studentGradeDisplay = document.getElementById('studentGradeDisplay');
            if (gradeInputForm) gradeInputForm.style.display = 'flex';
            if (studentGradeDisplay) studentGradeDisplay.style.display = 'none';
            
            // è®¾ç½®æ•™å¸ˆæ¨¡å¼æ ‡é¢˜
            const gradeSectionTitle = document.getElementById('gradeSectionTitle');
            if (gradeSectionTitle) {
                gradeSectionTitle.textContent = 'æˆç»©å½•å…¥ç³»ç»Ÿ';
            }
            
            // æ˜¾ç¤ºGitHubè®¾ç½®æŒ‰é’®ï¼ˆä»…æ•™å¸ˆå¯è§ï¼‰
            const githubSettingsBtn = document.getElementById('githubSettingsBtn');
            if (githubSettingsBtn) {
                githubSettingsBtn.style.display = 'block';
                githubSettingsBtn.classList.remove('student-hidden');
            }
        }
        
        // æ˜¾ç¤ºå­¦ç”ŸåŠŸèƒ½
        function showStudentFeatures() {
            // éšè—æ•™å¸ˆä¸“ç”¨å¯¼èˆªé¡¹
            const teacherNavItems = document.querySelectorAll('nav a[onclick*="grade-section"]');
            teacherNavItems.forEach(link => {
                link.style.display = 'none';
            });
            
            // éšè—ä¸Šä¼ åŠŸèƒ½
            const uploadSections = document.querySelectorAll('.upload-section');
            uploadSections.forEach(section => {
                section.style.display = 'none';
            });
            
            // æ˜¾ç¤ºå­¦ç”Ÿæˆç»©ç•Œé¢
            const gradeInputForm = document.getElementById('gradeInputForm');
            const studentGradeDisplay = document.getElementById('studentGradeDisplay');
            if (gradeInputForm) gradeInputForm.style.display = 'none';
            if (studentGradeDisplay) studentGradeDisplay.style.display = 'block';
            
            // è®¾ç½®å­¦ç”Ÿæ¨¡å¼æ ‡é¢˜
            const gradeSectionTitle = document.getElementById('gradeSectionTitle');
            if (gradeSectionTitle) {
                gradeSectionTitle.textContent = 'æˆ‘çš„æˆç»©';
            }
            
            // éšè—GitHubè®¾ç½®æŒ‰é’®ï¼ˆå­¦ç”Ÿä¸å¯è§ï¼‰
            const githubSettingsBtn = document.getElementById('githubSettingsBtn');
            if (githubSettingsBtn) {
                githubSettingsBtn.style.display = 'none';
                githubSettingsBtn.classList.add('student-hidden');
            }
            
            // æ›´æ–°å­¦ç”Ÿè¿›åº¦æ˜¾ç¤º
            updateStudentProgress();
            // æ›´æ–°å­¦ç”Ÿæˆç»©æ˜¾ç¤º
            updateStudentGradeDisplay();
        }
        
        // æ›´æ–°å­¦ç”Ÿè¿›åº¦æ˜¾ç¤º
        function updateStudentProgress() {
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                // æ›´æ–°é¢˜åº“è¿›åº¦
                const progressFill = document.querySelector('.progress-fill');
                const progressText = document.querySelector('.progress-text');
                const progressSpan = document.getElementById('studentProgressText');
                
                const progress = accountInfo.progress || 0;
                
                if (progressFill && progressText) {
                    progressFill.style.width = progress + '%';
                    progressText.textContent = progress + '%';
                }
                
                if (progressSpan) {
                    progressSpan.textContent = `å·²å®Œæˆ ${progress}%`;
                }
                
                // æ›´æ–°å­¦ä¹ ç»Ÿè®¡
                updateStudentStats(accountInfo);
            }
        }
        
        // æ›´æ–°å­¦ç”Ÿç»Ÿè®¡ä¿¡æ¯
        function updateStudentStats(accountInfo) {
            // è®¡ç®—è§†é¢‘å­¦ä¹ è¿›åº¦
            const videoProgress = accountInfo.videoProgress || 0;
            const videoText = document.querySelector('.stat-card:nth-child(1) p');
            if (videoText) {
                videoText.textContent = `${videoProgress}/7 è¯¾ç¨‹`;
            }
            
            // è®¡ç®—é¢˜ç›®ç»ƒä¹ è¿›åº¦
            const questionProgress = accountInfo.questionProgress || 0;
            const questionText = document.querySelector('.stat-card:nth-child(2) p');
            if (questionText) {
                questionText.textContent = `${questionProgress}/37 é¢˜`;
            }
            
            // è®¡ç®—å¹³å‡æˆç»©
            const grades = accountInfo.grades || [];
            const avgGradeText = document.querySelector('.stat-card:nth-child(3) p');
            if (avgGradeText) {
                if (grades.length > 0) {
                    const avgGrade = grades.reduce((sum, grade) => sum + grade, 0) / grades.length;
                    avgGradeText.textContent = `${avgGrade.toFixed(1)} åˆ†`;
                } else {
                    avgGradeText.textContent = '-- åˆ†';
                }
            }
            
            // è®¡ç®—å­¦ä¹ æ—¶é•¿
            const studyTime = accountInfo.studyTime || 0;
            const timeText = document.querySelector('.stat-card:nth-child(4) p');
            if (timeText) {
                timeText.textContent = `${studyTime} å°æ—¶`;
            }
        }
        
        // è®°å½•è§†é¢‘å­¦ä¹ è¿›åº¦
        function recordVideoProgress(videoId) {
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                // åˆå§‹åŒ–è§†é¢‘å­¦ä¹ è®°å½•
                if (!accountInfo.watchedVideos) {
                    accountInfo.watchedVideos = [];
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»çœ‹è¿‡è¿™ä¸ªè§†é¢‘
                if (!accountInfo.watchedVideos.includes(videoId)) {
                    accountInfo.watchedVideos.push(videoId);
                    accountInfo.videoProgress = accountInfo.watchedVideos.length;
                    
                    // æ›´æ–°æ€»ä½“è¿›åº¦
                    const totalProgress = Math.round((accountInfo.videoProgress + accountInfo.questionProgress) / 2);
                    accountInfo.progress = Math.min(totalProgress, 100);
                    
                    // æ›´æ–°æ˜¾ç¤º
                    updateStudentProgress();
                    
                    // æ˜¾ç¤ºå­¦ä¹ è¿›åº¦æç¤º
                    showMessage(`æ­å–œï¼æ‚¨å·²å®Œæˆ ${accountInfo.videoProgress}/7 ä¸ªè§†é¢‘è¯¾ç¨‹çš„å­¦ä¹ `, 'success');
                }
            }
        }
        
        // æµä½“åŠ›å­¦æ˜“é”™æ¦‚å¿µé¢˜åº“æ•°æ®
        const fluidMechanicsConcepts = [
            {
                id: 1,
                question: "äº¥å§†éœå…¹é€Ÿåº¦åˆ†æå®šç†ï¼šv(M) = v(Mâ‚€) + SÂ·Î´r + _____ Ã— Î´rï¼Œå³Mç‚¹é€Ÿåº¦æ˜¯ä¸Moç‚¹ç›¸åŒçš„å¹³åŠ¨é€Ÿåº¦ã€ç»•Moç‚¹è½¬åŠ¨åœ¨Mç‚¹å¼•èµ·çš„é€Ÿåº¦åŠå› æµä½“å˜å½¢åœ¨Mç‚¹å¼•èµ·çš„é€Ÿåº¦ä¸‰è€…ä¹‹å’Œã€‚",
                answer: "1/2 rot v",
                explanation: "äº¥å§†éœå…¹é€Ÿåº¦åˆ†æå®šç†å°†æµä½“å¾®å›¢çš„è¿åŠ¨åˆ†è§£ä¸ºå¹³åŠ¨ã€è½¬åŠ¨å’Œå˜å½¢ä¸‰éƒ¨åˆ†ï¼Œå…¶ä¸­è½¬åŠ¨éƒ¨åˆ†ä¸º1/2 rot v Ã— Î´r"
            },
            {
                id: 2,
                question: "æœ¬æ„æ–¹ç¨‹ï¼šP = -PI + 2Î¼(S - _____âˆ‡Â·V I) + (Î» + 1/3Î¼)(âˆ‡Â·V)Iï¼Œåº”åŠ›å¼ é‡ç­‰äºé™å‹å¼ é‡åŠ ä¸Šçº¯å‰ªåˆ‡æµåŠ¨å¼•èµ·ç²˜æ€§åº”åŠ›å¼ é‡åŠä½“ç§¯å˜åŒ–å¼•èµ·çš„åº”åŠ›å¼ é‡ã€‚",
                answer: "1/3",
                explanation: "æœ¬æ„æ–¹ç¨‹ä¸­ï¼Œçº¯å‰ªåˆ‡æµåŠ¨é¡¹éœ€è¦å‡å»1/3çš„ä½“ç§¯å˜åŒ–è´¡çŒ®ï¼Œä»¥ç¡®ä¿åº”åŠ›å¼ é‡çš„æ­£ç¡®åˆ†è§£"
            },
            {
                id: 3,
                question: "è¿åŠ¨æ–¹ç¨‹ï¼ˆåŠ¨é‡æ–¹ç¨‹ï¼‰ï¼šdv/dt = F - _____âˆ‡P + Î½âˆ‡Â²V + 1/3Î½âˆ‡(âˆ‡Â·V)ï¼Œå…¶ä¸­Î½æ˜¯è¿åŠ¨ç²˜æ€§ç³»æ•°ã€‚",
                answer: "1/Ï",
                explanation: "åŠ¨é‡æ–¹ç¨‹ä¸­å‹å¼ºæ¢¯åº¦åŠ›é¡¹ä¸º-1/Ïâˆ‡Pï¼ŒÏæ˜¯æµä½“å¯†åº¦"
            },
            {
                id: 4,
                question: "æ¶¡åº¦æ–¹ç¨‹ï¼šdÏ‰/dt = (Ï‰Â·âˆ‡)V - Ï‰(âˆ‡Â·V) + âˆ‡Ã—F_B - âˆ‡Ã—(âˆ‡P/Ï) + Î½âˆ‡Â²Ï‰ + _____âˆ‡(âˆ‡Â·V)",
                answer: "1/3Î½",
                explanation: "æ¶¡åº¦æ–¹ç¨‹æè¿°æ¶¡åº¦éšæ—¶é—´çš„å˜åŒ–ï¼ŒåŒ…å«æ¶¡åº¦æ‹‰ä¼¸ã€å‹ç¼©ã€ä½“ç§¯åŠ›ã€å‹åŠ›æ¢¯åº¦å’Œç²˜æ€§æ‰©æ•£ç­‰é¡¹"
            },
            {
                id: 5,
                question: "å°¼å¤æ‹‰å…¹æ›²çº¿ç ”ç©¶åœ†ç®¡æœ‰å‹æµçš„æ²¿ç¨‹é˜»åŠ›ç³»æ•°ï¼Œå…¶ä¸­å±‚æµåŒºå’Œ_____åŒºçš„é˜»åŠ›ç³»æ•°éƒ½åªä¸Reæœ‰å…³ã€‚",
                answer: "ç´Šæµå…‰æ»‘",
                explanation: "å°¼å¤æ‹‰å…¹æ›²çº¿æ˜¾ç¤ºå±‚æµåŒºå’Œç´Šæµå…‰æ»‘åŒºçš„é˜»åŠ›ç³»æ•°éƒ½åªä¸é›·è¯ºæ•°Reæœ‰å…³ï¼Œä¸ç›¸å¯¹ç²—ç³™åº¦æ— å…³"
            },
            {
                id: 6,
                question: "åœ¨ç´Šæµç²—ç³™åŒºï¼ˆé˜»åŠ›å¹³æ–¹åŒºï¼‰ï¼Œé˜»åŠ›ç³»æ•°åªä¸_____æœ‰å…³ï¼Œä¸”ä¸ºä¸€å¸¸æ•°ã€‚",
                answer: "k/d",
                explanation: "ç´Šæµç²—ç³™åŒºçš„é˜»åŠ›ç³»æ•°åªä¸ç›¸å¯¹ç²—ç³™åº¦k/dæœ‰å…³ï¼Œä¸é›·è¯ºæ•°æ— å…³"
            },
            {
                id: 7,
                question: "æ³¢æµªè¿åŠ¨ä¸­ï¼Œè‹¥ä¸ºé©»æ³¢ï¼Œæµä½“è´¨ç‚¹è½¨è¿¹æ˜¯_____ï¼Œåœ¨èŠ‚ç‚¹å¤„æµä½“è´¨ç‚¹åœ¨å¹³è¡¡ä½ç½®é™„è¿‘ä½œæ°´å¹³æŒ¯åŠ¨ã€‚",
                answer: "ç›´çº¿",
                explanation: "é©»æ³¢ä¸­æµä½“è´¨ç‚¹åšç›´çº¿è¿åŠ¨ï¼ŒèŠ‚ç‚¹å¤„ä¸ºæ°´å¹³æŒ¯åŠ¨ï¼Œæ³¢å³°æ³¢è°·å¤„ä¸ºå‚ç›´æŒ¯åŠ¨"
            },
            {
                id: 8,
                question: "æ³¢æµªè¿åŠ¨ä¸­ï¼Œè‹¥ä¸ºå‰è¿›æ³¢ï¼Œæµä½“è´¨ç‚¹è¿‘ä¼¼ä½œ_____è¿åŠ¨ï¼Œæ„ˆå¾€ä¸‹è´¨ç‚¹è¿åŠ¨åŠå¾„æ„ˆå°ã€‚",
                answer: "åœ†å‘¨",
                explanation: "å‰è¿›æ³¢ä¸­æµä½“è´¨ç‚¹åšåœ†å‘¨è¿åŠ¨ï¼ˆæˆ–æ¤­åœ†è¿åŠ¨ï¼‰ï¼Œæ·±åº¦è¶Šå¤§è¿åŠ¨åŠå¾„è¶Šå°"
            },
            {
                id: 9,
                question: "åº”å˜ç‡å¼ é‡ç”¨_____è¡¨ç¤ºï¼Œæè¿°æµä½“å˜å½¢è¿åŠ¨ï¼ˆè§’å˜å½¢ç‡ã€çº¿ç›¸å¯¹å¢é•¿ç‡ï¼‰çš„äºŒé˜¶å¼ é‡ã€‚",
                answer: "S",
                explanation: "åº”å˜ç‡å¼ é‡Sæè¿°æµä½“å¾®å›¢çš„å˜å½¢è¿åŠ¨ï¼ŒåŒ…æ‹¬çº¿å˜å½¢å’Œè§’å˜å½¢"
            },
            {
                id: 10,
                question: "é›·è¯ºå®éªŒè¡¨æ˜æµåŠ¨åˆ†ä¸º_____å’Œ_____ä¸¤ç§ï¼Œå±‚æµæµçº¿å±‚æ¬¡åˆ†æ˜ï¼Œæ¹æµæµä½“è´¨ç‚¹è¿åŠ¨æ‚ä¹±æ— ç« ã€‚",
                answer: "å±‚æµã€æ¹æµ",
                explanation: "é›·è¯ºå®éªŒæ˜¯æµä½“åŠ›å­¦å²ä¸Šçš„ç»å…¸å®éªŒï¼Œæ­ç¤ºäº†æµåŠ¨çš„ä¸¤ç§åŸºæœ¬å½¢æ€"
            },
            {
                id: 11,
                question: "Rossbyæ•°è¡¨å¾_____åŠ›å’Œ_____åŠ›ä¹‹æ¯”ï¼šRâ‚€ = V/(Î©L)ï¼Œè¡¡é‡ç§‘æ°åŠ›æ•ˆåº”çš„é‡è¦å‚æ•°ã€‚",
                answer: "æƒ¯æ€§ã€ç§‘æ°",
                explanation: "Rossbyæ•°æ˜¯åœ°çƒç‰©ç†æµä½“åŠ›å­¦ä¸­çš„é‡è¦æ— é‡çº²æ•°ï¼Œè¡¨å¾æƒ¯æ€§åŠ›ä¸ç§‘æ°åŠ›çš„ç›¸å¯¹é‡è¦æ€§"
            },
            {
                id: 12,
                question: "å½“Râ‚€â‰«1æ—¶ï¼Œå¯ä»¥ä¸è€ƒè™‘_____æ•ˆåº”ï¼›å½“Râ‚€â‰ª1æ—¶ï¼Œ_____æ•ˆåº”å¯¹æµä½“è¿åŠ¨æœ‰å†³å®šæ„ä¹‰ã€‚",
                answer: "æ—‹è½¬ã€æ—‹è½¬",
                explanation: "Rossbyæ•°å¤§æ—¶æƒ¯æ€§åŠ›å ä¸»å¯¼ï¼Œå°æ—¶ç§‘æ°åŠ›ï¼ˆæ—‹è½¬æ•ˆåº”ï¼‰å ä¸»å¯¼"
            },
            {
                id: 13,
                question: "åŠ¨èƒ½æ–¹ç¨‹ï¼šÏD/Dt(VÂ²/2) = F_bÂ·V - VÂ·âˆ‡Pï¼Œæè¿°æµä½“å¾®å›¢_____èƒ½çš„å˜åŒ–ã€‚",
                answer: "åŠ¨",
                explanation: "åŠ¨èƒ½æ–¹ç¨‹æè¿°æµä½“å¾®å›¢åŠ¨èƒ½éšæ—¶é—´çš„å˜åŒ–ï¼Œå³è¾¹æ˜¯ä½“ç§¯åŠ›åŠŸç‡å’Œå‹åŠ›åŠŸç‡"
            },
            {
                id: 14,
                question: "å±‚æµçš„ç‰¹ç‚¹æ˜¯æµåŠ¨æœ‰æ˜æ™°æµçº¿ï¼Œä¸¥æ ¼åˆ†å±‚ï¼Œå±‚ä¸å±‚ä¹‹é—´æœ‰å‰ªåˆ‡æµåŠ¨ï¼Œæ²¡æœ‰_____æ··åˆã€‚",
                answer: "æ³•å‘",
                explanation: "å±‚æµä¸­æµä½“åˆ†å±‚æµåŠ¨ï¼Œåªæœ‰åˆ‡å‘å‰ªåˆ‡ï¼Œæ²¡æœ‰æ³•å‘ï¼ˆå‚ç›´äºæµåŠ¨æ–¹å‘ï¼‰çš„æ··åˆ"
            },
            {
                id: 15,
                question: "æ¹æµçš„ç‰¹ç‚¹æ˜¯æµåŠ¨æ²¡æœ‰æ˜æ™°çš„æµçº¿ï¼Œä¸åˆ†å±‚ï¼Œæµä½“å›¢ä¹‹é—´_____æ˜æ˜¾ã€‚",
                answer: "æ··åˆ",
                explanation: "æ¹æµçš„é‡è¦ç‰¹å¾æ˜¯å¼ºçƒˆçš„æ··åˆï¼Œè¿™æ˜¯å…¶ä¼ çƒ­ä¼ è´¨èƒ½åŠ›å¼ºçš„åŸå› "
            },
            {
                id: 16,
                question: "Prandtlæ··åˆé•¿ç†è®ºå€Ÿé‰´'_____è‡ªç”±ç¨‹'çš„æ¦‚å¿µï¼Œå‡è®¾æ¹æµä¸­çš„æµä½“å¾®å›¢æœ‰'æ··åˆé•¿'ã€‚",
                answer: "åˆ†å­",
                explanation: "æ™®æœ—ç‰¹æ··åˆé•¿ç†è®ºç±»æ¯”åˆ†å­è¿åŠ¨è®ºä¸­çš„åˆ†å­è‡ªç”±ç¨‹æ¦‚å¿µæ¥æè¿°æ¹æµæ··åˆ"
            },
            {
                id: 17,
                question: "è¾¹ç•Œå±‚æ–¹ç¨‹çš„è¿ç»­æ€§æ–¹ç¨‹ï¼šâˆ‚u/âˆ‚x + âˆ‚v/âˆ‚y = _____",
                answer: "0",
                explanation: "è¿ç»­æ€§æ–¹ç¨‹è¡¨ç¤ºè´¨é‡å®ˆæ’ï¼Œå¯¹äºä¸å¯å‹ç¼©æµä½“ï¼Œé€Ÿåº¦æ•£åº¦ä¸ºé›¶"
            },
            {
                id: 18,
                question: "è¾¹ç•Œå±‚ç†è®ºè®¤ä¸ºåœ¨å¤§Reæ•°ã€æ— æµåŠ¨åˆ†ç¦»çš„ç»•æµé—®é¢˜ä¸­ï¼Œè¾¹ç•Œå±‚å†…_____åŠ›å’Œ_____åŠ›åŒé‡çº§ã€‚",
                answer: "ç²˜æ€§ã€æƒ¯æ€§",
                explanation: "è¾¹ç•Œå±‚ç†è®ºçš„æ ¸å¿ƒæ˜¯è¾¹ç•Œå±‚å†…ç²˜æ€§åŠ›å’Œæƒ¯æ€§åŠ›åŒç­‰é‡è¦ï¼Œè€Œè¾¹ç•Œå±‚å¤–ç²˜æ€§åŠ›å¯å¿½ç•¥"
            },
            {
                id: 19,
                question: "è¾¹ç•Œå±‚åšåº¦ä¸€èˆ¬äººä¸ºè§„å®šä¸å¤–éƒ¨æµåŠ¨é€Ÿåº¦ç›¸å·®_____%çš„åœ°æ–¹ä¸ºè¾¹ç•Œå±‚ä¸Šç•Œã€‚",
                answer: "1",
                explanation: "è¾¹ç•Œå±‚åšåº¦çš„å®šä¹‰ï¼šé€Ÿåº¦è¾¾åˆ°å¤–éƒ¨æµé€Ÿ99%çš„ä½ç½®"
            },
            {
                id: 20,
                question: "ä½ç§»åšåº¦Î´* = âˆ«â‚€^Î´(1-u/U_e)dyï¼ŒåŠ¨é‡æŸå¤±åšåº¦Î¸ = âˆ«â‚€^Î´(u/U_e)(1-u/U_e)dyï¼Œå…¶ä¸­Î¸åˆç§°ä¸º_____åšåº¦ã€‚",
                answer: "åŠ¨é‡",
                explanation: "åŠ¨é‡æŸå¤±åšåº¦Î¸è¡¨å¾è¾¹ç•Œå±‚å¯¹åŠ¨é‡è¾“è¿çš„å½±å“"
            },
            {
                id: 21,
                question: "æ¹æµè¿åŠ¨çš„åŸºæœ¬ç‰¹æ€§åŒ…æ‹¬ï¼šéšæœºæ€§ã€æ··åˆæ€§ã€æœ‰æ—‹æ€§å’Œ_____æ€§ã€‚",
                answer: "è€—æ•£",
                explanation: "æ¹æµçš„å››ä¸ªåŸºæœ¬ç‰¹æ€§ï¼šéšæœºæ€§ã€æ··åˆæ€§ã€æœ‰æ—‹æ€§ã€è€—æ•£æ€§"
            },
            {
                id: 22,
                question: "Bernoulliæ–¹ç¨‹é€‚ç”¨äºç†æƒ³_____ä½“ç§¯åŠ›æœ‰åŠ¿æµä½“_____æµåŠ¨ï¼ŒåŒä¸€æ¡æµçº¿ä¸Šå„ç‚¹å•ä½è´¨é‡æœºæ¢°èƒ½ç›¸ç­‰ã€‚",
                answer: "æ­£å‹ã€å®šå¸¸",
                explanation: "ä¼¯åŠªåˆ©æ–¹ç¨‹çš„é€‚ç”¨æ¡ä»¶ï¼šç†æƒ³ã€æ­£å‹ã€ä½“ç§¯åŠ›æœ‰åŠ¿ã€å®šå¸¸æµåŠ¨"
            },
            {
                id: 23,
                question: "åº”åŠ›å¼ é‡Pä¸åº”å˜ç‡å¼ é‡Sä¹‹é—´çš„å…³ç³»æ»¡è¶³å¹¿ä¹‰ç‰›é¡¿å…¬å¼çš„æµä½“ç§°ä¸º_____æµä½“ã€‚",
                answer: "ç‰›é¡¿",
                explanation: "ç‰›é¡¿æµä½“çš„å®šä¹‰ï¼šåº”åŠ›ä¸åº”å˜ç‡æˆçº¿æ€§å…³ç³»"
            },
            {
                id: 24,
                question: "å¼€å°”æ–‡å®šç†è¡¨æ˜å¯¹äºç†æƒ³æ­£å‹æµä½“ä¸”å¤–åŠ›æœ‰åŠ¿çš„æƒ…å†µä¸‹ï¼Œæ²¿ä»»ä¸€å°é—­ç‰©è´¨çº¿é€Ÿåº¦_____åœ¨è¿åŠ¨è¿‡ç¨‹ä¸­ä¸å˜ã€‚",
                answer: "ç¯é‡",
                explanation: "å¼€å°”æ–‡å®šç†ï¼ˆç¯é‡å®ˆæ’å®šç†ï¼‰æ˜¯ç†æƒ³æµä½“åŠ›å­¦çš„é‡è¦å®šç†"
            },
            {
                id: 25,
                question: "æµçº¿æ˜¯åŒä¸€æ—¶åˆ»ä¸­æµåœºå†…_____çš„è¿çº¿ï¼Œæµçº¿ä¸Šé€Ÿåº¦æ–¹å‘å³æ˜¯è¯¥ç‚¹æµçº¿çš„_____æ–¹å‘ã€‚",
                answer: "é€Ÿåº¦ã€åˆ‡çº¿",
                explanation: "æµçº¿çš„å®šä¹‰ï¼šæŸä¸€æ—¶åˆ»æµåœºä¸­çš„é€Ÿåº¦çŸ¢é‡çº¿ï¼Œé€Ÿåº¦çŸ¢é‡ä¸æµçº¿ç›¸åˆ‡"
            },
            {
                id: 26,
                question: "é›·è¯ºåº”åŠ›äº§ç”Ÿäºæ¹æµ_____ï¼Œä»£è¡¨è„‰åŠ¨å¯¹äºå¹³å‡æµçš„ä½œç”¨ï¼Œä¸æ˜¯_____çš„åŠ›ã€‚",
                answer: "è„‰åŠ¨ã€çœŸå®",
                explanation: "é›·è¯ºåº”åŠ›æ˜¯ç”±æ¹æµè„‰åŠ¨äº§ç”Ÿçš„è¡¨è§‚åº”åŠ›ï¼Œä¸æ˜¯çœŸå®çš„åˆ†å­åº”åŠ›"
            },
            {
                id: 27,
                question: "æµä½“æ˜“æµåŠ¨æ€§è¡¨ç°ä¸ºï¼šæµä½“é™æ­¢æ—¶åªæœ‰_____åº”åŠ›ï¼Œæ²¡æœ‰_____åº”åŠ›ã€‚",
                answer: "æ³•å‘ã€åˆ‡å‘",
                explanation: "æµä½“çš„åŸºæœ¬ç‰¹æ€§ï¼šé™æ­¢æ—¶ä¸èƒ½æ‰¿å—åˆ‡åº”åŠ›ï¼Œåªèƒ½æ‰¿å—æ³•å‘åº”åŠ›"
            },
            {
                id: 28,
                question: "è¿ç»­ä»‹è´¨å‡è®¾è¦æ±‚æµä½“å¾®å›¢éœ€ä¿è¯å®è§‚ä¸Šè¶³å¤Ÿ_____ï¼Œå¾®è§‚ä¸Šè¶³å¤Ÿ_____ã€‚",
                answer: "å°ã€å¤§",
                explanation: "è¿ç»­ä»‹è´¨å‡è®¾çš„å°ºåº¦è¦æ±‚ï¼šå®è§‚å°ï¼ˆç›¸å¯¹äºç ”ç©¶å¯¹è±¡ï¼‰ï¼Œå¾®è§‚å¤§ï¼ˆç›¸å¯¹äºåˆ†å­å°ºåº¦ï¼‰"
            },
            {
                id: 29,
                question: "é€Ÿåº¦æ•£åº¦âˆ‡Â·Væ˜¯æµä½“å¾®å›¢_____ç›¸å¯¹å˜åŒ–ç‡ï¼Œè‹¥âˆ‡Â·V=0ï¼Œåˆ™æµä½“ä¸å¯å‹ï¼Œæœ‰_____å‡½æ•°ã€‚",
                answer: "ä½“ç§¯ã€æµ",
                explanation: "é€Ÿåº¦æ•£åº¦è¡¨ç¤ºä½“ç§¯å˜åŒ–ç‡ï¼Œä¸å¯å‹ç¼©æµåŠ¨å­˜åœ¨æµå‡½æ•°"
            },
            {
                id: 30,
                question: "é€Ÿåº¦æ—‹åº¦âˆ‡Ã—Væ˜¯æµä½“å¾®å›¢è‡ªè½¬è§’é€Ÿåº¦çš„_____å€ï¼Œè‹¥âˆ‡Ã—V=0ï¼Œåˆ™æµä½“æ— æ—‹ï¼Œæœ‰é€Ÿåº¦_____ã€‚",
                answer: "2ã€åŠ¿",
                explanation: "æ—‹åº¦æ˜¯è§’é€Ÿåº¦çš„2å€ï¼Œæ— æ—‹æµåŠ¨å­˜åœ¨é€Ÿåº¦åŠ¿å‡½æ•°"
            },
            {
                id: 31,
                question: "å¤åŠ¿ä¸­é•œåƒæ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨åŒºåŸŸå¤–è®¾ç½®ä¸€ç»„å¥‡ç‚¹ï¼Œä½¿ç»„åˆæµåœºæ°å¥½å­˜åœ¨ä¸€æ¡_____ï¼Œå®ƒå°±æ˜¯è¾¹ç•Œã€‚",
                answer: "æµçº¿",
                explanation: "é•œåƒæ³•é€šè¿‡åœ¨åŒºåŸŸå¤–è®¾ç½®é•œåƒå¥‡ç‚¹ï¼Œä½¿è¾¹ç•Œæˆä¸ºæµçº¿æ¥æ»¡è¶³è¾¹ç•Œæ¡ä»¶"
            },
            {
                id: 32,
                question: "çƒå½¢æ¶²æ»´ä¸‹è½çš„å‡åŒ€å®šå¸¸é€Ÿåº¦V = (2/9)(Ï-Ïâ‚€)gaÂ²/Î¼ï¼Œå…¶ä¸­aæ˜¯_____ã€‚",
                answer: "åŠå¾„",
                explanation: "æ–¯æ‰˜å…‹æ–¯å…¬å¼ç»™å‡ºäº†å°çƒåœ¨ç²˜æ€§æµä½“ä¸­çš„ç»ˆç«¯é€Ÿåº¦"
            },
            {
                id: 33,
                question: "å¹³æ¿è¾¹ç•Œå±‚åšåº¦Î´ = kâˆš(Î½x/U)ï¼Œå…¶ä¸­kä¸ºå¸¸æ•°ï¼Œè¾¹ç•Œå±‚åšåº¦ä¸æµä½“_____ç³»æ•°ã€æµä½“åœ¨å¹³æ¿ä¸Šä½ç½®ã€æ¥æµé€Ÿåº¦æœ‰å…³ã€‚",
                answer: "ç²˜æ€§",
                explanation: "å¹³æ¿è¾¹ç•Œå±‚åšåº¦çš„å¸ƒæ‹‰ä¿®æ–¯è§£ï¼Œåšåº¦ä¸ç²˜æ€§ç³»æ•°ã€ä½ç½®ã€æ¥æµé€Ÿåº¦æœ‰å…³"
            },
            {
                id: 34,
                question: "åœ¨èˆªç©ºé£è¡Œå™¨è®¾è®¡ä¸­ï¼Œé€šè¿‡è®¾è®¡'_____ç¿¼é¢'ï¼Œä»¥ç»´æŒå±‚æµè¾¹ç•Œå±‚ï¼Œé¿å…è¾¹ç•Œå±‚åˆ†ç¦»ã€‚",
                answer: "å±‚æµ",
                explanation: "å±‚æµç¿¼é¢è®¾è®¡å¯ä»¥ç»´æŒå±‚æµè¾¹ç•Œå±‚ï¼Œå‡å°‘æ‘©æ“¦é˜»åŠ›"
            },
            {
                id: 35,
                question: "å¡é—¨æ¶¡è¡—ç°è±¡ä¸­ï¼Œåœ†æŸ±ç»•æµåœ¨Re > _____æ—¶å¼€å§‹å‡ºç°æ¶¡è¡—è„±è½ã€‚",
                answer: "40",
                explanation: "å¡é—¨æ¶¡è¡—æ˜¯åœ†æŸ±ç»•æµçš„ç»å…¸ç°è±¡ï¼Œå½“é›·è¯ºæ•°è¶…è¿‡40æ—¶å¼€å§‹å‡ºç°å‘¨æœŸæ€§æ¶¡è„±è½"
            },
            {
                id: 36,
                question: "å…°é‡‘æ¶¡æ¨¡å‹ä¸­ï¼Œæ¶¡æ ¸å†…éƒ¨æµåŠ¨ä¸º_____æ¶¡ï¼Œå¤–éƒ¨æµåŠ¨ä¸º_____æ¶¡ã€‚",
                answer: "å¼ºåˆ¶ã€è‡ªç”±",
                explanation: "å…°é‡‘æ¶¡æ¨¡å‹ï¼šå†…éƒ¨ä¸ºå¼ºåˆ¶æ¶¡ï¼ˆåˆšä½“æ—‹è½¬ï¼‰ï¼Œå¤–éƒ¨ä¸ºè‡ªç”±æ¶¡ï¼ˆåŠ¿æ¶¡ï¼‰"
            },
            {
                id: 37,
                question: "åœ°è½¬é£æ˜¯_____åŠ›ã€_____åŠ›å’Œ_____åŠ›ä¸‰è€…å¹³è¡¡çš„ç»“æœã€‚",
                answer: "å‹åŠ›æ¢¯åº¦ã€ç§‘æ°ã€æ‘©æ“¦",
                explanation: "åœ°è½¬é£å¹³è¡¡æ¶‰åŠå‹åŠ›æ¢¯åº¦åŠ›ã€ç§‘æ°åŠ›å’Œæ‘©æ“¦åŠ›çš„ä¸‰åŠ›å¹³è¡¡"
            },
            {
                id: 38,
                question: "è´¸æ˜“é£çš„å½¢æˆä¸»è¦ç”±äº_____æ•ˆåº”å’Œ_____åŠ çƒ­çš„å…±åŒä½œç”¨ã€‚",
                answer: "ç§‘æ°ã€å¤ªé˜³",
                explanation: "è´¸æ˜“é£æ˜¯ç”±åœ°çƒè‡ªè½¬çš„ç§‘æ°æ•ˆåº”å’Œå¤ªé˜³è¾å°„åŠ çƒ­ä¸å‡åŒ€é€ æˆçš„å¤§å°ºåº¦é£ç³»"
            }
        ];

        // å¼€å§‹æµä½“åŠ›å­¦æ¦‚å¿µç»ƒä¹ 
        function startFluidMechanicsConcepts() {
            if (!currentUser) {
                showMessage('è¯·å…ˆç™»å½•', 'warning');
                return;
            }
            
            // åˆ›å»ºç»ƒä¹ ç•Œé¢
            const modal = document.createElement('div');
            modal.className = 'exercise-modal';
            modal.innerHTML = `
                <div class="exercise-content">
                    <div class="exercise-header">
                        <h2><i class="fas fa-brain"></i> æµä½“åŠ›å­¦æ˜“é”™åè¯åŠæ¦‚å¿µæ±‡æ€»</h2>
                        <button type="button" class="close-btn" id="exerciseCloseBtn">&times;</button>
                    </div>
                    <div class="exercise-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="exerciseProgress"></div>
                        </div>
                        <span id="progressText">1/38</span>
                    </div>
                    <div class="exercise-body">
                        <div class="question-container">
                            <div class="question-number" id="questionNumber">ç¬¬1é¢˜</div>
                            <div class="question-text" id="questionText"></div>
                            <div class="answer-input">
                                <input type="text" id="answerInput" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ..." 
                                       onkeypress="if(event.key==='Enter') checkAnswer()">
                                <button type="button" onclick="checkAnswer()" class="check-btn">
                                    <i class="fas fa-check"></i> æ£€æŸ¥ç­”æ¡ˆ
                                </button>
                            </div>
                            <div class="answer-feedback" id="answerFeedback"></div>
                        </div>
                    </div>
                    <div class="exercise-controls">
                        <button type="button" onclick="previousQuestion()" id="prevBtn" class="nav-btn" disabled>
                            <i class="fas fa-chevron-left"></i> ä¸Šä¸€é¢˜
                        </button>
                        <button type="button" onclick="showHint()" class="hint-btn">
                            <i class="fas fa-lightbulb"></i> æç¤º
                        </button>
                        <button type="button" onclick="nextQuestion()" id="nextBtn" class="nav-btn">
                            ä¸‹ä¸€é¢˜ <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // åˆå§‹åŒ–ç»ƒä¹ 
            window.currentExercise = {
                questions: [...fluidMechanicsConcepts],
                currentIndex: 0,
                correctAnswers: 0,
                userAnswers: new Array(38).fill(''),
                isAnswered: new Array(38).fill(false)
            };
            
            showQuestion();
            modal.style.display = 'flex';
            
            // ç¡®ä¿æŒ‰é’®äº‹ä»¶æ­£å¸¸å·¥ä½œ
            setTimeout(() => {
                const nextBtn = document.getElementById('nextBtn');
                const prevBtn = document.getElementById('prevBtn');
                const closeBtn = document.getElementById('exerciseCloseBtn');
                
                if (nextBtn) {
                    nextBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        nextQuestion();
                    });
                }
                
                if (prevBtn) {
                    prevBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        previousQuestion();
                    });
                }
                
                if (closeBtn) {
                    closeBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('å…³é—­æŒ‰é’®è¢«ç‚¹å‡»');
                        closeExerciseModal();
                    });
                }
                
                // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨ä¹Ÿå¯ä»¥å…³é—­
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        console.log('ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨ï¼Œå…³é—­ç»ƒä¹ ');
                        closeExerciseModal();
                    }
                });
                
            }, 100);
        }

        // å¼€å§‹é¢˜ç›®ç»ƒä¹ 
        function startExercise(exerciseType, questionCount) {
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                // åˆå§‹åŒ–ç»ƒä¹ è®°å½•
                if (!accountInfo.completedExercises) {
                    accountInfo.completedExercises = [];
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»å®Œæˆè¿‡è¿™ä¸ªç»ƒä¹ 
                if (!accountInfo.completedExercises.includes(exerciseType)) {
                    // æ¨¡æ‹Ÿç»ƒä¹ å®Œæˆ
                    accountInfo.completedExercises.push(exerciseType);
                    accountInfo.questionProgress = accountInfo.completedExercises.length * 12; // æ¯ä¸ªç»ƒä¹ çº¦12é¢˜
                    
                    // æ›´æ–°æ€»ä½“è¿›åº¦
                    const totalProgress = Math.round((accountInfo.videoProgress + accountInfo.questionProgress) / 2);
                    accountInfo.progress = Math.min(totalProgress, 100);
                    
                    // æ›´æ–°æ˜¾ç¤º
                    updateStudentProgress();
                    
                    // æ˜¾ç¤ºç»ƒä¹ å®Œæˆæç¤º
                    showMessage(`æ­å–œï¼æ‚¨å·²å®Œæˆ ${exerciseType} ç»ƒä¹ ï¼Œå…± ${questionCount} é¢˜`, 'success');
                } else {
                    showMessage('æ‚¨å·²ç»å®Œæˆè¿‡è¿™ä¸ªç»ƒä¹ äº†', 'info');
                }
            } else {
                showMessage('è¯·å…ˆç™»å½•å­¦ç”Ÿè´¦å·', 'warning');
            }
        }
        
        // æ˜¾ç¤ºå½“å‰é¢˜ç›®
        function showQuestion() {
            const exercise = window.currentExercise;
            const currentQ = exercise.questions[exercise.currentIndex];
            
            document.getElementById('questionNumber').textContent = `ç¬¬${exercise.currentIndex + 1}é¢˜`;
            document.getElementById('questionText').textContent = currentQ.question;
            document.getElementById('progressText').textContent = `${exercise.currentIndex + 1}/38`;
            
            // æ›´æ–°è¿›åº¦æ¡
            const progress = ((exercise.currentIndex + 1) / 38) * 100;
            document.getElementById('exerciseProgress').style.width = progress + '%';
            
            // æ¢å¤ç”¨æˆ·ä¹‹å‰çš„ç­”æ¡ˆ
            document.getElementById('answerInput').value = exercise.userAnswers[exercise.currentIndex];
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            document.getElementById('prevBtn').disabled = exercise.currentIndex === 0;
            document.getElementById('nextBtn').textContent = exercise.currentIndex === 37 ? 'å®Œæˆç»ƒä¹ ' : 'ä¸‹ä¸€é¢˜ ';
            if (exercise.currentIndex < 37) {
                document.getElementById('nextBtn').innerHTML = 'ä¸‹ä¸€é¢˜ <i class="fas fa-chevron-right"></i>';
            } else {
                document.getElementById('nextBtn').innerHTML = '<i class="fas fa-flag-checkered"></i> å®Œæˆç»ƒä¹ ';
            }
            
            // æ¸…é™¤åé¦ˆ
            document.getElementById('answerFeedback').innerHTML = '';
            
            // å¦‚æœå·²ç»å›ç­”è¿‡ï¼Œæ˜¾ç¤ºç»“æœ
            if (exercise.isAnswered[exercise.currentIndex]) {
                showAnswerResult();
            }
        }
        
        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const exercise = window.currentExercise;
            const currentQ = exercise.questions[exercise.currentIndex];
            const userAnswer = document.getElementById('answerInput').value.trim();
            
            if (!userAnswer) {
                showMessage('è¯·è¾“å…¥ç­”æ¡ˆ', 'warning');
                return;
            }
            
            // ä¿å­˜ç”¨æˆ·ç­”æ¡ˆ
            exercise.userAnswers[exercise.currentIndex] = userAnswer;
            
            showAnswerResult();
        }
        
        // æ˜¾ç¤ºç­”æ¡ˆç»“æœ
        function showAnswerResult() {
            const exercise = window.currentExercise;
            const currentQ = exercise.questions[exercise.currentIndex];
            const userAnswer = exercise.userAnswers[exercise.currentIndex];
            const correctAnswer = currentQ.answer;
            const feedback = document.getElementById('answerFeedback');
            
            // ç®€åŒ–ç­”æ¡ˆæ¯”è¾ƒï¼ˆå»é™¤ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ç­‰ï¼‰
            const normalizeAnswer = (str) => str.replace(/[ï¼Œã€‚ã€ï¼›ï¼š""''ï¼ˆï¼‰\s]/g, '').toLowerCase();
            const isCorrect = normalizeAnswer(userAnswer).includes(normalizeAnswer(correctAnswer)) || 
                             normalizeAnswer(correctAnswer).includes(normalizeAnswer(userAnswer));
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å›ç­”è¿™é“é¢˜
            if (!exercise.isAnswered[exercise.currentIndex]) {
                if (isCorrect) {
                    exercise.correctAnswers++;
                }
                exercise.isAnswered[exercise.currentIndex] = true;
            }
            
            if (isCorrect) {
                feedback.innerHTML = `
                    <div class="feedback correct">
                        <i class="fas fa-check-circle"></i>
                        <strong>æ­£ç¡®ï¼</strong>
                        <div class="explanation">${currentQ.explanation}</div>
                    </div>
                `;
            } else {
                feedback.innerHTML = `
                    <div class="feedback incorrect">
                        <i class="fas fa-times-circle"></i>
                        <strong>ç­”æ¡ˆä¸æ­£ç¡®</strong>
                        <div class="correct-answer">æ­£ç¡®ç­”æ¡ˆï¼š<strong>${correctAnswer}</strong></div>
                        <div class="explanation">${currentQ.explanation}</div>
                    </div>
                `;
            }
        }
        
        // æ˜¾ç¤ºæç¤º
        function showHint() {
            const exercise = window.currentExercise;
            const currentQ = exercise.questions[exercise.currentIndex];
            const answer = currentQ.answer;
            
            // æ˜¾ç¤ºç­”æ¡ˆçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºæç¤º
            let hint = '';
            if (answer.includes('ã€')) {
                // å¤šä¸ªç­”æ¡ˆçš„æƒ…å†µ
                const parts = answer.split('ã€');
                hint = `æç¤ºï¼šç¬¬ä¸€ä¸ªç­”æ¡ˆä»¥"${parts[0][0]}"å¼€å¤´ï¼Œç¬¬äºŒä¸ªç­”æ¡ˆä»¥"${parts[1][0]}"å¼€å¤´`;
            } else {
                hint = `æç¤ºï¼šç­”æ¡ˆä»¥"${answer[0]}"å¼€å¤´ï¼Œå…±${answer.length}ä¸ªå­—ç¬¦`;
            }
            
            showMessage(hint, 'info');
        }
        
        // ä¸Šä¸€é¢˜
        function previousQuestion() {
            const exercise = window.currentExercise;
            if (exercise.currentIndex > 0) {
                exercise.currentIndex--;
                showQuestion();
            }
        }
        
        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            try {
                const exercise = window.currentExercise;
                console.log('Next question clicked, current index:', exercise.currentIndex);
                
                if (exercise.currentIndex < 37) {
                    exercise.currentIndex++;
                    showQuestion();
                } else {
                    // å®Œæˆç»ƒä¹ 
                    finishExercise();
                }
            } catch (error) {
                console.error('Error in nextQuestion:', error);
                showMessage('å¯¼èˆªå‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }
        }
        
        // å®Œæˆç»ƒä¹ 
        function finishExercise() {
            const exercise = window.currentExercise;
            const score = Math.round((exercise.correctAnswers / 38) * 100);
            
            const resultModal = document.createElement('div');
            resultModal.className = 'exercise-result-modal';
            resultModal.innerHTML = `
                <div class="result-content">
                    <div class="result-header">
                        <h2><i class="fas fa-trophy"></i> ç»ƒä¹ å®Œæˆï¼</h2>
                    </div>
                    <div class="result-stats">
                        <div class="stat-item">
                            <div class="stat-number">${exercise.correctAnswers}</div>
                            <div class="stat-label">æ­£ç¡®é¢˜æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">38</div>
                            <div class="stat-label">æ€»é¢˜æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">${score}%</div>
                            <div class="stat-label">æ­£ç¡®ç‡</div>
                        </div>
                    </div>
                    <div class="result-message">
                        ${score >= 90 ? '<i class="fas fa-medal"></i> ä¼˜ç§€ï¼æ‚¨å¯¹æµä½“åŠ›å­¦æ¦‚å¿µæŒæ¡å¾—å¾ˆå¥½ï¼' :
                          score >= 70 ? '<i class="fas fa-thumbs-up"></i> è‰¯å¥½ï¼ç»§ç»­åŠªåŠ›æé«˜ï¼' :
                          '<i class="fas fa-book"></i> éœ€è¦åŠ å¼ºå­¦ä¹ ï¼Œå»ºè®®é‡æ–°å¤ä¹ ç›¸å…³æ¦‚å¿µã€‚'}
                    </div>
                    <div class="result-actions">
                        <button onclick="restartExercise()" class="restart-btn">
                            <i class="fas fa-redo"></i> é‡æ–°ç»ƒä¹ 
                        </button>
                        <button onclick="closeAllModals()" class="close-btn">
                            <i class="fas fa-times"></i> å…³é—­
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(resultModal);
            resultModal.style.display = 'flex';
            
            // è®°å½•å­¦ä¹ è¿›åº¦
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                if (!accountInfo.completedExercises) {
                    accountInfo.completedExercises = [];
                }
                if (!accountInfo.completedExercises.includes('fluid-concepts')) {
                    accountInfo.completedExercises.push('fluid-concepts');
                    accountInfo.questionProgress = (accountInfo.completedExercises.length || 0) * 12;
                    updateStudentProgress();
                }
            }
        }
        
        // é‡æ–°å¼€å§‹ç»ƒä¹ 
        function restartExercise() {
            closeAllModals();
            startFluidMechanicsConcepts();
        }
        
        // å…³é—­ç»ƒä¹ æ¨¡æ€æ¡†
        function closeExerciseModal() {
            try {
                console.log('Closing exercise modal');
                const modal = document.querySelector('.exercise-modal');
                if (modal) {
                    modal.style.display = 'none';
                    setTimeout(() => {
                        modal.remove();
                    }, 100);
                } else {
                    console.log('No exercise modal found');
                }
            } catch (error) {
                console.error('Error closing modal:', error);
            }
        }
        
        // å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†
        function closeAllModals() {
            const modals = document.querySelectorAll('.exercise-modal, .exercise-result-modal');
            modals.forEach(modal => modal.remove());
        }

        // æ›´æ–°å­¦ç”Ÿæˆç»©æ˜¾ç¤º
        function updateStudentGradeDisplay() {
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                const grades = accountInfo.grades || [];
                
                // æ›´æ–°æˆç»©ç»Ÿè®¡
                const avgGradeElement = document.getElementById('studentAvgGrade');
                const maxGradeElement = document.getElementById('studentMaxGrade');
                const examCountElement = document.getElementById('studentExamCount');
                const gradeListElement = document.getElementById('studentGradeList');
                
                if (grades.length > 0) {
                    const avgGrade = grades.reduce((sum, grade) => sum + grade, 0) / grades.length;
                    const maxGrade = Math.max(...grades);
                    
                    if (avgGradeElement) avgGradeElement.textContent = avgGrade.toFixed(1);
                    if (maxGradeElement) maxGradeElement.textContent = maxGrade;
                    if (examCountElement) examCountElement.textContent = grades.length;
                    
                    // ç”Ÿæˆæˆç»©åˆ—è¡¨
                    if (gradeListElement) {
                        const gradeListHTML = grades.map((grade, index) => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e9ecef; margin-bottom: 10px;">
                                <span style="font-weight: 500;">ç¬¬${index + 1}æ¬¡è€ƒè¯•</span>
                                <span style="font-weight: bold; color: var(--primary);">${grade} åˆ†</span>
                            </div>
                        `).join('');
                        gradeListElement.innerHTML = gradeListHTML;
                    }
                } else {
                    if (avgGradeElement) avgGradeElement.textContent = '--';
                    if (maxGradeElement) maxGradeElement.textContent = '--';
                    if (examCountElement) examCountElement.textContent = '0';
                    if (gradeListElement) {
                        gradeListElement.innerHTML = '<p style="text-align: center; color: #6c757d; margin: 0;">æš‚æ— æˆç»©è®°å½•</p>';
                    }
                }
            }
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            // æ¸…ç©ºè¡¨å•
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            // æ˜¾ç¤ºç™»å½•ç•Œé¢
            document.getElementById('loginContainer').style.display = 'flex';
            
            // éšè—å¹³å°ç•Œé¢
            document.getElementById('platformContainer').style.display = 'none';
        }
        
        // åˆ‡æ¢å†…å®¹åŒºåŸŸ
        function switchSection(sectionId) {
            // ç§»é™¤æ‰€æœ‰å¯¼èˆªçš„activeçŠ¶æ€
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // è®¾ç½®å½“å‰å¯¼èˆªä¸ºactive
            const currentLink = document.querySelector(`a[onclick="switchSection('${sectionId}')"]`);
            if (currentLink) {
                currentLink.classList.add('active');
            }
            
            // éšè—æ‰€æœ‰å†…å®¹åŒºåŸŸ
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹åŒºåŸŸ
            document.getElementById(sectionId).classList.add('active');
            
            // æ ¹æ®é¡µé¢ç±»å‹è°ƒæ•´ä¿æŠ¤çº§åˆ«
            adjustProtectionLevel(sectionId);
        }
        
        // æ ¹æ®é¡µé¢ç±»å‹è°ƒæ•´ä¿æŠ¤çº§åˆ«
        function adjustProtectionLevel(sectionId) {
            if (!currentUser || currentUser.role !== 'student') return;
            
            const mainContent = document.querySelector('.main-content');
            const isLearningPage = (sectionId === 'video-section' || sectionId === 'exercise-section');
            
            if (isLearningPage) {
                // å­¦ä¹ é¡µé¢ï¼šå‡å°‘å¹²æ‰°ï¼Œä¼˜åŒ–ä½“éªŒ
                if (mainContent) {
                    mainContent.classList.remove('student-content');
                    mainContent.classList.add('learning-content');
                }
                
                // ç«‹å³æ›´æ–°æ°´å°ä¸ºå­¦ä¹ æ¨¡å¼
                createDynamicWatermark();
                
                console.log('åˆ‡æ¢åˆ°å­¦ä¹ æ¨¡å¼ï¼Œå‡å°‘è§†è§‰å¹²æ‰°');
            } else {
                // éå­¦ä¹ é¡µé¢ï¼šæ¢å¤å®Œæ•´ä¿æŠ¤
                if (mainContent) {
                    mainContent.classList.remove('learning-content');
                    mainContent.classList.add('student-content', 'non-learning');
                }
                
                // ç«‹å³æ›´æ–°æ°´å°ä¸ºä¿æŠ¤æ¨¡å¼
                createDynamicWatermark();
                
                console.log('åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼');
            }
        }
        
        // æ‰“å¼€è§†é¢‘æ¨¡æ€æ¡†
        function openVideoModal(videoId) {
            const modal = document.getElementById('videoModal');
            const videoFrame = document.getElementById('videoFrame');
            const videoTips = document.querySelector('.video-tips');
            
            // è§†é¢‘æ ‡é¢˜æ˜ å°„
            const videoTitles = {
                'BV16T421D7k4': 'æµä½“åŠ›å­¦ä¹‹ç¾ï¼Œå¤ªç¾äº†',
                'BV1GJ411x7h7': 'æµä½“åŠ›å­¦åŸºç¡€åŸç†',
                'BV1Yb4y1Y7Jp': 'ä¼¯åŠªåˆ©æ–¹ç¨‹è¯¦è§£',
                'BV1XJ411L7Bd': 'æµä½“åŠ¨åŠ›å­¦ä¸æ¶¡æ—‹',
                'BV1QJ411Y7N8': 'NSæ–¹ç¨‹è§£æ',
                'BV1NJ411L7Bd': 'æµä½“åŠ›å­¦å·¥ç¨‹åº”ç”¨',
                'BV1PJ411L7Bd': 'è¾¹ç•Œå±‚ç†è®ºç²¾è®²',
                'BV1RJ411L7Bd': 'ç‰©ç†æµ·æ´‹å­¦åŸºç¡€'
            };
            
            if (videoId === 'custom') {
                // è‡ªå®šä¹‰ä¸Šä¼ çš„è§†é¢‘
                const videoLink = document.getElementById('videoLink')?.value || '';
                if (videoLink.includes('bilibili.com')) {
                    // æå–Bç«™è§†é¢‘ID
                    const bvidMatch = videoLink.match(/BV\w+/);
                    if (bvidMatch) {
                        videoFrame.src = `https://player.bilibili.com/player.html?bvid=${bvidMatch[0]}&autoplay=1&page=1&high_quality=1&danmaku=0&t=0&as_wide=1&hasMuteButton=1&allowfullscreen=true&quality=120&vd_source=&volume=0.8&p2p=0`;
                    } else {
                        videoFrame.src = videoLink;
                    }
                } else {
                    videoFrame.src = videoLink;
                }
                document.getElementById('modalTitle').textContent = 'æµä½“åŠ›å­¦æ•™å­¦è§†é¢‘';
            } else if (videoTitles[videoId]) {
                // Bç«™è§†é¢‘
                videoFrame.src = `https://player.bilibili.com/player.html?bvid=${videoId}&autoplay=1&page=1&high_quality=1&danmaku=0&t=0&as_wide=1&hasMuteButton=1&allowfullscreen=true&quality=120&vd_source=&volume=0.8&p2p=0`;
                document.getElementById('modalTitle').textContent = videoTitles[videoId];
                
                // å¦‚æœæ˜¯å­¦ç”Ÿï¼Œè®°å½•è§†é¢‘å­¦ä¹ è¿›åº¦
                if (currentUser && accounts[currentUser] && accounts[currentUser].role === 'student') {
                    recordVideoProgress(videoId);
                }
            } else {
                // ç¤ºä¾‹è§†é¢‘
                videoFrame.src = '';
                document.getElementById('modalTitle').textContent = 'æµä½“åŠ›å­¦æ•™å­¦è§†é¢‘';
            }
            
            modal.classList.add('active');
            
            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            setTimeout(() => {
                videoTips.style.display = 'block';
                setTimeout(() => {
                    videoTips.style.display = 'none';
                }, 5000);
            }, 2000);
        }
        
        // å…³é—­è§†é¢‘æ¨¡æ€æ¡†
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const videoFrame = document.getElementById('videoFrame');
            const modalContent = document.querySelector('.modal-content');
            
            // é€€å‡ºå…¨å±æ¨¡å¼
            modalContent.classList.remove('fullscreen');
            
            // åœæ­¢è§†é¢‘æ’­æ”¾
            videoFrame.src = '';
            
            modal.classList.remove('active');
            
            // æ¢å¤æ°´å°æ˜¾ç¤º
            if (currentUser && currentUser.role === 'student') {
                setTimeout(() => {
                    createDynamicWatermark();
                }, 300);
            }
        }
        
        // åˆ‡æ¢å…¨å±æ¨¡å¼
        function toggleFullscreen() {
            const modalContent = document.querySelector('.modal-content');
            const fullscreenBtn = document.querySelector('.fullscreen-btn i');
            
            if (modalContent.classList.contains('fullscreen')) {
                // é€€å‡ºå…¨å±
                modalContent.classList.remove('fullscreen');
                fullscreenBtn.className = 'fas fa-expand';
            } else {
                // è¿›å…¥å…¨å±
                modalContent.classList.add('fullscreen');
                fullscreenBtn.className = 'fas fa-compress';
            }
        }
        
        // ç›‘å¬ESCé”®é€€å‡ºå…¨å±
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modalContent = document.querySelector('.modal-content');
                if (modalContent.classList.contains('fullscreen')) {
                    toggleFullscreen();
                }
            }
        });
        
        // åˆ›å»ºåˆ†æ•°çº¿å›¾è¡¨
        function createScoreChart(year = 'all') {
            const canvas = document.getElementById('scoreChart');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                
                // è¿‡æ»¤æ•°æ®
                let displayYears = [...scoreData.years];
                let reexamScores = [...scoreData.reexamScores];
                let nationalScores = [...scoreData.nationalScores];
                let applicants = [...scoreData.applicants];
                
                if (year !== 'all') {
                    const index = scoreData.years.indexOf(parseInt(year));
                    if (index !== -1) {
                        displayYears = [scoreData.years[index]];
                        reexamScores = [scoreData.reexamScores[index]];
                        nationalScores = [scoreData.nationalScores[index]];
                        applicants = [scoreData.applicants[index]];
                    }
                }
                
                // åˆ›å»ºå›¾è¡¨
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: displayYears,
                                        datasets: [
                    {
                        label: 'å¤è¯•çº¿',
                        data: reexamScores,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#3498db',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        tension: 0.2,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: 'å›½å®¶çº¿',
                        data: nationalScores,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#e74c3c',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        tension: 0.2,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: 'æŠ¥åäººæ•°',
                        data: applicants,
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#27ae60',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        tension: 0.2,
                        fill: false,
                        yAxisID: 'y1'
                    }
                ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                beginAtZero: false,
                                min: 260,
                                max: 320,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                title: {
                                    display: true,
                                    text: 'åˆ†æ•°'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: false,
                                min: 100,
                                max: 130,
                                grid: {
                                    drawOnChartArea: false,
                                },
                                title: {
                                    display: true,
                                    text: 'æŠ¥åäººæ•°'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'å¹´ä»½'
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            }
        }
        
        // æ›´æ–°åˆ†æ•°çº¿å›¾è¡¨
        function updateScoreChart(year) {
            // å…ˆé”€æ¯æ—§å›¾è¡¨
            const canvas = document.getElementById('scoreChart');
            if (canvas) {
                const chart = Chart.getChart(canvas);
                if (chart) {
                    chart.destroy();
                }
            }
            createScoreChart(year);
        }
        
        // åˆå§‹åŒ–æˆç»©å›¾è¡¨
        function initGradeChart() {
            const ctx = document.getElementById('gradeChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['90-100åˆ†', '80-89åˆ†', '70-79åˆ†', '60-69åˆ†', '60åˆ†ä»¥ä¸‹'],
                    datasets: [{
                        data: [15, 30, 25, 20, 10],
                        backgroundColor: [
                            '#27ae60',
                            '#2ecc71',
                            '#f1c40f',
                            '#e67e22',
                            '#e74c3c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // æ·»åŠ æˆç»©
        document.querySelector('.add-grade-btn').addEventListener('click', function() {
            const nameInput = document.querySelector('.grade-form input[type="text"]');
            const gradeInput = document.querySelector('.grade-form input[type="number"]');
            
            if (!nameInput.value || !gradeInput.value) {
                showAlert('è¯·å¡«å†™å­¦ç”Ÿå§“åå’Œæˆç»©');
                return;
            }
            
            const gradeList = document.querySelector('.grade-list');
            const newItem = document.createElement('div');
            newItem.className = 'grade-item';
            newItem.innerHTML = `
                <span>${nameInput.value}</span>
                <span>${gradeInput.value}</span>
            `;
            gradeList.appendChild(newItem);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            nameInput.value = '';
            gradeInput.value = '';
        });
        
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        function toggleMobileMenu() {
            const nav = document.getElementById('mainNav');
            nav.classList.toggle('active');
        }
        
        // ==================== é«˜çº§æ–‡ä»¶ä¸Šä¼ ç®¡ç†ç³»ç»Ÿ ====================
        
        // ä¸Šä¼ åŠŸèƒ½ç›¸å…³å˜é‡
        let currentUploadType = '';
        let selectedFiles = [];
        let selectedVideoFile = null;
        let uploadQueue = [];
        let activeUploads = new Map();
        let uploadStatistics = {
            totalFiles: 0,
            successfulUploads: 0,
            failedUploads: 0,
            totalSize: 0,
            uploadedSize: 0
        };

        // é«˜çº§æ–‡ä»¶ä¸Šä¼ ç®¡ç†å™¨
        class AdvancedUploadManager {
            constructor() {
                this.maxConcurrentUploads = 3;
                this.maxFileSize = 500 * 1024 * 1024; // 500MB
                this.supportedVideoFormats = ['mp4', 'webm', 'ogg', 'avi', 'mov', 'wmv', 'flv', 'm4v'];
                this.supportedExerciseFormats = ['json', 'txt', 'csv', 'xlsx', 'xls'];
                this.compressionEnabled = true;
                this.autoRetry = true;
                this.maxRetries = 3;
            }

            // åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ 
            initDragAndDrop(element) {
                if (!element) return;

                element.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    element.classList.add('dragover');
                    this.showDragOverlay(element, true);
                });

                element.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    if (!element.contains(e.relatedTarget)) {
                        element.classList.remove('dragover');
                        this.showDragOverlay(element, false);
                    }
                });

                element.addEventListener('drop', (e) => {
                    e.preventDefault();
                    element.classList.remove('dragover');
                    this.showDragOverlay(element, false);
                    
                    const files = Array.from(e.dataTransfer.files);
                    this.handleFileSelection(files);
                });
            }

            // æ˜¾ç¤ºæ‹–æ‹½è¦†ç›–å±‚
            showDragOverlay(element, show) {
                let overlay = element.querySelector('.drag-overlay');
                if (!overlay && show) {
                    overlay = document.createElement('div');
                    overlay.className = 'drag-overlay';
                    overlay.innerHTML = `
                        <div class="drag-overlay-content">
                            <div class="drag-overlay-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="drag-overlay-text">é‡Šæ”¾æ–‡ä»¶å¼€å§‹ä¸Šä¼ </div>
                            <div class="drag-overlay-hint">æ”¯æŒå¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼ </div>
                        </div>
                    `;
                    element.appendChild(overlay);
                }
                
                if (overlay) {
                    overlay.classList.toggle('active', show);
                }
            }

            // å¤„ç†æ–‡ä»¶é€‰æ‹©
            async handleFileSelection(files) {
                if (!files || files.length === 0) return;

                showAdvancedLoading('æ­£åœ¨åˆ†ææ–‡ä»¶...');

                const validFiles = [];
                const invalidFiles = [];

                for (const file of files) {
                    const validation = await this.validateFile(file);
                    if (validation.valid) {
                        validFiles.push({
                            file: file,
                            id: this.generateFileId(),
                            metadata: validation.metadata
                        });
                    } else {
                        invalidFiles.push({
                            file: file,
                            error: validation.error
                        });
                    }
                }

                hideAdvancedLoading();

                if (invalidFiles.length > 0) {
                    this.showFileValidationErrors(invalidFiles);
                }

                if (validFiles.length > 0) {
                    this.addFilesToQueue(validFiles);
                    this.showFilePreview(validFiles);
                }
            }

            // éªŒè¯æ–‡ä»¶
            async validateFile(file) {
                const result = {
                    valid: false,
                    error: null,
                    metadata: {}
                };

                // æ£€æŸ¥æ–‡ä»¶å¤§å°
                if (file.size > this.maxFileSize) {
                    result.error = `æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ (${this.formatFileSize(this.maxFileSize)})`;
                    return result;
                }

                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                const extension = file.name.split('.').pop().toLowerCase();
                const isVideo = this.supportedVideoFormats.includes(extension);
                const isExercise = this.supportedExerciseFormats.includes(extension);

                if (!isVideo && !isExercise) {
                    result.error = 'ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼';
                    return result;
                }

                // è·å–æ–‡ä»¶å…ƒæ•°æ®
                if (isVideo) {
                    result.metadata = await this.getVideoMetadata(file);
                    result.metadata.type = 'video';
                } else {
                    result.metadata = await this.getExerciseMetadata(file);
                    result.metadata.type = 'exercise';
                }

                result.valid = true;
                return result;
            }

            // è·å–è§†é¢‘å…ƒæ•°æ®
            async getVideoMetadata(file) {
                return new Promise((resolve) => {
                    const video = document.createElement('video');
                    const url = URL.createObjectURL(file);
                    
                    video.preload = 'metadata';
                    video.onloadedmetadata = () => {
                        resolve({
                            duration: video.duration,
                            width: video.videoWidth,
                            height: video.videoHeight,
                            aspectRatio: video.videoWidth / video.videoHeight
                        });
                        URL.revokeObjectURL(url);
                    };
                    
                    video.onerror = () => {
                        resolve({
                            duration: 0,
                            width: 0,
                            height: 0,
                            aspectRatio: 16/9
                        });
                        URL.revokeObjectURL(url);
                    };
                    
                    video.src = url;
                });
            }

            // è·å–é¢˜åº“å…ƒæ•°æ®
            async getExerciseMetadata(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const content = e.target.result;
                            let questionCount = 0;
                            
                            if (file.name.endsWith('.json')) {
                                const data = JSON.parse(content);
                                questionCount = Array.isArray(data) ? data.length : (data.questions ? data.questions.length : 0);
                            } else if (file.name.endsWith('.txt')) {
                                questionCount = content.split('\n').filter(line => line.trim()).length;
                            } else if (file.name.endsWith('.csv')) {
                                questionCount = content.split('\n').length - 1; // å‡å»æ ‡é¢˜è¡Œ
                            }
                            
                            resolve({
                                questionCount: questionCount,
                                format: file.name.split('.').pop().toLowerCase()
                            });
                        } catch (error) {
                            resolve({
                                questionCount: 0,
                                format: file.name.split('.').pop().toLowerCase()
                            });
                        }
                    };
                    reader.readAsText(file);
                });
            }

            // ç”Ÿæˆæ–‡ä»¶ID
            generateFileId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            // æ˜¾ç¤ºæ–‡ä»¶éªŒè¯é”™è¯¯
            showFileValidationErrors(invalidFiles) {
                const errorMessages = invalidFiles.map(item => 
                    `${item.file.name}: ${item.error}`
                ).join('\n');
                
                showAdvancedToast(`ä»¥ä¸‹æ–‡ä»¶éªŒè¯å¤±è´¥:\n${errorMessages}`, 'error');
            }
        }

        // åˆ›å»ºå…¨å±€ä¸Šä¼ ç®¡ç†å™¨å®ä¾‹
        const uploadManager = new AdvancedUploadManager();

        // ==================== é«˜çº§UIè¾…åŠ©å‡½æ•° ====================
        
        // æ˜¾ç¤ºé«˜çº§åŠ è½½æŒ‡ç¤ºå™¨
        function showAdvancedLoading(message = 'åŠ è½½ä¸­...') {
            let loadingOverlay = document.getElementById('advancedLoadingOverlay');
            if (!loadingOverlay) {
                loadingOverlay = document.createElement('div');
                loadingOverlay.id = 'advancedLoadingOverlay';
                loadingOverlay.className = 'loading-overlay';
                loadingOverlay.innerHTML = `
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">${message}</div>
                    </div>
                `;
                document.body.appendChild(loadingOverlay);
            } else {
                loadingOverlay.querySelector('.loading-text').textContent = message;
            }
            loadingOverlay.style.display = 'flex';
        }

        // éšè—é«˜çº§åŠ è½½æŒ‡ç¤ºå™¨
        function hideAdvancedLoading() {
            const loadingOverlay = document.getElementById('advancedLoadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
        }

        // æ˜¾ç¤ºé«˜çº§é€šçŸ¥
        function showAdvancedToast(message, type = 'info', duration = 5000) {
            const toastContainer = getOrCreateToastContainer();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconMap = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'info': 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="toast-header">
                    <i class="${iconMap[type]}"></i>
                    <span>${type.charAt(0).toUpperCase() + type.slice(1)}</span>
                </div>
                <div class="toast-body">${message}</div>
                <div class="toast-progress">
                    <div class="toast-progress-bar ${type}"></div>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => toast.classList.add('show'), 100);
            
            // è‡ªåŠ¨éšè—
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // è·å–æˆ–åˆ›å»ºé€šçŸ¥å®¹å™¨
        function getOrCreateToastContainer() {
            let container = document.getElementById('toastContainer');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toastContainer';
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            return container;
        }

        // æ˜¾ç¤ºè§†é¢‘é”™è¯¯
        function showVideoError(container, message) {
            container.innerHTML = `
                <div class="video-error">
                    <div class="video-error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="video-error-message">${message}</div>
                    <button class="btn btn-primary" onclick="closeVideoModal()">å…³é—­</button>
                </div>
            `;
        }

        // å…³é—­è§†é¢‘æ¨¡æ€æ¡†
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            if (modal) {
                modal.classList.remove('active');
                
                // æ¸…ç†æ’­æ”¾å™¨
                if (currentVideoPlayer) {
                    try {
                        currentVideoPlayer.dispose();
                    } catch (e) {
                        console.warn('Error disposing video player:', e);
                    }
                    currentVideoPlayer = null;
                }
                
                // é‡ç½®æ’­æ”¾å™¨çŠ¶æ€
                videoPlayerState = {
                    isPlaying: false,
                    currentTime: 0,
                    duration: 0,
                    volume: 1,
                    playbackRate: 1,
                    isFullscreen: false,
                    quality: 'auto'
                };
            }
        }

        // è®°å½•è§†é¢‘æ’­æ”¾ç»Ÿè®¡
        function recordVideoPlay(source, title, type) {
            const playRecord = {
                source: source,
                title: title,
                type: type,
                timestamp: new Date().toISOString(),
                user: currentUser,
                userAgent: navigator.userAgent
            };
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const playHistory = JSON.parse(localStorage.getItem('videoPlayHistory') || '[]');
            playHistory.push(playRecord);
            
            // åªä¿ç•™æœ€è¿‘100æ¡è®°å½•
            if (playHistory.length > 100) {
                playHistory.splice(0, playHistory.length - 100);
            }
            
            localStorage.setItem('videoPlayHistory', JSON.stringify(playHistory));
            
            console.log('ğŸ“Š Video play recorded:', playRecord);
        }

        // åˆå§‹åŒ–é«˜çº§åª’ä½“ä¿æŠ¤
        function initAdvancedMediaProtection() {
            if (!currentUser || !accounts[currentUser] || accounts[currentUser].role !== 'student') {
                return; // åªå¯¹å­¦ç”Ÿåº”ç”¨ä¿æŠ¤
            }

            // ç¦ç”¨å³é”®èœå•
            document.addEventListener('contextmenu', (e) => {
                if (e.target.closest('.advanced-video-player')) {
                    e.preventDefault();
                    showAdvancedToast('æ­¤æ“ä½œä¸è¢«å…è®¸', 'warning');
                }
            });

            // ç¦ç”¨æ‹–æ‹½
            document.addEventListener('dragstart', (e) => {
                if (e.target.closest('.advanced-video-player')) {
                    e.preventDefault();
                }
            });

            // ç¦ç”¨é€‰æ‹©
            document.addEventListener('selectstart', (e) => {
                if (e.target.closest('.advanced-video-player')) {
                    e.preventDefault();
                }
            });

            // ç›‘æ§å¼€å‘è€…å·¥å…·
            let devtools = {
                open: false,
                orientation: null
            };

            const threshold = 160;
            setInterval(() => {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        console.clear();
                        showAdvancedToast('æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·ï¼Œè¯·å…³é—­åç»§ç»­å­¦ä¹ ', 'warning');
                    }
                } else {
                    devtools.open = false;
                }
            }, 500);
        }

        // åº”ç”¨å­¦ç”Ÿè§†é¢‘ä¿æŠ¤
        function applyStudentVideoProtection(player) {
            if (!player) return;

            // ç¦ç”¨ç”»ä¸­ç”»
            const video = player.el().querySelector('video');
            if (video) {
                video.disablePictureInPicture = true;
                video.controlsList = 'nodownload nofullscreen noremoteplayback';
            }

            // æ·»åŠ æ°´å°
            const watermark = document.createElement('div');
            watermark.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                color: rgba(255, 255, 255, 0.7);
                font-size: 14px;
                font-weight: 600;
                pointer-events: none;
                z-index: 1000;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            `;
            watermark.textContent = `${accounts[currentUser].name} - ${new Date().toLocaleString()}`;
            
            const playerContainer = player.el().parentElement;
            if (playerContainer) {
                playerContainer.appendChild(watermark);
            }

            console.log('ğŸ›¡ï¸ Student video protection applied');
        }

        // åˆ¤æ–­æ˜¯å¦ä¸ºç›´æ¥è§†é¢‘URL
        function isDirectVideoUrl(url) {
            const videoExtensions = ['mp4', 'webm', 'ogg', 'avi', 'mov', 'wmv', 'flv', 'm4v'];
            const extension = url.split('.').pop().toLowerCase().split('?')[0];
            return videoExtensions.includes(extension);
        }

        // ==================== å¤šå¹³å°è§†é¢‘æ’­æ”¾å™¨ç³»ç»Ÿ ====================
        
        // åˆ›å»ºBilibiliæ’­æ”¾å™¨
        async function createBilibiliPlayer(container, source, title, metadata = {}) {
            try {
                // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨
                const loadingDiv = container.querySelector('.video-loading');
                if (loadingDiv) loadingDiv.remove();

                // æå–BVå·æˆ–AVå·
                let videoId = '';
                if (source.includes('bilibili.com')) {
                    const bvMatch = source.match(/BV[a-zA-Z0-9]+/);
                    const avMatch = source.match(/av(\d+)/);
                    if (bvMatch) {
                        videoId = bvMatch[0];
                    } else if (avMatch) {
                        videoId = `av${avMatch[1]}`;
                    }
                } else if (source.includes('b23.tv')) {
                    // å¤„ç†çŸ­é“¾æ¥ï¼Œéœ€è¦è§£æ
                    videoId = await resolveBilibiliShortLink(source);
                }

                if (!videoId) {
                    throw new Error('æ— æ³•è§£æBilibiliè§†é¢‘ID');
                }

                // åˆ›å»ºå¢å¼ºçš„Bilibiliæ’­æ”¾å™¨
                const playerContainer = document.createElement('div');
                playerContainer.style.cssText = `
                    position: relative;
                    width: 100%;
                    height: 100%;
                    background: #000;
                    border-radius: 16px;
                    overflow: hidden;
                `;

                // åˆ›å»ºiframeæ’­æ”¾å™¨
                const iframe = document.createElement('iframe');
                iframe.src = `https://player.bilibili.com/player.html?bvid=${videoId}&page=1&autoplay=0&high_quality=1&danmaku=0&t=0&as_wide=1&hasMuteButton=1&allowfullscreen=true&quality=120&vd_source=&p2p=0&no_share=1&no_recommend=1`;
                iframe.style.cssText = `
                    width: 100%;
                    height: 100%;
                    border: none;
                    border-radius: 16px;
                `;
                iframe.setAttribute('allow', 'fullscreen; autoplay; encrypted-media');
                iframe.setAttribute('allowfullscreen', 'true');
                iframe.setAttribute('scrolling', 'no');

                playerContainer.appendChild(iframe);

                // æ·»åŠ Bilibiliç‰¹æœ‰çš„æ§åˆ¶è¦†ç›–å±‚
                const controlsOverlay = document.createElement('div');
                controlsOverlay.className = 'video-controls-overlay';
                controlsOverlay.innerHTML = `
                    <button class="video-control-btn" id="bilibiliRefreshBtn" title="åˆ·æ–°æ’­æ”¾å™¨">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="video-control-btn" id="bilibiliOpenBtn" title="åœ¨æ–°çª—å£æ‰“å¼€">
                        <i class="fas fa-external-link-alt"></i>
                    </button>
                `;

                playerContainer.appendChild(controlsOverlay);

                // æ·»åŠ æ’­æ”¾æç¤º
                const playHint = document.createElement('div');
                playHint.style.cssText = `
                    position: absolute;
                    bottom: 100px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 14px;
                    z-index: 1000;
                    backdrop-filter: blur(10px);
                    -webkit-backdrop-filter: blur(10px);
                `;
                playHint.textContent = 'æ”¯æŒå…¨å±å’Œå€é€Ÿæ’­æ”¾ï¼Œè¯·åœ¨æ’­æ”¾å™¨å†…æ“ä½œ';
                playerContainer.appendChild(playHint);

                // 3ç§’åéšè—æç¤º
                setTimeout(() => {
                    playHint.style.opacity = '0';
                    playHint.style.transform = 'translateX(-50%) translateY(20px)';
                    setTimeout(() => playHint.remove(), 300);
                }, 3000);

                container.appendChild(playerContainer);

                // ç»‘å®šæ§åˆ¶æŒ‰é’®äº‹ä»¶
                setupBilibiliControls(controlsOverlay, iframe, source, videoId);

                console.log('âœ… Bilibili player created successfully:', videoId);

            } catch (error) {
                console.error('Error creating Bilibili player:', error);
                showVideoError(container, 'æ— æ³•åŠ è½½Bilibiliè§†é¢‘');
            }
        }

        // è®¾ç½®Bilibiliæ§åˆ¶æŒ‰é’®
        function setupBilibiliControls(overlay, iframe, source, videoId) {
            const refreshBtn = overlay.querySelector('#bilibiliRefreshBtn');
            const openBtn = overlay.querySelector('#bilibiliOpenBtn');

            refreshBtn.addEventListener('click', () => {
                iframe.src = iframe.src; // é‡æ–°åŠ è½½iframe
                showAdvancedToast('æ’­æ”¾å™¨å·²åˆ·æ–°', 'info');
            });

            openBtn.addEventListener('click', () => {
                window.open(source, '_blank');
                showAdvancedToast('å·²åœ¨æ–°çª—å£æ‰“å¼€', 'info');
            });
        }

        // è§£æBilibiliçŸ­é“¾æ¥
        async function resolveBilibiliShortLink(shortUrl) {
            try {
                // è¿™é‡Œå¯ä»¥é€šè¿‡ä»£ç†æœåŠ¡è§£æçŸ­é“¾æ¥
                // æš‚æ—¶è¿”å›ç©ºï¼Œéœ€è¦åç«¯æ”¯æŒ
                return '';
            } catch (error) {
                console.error('Error resolving Bilibili short link:', error);
                return '';
            }
        }

        // åˆ›å»ºYouTubeæ’­æ”¾å™¨
        async function createYouTubePlayer(container, source, title, metadata = {}) {
            try {
                // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨
                const loadingDiv = container.querySelector('.video-loading');
                if (loadingDiv) loadingDiv.remove();

                // æå–YouTubeè§†é¢‘ID
                let videoId = '';
                const patterns = [
                    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,
                    /youtube\.com\/v\/([^&\n?#]+)/,
                    /youtube\.com\/watch\?.*v=([^&\n?#]+)/
                ];

                for (const pattern of patterns) {
                    const match = source.match(pattern);
                    if (match) {
                        videoId = match[1];
                        break;
                    }
                }

                if (!videoId) {
                    throw new Error('æ— æ³•è§£æYouTubeè§†é¢‘ID');
                }

                // åˆ›å»ºYouTubeæ’­æ”¾å™¨å®¹å™¨
                const playerContainer = document.createElement('div');
                playerContainer.style.cssText = `
                    position: relative;
                    width: 100%;
                    height: 100%;
                    background: #000;
                    border-radius: 16px;
                    overflow: hidden;
                `;

                // åˆ›å»ºYouTube iframe
                const iframe = document.createElement('iframe');
                iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=0&controls=1&modestbranding=1&rel=0&showinfo=0&fs=1&cc_load_policy=1&iv_load_policy=3&autohide=1&playsinline=1`;
                iframe.style.cssText = `
                    width: 100%;
                    height: 100%;
                    border: none;
                    border-radius: 16px;
                `;
                iframe.setAttribute('allow', 'fullscreen; autoplay; encrypted-media; accelerometer; gyroscope; picture-in-picture');
                iframe.setAttribute('allowfullscreen', 'true');

                playerContainer.appendChild(iframe);

                // æ·»åŠ YouTubeæ§åˆ¶è¦†ç›–å±‚
                const controlsOverlay = document.createElement('div');
                controlsOverlay.className = 'video-controls-overlay';
                controlsOverlay.innerHTML = `
                    <button class="video-control-btn" id="youtubeRefreshBtn" title="åˆ·æ–°æ’­æ”¾å™¨">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="video-control-btn" id="youtubeOpenBtn" title="åœ¨YouTubeæ‰“å¼€">
                        <i class="fab fa-youtube"></i>
                    </button>
                `;

                playerContainer.appendChild(controlsOverlay);

                container.appendChild(playerContainer);

                // ç»‘å®šYouTubeæ§åˆ¶äº‹ä»¶
                setupYouTubeControls(controlsOverlay, iframe, source, videoId);

                console.log('âœ… YouTube player created successfully:', videoId);

            } catch (error) {
                console.error('Error creating YouTube player:', error);
                showVideoError(container, 'æ— æ³•åŠ è½½YouTubeè§†é¢‘');
            }
        }

        // è®¾ç½®YouTubeæ§åˆ¶æŒ‰é’®
        function setupYouTubeControls(overlay, iframe, source, videoId) {
            const refreshBtn = overlay.querySelector('#youtubeRefreshBtn');
            const openBtn = overlay.querySelector('#youtubeOpenBtn');

            refreshBtn.addEventListener('click', () => {
                iframe.src = iframe.src;
                showAdvancedToast('æ’­æ”¾å™¨å·²åˆ·æ–°', 'info');
            });

            openBtn.addEventListener('click', () => {
                window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
                showAdvancedToast('å·²åœ¨YouTubeæ‰“å¼€', 'info');
            });
        }

        // åˆ›å»ºæŠ–éŸ³æ’­æ”¾å™¨
        async function createDouyinPlayer(container, source, title, metadata = {}) {
            try {
                // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨
                const loadingDiv = container.querySelector('.video-loading');
                if (loadingDiv) loadingDiv.remove();

                // æŠ–éŸ³è§†é¢‘éœ€è¦ç‰¹æ®Šå¤„ç†
                const playerContainer = document.createElement('div');
                playerContainer.style.cssText = `
                    position: relative;
                    width: 100%;
                    height: 100%;
                    background: #000;
                    border-radius: 16px;
                    overflow: hidden;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;

                // æŠ–éŸ³æ’­æ”¾æç¤º
                const douyinNotice = document.createElement('div');
                douyinNotice.style.cssText = `
                    text-align: center;
                    color: white;
                    padding: 40px;
                `;
                douyinNotice.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 20px;">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3 style="margin-bottom: 16px;">æŠ–éŸ³è§†é¢‘</h3>
                    <p style="margin-bottom: 20px; opacity: 0.8;">
                        ç”±äºå¹³å°é™åˆ¶ï¼ŒæŠ–éŸ³è§†é¢‘éœ€è¦åœ¨ç§»åŠ¨ç«¯è§‚çœ‹<br>
                        æˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åœ¨æ–°çª—å£æ‰“å¼€
                    </p>
                    <button class="btn btn-primary" onclick="window.open('${source}', '_blank')">
                        <i class="fas fa-external-link-alt"></i>
                        åœ¨æŠ–éŸ³æ‰“å¼€
                    </button>
                `;

                playerContainer.appendChild(douyinNotice);
                container.appendChild(playerContainer);

                console.log('âœ… Douyin player notice created');

            } catch (error) {
                console.error('Error creating Douyin player:', error);
                showVideoError(container, 'æ— æ³•åŠ è½½æŠ–éŸ³è§†é¢‘');
            }
        }

        // åˆ›å»ºé€šç”¨æ’­æ”¾å™¨
        async function createGenericPlayer(container, source, title, metadata = {}) {
            try {
                // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨
                const loadingDiv = container.querySelector('.video-loading');
                if (loadingDiv) loadingDiv.remove();

                // åˆ›å»ºé€šç”¨iframeæ’­æ”¾å™¨
                const playerContainer = document.createElement('div');
                playerContainer.style.cssText = `
                    position: relative;
                    width: 100%;
                    height: 100%;
                    background: #000;
                    border-radius: 16px;
                    overflow: hidden;
                `;

                const iframe = document.createElement('iframe');
                iframe.src = source;
                iframe.style.cssText = `
                    width: 100%;
                    height: 100%;
                    border: none;
                    border-radius: 16px;
                `;
                iframe.setAttribute('allow', 'fullscreen; autoplay; encrypted-media');
                iframe.setAttribute('allowfullscreen', 'true');

                playerContainer.appendChild(iframe);

                // æ·»åŠ é€šç”¨æ§åˆ¶æŒ‰é’®
                const controlsOverlay = document.createElement('div');
                controlsOverlay.className = 'video-controls-overlay';
                controlsOverlay.innerHTML = `
                    <button class="video-control-btn" id="genericRefreshBtn" title="åˆ·æ–°æ’­æ”¾å™¨">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="video-control-btn" id="genericOpenBtn" title="åœ¨æ–°çª—å£æ‰“å¼€">
                        <i class="fas fa-external-link-alt"></i>
                    </button>
                `;

                playerContainer.appendChild(controlsOverlay);
                container.appendChild(playerContainer);

                // ç»‘å®šé€šç”¨æ§åˆ¶äº‹ä»¶
                setupGenericControls(controlsOverlay, iframe, source);

                console.log('âœ… Generic player created successfully');

            } catch (error) {
                console.error('Error creating generic player:', error);
                showVideoError(container, 'æ— æ³•åŠ è½½è§†é¢‘å†…å®¹');
            }
        }

        // è®¾ç½®é€šç”¨æ§åˆ¶æŒ‰é’®
        function setupGenericControls(overlay, iframe, source) {
            const refreshBtn = overlay.querySelector('#genericRefreshBtn');
            const openBtn = overlay.querySelector('#genericOpenBtn');

            refreshBtn.addEventListener('click', () => {
                iframe.src = iframe.src;
                showAdvancedToast('æ’­æ”¾å™¨å·²åˆ·æ–°', 'info');
            });

            openBtn.addEventListener('click', () => {
                window.open(source, '_blank');
                showAdvancedToast('å·²åœ¨æ–°çª—å£æ‰“å¼€', 'info');
            });
        }

        // ==================== æ™ºèƒ½é¢˜åº“å¤„ç†ç³»ç»Ÿ ====================
        
        // é«˜çº§é¢˜åº“ç®¡ç†å™¨
        class AdvancedExerciseManager {
            constructor() {
                this.exerciseTypes = {
                    'multiple-choice': 'å•é€‰é¢˜',
                    'multiple-select': 'å¤šé€‰é¢˜',
                    'fill-in-blank': 'å¡«ç©ºé¢˜',
                    'true-false': 'åˆ¤æ–­é¢˜',
                    'short-answer': 'ç®€ç­”é¢˜',
                    'essay': 'è®ºè¿°é¢˜'
                };
                this.difficultyLevels = ['ç®€å•', 'ä¸­ç­‰', 'å›°éš¾', 'ä¸“å®¶'];
                this.categories = ['åŸºç¡€æ¦‚å¿µ', 'å…¬å¼æ¨å¯¼', 'å®é™…åº”ç”¨', 'ç»¼åˆåˆ†æ'];
            }

            // æ™ºèƒ½è§£æé¢˜åº“å†…å®¹
            async parseExerciseContent(content, format) {
                try {
                    let questions = [];
                    
                    switch (format.toLowerCase()) {
                        case 'json':
                            questions = await this.parseJsonFormat(content);
                            break;
                        case 'txt':
                            questions = await this.parseTextFormat(content);
                            break;
                        case 'csv':
                            questions = await this.parseCsvFormat(content);
                            break;
                        case 'xlsx':
                        case 'xls':
                            questions = await this.parseExcelFormat(content);
                            break;
                        default:
                            throw new Error(`ä¸æ”¯æŒçš„æ ¼å¼: ${format}`);
                    }

                    // éªŒè¯å’Œå¢å¼ºé¢˜ç›®æ•°æ®
                    return this.enhanceQuestions(questions);

                } catch (error) {
                    console.error('Error parsing exercise content:', error);
                    throw error;
                }
            }

            // è§£æJSONæ ¼å¼
            async parseJsonFormat(content) {
                const data = JSON.parse(content);
                if (Array.isArray(data)) {
                    return data;
                } else if (data.questions && Array.isArray(data.questions)) {
                    return data.questions;
                } else {
                    throw new Error('JSONæ ¼å¼ä¸æ­£ç¡®');
                }
            }

            // è§£ææ–‡æœ¬æ ¼å¼
            async parseTextFormat(content) {
                const lines = content.split('\n').filter(line => line.trim());
                const questions = [];
                
                let currentQuestion = null;
                let questionNumber = 1;

                for (const line of lines) {
                    const trimmedLine = line.trim();
                    
                    if (trimmedLine.match(/^\d+[.ã€]/)) {
                        // æ–°é¢˜ç›®å¼€å§‹
                        if (currentQuestion) {
                            questions.push(currentQuestion);
                        }
                        
                        currentQuestion = {
                            id: questionNumber++,
                            question: trimmedLine.replace(/^\d+[.ã€]\s*/, ''),
                            type: 'fill-in-blank',
                            answer: '',
                            options: [],
                            explanation: '',
                            difficulty: 'ä¸­ç­‰',
                            category: 'åŸºç¡€æ¦‚å¿µ'
                        };
                    } else if (trimmedLine.match(/^[A-D][.ã€]/)) {
                        // é€‰é¡¹
                        if (currentQuestion) {
                            currentQuestion.options.push(trimmedLine);
                            if (currentQuestion.type === 'fill-in-blank') {
                                currentQuestion.type = 'multiple-choice';
                            }
                        }
                    } else if (trimmedLine.startsWith('ç­”æ¡ˆ:') || trimmedLine.startsWith('Answer:')) {
                        // ç­”æ¡ˆ
                        if (currentQuestion) {
                            currentQuestion.answer = trimmedLine.replace(/^(ç­”æ¡ˆ:|Answer:)\s*/, '');
                        }
                    } else if (trimmedLine.startsWith('è§£æ:') || trimmedLine.startsWith('Explanation:')) {
                        // è§£æ
                        if (currentQuestion) {
                            currentQuestion.explanation = trimmedLine.replace(/^(è§£æ:|Explanation:)\s*/, '');
                        }
                    }
                }

                // æ·»åŠ æœ€åä¸€é¢˜
                if (currentQuestion) {
                    questions.push(currentQuestion);
                }

                return questions;
            }

            // è§£æCSVæ ¼å¼
            async parseCsvFormat(content) {
                const lines = content.split('\n');
                const questions = [];
                
                // å‡è®¾ç¬¬ä¸€è¡Œæ˜¯æ ‡é¢˜
                const headers = lines[0].split(',').map(h => h.trim());
                
                for (let i = 1; i < lines.length; i++) {
                    const values = this.parseCsvLine(lines[i]);
                    if (values.length >= 2) {
                        const question = {
                            id: i,
                            question: values[0] || '',
                            answer: values[1] || '',
                            type: values[2] || 'fill-in-blank',
                            difficulty: values[3] || 'ä¸­ç­‰',
                            category: values[4] || 'åŸºç¡€æ¦‚å¿µ',
                            explanation: values[5] || '',
                            options: []
                        };

                        // å¦‚æœæœ‰é€‰é¡¹åˆ—
                        for (let j = 6; j < values.length && j < 10; j++) {
                            if (values[j] && values[j].trim()) {
                                question.options.push(values[j].trim());
                            }
                        }

                        if (question.options.length > 0 && question.type === 'fill-in-blank') {
                            question.type = 'multiple-choice';
                        }

                        questions.push(question);
                    }
                }

                return questions;
            }

            // è§£æCSVè¡Œï¼ˆå¤„ç†å¼•å·åŒ…å›´çš„å­—æ®µï¼‰
            parseCsvLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim());
                return result;
            }

            // è§£æExcelæ ¼å¼ï¼ˆéœ€è¦XLSXåº“æ”¯æŒï¼‰
            async parseExcelFormat(file) {
                // è¿™é‡Œéœ€è¦ä½¿ç”¨XLSXåº“æ¥è§£æExcelæ–‡ä»¶
                // æš‚æ—¶è¿”å›ç©ºæ•°ç»„ï¼Œéœ€è¦å®é™…çš„Excelè§£æå®ç°
                console.warn('Excel format parsing not yet implemented');
                return [];
            }

            // å¢å¼ºé¢˜ç›®æ•°æ®
            enhanceQuestions(questions) {
                return questions.map((question, index) => {
                    // ç¡®ä¿å¿…è¦å­—æ®µå­˜åœ¨
                    const enhanced = {
                        id: question.id || (index + 1),
                        question: question.question || '',
                        answer: question.answer || '',
                        type: question.type || 'fill-in-blank',
                        difficulty: question.difficulty || 'ä¸­ç­‰',
                        category: question.category || 'åŸºç¡€æ¦‚å¿µ',
                        explanation: question.explanation || '',
                        options: question.options || [],
                        tags: question.tags || [],
                        points: question.points || 1,
                        timeLimit: question.timeLimit || 60, // ç§’
                        created: question.created || new Date().toISOString(),
                        updated: new Date().toISOString()
                    };

                    // æ™ºèƒ½æ¨æ–­é¢˜ç›®ç±»å‹
                    if (!question.type || question.type === 'auto') {
                        enhanced.type = this.inferQuestionType(enhanced);
                    }

                    // æ™ºèƒ½æ¨æ–­éš¾åº¦
                    if (enhanced.difficulty === 'auto') {
                        enhanced.difficulty = this.inferDifficulty(enhanced);
                    }

                    // æ™ºèƒ½æ¨æ–­åˆ†ç±»
                    if (enhanced.category === 'auto') {
                        enhanced.category = this.inferCategory(enhanced);
                    }

                    return enhanced;
                });
            }

            // æ¨æ–­é¢˜ç›®ç±»å‹
            inferQuestionType(question) {
                const questionText = question.question.toLowerCase();
                
                if (question.options && question.options.length > 0) {
                    if (question.options.length === 2 && 
                        (question.options.some(opt => opt.includes('å¯¹') || opt.includes('é”™') || 
                         opt.includes('True') || opt.includes('False')))) {
                        return 'true-false';
                    } else if (question.answer && question.answer.split(',').length > 1) {
                        return 'multiple-select';
                    } else {
                        return 'multiple-choice';
                    }
                }

                if (questionText.includes('å¡«ç©º') || questionText.includes('___') || 
                    questionText.includes('____') || questionText.includes('ï¼ˆï¼‰')) {
                    return 'fill-in-blank';
                }

                if (questionText.includes('åˆ¤æ–­') || questionText.includes('å¯¹é”™') ||
                    questionText.includes('æ­£ç¡®') || questionText.includes('é”™è¯¯')) {
                    return 'true-false';
                }

                if (questionText.includes('ç®€è¿°') || questionText.includes('ç®€ç­”') ||
                    questionText.includes('è¯´æ˜') || questionText.includes('è§£é‡Š')) {
                    return 'short-answer';
                }

                if (questionText.includes('è®ºè¿°') || questionText.includes('åˆ†æ') ||
                    questionText.includes('è®¨è®º') || questionText.length > 200) {
                    return 'essay';
                }

                return 'fill-in-blank'; // é»˜è®¤ç±»å‹
            }

            // æ¨æ–­éš¾åº¦ç­‰çº§
            inferDifficulty(question) {
                const questionText = question.question.toLowerCase();
                let score = 0;

                // åŸºäºå…³é”®è¯æ¨æ–­
                const easyKeywords = ['å®šä¹‰', 'æ¦‚å¿µ', 'åŸºæœ¬', 'ç®€å•', 'ä»€ä¹ˆæ˜¯'];
                const mediumKeywords = ['è®¡ç®—', 'åº”ç”¨', 'åˆ†æ', 'æ¯”è¾ƒ', 'è§£é‡Š'];
                const hardKeywords = ['æ¨å¯¼', 'è¯æ˜', 'ç»¼åˆ', 'è®¾è®¡', 'è¯„ä»·'];
                const expertKeywords = ['åˆ›æ–°', 'ä¼˜åŒ–', 'æ‰¹åˆ¤', 'ç ”ç©¶', 'å‘å±•'];

                easyKeywords.forEach(keyword => {
                    if (questionText.includes(keyword)) score -= 1;
                });

                mediumKeywords.forEach(keyword => {
                    if (questionText.includes(keyword)) score += 0;
                });

                hardKeywords.forEach(keyword => {
                    if (questionText.includes(keyword)) score += 1;
                });

                expertKeywords.forEach(keyword => {
                    if (questionText.includes(keyword)) score += 2;
                });

                // åŸºäºé¢˜ç›®é•¿åº¦
                if (question.question.length > 300) score += 1;
                if (question.question.length < 50) score -= 1;

                // åŸºäºé€‰é¡¹æ•°é‡ï¼ˆå¦‚æœæœ‰ï¼‰
                if (question.options.length > 4) score += 1;

                if (score <= -1) return 'ç®€å•';
                if (score <= 0) return 'ä¸­ç­‰';
                if (score <= 1) return 'å›°éš¾';
                return 'ä¸“å®¶';
            }

            // æ¨æ–­é¢˜ç›®åˆ†ç±»
            inferCategory(question) {
                const questionText = question.question.toLowerCase();

                if (questionText.includes('å®šä¹‰') || questionText.includes('æ¦‚å¿µ') ||
                    questionText.includes('åŸºæœ¬') || questionText.includes('åŸç†')) {
                    return 'åŸºç¡€æ¦‚å¿µ';
                }

                if (questionText.includes('å…¬å¼') || questionText.includes('æ¨å¯¼') ||
                    questionText.includes('è®¡ç®—') || questionText.includes('æ–¹ç¨‹')) {
                    return 'å…¬å¼æ¨å¯¼';
                }

                if (questionText.includes('åº”ç”¨') || questionText.includes('å®é™…') ||
                    questionText.includes('å·¥ç¨‹') || questionText.includes('å®ä¾‹')) {
                    return 'å®é™…åº”ç”¨';
                }

                if (questionText.includes('åˆ†æ') || questionText.includes('ç»¼åˆ') ||
                    questionText.includes('æ¯”è¾ƒ') || questionText.includes('è¯„ä»·')) {
                    return 'ç»¼åˆåˆ†æ';
                }

                return 'åŸºç¡€æ¦‚å¿µ'; // é»˜è®¤åˆ†ç±»
            }

            // éªŒè¯é¢˜åº“æ•°æ®å®Œæ•´æ€§
            validateExerciseData(exerciseData) {
                const errors = [];
                const warnings = [];

                if (!exerciseData.title || exerciseData.title.trim() === '') {
                    errors.push('é¢˜åº“æ ‡é¢˜ä¸èƒ½ä¸ºç©º');
                }

                if (!exerciseData.questions || !Array.isArray(exerciseData.questions)) {
                    errors.push('é¢˜åº“å¿…é¡»åŒ…å«é¢˜ç›®æ•°ç»„');
                } else if (exerciseData.questions.length === 0) {
                    errors.push('é¢˜åº“ä¸èƒ½ä¸ºç©º');
                } else {
                    exerciseData.questions.forEach((question, index) => {
                        if (!question.question || question.question.trim() === '') {
                            errors.push(`ç¬¬${index + 1}é¢˜çš„é¢˜ç›®å†…å®¹ä¸èƒ½ä¸ºç©º`);
                        }

                        if (!question.answer || question.answer.trim() === '') {
                            warnings.push(`ç¬¬${index + 1}é¢˜ç¼ºå°‘ç­”æ¡ˆ`);
                        }

                        if (question.type === 'multiple-choice' || question.type === 'multiple-select') {
                            if (!question.options || question.options.length < 2) {
                                errors.push(`ç¬¬${index + 1}é¢˜çš„é€‰æ‹©é¢˜å¿…é¡»æœ‰è‡³å°‘2ä¸ªé€‰é¡¹`);
                            }
                        }
                    });
                }

                return { errors, warnings };
            }

            // ç”Ÿæˆé¢˜åº“ç»Ÿè®¡ä¿¡æ¯
            generateStatistics(exerciseData) {
                if (!exerciseData.questions || exerciseData.questions.length === 0) {
                    return null;
                }

                const stats = {
                    totalQuestions: exerciseData.questions.length,
                    types: {},
                    difficulties: {},
                    categories: {},
                    averageLength: 0,
                    hasAnswers: 0,
                    hasExplanations: 0
                };

                let totalLength = 0;

                exerciseData.questions.forEach(question => {
                    // ç»Ÿè®¡é¢˜å‹
                    const type = this.exerciseTypes[question.type] || question.type;
                    stats.types[type] = (stats.types[type] || 0) + 1;

                    // ç»Ÿè®¡éš¾åº¦
                    stats.difficulties[question.difficulty] = (stats.difficulties[question.difficulty] || 0) + 1;

                    // ç»Ÿè®¡åˆ†ç±»
                    stats.categories[question.category] = (stats.categories[question.category] || 0) + 1;

                    // ç»Ÿè®¡é•¿åº¦
                    totalLength += question.question.length;

                    // ç»Ÿè®¡å®Œæ•´æ€§
                    if (question.answer && question.answer.trim() !== '') {
                        stats.hasAnswers++;
                    }

                    if (question.explanation && question.explanation.trim() !== '') {
                        stats.hasExplanations++;
                    }
                });

                stats.averageLength = Math.round(totalLength / exerciseData.questions.length);
                stats.answerCompleteness = Math.round((stats.hasAnswers / stats.totalQuestions) * 100);
                stats.explanationCompleteness = Math.round((stats.hasExplanations / stats.totalQuestions) * 100);

                return stats;
            }
        }

        // åˆ›å»ºå…¨å±€é¢˜åº“ç®¡ç†å™¨å®ä¾‹
        const exerciseManager = new AdvancedExerciseManager();
        
        // æ‰“å¼€ä¸Šä¼ æ¨¡æ€æ¡†
        function openUploadModal(type) {
            currentUploadType = type;
            const modal = document.getElementById('uploadModal');
            const title = document.getElementById('uploadModalTitle');
            const fileGroup = document.getElementById('fileUploadGroup');
            const videoLinkGroup = document.getElementById('videoLinkGroup');
            const videoFileGroup = document.getElementById('videoFileGroup');
            const videoSourceGroup = document.getElementById('videoSourceGroup');
            
            if (type === 'video') {
                title.textContent = 'æ·»åŠ è§†é¢‘';
                fileGroup.style.display = 'none';
                videoSourceGroup.style.display = 'block';
                // é»˜è®¤æ˜¾ç¤ºé“¾æ¥é€‰é¡¹
                toggleVideoSource('link');
            } else {
                title.textContent = 'ä¸Šä¼ é¢˜åº“';
                fileGroup.style.display = 'block';  
                videoLinkGroup.style.display = 'none';
                videoFileGroup.style.display = 'none';
                videoSourceGroup.style.display = 'none';
                
                // æ˜¾ç¤ºé¢˜åº“ä¸Šä¼ é€‰é¡¹
                const exerciseSourceGroup = document.getElementById('exerciseSourceGroup');
                if (exerciseSourceGroup) {
                    exerciseSourceGroup.style.display = 'block';
                    toggleExerciseSource('file'); // é»˜è®¤é€‰æ‹©æœ¬åœ°æ–‡ä»¶
                }
            }
            
            modal.classList.add('active');
            initFileUpload();
            if (type === 'video') {
    
            }
        }
        
        // å…³é—­ä¸Šä¼ æ¨¡æ€æ¡†
        function closeUploadModal() {
            const modal = document.getElementById('uploadModal');
            modal.classList.remove('active');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('uploadTitle').value = '';
            document.getElementById('uploadDescription').value = '';
            document.getElementById('videoLink').value = '';
            document.getElementById('videoFileInput').value = '';
            document.getElementById('douyinLinkInput').value = '';
            document.getElementById('exerciseFileInput').value = '';
            document.getElementById('exerciseJsonInput').value = '';
            document.getElementById('exerciseTextInput').value = '';
            selectedFiles = [];
            selectedVideoFile = null;
            window.selectedVideoFile = null;
            window.selectedExerciseFile = null;
            updateFilePreview();
            hideVideoUploadProgress();
            
            // éšè—æ–‡ä»¶é¢„è§ˆ
            const videoFilePreview = document.getElementById('videoFilePreview');
            if (videoFilePreview) {
                videoFilePreview.style.display = 'none';
            }
            
            const exerciseFilePreview = document.getElementById('exerciseFilePreview');
            if (exerciseFilePreview) {
                exerciseFilePreview.style.display = 'none';
            }
            
            // é‡ç½®è§†é¢‘æ¥æºé€‰æ‹©
            const linkRadio = document.querySelector('input[name="videoSource"][value="link"]');
            if (linkRadio) {
                linkRadio.checked = true;
                toggleVideoSource('link');
            }
            
            // é‡ç½®é¢˜åº“æ¥æºé€‰æ‹©
            const fileRadio = document.querySelector('input[name="exerciseSource"][value="file"]');
            if (fileRadio) {
                fileRadio.checked = true;
                toggleExerciseSource('file');
            }
        }
        
        // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ 
        function initFileUpload() {
            const fileArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ
            fileArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            // æ–‡ä»¶é€‰æ‹©
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ‹–æ‹½ä¸Šä¼ 
            fileArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileArea.classList.add('dragover');
            });
            
            fileArea.addEventListener('dragleave', () => {
                fileArea.classList.remove('dragover');
            });
            
            fileArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }
        
        // å¤„ç†æ–‡ä»¶
        function handleFiles(files) {
            const validFiles = files.filter(file => {
                const validTypes = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png'];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                return validTypes.includes(fileExtension) && file.size <= 50 * 1024 * 1024; // 50MBé™åˆ¶
            });
            
            selectedFiles = selectedFiles.concat(validFiles);
            updateFilePreview();
        }
        
        // æ›´æ–°æ–‡ä»¶é¢„è§ˆ
        function updateFilePreview() {
            const preview = document.getElementById('uploadPreview');
            const fileList = document.getElementById('fileList');
            
            if (selectedFiles.length === 0) {
                preview.classList.remove('active');
                return;
            }
            
            preview.classList.add('active');
            fileList.innerHTML = '';
            
            selectedFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'upload-preview-item';
                item.innerHTML = `
                    <div class="file-info">
                        <i class="fas fa-file"></i>
                        <span>${file.name} (${formatFileSize(file.size)})</span>
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                fileList.appendChild(item);
            });
        }
        
        // ç§»é™¤æ–‡ä»¶
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFilePreview();
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // æäº¤ä¸Šä¼ 
        async function submitUpload() {
            const title = document.getElementById('uploadTitle').value;
            const description = document.getElementById('uploadDescription').value;
            const category = document.getElementById('uploadCategory').value;
            
            if (!title.trim()) {
                showAlert('è¯·è¾“å…¥æ ‡é¢˜');
                return;
            }
            
            if (currentUploadType === 'video') {
                const videoSource = document.querySelector('input[name="videoSource"]:checked').value;
                
                if (videoSource === 'link') {
                    const videoLink = document.getElementById('videoLink').value;
                    if (!videoLink.trim()) {
                        showAlert('è¯·è¾“å…¥è§†é¢‘é“¾æ¥');
                        return;
                    }
                    // åˆ›å»ºåœ¨çº¿è§†é¢‘æ•°æ®å¯¹è±¡
                    const videoData = {
                        id: 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        title: title,
                        description: description,
                        source: videoLink,
                        type: 'link',
                        category: category,
                        uploadTime: new Date().toISOString()
                    };
                    
                    // æ·»åŠ åˆ°è§†é¢‘æ•°æ®
                    videosData.push(videoData);
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    const uploadedVideos = JSON.parse(localStorage.getItem('uploadedVideos') || '[]');
                    uploadedVideos.push(videoData);
                    localStorage.setItem('uploadedVideos', JSON.stringify(uploadedVideos));
                    
                    // ä¿å­˜åˆ°GitHub
                    saveVideosToGitHub();
                    
                    // æ·»åŠ åˆ°é¡µé¢æ˜¾ç¤º
                    recreateVideoCardFromData(videoData);
                    
                    // å…³é—­ä¸Šä¼ æ¨¡æ€æ¡†
                    closeUploadModal();
                    
                    showMessage('è§†é¢‘ä¸Šä¼ æˆåŠŸï¼', 'success');
                } else if (videoSource === 'douyin') {
                    const douyinLink = document.getElementById('douyinLinkInput').value;
                    if (!douyinLink.trim()) {
                        showAlert('è¯·è¾“å…¥æŠ–éŸ³è§†é¢‘é“¾æ¥');
                        return;
                    }
                    // åˆ›å»ºæŠ–éŸ³è§†é¢‘æ•°æ®å¯¹è±¡
                    const videoData = {
                        id: 'douyin_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        title: title,
                        description: description,
                        source: douyinLink,
                        type: 'douyin',
                        category: category,
                        platform: 'æŠ–éŸ³',
                        uploadTime: new Date().toISOString()
                    };
                    
                    // æ·»åŠ åˆ°è§†é¢‘æ•°æ®
                    videosData.push(videoData);
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    const uploadedVideos = JSON.parse(localStorage.getItem('uploadedVideos') || '[]');
                    uploadedVideos.push(videoData);
                    localStorage.setItem('uploadedVideos', JSON.stringify(uploadedVideos));
                    
                    // ä¿å­˜åˆ°GitHub
                    saveVideosToGitHub();
                    
                    // æ·»åŠ åˆ°é¡µé¢æ˜¾ç¤º
                    recreateVideoCardFromData(videoData);
                    
                    // å…³é—­ä¸Šä¼ æ¨¡æ€æ¡†
                    closeUploadModal();
                    
                    showMessage('æŠ–éŸ³è§†é¢‘ä¸Šä¼ æˆåŠŸï¼', 'success');
                } else if (videoSource === 'file') {
                    // æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åˆ°GitHub
                    if (!window.selectedVideoFile) {
                        showAlert('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶');
                        return;
                    }
                    
                    const file = window.selectedVideoFile;
                    
                    // æ£€æŸ¥GitHubè¿æ¥
                    if (!hasValidGitHubConfig()) {
                        if (currentUser && accounts[currentUser] && accounts[currentUser].role === 'teacher') {
                            showAlert('è¯·å…ˆé…ç½®GitHub Tokenä»¥ä¸Šä¼ æ–‡ä»¶');
                        } else {
                            showAlert('æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·è”ç³»æ•™å¸ˆ');
                        }
                        return;
                    }
                    
                    try {
                        // ç”Ÿæˆå”¯ä¸€çš„æ–‡ä»¶å
                        const timestamp = Date.now();
                        const randomId = Math.random().toString(36).substr(2, 9);
                        const fileExtension = file.name.split('.').pop();
                        const uniqueFileName = `video_${timestamp}_${randomId}.${fileExtension}`;
                        const githubPath = `videos/${uniqueFileName}`;
                        
                        // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
                        showMessage('æ­£åœ¨ä¸Šä¼ è§†é¢‘åˆ°GitHubåç«¯...', 'info');
                        
                        // ä¸Šä¼ æ–‡ä»¶åˆ°GitHub
                        const uploadResult = await githubStorage.uploadBinaryFile(
                            file, 
                            githubPath, 
                            `ä¸Šä¼ è§†é¢‘æ–‡ä»¶: ${title}`
                        );
                        
                        if (uploadResult && uploadResult.success) {
                            // åˆ›å»ºè§†é¢‘æ•°æ®å¯¹è±¡ï¼Œä½¿ç”¨GitHubçš„ä¸‹è½½URL
                            const videoData = {
                                id: 'file_' + timestamp + '_' + randomId,
                                title: title,
                                description: description,
                                source: uploadResult.downloadUrl, // ä½¿ç”¨GitHubçš„ä¸‹è½½URL
                                type: 'file',
                                category: category,
                                platform: 'GitHubå­˜å‚¨',
                                fileName: file.name,
                                fileSize: file.size,
                                fileType: file.type,
                                githubPath: githubPath,
                                githubSha: uploadResult.sha,
                                uploadTime: new Date().toISOString()
                            };
                            
                            // æ·»åŠ åˆ°è§†é¢‘æ•°æ®
                            videosData.push(videoData);
                            
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                            const uploadedVideos = JSON.parse(localStorage.getItem('uploadedVideos') || '[]');
                            uploadedVideos.push(videoData);
                            localStorage.setItem('uploadedVideos', JSON.stringify(uploadedVideos));
                            
                            // ä¿å­˜è§†é¢‘å…ƒæ•°æ®åˆ°GitHub
                            await saveVideosToGitHub();
                            
                            // æ·»åŠ åˆ°é¡µé¢æ˜¾ç¤º
                            recreateVideoCardFromData(videoData);
                            
                            // å…³é—­ä¸Šä¼ æ¨¡æ€æ¡†
                            closeUploadModal();
                            
                            showMessage(`è§†é¢‘ä¸Šä¼ æˆåŠŸï¼å·²ä¿å­˜åˆ°GitHub: ${uniqueFileName}`, 'success');
                            
                        } else {
                            showAlert('è§†é¢‘ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒGitHubé…ç½®');
                        }
                        
                    } catch (error) {
                        console.error('ä¸Šä¼ è§†é¢‘æ—¶å‡ºé”™:', error);
                        showAlert('ä¸Šä¼ è§†é¢‘æ—¶å‡ºç°é”™è¯¯: ' + error.message);
                    }
                }
            } else {
                // é¢˜åº“ä¸Šä¼ å¤„ç†
                const exerciseSource = document.querySelector('input[name="exerciseSource"]:checked')?.value || 'file';
                
                try {
                    let exerciseData = null;
                    
                    if (exerciseSource === 'file') {
                        // æœ¬åœ°æ–‡ä»¶ä¸Šä¼ 
                        if (!window.selectedExerciseFile) {
                            showAlert('è¯·é€‰æ‹©é¢˜åº“æ–‡ä»¶');
                            return;
                        }
                        
                        const file = window.selectedExerciseFile;
                        exerciseData = await processExerciseFile(file, title, description, category);
                        
                    } else if (exerciseSource === 'json') {
                        // JSONæ ¼å¼é¢˜åº“
                        const jsonInput = document.getElementById('exerciseJsonInput').value.trim();
                        if (!jsonInput) {
                            showAlert('è¯·è¾“å…¥JSONæ ¼å¼çš„é¢˜åº“æ•°æ®');
                            return;
                        }
                        
                        exerciseData = await processExerciseJson(jsonInput, title, description, category);
                        
                    } else if (exerciseSource === 'text') {
                        // æ–‡æœ¬æ ¼å¼é¢˜åº“
                        const textInput = document.getElementById('exerciseTextInput').value.trim();
                        if (!textInput) {
                            showAlert('è¯·è¾“å…¥æ–‡æœ¬æ ¼å¼çš„é¢˜åº“æ•°æ®');
                            return;
                        }
                        
                        exerciseData = await processExerciseText(textInput, title, description, category);
                    }
                    
                    if (exerciseData) {
                        // æ·»åŠ åˆ°é¢˜åº“æ•°æ®
                        exercisesData.push(exerciseData);
                        
                        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                        const uploadedExercises = JSON.parse(localStorage.getItem('uploadedExercises') || '[]');
                        uploadedExercises.push(exerciseData);
                        localStorage.setItem('uploadedExercises', JSON.stringify(uploadedExercises));
                        
                        // ä¿å­˜åˆ°GitHub
                        await saveExercisesToGitHub();
                        
                        // æ·»åŠ åˆ°é¡µé¢æ˜¾ç¤º
                        recreateExerciseCardFromData(exerciseData);
                        
                        // å…³é—­ä¸Šä¼ æ¨¡æ€æ¡†
                        closeUploadModal();
                        
                        showMessage(`é¢˜åº“ä¸Šä¼ æˆåŠŸï¼åŒ…å« ${exerciseData.questionCount || 0} é“é¢˜ç›®`, 'success');
                    }
                    
                } catch (error) {
                    console.error('ä¸Šä¼ é¢˜åº“æ—¶å‡ºé”™:', error);
                    showAlert('ä¸Šä¼ é¢˜åº“æ—¶å‡ºç°é”™è¯¯: ' + error.message);
                }
            }
            
        }
        
        // å¤„ç†é¢˜åº“æ–‡ä»¶
        async function processExerciseFile(file, title, description, category) {
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        let questions = [];
                        const content = e.target.result;
                        
                        if (fileExtension === '.json') {
                            // JSONæ ¼å¼
                            const jsonData = JSON.parse(content);
                            questions = Array.isArray(jsonData) ? jsonData : [jsonData];
                        } else if (fileExtension === '.txt' || fileExtension === '.csv') {
                            // æ–‡æœ¬æ ¼å¼ï¼Œæ¯è¡Œä¸€é¢˜
                            const lines = content.split('\n').filter(line => line.trim());
                            questions = lines.map((line, index) => {
                                const parts = line.split('|');
                                if (parts.length >= 6) {
                                    return {
                                        id: index + 1,
                                        question: parts[0].trim(),
                                        options: parts.slice(1, -2).map(opt => opt.trim()),
                                        answer: parts[parts.length - 2].trim(),
                                        explanation: parts[parts.length - 1].trim()
                                    };
                                }
                                return null;
                            }).filter(q => q !== null);
                        }
                        
                        const exerciseData = {
                            id: 'exercise_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            title: title,
                            description: description,
                            category: category,
                            questionCount: questions.length,
                            questions: questions,
                            sourceFile: file.name,
                            sourceType: 'file',
                            uploadTime: new Date().toISOString()
                        };
                        
                        resolve(exerciseData);
                    } catch (error) {
                        reject(new Error('æ–‡ä»¶è§£æå¤±è´¥: ' + error.message));
                    }
                };
                reader.onerror = () => reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
                reader.readAsText(file, 'UTF-8');
            });
        }
        
        // å¤„ç†JSONæ ¼å¼é¢˜åº“
        async function processExerciseJson(jsonInput, title, description, category) {
            try {
                const jsonData = JSON.parse(jsonInput);
                const questions = Array.isArray(jsonData) ? jsonData : [jsonData];
                
                const exerciseData = {
                    id: 'exercise_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    title: title,
                    description: description,
                    category: category,
                    questionCount: questions.length,
                    questions: questions,
                    sourceType: 'json',
                    uploadTime: new Date().toISOString()
                };
                
                return exerciseData;
            } catch (error) {
                throw new Error('JSONæ ¼å¼è§£æå¤±è´¥: ' + error.message);
            }
        }
        
        // å¤„ç†æ–‡æœ¬æ ¼å¼é¢˜åº“
        async function processExerciseText(textInput, title, description, category) {
            try {
                const lines = textInput.split('\n').filter(line => line.trim());
                const questions = lines.map((line, index) => {
                    const parts = line.split('|');
                    if (parts.length >= 6) {
                        return {
                            id: index + 1,
                            question: parts[0].trim(),
                            options: parts.slice(1, -2).map(opt => opt.trim()),
                            answer: parts[parts.length - 2].trim(),
                            explanation: parts[parts.length - 1].trim()
                        };
                    }
                    return null;
                }).filter(q => q !== null);
                
                if (questions.length === 0) {
                    throw new Error('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„é¢˜ç›®ï¼Œè¯·æ£€æŸ¥æ ¼å¼');
                }
                
                const exerciseData = {
                    id: 'exercise_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    title: title,
                    description: description,
                    category: category,
                    questionCount: questions.length,
                    questions: questions,
                    sourceType: 'text',
                    uploadTime: new Date().toISOString()
                };
                
                return exerciseData;
            } catch (error) {
                throw new Error('æ–‡æœ¬æ ¼å¼è§£æå¤±è´¥: ' + error.message);
            }
        }
        
        // å­˜å‚¨ä¸Šä¼ çš„è§†é¢‘æ•°æ® - æŒä¹…åŒ–å­˜å‚¨
        let uploadedVideos = [];
        
        // ä»localStorageåŠ è½½å·²ä¸Šä¼ çš„é¢˜åº“
        function loadUploadedExercises() {
            try {
                const saved = localStorage.getItem('uploadedExercises');
                if (saved) {
                    const exercises = JSON.parse(saved);
                    console.log('åŠ è½½å·²ä¿å­˜çš„é¢˜åº“:', exercises.length + 'ä¸ª');
                    
                    // å°†æœ¬åœ°é¢˜åº“æ·»åŠ åˆ°exercisesDataä¸­ä»¥ä¾¿æ˜¾ç¤º
                    exercises.forEach(exercise => {
                        if (!exercisesData.find(e => e.id === exercise.id)) {
                            exercisesData.push(exercise);
                        }
                    });
                    
                    // é‡å»ºé¢˜åº“åˆ—è¡¨æ˜¾ç¤º
                    setTimeout(() => rebuildExerciseList(), 300);
                }
            } catch (error) {
                console.error('åŠ è½½é¢˜åº“å¤±è´¥:', error);
            }
        }
        
        // ä»localStorageåŠ è½½å·²ä¸Šä¼ çš„è§†é¢‘
        function loadUploadedVideos() {
            try {
                const saved = localStorage.getItem('uploadedVideos');
                if (saved) {
                    const videos = JSON.parse(saved);
                    // è¿‡æ»¤æ‰å¯èƒ½æœ‰é—®é¢˜çš„è§†é¢‘ï¼ˆå¦‚æ ‡é¢˜ä¸º"1"æˆ–ç©ºæ ‡é¢˜çš„è§†é¢‘ï¼‰
                    uploadedVideos = videos.filter(video => 
                        video.title && 
                        video.title.trim() !== '' && 
                        video.title.trim() !== '1' &&
                        video.title.length > 1
                    );
                    console.log('åŠ è½½å·²ä¿å­˜çš„è§†é¢‘:', uploadedVideos.length + 'ä¸ª');
                    
                    // å°†æœ¬åœ°è§†é¢‘æ·»åŠ åˆ°videosDataä¸­ä»¥ä¾¿æ˜¾ç¤º
                    uploadedVideos.forEach(video => {
                        if (!videosData.find(v => v.id === video.id)) {
                            videosData.push(video);
                        }
                    });
                    
                    // é‡å»ºè§†é¢‘åˆ—è¡¨æ˜¾ç¤º
                    setTimeout(() => rebuildVideoList(), 300);
                    
                    // é‡æ–°åˆ›å»ºè§†é¢‘å¡ç‰‡
                    uploadedVideos.forEach(video => {
                        recreateVideoCard(video);
                    });
                    
                    // å¦‚æœè¿‡æ»¤åçš„è§†é¢‘åˆ—è¡¨ä¸åŸåˆ—è¡¨ä¸åŒï¼Œæ›´æ–°localStorage
                    if (uploadedVideos.length !== videos.length) {
                        saveUploadedVideos();
                        console.log('å·²æ¸…ç†', videos.length - uploadedVideos.length, 'ä¸ªæ— æ•ˆè§†é¢‘');
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è§†é¢‘æ•°æ®å¤±è´¥:', error);
                uploadedVideos = [];
                // å¦‚æœæ•°æ®æŸåï¼Œæ¸…é™¤localStorage
                localStorage.removeItem('uploadedVideos');
            }
        }
        
        // ä¿å­˜è§†é¢‘æ•°æ®åˆ°localStorage
        function saveUploadedVideos() {
            try {
                // åˆ›å»ºä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ï¼Œä¸åŒ…å«blob URLï¼ˆå› ä¸ºblob URLæ— æ³•åºåˆ—åŒ–ï¼‰
                const videosToSave = uploadedVideos.map(video => ({
                    id: video.id,
                    title: video.title,
                    description: video.description,
                    type: video.type,
                    category: video.category,
                    fileName: video.fileName,
                    fileSize: video.fileSize,
                    fileType: video.fileType,
                    uploadTime: video.uploadTime
                }));
                
                localStorage.setItem('uploadedVideos', JSON.stringify(videosToSave));
                console.log('è§†é¢‘æ•°æ®å·²ä¿å­˜');
            } catch (error) {
                console.error('ä¿å­˜è§†é¢‘æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ·»åŠ è§†é¢‘åˆ°åˆ—è¡¨
        function addVideoToList(title, description, linkOrFile, category, type = 'link') {
            const videoGrid = document.querySelector('.video-grid');
            if (!videoGrid) {
                console.error('Video grid not found');
                return;
            }
            
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            
            const sourceIcon = type === 'file' ? 'fas fa-file-video' : 'fas fa-link';
            const sourceText = type === 'file' ? 'æœ¬åœ°æ–‡ä»¶' : 'åœ¨çº¿é“¾æ¥';
            
            // ç”Ÿæˆå”¯ä¸€ID
            const videoId = 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // è®¾ç½®è§†é¢‘å¡ç‰‡ID
            videoCard.setAttribute('data-video-id', videoId);
            
            // å­˜å‚¨è§†é¢‘æ•°æ®
            const videoData = {
                id: videoId,
                title: title,
                description: description,
                source: linkOrFile,
                type: type,
                category: category,
                uploadTime: new Date().toISOString()
            };
            
            // å¦‚æœæ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œå­˜å‚¨æ–‡ä»¶ä¿¡æ¯
            if (type === 'file' && selectedVideoFile) {
                videoData.fileName = selectedVideoFile.name;
                videoData.fileSize = selectedVideoFile.size;
                videoData.fileType = selectedVideoFile.type;
                // é‡æ–°åˆ›å»ºblob URLï¼ˆå› ä¸ºåŸæ¥çš„å¯èƒ½å·²å¤±æ•ˆï¼‰
                videoData.source = URL.createObjectURL(selectedVideoFile);
            }
            
            uploadedVideos.push(videoData);
            
            // ä¿å­˜åˆ°localStorage
            saveUploadedVideos();
            
            // åˆ›å»ºæ’­æ”¾æŒ‰é’®å®¹å™¨
            const playButtonDiv = document.createElement('div');
            playButtonDiv.className = 'play-button';
            playButtonDiv.onclick = function() {
                playCustomVideoById(videoId);
            };
            playButtonDiv.innerHTML = '<i class="fas fa-play"></i>';
            
            // åˆ›å»ºè§†é¢‘é¢„è§ˆå®¹å™¨
            const videoPreviewDiv = document.createElement('div');
            videoPreviewDiv.className = 'video-preview';
            videoPreviewDiv.innerHTML = '<i class="fas fa-video"></i>';
            videoPreviewDiv.appendChild(playButtonDiv);
            
            // åˆ›å»ºè§†é¢‘ä¿¡æ¯å®¹å™¨
            const videoInfoDiv = document.createElement('div');
            videoInfoDiv.className = 'video-info';
            videoInfoDiv.innerHTML = `
                <h3 class="video-title">${escapeHtml(title)}</h3>
                <p class="video-description">${escapeHtml(description)}</p>
                <div class="video-duration">
                    <div><i class="far fa-clock"></i> æ–°ä¸Šä¼ </div>
                    <div><i class="${sourceIcon}"></i> ${sourceText}</div>
                </div>
            `;
            
            // ç»„è£…è§†é¢‘å¡ç‰‡
            videoCard.appendChild(videoPreviewDiv);
            videoCard.appendChild(videoInfoDiv);
            
            // æ’å…¥åˆ°ç‰¹è‰²è§†é¢‘åé¢
            const featuredVideo = videoGrid.querySelector('.video-card.featured');
            if (featuredVideo) {
                featuredVideo.parentNode.insertBefore(videoCard, featuredVideo.nextSibling);
            } else {
                videoGrid.appendChild(videoCard);
            }
            
            console.log('Video added to list:', { id: videoId, title, type, source: linkOrFile });
            
            // é‡æ–°åˆå§‹åŒ–åª’ä½“ä¿æŠ¤
            if (currentUser && currentUser.role === 'student') {
                setTimeout(() => {
                    initMediaProtection();
                }, 100);
            }
        }
        
        // åˆå§‹åŒ–åª’ä½“ä¿æŠ¤
        function initMediaProtection() {
            if (!currentUser || currentUser.role !== 'student') return;
            
            // å¯¹äºè§†é¢‘å…ƒç´ ï¼Œåªç¦ç”¨å³é”®èœå•ï¼Œä¿ç•™æ’­æ”¾æ§ä»¶
            const videoElements = document.querySelectorAll('video');
            videoElements.forEach(element => {
                // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
                element.removeEventListener('contextmenu', handleVideoContextMenu);
                // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                element.addEventListener('contextmenu', handleVideoContextMenu);
            });
            
            // ç¦ç”¨å›¾ç‰‡å’Œiframeçš„äº¤äº’
            const mediaElements = document.querySelectorAll('img, iframe');
            mediaElements.forEach(element => {
                element.style.pointerEvents = 'none';
                element.removeEventListener('contextmenu', handleMediaContextMenu);
                element.addEventListener('contextmenu', handleMediaContextMenu);
            });
        }
        
        // è§†é¢‘å³é”®èœå•å¤„ç†
        function handleVideoContextMenu(e) {
            e.preventDefault();
            showSecurityAlert('è§†é¢‘å†…å®¹å—ç‰ˆæƒä¿æŠ¤ï¼');
            return false;
        }
        
        // åª’ä½“å³é”®èœå•å¤„ç†
        function handleMediaContextMenu(e) {
            e.preventDefault();
            showSecurityAlert('åª’ä½“å†…å®¹å—ç‰ˆæƒä¿æŠ¤ï¼');
            return false;
        }
        
        // HTMLè½¬ä¹‰å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // é‡æ–°åˆ›å»ºè§†é¢‘å¡ç‰‡ï¼ˆç”¨äºé¡µé¢åˆ·æ–°åæ¢å¤ï¼‰
        function recreateVideoCard(videoData) {
            const videoGrid = document.querySelector('.video-grid');
            if (!videoGrid) return;
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨è¿™ä¸ªè§†é¢‘å¡ç‰‡
            const existingCard = document.querySelector(`[data-video-id="${videoData.id}"]`);
            if (existingCard) return;
            
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            videoCard.setAttribute('data-video-id', videoData.id);
            
            const sourceIcon = videoData.type === 'file' ? 'fas fa-file-video' : 'fas fa-link';
            const sourceText = videoData.type === 'file' ? 'æœ¬åœ°æ–‡ä»¶' : 'åœ¨çº¿é“¾æ¥';
            
            // åˆ›å»ºæ’­æ”¾æŒ‰é’®å®¹å™¨
            const playButtonDiv = document.createElement('div');
            playButtonDiv.className = 'play-button';
            playButtonDiv.onclick = function() {
                playCustomVideoById(videoData.id);
            };
            playButtonDiv.innerHTML = '<i class="fas fa-play"></i>';
            
            // åˆ›å»ºè§†é¢‘é¢„è§ˆå®¹å™¨
            const videoPreviewDiv = document.createElement('div');
            videoPreviewDiv.className = 'video-preview';
            videoPreviewDiv.innerHTML = '<i class="fas fa-video"></i>';
            videoPreviewDiv.appendChild(playButtonDiv);
            
            // åˆ›å»ºè§†é¢‘ä¿¡æ¯å®¹å™¨
            const videoInfoDiv = document.createElement('div');
            videoInfoDiv.className = 'video-info';
            
            // æ ¼å¼åŒ–ä¸Šä¼ æ—¶é—´
            const uploadTime = videoData.uploadTime ? 
                new Date(videoData.uploadTime).toLocaleDateString() : 'æ–°ä¸Šä¼ ';
            
            // æ£€æŸ¥æœ¬åœ°æ–‡ä»¶æ˜¯å¦éœ€è¦é‡æ–°é€‰æ‹©
            const needsReupload = videoData.type === 'file' && 
                (!videoData.source || !videoData.source.startsWith('blob:'));
            
            const statusText = needsReupload ? 
                '<div style="color: #f39c12;"><i class="fas fa-exclamation-triangle"></i> éœ€è¦é‡æ–°é€‰æ‹©æ–‡ä»¶</div>' : 
                `<div><i class="${sourceIcon}"></i> ${sourceText}</div>`;
            
            videoInfoDiv.innerHTML = `
                <h3 class="video-title">${escapeHtml(videoData.title)}</h3>
                <p class="video-description">${escapeHtml(videoData.description)}</p>
                <div class="video-duration">
                    <div><i class="far fa-clock"></i> ${uploadTime}</div>
                    ${statusText}
                </div>
            `;
            
            // ç»„è£…è§†é¢‘å¡ç‰‡
            videoCard.appendChild(videoPreviewDiv);
            videoCard.appendChild(videoInfoDiv);
            
            // æ’å…¥åˆ°ç‰¹è‰²è§†é¢‘åé¢
            const featuredVideo = videoGrid.querySelector('.video-card.featured');
            if (featuredVideo) {
                featuredVideo.parentNode.insertBefore(videoCard, featuredVideo.nextSibling);
            } else {
                videoGrid.appendChild(videoCard);
            }
            
            console.log('é‡æ–°åˆ›å»ºè§†é¢‘å¡ç‰‡:', videoData.title);
        }
        
        // é€šè¿‡IDæ’­æ”¾è‡ªå®šä¹‰è§†é¢‘
        function playCustomVideoById(videoId) {
            const videoData = uploadedVideos.find(v => v.id === videoId);
            if (videoData) {
                console.log('Playing video:', videoData);
                
                // å¦‚æœæ˜¯æœ¬åœ°æ–‡ä»¶ä¸”æ²¡æœ‰æœ‰æ•ˆçš„sourceï¼Œæç¤ºé‡æ–°ä¸Šä¼ 
                if (videoData.type === 'file' && (!videoData.source || !videoData.source.startsWith('blob:'))) {
                    showReuploadDialog(videoData);
                    return;
                }
                
                playCustomVideo(videoData.source, videoData.title, videoData.type);
            } else {
                console.error('Video not found:', videoId);
                showSecurityAlert('è§†é¢‘æ•°æ®æœªæ‰¾åˆ°');
            }
        }
        
        // æ·»åŠ é¢˜ç›®åˆ°åˆ—è¡¨
        function addQuestionToList(title, description, files, category) {
            const exerciseGrid = document.querySelector('.exercise-grid');
            const exerciseCard = document.createElement('div');
            exerciseCard.className = 'exercise-card';
            exerciseCard.innerHTML = `
                <div class="exercise-title">${title}</div>
                <div class="exercise-meta">
                    <span><i class="far fa-file-alt"></i> ${files.length}ä¸ªæ–‡ä»¶</span>
                    <span><i class="far fa-clock"></i> æ–°ä¸Šä¼ </span>
                </div>
                <button class="start-btn">å¼€å§‹ç»ƒä¹ </button>
            `;
            
            exerciseGrid.appendChild(exerciseCard);
        }
        
        // ç‚¹å‡»å¯¼èˆªé“¾æ¥æ—¶å…³é—­ç§»åŠ¨ç«¯èœå•
        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    document.getElementById('mainNav').classList.remove('active');
                }
            });
        });
        
        // çª—å£å¤§å°æ”¹å˜æ—¶å¤„ç†å“åº”å¼
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                document.getElementById('mainNav').classList.remove('active');
            }
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.addEventListener('click', (e) => {
            const uploadModal = document.getElementById('uploadModal');
            const videoModal = document.getElementById('videoModal');
            
            if (e.target === uploadModal) {
                closeUploadModal();
            }
            if (e.target === videoModal) {
                closeVideoModal();
            }
        });
        
        // é”®ç›˜äº‹ä»¶å¤„ç†
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeUploadModal();
                closeVideoModal();
            }
        });
        
        // è§¦æ‘¸è®¾å¤‡ä¼˜åŒ–
        if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');
        }
        
        // æ˜¾ç¤ºç¾åŒ–çš„æç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'success') {
            // ç§»é™¤ç°æœ‰çš„æ¶ˆæ¯
            const existingMessage = document.querySelector('.message-toast');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // å›¾æ ‡æ˜ å°„
            const iconMap = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            // åˆ›å»ºæ–°çš„æ¶ˆæ¯å…ƒç´ 
            const messageElement = document.createElement('div');
            messageElement.className = `message-toast ${type}`;
            messageElement.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas ${iconMap[type] || 'fa-info-circle'}"></i>
                    <span style="flex: 1;">${message}</span>
                    ${type === 'info' ? '<div class="loading-spinner"></div>' : ''}
                </div>
            `;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(messageElement);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                messageElement.classList.add('show');
            }, 100);
            
            // è‡ªåŠ¨éšè—ï¼ˆinfoç±»å‹æ˜¾ç¤ºæ›´ä¹…ï¼‰
            const hideDelay = type === 'info' ? 5000 : 3000;
            setTimeout(() => {
                messageElement.classList.remove('show');
                setTimeout(() => {
                    if (messageElement.parentNode) {
                        messageElement.parentNode.removeChild(messageElement);
                    }
                }, 300);
            }, hideDelay);
        }
        
        // åˆ‡æ¢è§†é¢‘æ¥æº
        function toggleVideoSource(source) {
            const videoLinkGroup = document.getElementById('videoLinkGroup');
            const videoFileGroup = document.getElementById('videoFileGroup');
            const douyinLinkGroup = document.getElementById('douyinLinkGroup');
            
            // éšè—æ‰€æœ‰ç»„
            videoLinkGroup.style.display = 'none';
            videoFileGroup.style.display = 'none';
            douyinLinkGroup.style.display = 'none';
            
            // æ˜¾ç¤ºé€‰ä¸­çš„ç»„
            if (source === 'link') {
                videoLinkGroup.style.display = 'block';
            } else if (source === 'file') {
                videoFileGroup.style.display = 'block';
            } else if (source === 'douyin') {
                douyinLinkGroup.style.display = 'block';
            }
        }
        
        // å¤„ç†æœ¬åœ°è§†é¢‘æ–‡ä»¶é€‰æ‹©
        function handleVideoFileSelect(input) {
            const file = input.files[0];
            if (!file) {
                document.getElementById('videoFilePreview').style.display = 'none';
                return;
            }
            
            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('video/')) {
                showMessage('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼', 'error');
                input.value = '';
                return;
            }
            
            // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆ500MBé™åˆ¶ï¼‰
            const maxSize = 500 * 1024 * 1024; // 500MB
            if (file.size > maxSize) {
                showMessage('è§†é¢‘æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº500MBçš„æ–‡ä»¶ï¼', 'error');
                input.value = '';
                return;
            }
            
            // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆä¿¡æ¯
            const preview = document.getElementById('videoFilePreview');
            const fileName = document.getElementById('videoFileName');
            const fileInfo = document.getElementById('videoFileInfo');
            
            fileName.textContent = file.name;
            fileInfo.textContent = `æ–‡ä»¶å¤§å°: ${formatFileSize(file.size)} | ç±»å‹: ${file.type}`;
            preview.style.display = 'block';
            
            // å­˜å‚¨é€‰ä¸­çš„æ–‡ä»¶
            window.selectedVideoFile = file;
            
            showMessage('è§†é¢‘æ–‡ä»¶é€‰æ‹©æˆåŠŸï¼', 'success');
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // åˆ‡æ¢é¢˜åº“æ¥æº
        function toggleExerciseSource(source) {
            const exerciseFileGroup = document.getElementById('exerciseFileGroup');
            const exerciseJsonGroup = document.getElementById('exerciseJsonGroup');
            const exerciseTextGroup = document.getElementById('exerciseTextGroup');
            
            // éšè—æ‰€æœ‰ç»„
            exerciseFileGroup.style.display = 'none';
            exerciseJsonGroup.style.display = 'none';
            exerciseTextGroup.style.display = 'none';
            
            // æ˜¾ç¤ºé€‰ä¸­çš„ç»„
            if (source === 'file') {
                exerciseFileGroup.style.display = 'block';
            } else if (source === 'json') {
                exerciseJsonGroup.style.display = 'block';
            } else if (source === 'text') {
                exerciseTextGroup.style.display = 'block';
            }
        }
        
        // å¤„ç†é¢˜åº“æ–‡ä»¶é€‰æ‹©
        function handleExerciseFileSelect(input) {
            const file = input.files[0];
            if (!file) {
                document.getElementById('exerciseFilePreview').style.display = 'none';
                return;
            }
            
            // éªŒè¯æ–‡ä»¶ç±»å‹
            const allowedTypes = ['.json', '.txt', '.csv', '.xlsx', '.xls'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            if (!allowedTypes.includes(fileExtension)) {
                showMessage('è¯·é€‰æ‹©æ”¯æŒçš„é¢˜åº“æ–‡ä»¶æ ¼å¼ï¼', 'error');
                input.value = '';
                return;
            }
            
            // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆ10MBé™åˆ¶ï¼‰
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                showMessage('é¢˜åº“æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº10MBçš„æ–‡ä»¶ï¼', 'error');
                input.value = '';
                return;
            }
            
            // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆä¿¡æ¯
            const preview = document.getElementById('exerciseFilePreview');
            const fileName = document.getElementById('exerciseFileName');
            const fileInfo = document.getElementById('exerciseFileInfo');
            
            fileName.textContent = file.name;
            fileInfo.textContent = `æ–‡ä»¶å¤§å°: ${formatFileSize(file.size)} | ç±»å‹: ${file.type || fileExtension}`;
            preview.style.display = 'block';
            
            // å­˜å‚¨é€‰ä¸­çš„æ–‡ä»¶
            window.selectedExerciseFile = file;
            
            showMessage('é¢˜åº“æ–‡ä»¶é€‰æ‹©æˆåŠŸï¼', 'success');
        }

        // ç®€åŒ–çš„è§†é¢‘é…ç½®
        const VIDEO_CONFIG = {
            supportedPlatforms: ['æŠ–éŸ³', 'Bç«™', 'YouTube', 'å…¶ä»–']
        };

        // ç®€åŒ–çš„è§†é¢‘å·¥å…·ç±»
        class SimpleVideoHelper {
            // æ ¼å¼åŒ–æ—¶é—´
            formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                
                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
            
            // æ£€æµ‹è§†é¢‘å¹³å°
            detectPlatform(url) {
                if (url.includes('douyin.com') || url.includes('v.douyin.com')) {
                    return 'æŠ–éŸ³';
                } else if (url.includes('bilibili.com')) {
                    return 'Bç«™';
                } else if (url.includes('youtube.com') || url.includes('youtu.be')) {
                    return 'YouTube';
                }
                return 'å…¶ä»–';
            }
        }

        // åˆ›å»ºè§†é¢‘åŠ©æ‰‹å®ä¾‹
        const videoHelper = new SimpleVideoHelper();




        
        // éšè—è§†é¢‘ä¸Šä¼ è¿›åº¦
        function hideVideoUploadProgress() {
            const progressContainer = document.getElementById('videoUploadProgress');
            const progressFill = document.getElementById('videoProgressFill');
            const progressText = document.getElementById('videoProgressText');
            
            progressContainer.style.display = 'none';
            progressFill.style.width = '0%';
            progressText.textContent = '0%';
        }
        
        // ==================== é«˜çº§è§†é¢‘æ’­æ”¾å™¨ç³»ç»Ÿ ====================
        
        // å…¨å±€è§†é¢‘æ’­æ”¾å™¨çŠ¶æ€
        let currentVideoPlayer = null;
        let videoPlayerState = {
            isPlaying: false,
            currentTime: 0,
            duration: 0,
            volume: 1,
            playbackRate: 1,
            isFullscreen: false,
            quality: 'auto'
        };

        // æ™ºèƒ½è§†é¢‘æ’­æ”¾å™¨ - æ ¹æ®è§†é¢‘ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ’­æ”¾æ–¹å¼
        async function playCustomVideo(source, title, type, metadata = {}) {
            try {
                showAdvancedLoading('æ­£åœ¨åŠ è½½è§†é¢‘æ’­æ”¾å™¨...');
                
                const modal = document.getElementById('videoModal');
                if (!modal) {
                    console.error('Video modal not found');
                    showAdvancedToast('è§†é¢‘æ’­æ”¾å™¨åˆå§‹åŒ–å¤±è´¥', 'error');
                    return;
                }
                
                // æ¸…ç†ä¹‹å‰çš„æ’­æ”¾å™¨
                if (currentVideoPlayer) {
                    try {
                        currentVideoPlayer.dispose();
                    } catch (e) {
                        console.warn('Error disposing previous player:', e);
                    }
                    currentVideoPlayer = null;
                }
                
                // åˆ›å»ºæ–°çš„æ’­æ”¾å™¨å®¹å™¨
                const playerContainer = document.createElement('div');
                playerContainer.className = 'advanced-video-player';
                playerContainer.innerHTML = `
                    <div class="video-loading">
                        <div class="video-loading-spinner"></div>
                        <div>æ­£åœ¨åŠ è½½è§†é¢‘...</div>
                    </div>
                    <div class="video-info-overlay">
                        <div class="video-title">${title}</div>
                        <div class="video-description">${metadata.description || 'é«˜è´¨é‡è§†é¢‘å†…å®¹'}</div>
                    </div>
                    <button class="video-close-btn" onclick="closeVideoModal()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                modal.innerHTML = '';
                modal.appendChild(playerContainer);
                modal.classList.add('active');
                
                // æ˜¾ç¤ºä¿¡æ¯è¦†ç›–å±‚
                setTimeout(() => {
                    const infoOverlay = playerContainer.querySelector('.video-info-overlay');
                    if (infoOverlay) {
                        infoOverlay.classList.add('show');
                        setTimeout(() => infoOverlay.classList.remove('show'), 3000);
                    }
                }, 500);
                
                console.log('ğŸ¬ Playing video:', { source, title, type, metadata });
                
                // æ ¹æ®ç±»å‹åˆ›å»ºæ’­æ”¾å™¨
                if (type === 'file' || isDirectVideoUrl(source)) {
                    await createAdvancedVideoPlayer(playerContainer, source, title, metadata);
                } else if (source.includes('bilibili.com') || source.includes('b23.tv')) {
                    await createBilibiliPlayer(playerContainer, source, title, metadata);
                } else if (source.includes('youtube.com') || source.includes('youtu.be')) {
                    await createYouTubePlayer(playerContainer, source, title, metadata);
                } else if (source.includes('douyin.com') || source.includes('v.douyin.com')) {
                    await createDouyinPlayer(playerContainer, source, title, metadata);
                } else {
                    await createGenericPlayer(playerContainer, source, title, metadata);
                }
                
                hideAdvancedLoading();
                
                // åº”ç”¨åª’ä½“ä¿æŠ¤
                setTimeout(() => {
                    initAdvancedMediaProtection();
                }, 100);
                
                // è®°å½•æ’­æ”¾ç»Ÿè®¡
                recordVideoPlay(source, title, type);
                
            } catch (error) {
                console.error('Error playing video:', error);
                hideAdvancedLoading();
                showAdvancedToast('è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }
        
        // åˆ›å»ºé«˜çº§è§†é¢‘æ’­æ”¾å™¨ï¼ˆæ”¯æŒå€é€Ÿã€å…¨å±ã€ç”»è´¨é€‰æ‹©ç­‰ï¼‰
        async function createAdvancedVideoPlayer(container, source, title, metadata = {}) {
            try {
                // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨
                const loadingDiv = container.querySelector('.video-loading');
                if (loadingDiv) loadingDiv.remove();
                
                // åˆ›å»ºVideo.jsæ’­æ”¾å™¨
                const videoElement = document.createElement('video-js');
                videoElement.className = 'vjs-default-skin';
                videoElement.setAttribute('controls', '');
                videoElement.setAttribute('preload', 'metadata');
                videoElement.setAttribute('data-setup', '{}');
                videoElement.style.width = '100%';
                videoElement.style.height = '100%';
                
                // æ·»åŠ è§†é¢‘æº
                const sourceElement = document.createElement('source');
                sourceElement.src = source;
                sourceElement.type = getVideoMimeType(source);
                videoElement.appendChild(sourceElement);
                
                container.appendChild(videoElement);
                
                // åˆå§‹åŒ–Video.jsæ’­æ”¾å™¨
                currentVideoPlayer = videojs(videoElement, {
                    fluid: true,
                    responsive: true,
                    playbackRates: [0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.5, 3, 4],
                    controls: true,
                    preload: 'metadata',
                    html5: {
                        vhs: {
                            overrideNative: true
                        }
                    },
                    techOrder: ['html5'],
                    sources: [{
                        src: source,
                        type: getVideoMimeType(source)
                    }]
                });
                
                // æ·»åŠ è‡ªå®šä¹‰æ§åˆ¶æŒ‰é’®
                addCustomVideoControls(container, currentVideoPlayer);
                
                // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
                setupVideoPlayerEvents(currentVideoPlayer, title);
                
                // åº”ç”¨å­¦ç”Ÿä¿æŠ¤ï¼ˆå¦‚æœæ˜¯å­¦ç”Ÿç”¨æˆ·ï¼‰
                if (currentUser && accounts[currentUser] && accounts[currentUser].role === 'student') {
                    applyStudentVideoProtection(currentVideoPlayer);
                }
                
                console.log('âœ… Advanced video player created successfully');
                
            } catch (error) {
                console.error('Error creating advanced video player:', error);
                showVideoError(container, 'è§†é¢‘æ’­æ”¾å™¨åˆ›å»ºå¤±è´¥');
            }
        }
        
        // è·å–è§†é¢‘MIMEç±»å‹
        function getVideoMimeType(url) {
            const extension = url.split('.').pop().toLowerCase();
            const mimeTypes = {
                'mp4': 'video/mp4',
                'webm': 'video/webm',
                'ogg': 'video/ogg',
                'avi': 'video/x-msvideo',
                'mov': 'video/quicktime',
                'wmv': 'video/x-ms-wmv',
                'flv': 'video/x-flv',
                'm4v': 'video/x-m4v'
            };
            return mimeTypes[extension] || 'video/mp4';
        }
        
        // æ·»åŠ è‡ªå®šä¹‰è§†é¢‘æ§åˆ¶æŒ‰é’®
        function addCustomVideoControls(container, player) {
            const controlsOverlay = document.createElement('div');
            controlsOverlay.className = 'video-controls-overlay';
            controlsOverlay.innerHTML = `
                <button class="video-control-btn" id="speedControlBtn" title="æ’­æ”¾é€Ÿåº¦">
                    <i class="fas fa-tachometer-alt"></i>
                </button>
                <button class="video-control-btn" id="qualityControlBtn" title="è§†é¢‘ç”»è´¨">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="video-control-btn" id="pipControlBtn" title="ç”»ä¸­ç”»">
                    <i class="fas fa-external-link-alt"></i>
                </button>
            `;
            
            // é€Ÿåº¦æ§åˆ¶é¢æ¿
            const speedControl = document.createElement('div');
            speedControl.className = 'video-speed-control';
            speedControl.innerHTML = `
                <div class="speed-option" data-speed="0.5">0.5x</div>
                <div class="speed-option" data-speed="0.75">0.75x</div>
                <div class="speed-option active" data-speed="1">1x</div>
                <div class="speed-option" data-speed="1.25">1.25x</div>
                <div class="speed-option" data-speed="1.5">1.5x</div>
                <div class="speed-option" data-speed="2">2x</div>
                <div class="speed-option" data-speed="3">3x</div>
                <div class="speed-option" data-speed="4">4x</div>
            `;
            
            // ç”»è´¨æ§åˆ¶é¢æ¿
            const qualityControl = document.createElement('div');
            qualityControl.className = 'video-quality-control';
            qualityControl.innerHTML = `
                <div class="quality-option active" data-quality="auto">è‡ªåŠ¨</div>
                <div class="quality-option" data-quality="1080p">1080p</div>
                <div class="quality-option" data-quality="720p">720p</div>
                <div class="quality-option" data-quality="480p">480p</div>
                <div class="quality-option" data-quality="360p">360p</div>
            `;
            
            container.appendChild(controlsOverlay);
            container.appendChild(speedControl);
            container.appendChild(qualityControl);
            
            // ç»‘å®šäº‹ä»¶
            setupCustomControlEvents(container, player);
        }
        
        // è®¾ç½®è‡ªå®šä¹‰æ§åˆ¶äº‹ä»¶
        function setupCustomControlEvents(container, player) {
            // é€Ÿåº¦æ§åˆ¶
            const speedBtn = container.querySelector('#speedControlBtn');
            const speedControl = container.querySelector('.video-speed-control');
            const speedOptions = container.querySelectorAll('.speed-option');
            
            speedBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                speedControl.classList.toggle('active');
                container.querySelector('.video-quality-control').classList.remove('active');
            });
            
            speedOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const speed = parseFloat(option.dataset.speed);
                    player.playbackRate(speed);
                    videoPlayerState.playbackRate = speed;
                    
                    speedOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    speedControl.classList.remove('active');
                    
                    showAdvancedToast(`æ’­æ”¾é€Ÿåº¦è®¾ç½®ä¸º ${speed}x`, 'success');
                });
            });
            
            // ç”»è´¨æ§åˆ¶
            const qualityBtn = container.querySelector('#qualityControlBtn');
            const qualityControl = container.querySelector('.video-quality-control');
            const qualityOptions = container.querySelectorAll('.quality-option');
            
            qualityBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                qualityControl.classList.toggle('active');
                speedControl.classList.remove('active');
            });
            
            qualityOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const quality = option.dataset.quality;
                    videoPlayerState.quality = quality;
                    
                    qualityOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    qualityControl.classList.remove('active');
                    
                    showAdvancedToast(`ç”»è´¨è®¾ç½®ä¸º ${quality}`, 'success');
                });
            });
            
            // ç”»ä¸­ç”»æ§åˆ¶
            const pipBtn = container.querySelector('#pipControlBtn');
            if (document.pictureInPictureEnabled) {
                pipBtn.addEventListener('click', async () => {
                    try {
                        const video = player.el().querySelector('video');
                        if (document.pictureInPictureElement) {
                            await document.exitPictureInPicture();
                        } else {
                            await video.requestPictureInPicture();
                        }
                    } catch (error) {
                        console.error('Picture-in-picture error:', error);
                        showAdvancedToast('ç”»ä¸­ç”»åŠŸèƒ½ä¸å¯ç”¨', 'warning');
                    }
                });
            } else {
                pipBtn.style.display = 'none';
            }
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­æ§åˆ¶é¢æ¿
            document.addEventListener('click', () => {
                speedControl.classList.remove('active');
                qualityControl.classList.remove('active');
            });
        }
        
        // è®¾ç½®è§†é¢‘æ’­æ”¾å™¨äº‹ä»¶
        function setupVideoPlayerEvents(player, title) {
            player.ready(() => {
                console.log('ğŸ“¹ Video player is ready');
                
                // æ›´æ–°æ’­æ”¾å™¨çŠ¶æ€
                videoPlayerState.duration = player.duration();
                
                // é”®ç›˜å¿«æ·é”®
                player.on('keydown', (e) => {
                    handleVideoKeyboard(e, player);
                });
                
                // æ’­æ”¾çŠ¶æ€å˜åŒ–
                player.on('play', () => {
                    videoPlayerState.isPlaying = true;
                    console.log('â–¶ï¸ Video started playing');
                });
                
                player.on('pause', () => {
                    videoPlayerState.isPlaying = false;
                    console.log('â¸ï¸ Video paused');
                });
                
                // æ—¶é—´æ›´æ–°
                player.on('timeupdate', () => {
                    videoPlayerState.currentTime = player.currentTime();
                });
                
                // éŸ³é‡å˜åŒ–
                player.on('volumechange', () => {
                    videoPlayerState.volume = player.volume();
                });
                
                // å…¨å±å˜åŒ–
                player.on('fullscreenchange', () => {
                    videoPlayerState.isFullscreen = player.isFullscreen();
                });
                
                // é”™è¯¯å¤„ç†
                player.on('error', (error) => {
                    console.error('Video player error:', error);
                    showAdvancedToast('è§†é¢‘æ’­æ”¾å‡ºé”™', 'error');
                });
                
                // åŠ è½½å®Œæˆ
                player.on('loadeddata', () => {
                    console.log('ğŸ“Š Video data loaded');
                    showAdvancedToast(`è§†é¢‘ã€Š${title}ã€‹åŠ è½½å®Œæˆ`, 'success');
                });
            });
        }
        
        // å¤„ç†è§†é¢‘é”®ç›˜å¿«æ·é”®
        function handleVideoKeyboard(event, player) {
            const key = event.which || event.keyCode;
            
            switch (key) {
                case 32: // ç©ºæ ¼ - æ’­æ”¾/æš‚åœ
                    event.preventDefault();
                    if (player.paused()) {
                        player.play();
                    } else {
                        player.pause();
                    }
                    break;
                    
                case 37: // å·¦ç®­å¤´ - åé€€10ç§’
                    event.preventDefault();
                    player.currentTime(Math.max(0, player.currentTime() - 10));
                    break;
                    
                case 39: // å³ç®­å¤´ - å‰è¿›10ç§’
                    event.preventDefault();
                    player.currentTime(Math.min(player.duration(), player.currentTime() + 10));
                    break;
                    
                case 38: // ä¸Šç®­å¤´ - å¢åŠ éŸ³é‡
                    event.preventDefault();
                    player.volume(Math.min(1, player.volume() + 0.1));
                    break;
                    
                case 40: // ä¸‹ç®­å¤´ - å‡å°‘éŸ³é‡
                    event.preventDefault();
                    player.volume(Math.max(0, player.volume() - 0.1));
                    break;
                    
                case 70: // F - å…¨å±
                    event.preventDefault();
                    if (player.isFullscreen()) {
                        player.exitFullscreen();
                    } else {
                        player.requestFullscreen();
                    }
                    break;
                    
                case 77: // M - é™éŸ³
                    event.preventDefault();
                    player.muted(!player.muted());
                    break;
            }
        }
        
        // åˆ›å»ºBç«™æ’­æ”¾å™¨
        function createBilibiliPlayer(container, source, title) {
            const bvid = extractBilibiliId(source);
            container.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%;">
                    <iframe id="bilibiliPlayer" 
                            src="https://player.bilibili.com/player.html?bvid=${bvid}&page=1&autoplay=0&high_quality=1&danmaku=0&t=0&as_wide=1&hasMuteButton=1&allowfullscreen=true&quality=120&vd_source=&p2p=0" 
                            scrolling="no" border="0" frameborder="no" framespacing="0" 
                            allow="fullscreen; autoplay"
                            style="width: 100%; height: 100%; border-radius: 8px;">
                    </iframe>
                    
                    <!-- Bç«™æ’­æ”¾å™¨æç¤º -->
                    <div style="
                        position: absolute;
                        top: 15px;
                        right: 15px;
                        background: rgba(0,188,212,0.9);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    ">
                        <i class="fab fa-bilibili"></i>
                        <span>Bç«™è§†é¢‘ - æ”¯æŒå…¨å±å’Œå€é€Ÿæ’­æ”¾</span>
                    </div>
                </div>
            `;
        }
        
        // åˆ›å»ºYouTubeæ’­æ”¾å™¨
        function createYouTubePlayer(container, source, title) {
            const videoId = extractYouTubeId(source);
            container.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%;">
                    <iframe id="youtubePlayer"
                            src="https://www.youtube.com/embed/${videoId}?enablejsapi=1&controls=1&modestbranding=1" 
                            frameborder="0" 
                            allowfullscreen 
                            style="width: 100%; height: 100%; border-radius: 8px;">
                    </iframe>
                    
                    <!-- YouTubeæ’­æ”¾å™¨æç¤º -->
                    <div style="
                        position: absolute;
                        top: 15px;
                        right: 15px;
                        background: rgba(255,0,0,0.9);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    ">
                        <i class="fab fa-youtube"></i>
                        <span>YouTubeè§†é¢‘ - å€é€Ÿå’Œå…¨å±è¯·åœ¨æ’­æ”¾å™¨å†…æ“ä½œ</span>
                    </div>
                </div>
            `;
        }
        
        // åˆ›å»ºé€šç”¨æ’­æ”¾å™¨
        function createGenericPlayer(container, source, title) {
            container.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%;">
                    <iframe src="${source}" 
                            frameborder="0" 
                            allowfullscreen 
                            style="width: 100%; height: 100%; border-radius: 8px;">
                    </iframe>
                    
                    <!-- é€šç”¨æ’­æ”¾å™¨æç¤º -->
                    <div style="
                        position: absolute;
                        top: 15px;
                        right: 15px;
                        background: rgba(108,117,125,0.9);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    ">
                        <i class="fas fa-play-circle"></i>
                        <span>å¤–éƒ¨è§†é¢‘ - åŠŸèƒ½ç”±æºç«™æä¾›</span>
                    </div>
                </div>
            `;
        }
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºç›´æ¥è§†é¢‘æ–‡ä»¶URL
        function isDirectVideoUrl(url) {
            const videoExtensions = ['.mp4', '.webm', '.ogg', '.avi', '.mov', '.wmv', '.flv', '.m4v'];
            const urlLower = url.toLowerCase();
            return videoExtensions.some(ext => urlLower.includes(ext)) || 
                   urlLower.includes('video') || 
                   urlLower.includes('.m3u8'); // HLSæµ
        }
        
        // æå–Bç«™è§†é¢‘ID
        function extractBilibiliId(url) {
            const match = url.match(/(?:bilibili\.com\/video\/|b23\.tv\/)([A-Za-z0-9]+)/);
            return match ? match[1] : '';
        }
        
        // æå–YouTubeè§†é¢‘ID
        function extractYouTubeId(url) {
            const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_-]+)/);
            return match ? match[1] : '';
        }
        
        // æ˜¾ç¤ºé‡æ–°ä¸Šä¼ å¯¹è¯æ¡†
        function showReuploadDialog(videoData) {
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10001;
            `;
            
            dialog.innerHTML = `
                <div style="
                    background: white;
                    padding: 30px;
                    border-radius: 12px;
                    max-width: 500px;
                    text-align: center;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                ">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">
                        <i class="fas fa-video"></i> è§†é¢‘æ–‡ä»¶éœ€è¦é‡æ–°é€‰æ‹©
                    </h3>
                    <p style="margin-bottom: 20px; color: var(--text);">
                        è§†é¢‘"${escapeHtml(videoData.title)}"éœ€è¦é‡æ–°é€‰æ‹©æ–‡ä»¶æ‰èƒ½æ’­æ”¾
                        <br><small>åŸæ–‡ä»¶ï¼š${videoData.fileName || 'æœªçŸ¥'}</small>
                    </p>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="selectVideoFile('${videoData.id}')" style="
                            background: var(--primary);
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                        ">
                            <i class="fas fa-upload"></i> é‡æ–°é€‰æ‹©æ–‡ä»¶
                        </button>
                        <button onclick="closeReuploadDialog()" style="
                            background: #ccc;
                            color: #666;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                        ">
                            å–æ¶ˆ
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialog);
            window.currentReuploadDialog = dialog;
        }
        
        // å…³é—­é‡æ–°ä¸Šä¼ å¯¹è¯æ¡†
        function closeReuploadDialog() {
            if (window.currentReuploadDialog) {
                document.body.removeChild(window.currentReuploadDialog);
                window.currentReuploadDialog = null;
            }
        }
        
        // é€‰æ‹©è§†é¢‘æ–‡ä»¶é‡æ–°ä¸Šä¼ 
        function selectVideoFile(videoId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'video/mp4,video/mov,video/avi,video/webm';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // æ›´æ–°è§†é¢‘æ•°æ®
                    const videoIndex = uploadedVideos.findIndex(v => v.id === videoId);
                    if (videoIndex !== -1) {
                        const newBlobUrl = URL.createObjectURL(file);
                        uploadedVideos[videoIndex].source = newBlobUrl;
                        uploadedVideos[videoIndex].fileName = file.name;
                        uploadedVideos[videoIndex].fileSize = file.size;
                        uploadedVideos[videoIndex].fileType = file.type;
                        
                        // ä¿å­˜æ›´æ–°
                        saveUploadedVideos();
                        
                        // æ’­æ”¾è§†é¢‘
                        playCustomVideo(newBlobUrl, uploadedVideos[videoIndex].title, 'file');
                        
                        showMessage('æ–‡ä»¶å·²æ›´æ–°ï¼Œæ­£åœ¨æ’­æ”¾...');
                    }
                }
                closeReuploadDialog();
            };
            
            input.click();
        }
        
        // åˆå§‹åŒ–é«˜çº§è§†é¢‘æ’­æ”¾å™¨
        function initAdvancedVideoPlayer() {
            const video = document.getElementById('customVideoPlayer');
            const playbackRateSelect = document.getElementById('playbackRate');
            const qualitySelect = document.getElementById('videoQuality');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const customControls = document.getElementById('customControls');
            const playbackHint = document.getElementById('playbackHint');
            
            if (!video) {
                console.error('Video element not found');
                return;
            }
            
            // å­¦ç”Ÿç«¯ç‰¹æ®Šä¿æŠ¤ - å…è®¸å…¨å±ä½†ç¦ç”¨ä¸‹è½½
            if (currentUser && currentUser.role === 'student') {
                // ç¦ç”¨å³é”®èœå•ä½†ä¿ç•™æ’­æ”¾æ§ä»¶
                video.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    showSecurityAlert('è§†é¢‘å†…å®¹å—ç‰ˆæƒä¿æŠ¤ï¼');
                    return false;
                });
                
                // åªç¦ç”¨ä¸‹è½½å’Œç”»ä¸­ç”»ï¼Œå…è®¸å…¨å±
                video.controlsList = "nodownload noremoteplayback";
                
                // ç›‘æ§å½•å±å°è¯•
                video.addEventListener('enterpictureinpicture', function(e) {
                    e.preventDefault();
                    showSecurityAlert('ç¦æ­¢ç”»ä¸­ç”»æ¨¡å¼ï¼');
                    return false;
                });
            } else {
                // æ•™å¸ˆç«¯å¯ä»¥ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½
                video.controlsList = "";
            }
            
            // å€é€Ÿæ§åˆ¶ - å¢å¼ºç‰ˆ
            if (playbackRateSelect) {
                playbackRateSelect.addEventListener('change', function() {
                    const rate = parseFloat(this.value);
                    video.playbackRate = rate;
                    console.log('æ’­æ”¾é€Ÿåº¦è®¾ç½®ä¸º:', rate + 'x');
                    
                    // æ˜¾ç¤ºå€é€Ÿå˜åŒ–æç¤º
                    showSpeedChangeNotification(rate);
                });
                
                // ç¡®ä¿åˆå§‹å€é€Ÿä¸º1x
                video.playbackRate = 1.0;
                playbackRateSelect.value = '1';
            }
            
            // å…¨å±æŒ‰é’®æ§åˆ¶
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        video.requestFullscreen().then(() => {
                            fullscreenBtn.textContent = 'é€€å‡º';
                            fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> é€€å‡º';
                        }).catch(err => {
                            console.log('å…¨å±å¤±è´¥:', err);
                            showMessage('å…¨å±åŠŸèƒ½ä¸å¯ç”¨', 'warning');
                        });
                    } else {
                        document.exitFullscreen().then(() => {
                            fullscreenBtn.textContent = 'å…¨å±';
                            fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> å…¨å±';
                        });
                    }
                });
            }
            
            // æ¸…æ™°åº¦æ§åˆ¶ï¼ˆæ¨¡æ‹Ÿï¼‰
            qualitySelect.addEventListener('change', function() {
                console.log('æ¸…æ™°åº¦è®¾ç½®ä¸º:', this.value);
                // è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦åˆ‡æ¢ä¸åŒæ¸…æ™°åº¦çš„è§†é¢‘æº
            });
            
            // è§†é¢‘åŠ è½½äº‹ä»¶
            video.addEventListener('loadstart', function() {
                console.log('è§†é¢‘å¼€å§‹åŠ è½½');
                // æ˜¾ç¤ºæ’­æ”¾æç¤º
                if (playbackHint) {
                    playbackHint.style.display = 'block';
                    setTimeout(() => {
                        playbackHint.style.display = 'none';
                    }, 3000);
                }
            });
            
            video.addEventListener('loadeddata', function() {
                console.log('è§†é¢‘æ•°æ®åŠ è½½å®Œæˆ');
                // æ˜¾ç¤ºè‡ªå®šä¹‰æ§åˆ¶æ 
                if (customControls) {
                    customControls.style.display = 'flex';
                }
            });
            
            video.addEventListener('error', function(e) {
                console.error('è§†é¢‘åŠ è½½é”™è¯¯:', e);
                showSecurityAlert('è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
            });
            
            // æ’­æ”¾çŠ¶æ€ç›‘æ§
            video.addEventListener('play', function() {
                console.log('è§†é¢‘å¼€å§‹æ’­æ”¾');
                // å­¦ç”Ÿç«¯æ’­æ”¾æ—¶çš„ç‰¹æ®Šå¤„ç†
                if (currentUser && currentUser.role === 'student') {
                    // è®°å½•å­¦ä¹ è¿›åº¦
                    recordStudyProgress('video', video.src);
                }
            });
            
            video.addEventListener('pause', function() {
                console.log('è§†é¢‘æš‚åœ');
            });
            
            // æ§åˆ¶æ è‡ªåŠ¨éšè—
            let controlsTimeout;
            const showControls = () => {
                customControls.style.opacity = '1';
                clearTimeout(controlsTimeout);
                controlsTimeout = setTimeout(() => {
                    if (!video.paused) {
                        customControls.style.opacity = '0.7';
                    }
                }, 3000);
            };
            
            video.addEventListener('mousemove', showControls);
            video.addEventListener('click', showControls);
            
            // åˆå§‹æ˜¾ç¤ºæ§åˆ¶æ 
            showControls();
            
            // æ·»åŠ å…¨å±åŠŸèƒ½å¢å¼º
            addFullscreenEnhancements(video);
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
            addKeyboardShortcuts(video, playbackRateSelect);
        }
        
        // æ˜¾ç¤ºå€é€Ÿå˜åŒ–æç¤º
        function showSpeedChangeNotification(rate) {
            // ç§»é™¤ç°æœ‰æç¤º
            const existingNotification = document.querySelector('.speed-notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // åˆ›å»ºæ–°æç¤º
            const notification = document.createElement('div');
            notification.className = 'speed-notification';
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                z-index: 10000;
                pointer-events: none;
                animation: speedNotificationFade 1.5s ease-out forwards;
            `;
            notification.textContent = `${rate}x`;
            
            // æ·»åŠ CSSåŠ¨ç”»
            if (!document.querySelector('#speedNotificationStyle')) {
                const style = document.createElement('style');
                style.id = 'speedNotificationStyle';
                style.textContent = `
                    @keyframes speedNotificationFade {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                        20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                        80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(notification);
            
            // è‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 1500);
        }
        
        // æ·»åŠ å…¨å±åŠŸèƒ½å¢å¼º
        function addFullscreenEnhancements(video) {
            // åŒå‡»å…¨å±
            video.addEventListener('dblclick', function() {
                if (!document.fullscreenElement) {
                    video.requestFullscreen().catch(err => {
                        console.log('å…¨å±å¤±è´¥:', err);
                        showMessage('å…¨å±åŠŸèƒ½ä¸å¯ç”¨', 'warning');
                    });
                } else {
                    document.exitFullscreen();
                }
            });
            
            // å…¨å±çŠ¶æ€å˜åŒ–ç›‘å¬
            document.addEventListener('fullscreenchange', function() {
                const customControls = document.getElementById('customControls');
                const fullscreenBtn = document.getElementById('fullscreenBtn');
                
                if (document.fullscreenElement) {
                    // å…¨å±æ¨¡å¼
                    if (customControls) {
                        customControls.style.bottom = '30px';
                        customControls.style.right = '30px';
                        customControls.style.background = 'rgba(0,0,0,0.95)';
                        customControls.style.fontSize = '14px';
                    }
                    if (fullscreenBtn) {
                        fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> é€€å‡º';
                    }
                } else {
                    // é€€å‡ºå…¨å±
                    if (customControls) {
                        customControls.style.bottom = '15px';
                        customControls.style.right = '15px';
                        customControls.style.background = 'rgba(0,0,0,0.9)';
                        customControls.style.fontSize = '13px';
                    }
                    if (fullscreenBtn) {
                        fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> å…¨å±';
                    }
                }
            });
        }
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        function addKeyboardShortcuts(video, playbackRateSelect) {
            video.addEventListener('keydown', function(e) {
                // é˜²æ­¢åœ¨å­¦ç”Ÿç«¯ä½¿ç”¨æŸäº›å¿«æ·é”®
                if (currentUser && currentUser.role === 'student') {
                    // å­¦ç”Ÿç«¯åªå…è®¸åŸºæœ¬çš„æ’­æ”¾æ§åˆ¶
                    switch(e.key) {
                        case ' ': // ç©ºæ ¼é”®æš‚åœ/æ’­æ”¾
                            e.preventDefault();
                            if (video.paused) {
                                video.play();
                            } else {
                                video.pause();
                            }
                            break;
                        case 'f':
                        case 'F': // Fé”®å…¨å±
                            e.preventDefault();
                            if (!document.fullscreenElement) {
                                video.requestFullscreen();
                            } else {
                                document.exitFullscreen();
                            }
                            break;
                    }
                } else {
                    // æ•™å¸ˆç«¯å®Œæ•´å¿«æ·é”®æ”¯æŒ
                    switch(e.key) {
                        case ' ': // ç©ºæ ¼é”®æš‚åœ/æ’­æ”¾
                            e.preventDefault();
                            if (video.paused) {
                                video.play();
                            } else {
                                video.pause();
                            }
                            break;
                        case 'f':
                        case 'F': // Fé”®å…¨å±
                            e.preventDefault();
                            if (!document.fullscreenElement) {
                                video.requestFullscreen();
                            } else {
                                document.exitFullscreen();
                            }
                            break;
                        case 'ArrowLeft': // å·¦ç®­å¤´åé€€10ç§’
                            e.preventDefault();
                            video.currentTime = Math.max(0, video.currentTime - 10);
                            break;
                        case 'ArrowRight': // å³ç®­å¤´å‰è¿›10ç§’
                            e.preventDefault();
                            video.currentTime = Math.min(video.duration, video.currentTime + 10);
                            break;
                        case 'ArrowUp': // ä¸Šç®­å¤´æé«˜éŸ³é‡
                            e.preventDefault();
                            video.volume = Math.min(1, video.volume + 0.1);
                            break;
                        case 'ArrowDown': // ä¸‹ç®­å¤´é™ä½éŸ³é‡
                            e.preventDefault();
                            video.volume = Math.max(0, video.volume - 0.1);
                            break;
                    }
                }
            });
            
            // ç¡®ä¿è§†é¢‘å…ƒç´ å¯ä»¥æ¥æ”¶é”®ç›˜äº‹ä»¶
            video.setAttribute('tabindex', '0');
        }
        
        // è®°å½•å­¦ä¹ è¿›åº¦
        function recordStudyProgress(type, content) {
            if (!currentUser || currentUser.role !== 'student') return;
            
            const username = Object.keys(accounts).find(key => accounts[key] === currentUser);
            if (username && accounts[username]) {
                if (type === 'video') {
                    if (!accounts[username].watchedVideos) {
                        accounts[username].watchedVideos = [];
                    }
                    if (!accounts[username].watchedVideos.includes(content)) {
                        accounts[username].watchedVideos.push(content);
                        accounts[username].videoProgress = accounts[username].watchedVideos.length;
                        
                        // ä¿å­˜åˆ°GitHub
                        saveUsersToGitHub();
                        console.log('è§†é¢‘å­¦ä¹ è¿›åº¦å·²è®°å½•');
                    }
                } else if (type === 'exercise') {
                    if (!accounts[username].startedExercises) {
                        accounts[username].startedExercises = [];
                    }
                    if (!accounts[username].startedExercises.includes(content)) {
                        accounts[username].startedExercises.push(content);
                        
                        // ä¿å­˜åˆ°GitHub
                        saveUsersToGitHub();
                        console.log('é¢˜ç›®å­¦ä¹ è¿›åº¦å·²è®°å½•');
                    }
                }
            }
        }
        
        // ä¿®æ”¹å¯†ç ç›¸å…³å‡½æ•°
        function showChangePasswordModal() {
            const modal = document.getElementById('changePasswordModal');
            modal.classList.add('active');
            
            // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
            const form = document.getElementById('changePasswordForm');
            if (form && !form.hasAttribute('data-bound')) {
                form.setAttribute('data-bound', 'true');
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    changePassword();
                });
            }
        }
        
        function closeChangePasswordModal() {
            const modal = document.getElementById('changePasswordModal');
            modal.classList.remove('active');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('changeUsername').value = '';
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
        
        async function changePassword() {
            const username = document.getElementById('changeUsername').value.trim();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // éªŒè¯è¾“å…¥
            if (!username || !currentPassword || !newPassword || !confirmPassword) {
                showAlert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            if (newPassword.length < 6) {
                showAlert('æ–°å¯†ç é•¿åº¦è‡³å°‘6ä½');
                return;
            }
            
            // éªŒè¯ç”¨æˆ·åå’Œå½“å‰å¯†ç 
            if (!accounts[username] || accounts[username].password !== currentPassword) {
                showAlert('ç”¨æˆ·åæˆ–å½“å‰å¯†ç é”™è¯¯');
                return;
            }
            
            // ä¿®æ”¹å¯†ç 
            accounts[username].password = newPassword;
            
            // ä¿å­˜åˆ°GitHub
            const success = await saveUsersToGitHub();
            if (success) {
                showMessage('å¯†ç ä¿®æ”¹æˆåŠŸï¼', 'success');
                closeChangePasswordModal();
            } else {
                showAlert('å¯†ç ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
        
        // å¼€å§‹ç»ƒä¹ é¢˜ç›®
        function startExercise(exerciseId) {
            const exercise = exercisesData.find(e => e.id === exerciseId);
            if (!exercise) {
                showAlert('é¢˜ç›®ä¸å­˜åœ¨');
                return;
            }
            
            // è®°å½•å­¦ä¹ è¿›åº¦
            if (currentUser && currentUser.role === 'student') {
                recordStudyProgress('exercise', exerciseId);
            }
            
            // æ˜¾ç¤ºé¢˜ç›®è¯¦æƒ…æ¨¡æ€æ¡†
            showExerciseModal(exercise);
        }
        
        // æ˜¾ç¤ºé¢˜ç›®è¯¦æƒ…æ¨¡æ€æ¡†
        function showExerciseModal(exercise) {
            const modal = document.createElement('div');
            modal.className = 'modal-backdrop active';
            modal.id = 'exerciseModal';
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3><i class="fas fa-question-circle"></i> ${escapeHtml(exercise.title)}</h3>
                        <button class="close-modal" onclick="closeExerciseModal()">&times;</button>
                    </div>
                    <div style="padding: 20px;">
                        <div class="exercise-description" style="margin-bottom: 20px; font-size: 16px; line-height: 1.6;">
                            ${escapeHtml(exercise.description)}
                        </div>
                        
                        <div class="exercise-files" style="margin-bottom: 20px;">
                            <h4>ç›¸å…³æ–‡ä»¶ï¼š</h4>
                            ${exercise.files.map(file => `
                                <div style="padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 6px;">
                                    <i class="fas fa-file"></i> ${file.name} (${(file.size / 1024).toFixed(1)}KB)
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="exercise-actions" style="text-align: center;">
                            <button class="upload-btn-primary" onclick="completeExercise('${exercise.id}')">
                                <i class="fas fa-check"></i> æ ‡è®°ä¸ºå·²å®Œæˆ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // å…³é—­é¢˜ç›®æ¨¡æ€æ¡†ï¼ˆç»Ÿä¸€ç‰ˆæœ¬ï¼‰
        function closeExerciseModal() {
            try {
                console.log('æ­£åœ¨å…³é—­ç»ƒä¹ æ¨¡æ€æ¡†...');
                
                // æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„æ¨¡æ€æ¡†
                const modals = [
                    document.getElementById('exerciseModal'),
                    document.querySelector('.exercise-modal'),
                    document.querySelector('.exercise-result-modal')
                ];
                
                let closed = false;
                modals.forEach(modal => {
                    if (modal) {
                        console.log('æ‰¾åˆ°æ¨¡æ€æ¡†ï¼Œæ­£åœ¨å…³é—­...');
                        modal.style.display = 'none';
                        setTimeout(() => {
                            if (modal.parentNode) {
                                modal.parentNode.removeChild(modal);
                            }
                        }, 100);
                        closed = true;
                    }
                });
                
                if (closed) {
                    console.log('âœ… ç»ƒä¹ æ¨¡æ€æ¡†å·²å…³é—­');
                    showMessage('å·²é€€å‡ºç»ƒä¹ ', 'info');
                } else {
                    console.log('âš ï¸ æœªæ‰¾åˆ°è¦å…³é—­çš„æ¨¡æ€æ¡†');
                }
                
                // æ¸…ç†å…¨å±€çŠ¶æ€
                if (window.currentExercise) {
                    window.currentExercise = null;
                }
                
            } catch (error) {
                console.error('âŒ å…³é—­æ¨¡æ€æ¡†æ—¶å‡ºé”™:', error);
            }
        }
        
        // å®Œæˆç»ƒä¹ 
        function completeExercise(exerciseId) {
            if (currentUser && currentUser.role === 'student') {
                const username = Object.keys(accounts).find(key => accounts[key] === currentUser);
                if (username && accounts[username]) {
                    if (!accounts[username].completedExercises) {
                        accounts[username].completedExercises = [];
                    }
                    if (!accounts[username].completedExercises.includes(exerciseId)) {
                        accounts[username].completedExercises.push(exerciseId);
                        accounts[username].questionProgress = accounts[username].completedExercises.length;
                        
                        // ä¿å­˜åˆ°GitHub
                        saveUsersToGitHub();
                        showMessage('ç»ƒä¹ å·²å®Œæˆï¼', 'success');
                    }
                }
            }
            closeExerciseModal();
        }
        
        // æ˜¾ç¤ºç™»å½•é”™è¯¯
        function showLoginError(message) {
            const loginError = document.getElementById('loginError');
            if (loginError) {
                loginError.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
                loginError.style.display = 'block';
            }
            showMessage(message, 'error');
        }
        
        // æ›¿æ¢alertä¸ºæ›´å¥½çš„æç¤º
        function showAlert(message, type = 'error') {
            showMessage(message, type);
        }
    </script>
</body>
</html>
