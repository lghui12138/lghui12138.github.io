<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, notranslate">
    <title>流体力学学习平台 - 中国海洋大学</title>
    
    <!-- 反爬虫和安全防护 -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="referrer" content="no-referrer">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary: #1a3a57;
            --secondary: #2a6aa7;
            --accent: #3498db;
            --teacher: #27ae60;
            --student: #f39c12;
            --light: #ecf0f1;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --dark: #1a1a2e;
            --text: #34495e;
            --featured: linear-gradient(90deg, #ff9966, #ff5e62);
            --reexam-color: #3498db;   /* 复试线颜色 */
            --national-color: #e74c3c; /* 国家线颜色 */
            --ocean-blue: #1e6fa8;
            --wave-color: #2c9ab7;
        }
        
        body {
            background-color: #f5f9ff;
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            background: linear-gradient(135deg, #f5f9ff 0%, #e6f0ff 100%);
            min-height: 100vh;
            
            /* 防截屏和防选择 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            
            /* 防止拖拽 */
            -webkit-user-drag: none;
            -moz-user-drag: none;
            user-drag: none;
            
            /* 防打印 */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* 防截屏和反爬虫保护 */
        * {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-user-drag: none !important;
            -moz-user-drag: none !important;
            user-drag: none !important;
        }
        
        /* 防止右键菜单 */
        body, html {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* 防止图片和视频被保存 */
        img, video, iframe {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-user-drag: none !important;
            -moz-user-drag: none !important;
            user-drag: none !important;
            pointer-events: none;
            -webkit-touch-callout: none;
        }
        
        /* 防止开发者工具检测 */
        .anti-debug {
            display: none !important;
        }
        
        /* 水印保护层 - 优化学习体验 */
        .watermark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        /* 学习模式下隐藏背景水印 */
        .watermark-overlay.learning-mode {
            opacity: 0;
        }
        
        /* 非学习模式显示轻微水印 */
        .watermark-overlay.protection-mode {
            opacity: 1;
            background-image: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 150px,
                    rgba(26, 58, 87, 0.02) 150px,
                    rgba(26, 58, 87, 0.02) 300px
                );
        }
        
        /* 学生端特殊保护 - 优化学习体验 */
        .student-content {
            position: relative;
        }
        
        /* 只在非学习页面显示保护层 */
        .student-content.non-learning::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(26, 58, 87, 0.01) 0%, transparent 70%),
                radial-gradient(circle at 80% 80%, rgba(26, 58, 87, 0.01) 0%, transparent 70%);
            pointer-events: none;
            z-index: 1;
        }
        
        /* 学习页面清除所有干扰 */
        .learning-content {
            position: relative;
            background: #f8fbff;
        }
        
        .learning-content::before {
            display: none;
        }
        
        /* 学习模式下优化视频卡片 */
        .learning-content .video-card {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(26, 58, 87, 0.1);
            transition: all 0.3s ease;
        }
        
        .learning-content .video-card:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        
        /* 学习模式下优化题库卡片 */
        .learning-content .exercise-card {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(26, 58, 87, 0.1);
            transition: all 0.3s ease;
        }
        
        .learning-content .exercise-card:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        
        /* 学习模式下的内容区域 */
        .learning-content .content-section {
            background: transparent;
            padding: 20px 0;
        }
        
        /* 学习模式下的标题优化 */
        .learning-content .section-title {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
        }
        
        /* 防打印样式 */
        @media print {
            * {
                display: none !important;
            }
            
            body::before {
                content: "此内容受版权保护，禁止打印";
                display: block !important;
                text-align: center;
                font-size: 24px;
                color: red;
                margin: 50px;
            }
        }
        
        /* 安全警告动画 */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* 学生端额外保护样式 */
        .student-protection {
            position: relative;
        }
        
        .student-protection::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                transparent 40%,
                rgba(26, 58, 87, 0.02) 50%,
                transparent 60%
            );
            pointer-events: none;
            z-index: 1;
        }
        
        /* 登录界面 */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25" fill="%23ecf0f1"/><path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z" opacity=".5" fill="%23ecf0f1"/><path d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z" fill="%23ecf0f1"/></svg>');
            background-size: cover;
            z-index: 0;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            text-align: center;
            z-index: 10;
            position: relative;
            animation: fadeInScale 0.6s ease;
        }
        
        .login-logo {
            margin-bottom: 30px;
        }
        
        .login-title {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 24px;
        }
        
        .login-subtitle {
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .login-form {
            margin-top: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(42, 106, 167, 0.3);
        }
        
        .password-hint {
            text-align: right;
            font-size: 13px;
            color: #7f8c8d;
            margin-top: -15px;
            margin-bottom: 15px;
        }
        
        .password-hint i {
            margin-right: 5px;
        }
        
        /* 导航栏样式 */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(26, 58, 87, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .featured-banner {
            background: var(--ocean-blue);
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .logo i {
            font-size: 28px;
            color: #63b3ff;
            background: rgba(255, 255, 255, 0.15);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 5px;
        }
        
        nav li {
            padding: 0 8px;
        }
        
        nav a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 30px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .user-info:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .user-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(45deg, #63b3ff, #2a6aa7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .logout-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
            font-size: 16px;
        }
        
        .role-badge {
            font-size: 12px;
            padding: 3px 10px;
            border-radius: 12px;
            margin-left: 5px;
        }
        
        .teacher-badge {
            background: var(--teacher);
        }
        
        .student-badge {
            background: var(--student);
        }
        
        /* 主内容区域 */
        .main-content {
            padding: 30px 0;
            min-height: calc(100vh - 220px);
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 28px;
            color: var(--primary);
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--accent);
            border-radius: 3px;
        }
        
        .section-title i {
            background: rgba(42, 106, 167, 0.15);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
        }
        
        /* 复习规划板块 */
        .review-planner {
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
            border: 1px solid #e3edfa;
            position: relative;
        }
        
        .planner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .timeline-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .timeline-month {
            margin-bottom: 30px;
        }
        
        .month-title {
            font-size: 20px;
            color: var(--secondary);
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 3px solid var(--accent);
        }
        
        .plan-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(236, 240, 241, 0.5);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .plan-item:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateX(5px);
        }
        
        .week-label {
            background: var(--accent);
            color: white;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 4px;
            min-width: 80px;
            text-align: center;
            margin-right: 15px;
        }
        
        .plan-content {
            flex: 1;
        }
        
        .plan-content h4 {
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        .plan-content p {
            font-size: 14px;
            color: #5e7c9c;
        }
        
        .plan-status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
        }
        
        .status-check {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .status-check.completed {
            background: var(--success);
            border-color: var(--success);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-check.completed::before {
            content: "✓";
            color: white;
            font-size: 14px;
        }
        
        /* 视频课程板块 */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .video-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            border: 1px solid #e3edfa;
        }
        
        .video-card.featured {
            grid-column: 1 / -1;
            display: flex;
            max-width: 900px;
            margin: 0 auto;
            border: 2px solid var(--accent);
        }
        
        .video-card.featured .video-preview {
            flex: 1;
            min-height: 250px;
        }
        
        .video-card.featured .video-info {
            flex: 1;
            padding: 25px;
        }
        
        .video-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(26, 58, 87, 0.15);
        }
        
        .video-preview {
            height: 160px;
            background: linear-gradient(45deg, var(--primary), #316399);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .video-preview i {
            font-size: 60px;
            color: rgba(255, 255, 255, 0.15);
        }
        
        .featured-tag {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--success);
            color: white;
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        .play-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            color: var(--secondary);
            background: white;
        }
        
        .video-info {
            padding: 20px;
        }
        
        .video-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 44px;
        }
        
        .video-description {
            color: #5e7c9c;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .video-duration {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #6d8db0;
            font-size: 14px;
            margin-top: 10px;
        }
        
        /* 题库系统板块 */
        .question-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
            border: 1px solid #e3edfa;
            margin-top: 20px;
        }
        
        .upload-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 25px;
            background: rgba(42, 106, 167, 0.05);
            padding: 20px;
            border-radius: 10px;
            border: 2px dashed #63b3ff;
        }
        
        .upload-section h3 {
            color: var(--primary);
        }
        
        .upload-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            box-shadow: 0 4px 10px rgba(42, 106, 167, 0.2);
        }
        
        .upload-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(42, 106, 167, 0.25);
        }
        
        .progress-container {
            margin-top: 25px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .progress-header h3 {
            color: var(--primary);
        }
        
        .progress-bar {
            height: 10px;
            background: #e0e7f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 25px;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #63b3ff, var(--accent));
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-text {
            position: absolute;
            right: 10px;
            top: -22px;
            font-size: 12px;
            color: var(--secondary);
        }
        
        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .exercise-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 58, 87, 0.08);
            border-left: 4px solid var(--accent);
            transition: all 0.3s ease;
            border: 1px solid #e3edfa;
        }
        
        .exercise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(26, 58, 87, 0.15);
        }
        
        .exercise-title {
            font-weight: 700;
            font-size: 17px;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .exercise-meta {
            display: flex;
            justify-content: space-between;
            color: var(--secondary);
            font-size: 14px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e3edfa;
        }
        
        .exercise-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .start-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: block;
            width: 100%;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .start-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        /* 分数线板块 */
        .score-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: 1px solid #e3edfa;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: var(--accent);
            color: white;
        }
        
        .score-chart-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-box {
            height: 400px;
            position: relative;
        }
        
        .score-details {
            margin-top: 30px;
        }
        
        .section-card {
            background: white;
            border: 1px solid #e3edfa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .info-item {
            display: flex;
            margin-bottom: 15px;
        }
        
        .info-label {
            width: 140px;
            font-weight: 600;
            color: var(--primary);
            margin-right: 20px;
        }
        
        .info-content {
            flex: 1;
            color: var(--text);
        }
        
        .info-content p {
            margin-bottom: 5px;
        }
        
        .diff-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .diff-up {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .diff-down {
            background-color: #d4edda;
            color: #155724;
        }
        
        /* 成绩录入板块 */
        .grade-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
        }
        
        .grade-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .grade-form input {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .add-grade-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0 20px;
        }
        
        .add-grade-btn:hover {
            background: var(--secondary);
        }
        
        .grade-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .grade-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(26, 58, 87, 0.08);
            border-left: 4px solid var(--accent);
        }
        
        .grade-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .grade-value {
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
            color: var(--secondary);
        }
        
        .grade-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .grade-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e3edfa;
        }
        
        .grade-item:last-child {
            border-bottom: none;
        }
        
        .grade-actions {
            display: flex;
            gap: 10px;
        }
        
        .grade-actions button {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
        }
        
        /* 模态框样式 - 优化学习体验 */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        /* 学习模式下的模态框 */
        .learning-content .modal-backdrop {
            background: rgba(0, 0, 0, 0.95);
        }
        
        .modal-backdrop.active {
            visibility: visible;
            opacity: 1;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90vw;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
        
        .fullscreen-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .fullscreen-btn i {
            transition: transform 0.3s ease;
        }
        
        .modal-content.fullscreen .fullscreen-btn i {
            transform: rotate(180deg);
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background: #000;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0 0 15px 15px;
        }
        
        /* 全屏模式样式 */
        .modal-content.fullscreen {
            width: 100vw;
            height: 100vh;
            max-width: none;
            max-height: none;
            border-radius: 0;
            margin: 0;
        }
        
        .modal-content.fullscreen .video-container {
            height: calc(100vh - 60px);
            padding-bottom: 0;
        }
        
        .modal-content.fullscreen .video-container iframe {
            border-radius: 0;
        }
        
        .modal-content.fullscreen .modal-header {
            border-radius: 0;
        }
        
        footer {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-top: 40px;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .copyright {
            font-size: 14px;
            opacity: 0.8;
            letter-spacing: 0.5px;
        }
        
        /* 专业信息板块 */
        .university-info {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-card {
            background: rgba(236, 240, 241, 0.5);
            border-radius: 8px;
            padding: 20px;
            border-left: 3px solid var(--accent);
        }
        
        .info-card h3 {
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .info-card ul {
            padding-left: 20px;
        }
        
        .info-card li {
            margin-bottom: 10px;
        }
        
        .reference-book {
            display: flex;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .book-icon {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 15px;
        }
        
        /* 动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes wave {
            0% { transform: translateX(0); }
            50% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }
        
        /* 响应式调整 */
        @media (max-width: 1200px) {
            .container {
                padding: 0 15px;
            }
            
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .exercise-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .video-card.featured {
                flex-direction: column;
            }
            
            .timeline-container {
                grid-template-columns: 1fr;
            }
            
            .grade-form {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .score-filters {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .filter-btn {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
        }
        
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .logo h1 {
                font-size: 20px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                margin: 10px 0;
                gap: 5px;
            }
            
            nav li {
                padding: 2px;
            }
            
            nav a {
                padding: 8px 12px;
                font-size: 14px;
                border-radius: 20px;
            }
            
            .user-menu {
                width: 100%;
                justify-content: center;
            }
            
            .upload-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .exercise-grid {
                grid-template-columns: 1fr;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 22px;
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .section-title i {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .login-box {
                margin: 20px;
                padding: 30px 20px;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px;
            }
            
            .modal-content.fullscreen {
                width: 100vw;
                height: 100vh;
                margin: 0;
            }
            
            .video-tips {
                font-size: 12px !important;
                padding: 8px 12px !important;
                bottom: 10px !important;
                left: 10px !important;
            }
            
            .grade-results {
                grid-template-columns: 1fr;
            }
            
            .chart-box {
                height: 300px;
            }
            
            .info-item {
                flex-direction: column;
                gap: 5px;
            }
            
            .info-label {
                width: 100%;
                margin-right: 0;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .login-box {
                padding: 25px 15px;
            }
            
            .login-title {
                font-size: 20px;
            }
            
            .login-subtitle {
                font-size: 14px;
            }
            
            .section-title {
                font-size: 20px;
            }
            
            .video-card {
                margin: 0 10px;
            }
            
            .exercise-card {
                margin: 0 10px;
            }
            
            .nav a {
                padding: 6px 10px;
                font-size: 13px;
            }
            
            .user-info {
                padding: 6px 10px;
            }
            
            .user-icon {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
        }
        
        /* 新增上传功能样式 */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .upload-modal.active {
            display: flex;
        }
        
        .upload-modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .upload-form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .upload-form-group label {
            font-weight: 600;
            color: var(--primary);
        }
        
        .upload-form-group input,
        .upload-form-group textarea,
        .upload-form-group select {
            padding: 12px;
            border: 2px solid #e3edfa;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .upload-form-group input:focus,
        .upload-form-group textarea:focus,
        .upload-form-group select:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .upload-form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .file-upload-area {
            border: 2px dashed var(--accent);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: rgba(52, 152, 219, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: var(--secondary);
        }
        
        .file-upload-area.dragover {
            background: rgba(52, 152, 219, 0.15);
            border-color: var(--secondary);
        }
        
        .file-upload-area i {
            font-size: 48px;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .file-upload-area p {
            color: var(--text);
            margin-bottom: 10px;
        }
        
        .file-upload-area small {
            color: #7f8c8d;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .radio-label input[type="radio"] {
            margin: 0;
        }
        
        .upload-progress {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 12px;
            color: var(--text);
            text-align: center;
            display: block;
        }
        
        .upload-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .upload-btn-primary {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .upload-btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .upload-btn-secondary {
            background: #ecf0f1;
            color: var(--text);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .upload-btn-secondary:hover {
            background: #d5dbdb;
        }
        
        .upload-preview {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }
        
        .upload-preview.active {
            display: block;
        }
        
        .upload-preview h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .upload-preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e3edfa;
        }
        
        .upload-preview-item:last-child {
            border-bottom: none;
        }
        
        .upload-preview-item .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upload-preview-item .file-info i {
            color: var(--accent);
        }
        
        .upload-preview-item .remove-file {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 5px;
        }
        
        /* 改进的导航栏移动端适配 */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            nav {
                display: none;
                width: 100%;
                margin-top: 15px;
            }
            
            nav.active {
                display: block;
            }
            
            nav ul {
                flex-direction: column;
                gap: 5px;
            }
            
            nav li {
                width: 100%;
            }
            
            nav a {
                width: 100%;
                justify-content: center;
                padding: 12px;
            }
        }
        
        /* 触摸设备优化 */
        .touch-device .video-card:hover,
        .touch-device .exercise-card:hover {
            transform: none;
        }
        
        .touch-device .play-button {
            min-height: 44px;
            min-width: 44px;
        }
        
        .touch-device .upload-btn,
        .touch-device .start-btn,
        .touch-device .add-grade-btn {
            min-height: 44px;
            padding: 12px 20px;
        }
        
        .touch-device nav a {
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 加载动画 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 成功提示 */
        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .success-message.show {
            transform: translateX(0);
        }
        
        /* 错误提示 */
        .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .error-message.show {
            transform: translateX(0);
        }
        
        /* 数据表格响应式设计 */
        @media (max-width: 768px) {
            .data-table-container {
                overflow-x: auto;
            }
            
            .data-table-container table {
                min-width: 600px;
                font-size: 14px;
            }
            
            .data-table-container th,
            .data-table-container td {
                padding: 8px 6px !important;
            }
        }
        
        @media (max-width: 480px) {
            .data-table-container table {
                min-width: 500px;
                font-size: 12px;
            }
            
            .data-table-container th,
            .data-table-container td {
                padding: 6px 4px !important;
            }
        }
        
        /* ==================== 美化样式增强 ==================== */
        
        /* 加载动画 */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 改进的消息提示 */
        .message-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .message-toast.show {
            transform: translateX(0);
        }
        
        .message-toast.success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .message-toast.error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .message-toast.warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        
        .message-toast.info {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        /* 改进的视频卡片 */
        .video-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .video-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }
        
        .video-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .video-card:hover::before {
            opacity: 1;
        }
        
        /* 改进的题库卡片 */
        .exercise-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .exercise-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            border-color: var(--secondary);
        }
        
        .exercise-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .exercise-card:hover::before {
            opacity: 1;
        }
        
        /* 改进的按钮样式 */
        .btn-primary, .upload-btn-primary, .exercise-btn {
            background: linear-gradient(135deg, var(--primary), #1976D2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover, .upload-btn-primary:hover, .exercise-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.3);
        }
        
        .btn-primary::before, .upload-btn-primary::before, .exercise-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before, .upload-btn-primary:hover::before, .exercise-btn:hover::before {
            left: 100%;
        }
        
        /* 改进的模态框 */
        .modal-backdrop {
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            background: rgba(0,0,0,0.6);
        }
        
        .modal-content {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            animation: modalSlideIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* 改进的输入框 */
        .upload-form-group input, .upload-form-group textarea, .upload-form-group select {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
        }
        
        .upload-form-group input:focus, .upload-form-group textarea:focus, .upload-form-group select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            background: white;
        }
        
        /* 改进的进度条 */
        .progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* 改进的标签 */
        .video-meta span, .exercise-meta span {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #495057;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        /* 状态指示器 */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-indicator.online {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
        }
        
        .status-indicator.offline {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }
        
        .status-indicator.warning {
            background: rgba(255, 152, 0, 0.1);
            color: #ff9800;
        }
        
        /* 设置按钮样式 */
        .settings-btn {
            background: none;
            border: none;
            color: #666;
            margin-right: 15px;
            cursor: pointer;
            font-size: 16px;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .settings-btn:hover {
            background: rgba(0,0,0,0.1);
            color: var(--primary);
        }
        
        .settings-btn:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* 强制所有input显示标签 */
        input:not([aria-label]):not([aria-labelledby]) {
            border: 2px solid red !important;
        }
        
        input:not([aria-label]):not([aria-labelledby])::before {
            content: "缺少标签!" !important;
            color: red !important;
        }
        
        /* 确保所有表单元素可访问性 */
        .login-form input,
        .upload-form input,
        .grade-form input {
            position: relative;
        }
        
        /* 为动态生成的元素添加默认标签 */
        input[placeholder]:not([aria-label]) {
            aria-label: attr(placeholder);
        }
    </style>
</head>
<body id="appBody">
    <!-- 水印保护层 -->
    <div class="watermark-overlay" id="watermarkOverlay"></div>
    
    <!-- 反调试保护 -->
    <div class="anti-debug" id="antiDebug"></div>
    
    <!-- 登录界面（默认显示） -->
    <div class="login-container" id="loginContainer">
        <div class="wave"></div>
        <div class="login-box">
            <div class="login-logo">
                <div style="display: flex; justify-content: center;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(45deg, #63b3ff, #2a6aa7); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-water" style="font-size: 40px; color: white;"></i>
                    </div>
                </div>
                <h2 class="login-title">流体力学学习平台</h2>
                <p class="login-subtitle">中国海洋大学 | 803流体力学</p>
            </div>
            
            <form class="login-form" id="loginForm" novalidate>
                <div class="input-group">
                    <label for="username">账号</label>
                    <input type="text" 
                           id="username" 
                           name="username"
                           placeholder="请输入账号" 
                           autocomplete="username"
                           required
                           aria-describedby="username-help">
                    <div class="input-hint" id="username-help" style="display: none;">
                        <i class="fas fa-user"></i> 请输入您的登录账号
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="password">密码</label>
                    <input type="password" 
                           id="password" 
                           name="password"
                           placeholder="请输入密码" 
                           autocomplete="current-password"
                           required
                           aria-describedby="password-help">
                    <div class="password-hint" id="password-help">
                        <i class="fas fa-lock"></i> 密码区分大小写
                    </div>
                </div>
                
                <div class="login-error" id="loginError" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i> 用户名或密码错误
                </div>
                
                <button type="submit" class="login-btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> 登录
                </button>
            </form>
                
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="showChangePasswordModal()" style="color: var(--secondary); text-decoration: none; font-size: 14px;">
                        <i class="fas fa-key"></i> 修改密码
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 修改密码模态框 -->
    <div class="modal-backdrop" id="changePasswordModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> 修改密码</h3>
                <button class="close-modal" 
                        onclick="closeChangePasswordModal()"
                        aria-label="关闭修改密码对话框"
                        title="关闭">&times;</button>
            </div>
            <form id="changePasswordForm" style="padding: 20px;" novalidate>
                <div class="upload-form-group">
                    <label for="changeUsername">用户名</label>
                    <input type="text" 
                           id="changeUsername" 
                           name="changeUsername"
                           placeholder="请输入用户名"
                           autocomplete="username"
                           required
                           aria-label="用户名">
                </div>
                
                <div class="upload-form-group">
                    <label for="currentPassword">当前密码</label>
                    <input type="password" 
                           id="currentPassword" 
                           name="currentPassword"
                           placeholder="请输入当前密码"
                           autocomplete="current-password"
                           required
                           aria-label="当前密码">
                </div>
                
                <div class="upload-form-group">
                    <label for="newPassword">新密码</label>
                    <input type="password" 
                           id="newPassword" 
                           name="newPassword"
                           placeholder="请输入新密码"
                           autocomplete="new-password"
                           required
                           aria-label="新密码">
                </div>
                
                <div class="upload-form-group">
                    <label for="confirmPassword">确认新密码</label>
                    <input type="password" 
                           id="confirmPassword" 
                           name="confirmPassword"
                           placeholder="请再次输入新密码"
                           autocomplete="new-password"
                           required
                           aria-label="确认新密码">
                </div>
                
                <div class="upload-buttons">
                    <button type="button" 
                            class="upload-btn-secondary" 
                            onclick="closeChangePasswordModal()"
                            aria-label="取消修改密码">取消</button>
                    <button type="submit" 
                            class="upload-btn-primary"
                            aria-label="确认修改密码">确认修改</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 平台界面（登录后显示） -->
    <div id="platformContainer" style="display: none;">
        <header>
            <div class="featured-banner">
                今日推荐：流体力学之美 - 探索流动世界的奥秘
            </div>
            <div class="container">
                <div class="header-top">
                    <div class="logo" onclick="switchSection('review-section')">
                        <i class="fas fa-water"></i>
                        <h1>流体力学学习平台</h1>
                    </div>
                    
                    <button class="mobile-menu-toggle" 
                            onclick="toggleMobileMenu()"
                            aria-label="切换移动端菜单"
                            title="菜单">
                        <i class="fas fa-bars" aria-hidden="true"></i>
                    </button>
                    
                    <nav id="mainNav">
                        <ul>
                            <li><a href="#" onclick="switchSection('review-section')" class="active"><i class="fas fa-book"></i> 复习规划</a></li>
                            <li><a href="#" onclick="switchSection('video-section')"><i class="fas fa-video"></i> 视频课程</a></li>
                            <li><a href="#" onclick="switchSection('question-section')"><i class="fas fa-question-circle"></i> 题库练习</a></li>
                            <li><a href="#" onclick="switchSection('score-section')"><i class="fas fa-chart-line"></i> 分数线</a></li>
                            <li><a href="#" onclick="switchSection('grade-section')"><i class="fas fa-graduation-cap"></i> 成绩录入</a></li>
                        </ul>
                    </nav>
                    
                    <div class="user-menu">
                        <div id="githubStatus" class="status-indicator offline" style="margin-right: 10px;">
                            <i class="fas fa-cloud-slash"></i>
                            <span>离线模式</span>
                        </div>
                        <button onclick="window.open('github-setup.html', '_blank')" 
                                class="settings-btn"
                                title="配置GitHub后台"
                                aria-label="配置GitHub后台设置">
                            <i class="fas fa-cog" aria-hidden="true"></i>
                        </button>
                        <div class="user-info" id="userInfo">
                            <div class="user-icon" id="userIcon">刘</div>
                            <div>
                                <span id="usernameText">刘光辉</span>
                                <span id="roleBadge" class="role-badge teacher-badge">教师</span>
                            </div>
                            <button class="logout-btn" 
                                    title="退出登录" 
                                    aria-label="退出登录"
                                    onclick="logout()">
                                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-content container">
            <!-- 复习规划板块 -->
            <section id="review-section" class="content-section active">
                <div class="section-title">
                    <i class="fas fa-book"></i> 专业课复习规划 (803流体力学)
                </div>
                
                <div class="university-info">
                    <div class="info-grid">
                                    <div class="info-card">
                <h3><i class="fas fa-university"></i> 院校专业情况简述</h3>
                <p><strong>2025年招生情况：</strong></p>
                <p>• 统考名额：38人（默认）→ 35人（复试时）</p>
                <p>• 调剂名额：0人</p>
                <p>• 复试人数：35人</p>
                <p>• 录取人数：35人</p>
                <p>• 复试比例：1.0</p>
                <p>• 专业报名人数：125人</p>
                <p>• 录取率：28.0%</p>
                <p>• 分数线：274分（国家线）</p>
            </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-graduation-cap"></i> 考试要求</h3>
                            <p>要求考生能系统理解流体力学的基本概念和基本原理，掌握流体力学的基本思想与方法，具有较好的流体力学知识以及运用所学知识分析问题和解决问题的能力。</p>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-file-alt"></i> 考试形式</h3>
                            <p>闭卷考试，满分150分，考试时间180分钟</p>
                            <p>基础理论（40%），理想流体（30%），粘性流体（30%）</p>
                        </div>
                    </div>
                    
                    <div class="info-grid" style="margin-top: 25px;">
                        <div class="info-card">
                            <h3><i class="fas fa-book-open"></i> 初试参考书目</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>流体力学（第二版）</strong>
                                    <p>吴望一 | 北京大学出版社 | 2021年</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-book"></i> 初试辅助书籍</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>流体力学（第二版）</strong>
                                    <p>周光炯 | 高等教育出版社</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-book"></i> 复试参考书目</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>物理海洋学</strong>
                                    <p>董昌明 | 科学出版社 | 2019年</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-tips">
                        <h3><i class="fas fa-lightbulb"></i> 复习建议</h3>
                        <p><strong>基础阶段：</strong>学习基础知识，先读流体力学第二版，看郑桂珍网课</p>
                        <p><strong>强化阶段：</strong>基础知识串讲，带练</p>
                        <p><strong>真题阶段：</strong>真题做两遍，重点真题讲解</p>
                        <p><strong>复试准备：</strong>物理海洋学占复试内容的80%，需重点复习</p>
                    </div>
                </div>
                
                <div class="review-planner" style="margin-top: 25px;">
                    <div class="planner-header">
                        <h3><i class="fas fa-calendar-alt"></i> 专业课复习时间表</h3>
                        <div class="progress-header">
                            <span>完成进度：35%</span>
                        </div>
                    </div>
                    
                    <div class="timeline-container">
                        <div class="timeline-month">
                            <h3 class="month-title">7月 - 基础巩固</h3>
                            <div class="plan-item">
                                <div class="week-label">第1周</div>
                                <div class="plan-content">
                                    <h4>流体的物理性质</h4>
                                    <p>连续介质模型、牛顿流体与非牛顿流体、流体的粘滞性</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check completed"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第2周</div>
                                <div class="plan-content">
                                    <h4>本构方程和亥姆霍兹定理</h4>
                                    <p>应力张量、本构方程、速度分解定理</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check completed"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第3-4周</div>
                                <div class="plan-content">
                                    <h4>理想流体动量方程</h4>
                                    <p>欧拉方程、伯努利方程及应用</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">8月 - 核心原理</h3>
                            <div class="plan-item">
                                <div class="week-label">第1周</div>
                                <div class="plan-content">
                                    <h4>流体力学方程组</h4>
                                    <p>连续性方程、动量方程、能量方程</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第2周</div>
                                <div class="plan-content">
                                    <h4>涡旋运动</h4>
                                    <p>涡量、环量、涡旋运动基本定理</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第3-4周</div>
                                <div class="plan-content">
                                    <h4>势流理论基础</h4>
                                    <p>速度势函数、流函数、基本势流叠加原理</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">9月 - 专题深化</h3>
                            <div class="plan-item">
                                <div class="week-label">第1-2周</div>
                                <div class="plan-content">
                                    <h4>势流理论深化</h4>
                                    <p>布拉修斯定理、镜像法、机翼理论</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">10月 - 应用实践</h3>
                            <div class="plan-item">
                                <div class="week-label">第1周</div>
                                <div class="plan-content">
                                    <h4>相似原理与量纲分析</h4>
                                    <p>量纲齐次性原理、π定理应用、流动相似准数</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第2-4周</div>
                                <div class="plan-content">
                                    <h4>粘性流体理论</h4>
                                    <p>NS方程、层流与湍流、边界层理论</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">11-12月 - 真题冲刺</h3>
                            <div class="plan-item">
                                <div class="week-label">11月</div>
                                <div class="plan-content">
                                    <h4>真题精讲</h4>
                                    <p>历年真题解析与考点归纳</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">12月</div>
                                <div class="plan-content">
                                    <h4>错题串讲</h4>
                                    <p>高频错题分析与解题技巧</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="review-planner" style="margin-top: 25px;">
                    <div class="planner-header">
                        <h3><i class="fas fa-tasks"></i> 课后复习注意事项</h3>
                    </div>
                    
                    <div class="review-notes">
                        <h4>复习规划补充说明</h4>
                        <ul>
                            <li>需保证质量完成课后任务，9月可以开始尝试做真题</li>
                            <li>不会的真题可以通过微信群或课堂提问</li>
                            <li>每周至少投入10小时进行专业课复习</li>
                            <li>重点掌握伯努利方程、NS方程和边界层理论</li>
                            <li>关注物理海洋学在复试中的重要性（占80%）</li>
                        </ul>
                    </div>
                    
                    <div class="review-notes">
                        <h4>上课规划说明</h4>
                        <ul>
                            <li>总课时为20小时</li>
                            <li>课程安排为初步计划，可根据实际情况协商调整</li>
                            <li>如有事需调整上课时间，至少提前一天告知对方</li>
                            <li>课后作业需保证质量完成</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- 视频课程板块 -->
            <section id="video-section" class="content-section">
                <div class="section-title">
                    <i class="fas fa-video"></i> 流体力学视频课程
                </div>
                
                <div class="video-grid">
                    <div class="video-card featured">
                        <div class="video-preview">
                            <i class="fas fa-water"></i>
                            <div class="featured-tag">
                                <i class="fas fa-star"></i> 平台推荐
                            </div>
                            <div class="play-button" onclick="openVideoModal('BV16T421D7k4')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">流体力学之美，太美了</h3>
                            <p class="video-description">探索流体世界的奇妙现象与科学原理，揭示自然界的流动艺术。本课程通过高清实验演示和计算机模拟，展示流体在不同条件下的动态行为，帮助理解流体力学在航空航天、船舶设计等领域的应用。</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 18:45</div>
                                <div><i class="fas fa-download"></i> 教师上传</div>
                                <div><i class="far fa-eye"></i> 32,458 次观看</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fas fa-wind"></i>
                            <div class="play-button" onclick="openVideoModal('BV1GJ411x7h7')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">流体力学基础原理</h3>
                            <p class="video-description">从零开始掌握流体力学核心概念，适合初学者入门学习。课程涵盖流体静力学、流体动力学基本原理，以及基本方程的推导和应用。</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 22:30</div>
                                <div><i class="fas fa-download"></i> B站精选</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fas fa-tint"></i>
                            <div class="play-button" onclick="openVideoModal('BV1Yb4y1Y7Jp')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">伯努利方程详解</h3>
                            <p class="video-description">深入理解伯努利方程及其在流体力学中的应用，包括飞机升力原理、管道流体流动分析等实际应用场景。</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 25:15</div>
                                <div><i class="fas fa-download"></i> B站精选</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fas fa-wave-square"></i>
                            <div class="play-button" onclick="openVideoModal('BV1XJ411L7Bd')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">流体动力学与涡旋</h3>
                            <p class="video-description">学习流体动力学核心概念，理解涡旋形成机制及其在海洋环流、大气运动中的应用。</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 28:40</div>
                                <div><i class="fas fa-download"></i> B站精选</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fas fa-ship"></i>
                            <div class="play-button" onclick="openVideoModal('BV1NJ411L7Bd')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">流体力学工程应用</h3>
                            <p class="video-description">船舶与海洋工程中的流体力学原理与实践，包括船舶阻力计算、螺旋桨设计等关键技术。</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 32:10</div>
                                <div><i class="fas fa-download"></i> B站精选</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fas fa-tachometer-alt"></i>
                            <div class="play-button" onclick="openVideoModal('BV1PJ411L7Bd')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">边界层理论精讲</h3>
                            <p class="video-description">深入解析边界层理论，包括层流边界层、湍流边界层及其在工程中的应用。</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 26:45</div>
                                <div><i class="fas fa-download"></i> B站精选</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fas fa-calculator"></i>
                            <div class="play-button" onclick="openVideoModal('BV1QJ411Y7N8')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">NS方程解析</h3>
                            <p class="video-description">纳维-斯托克斯方程的推导、解析解与数值解法，理解流体运动的基本控制方程。</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 30:20</div>
                                <div><i class="fas fa-download"></i> B站精选</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <div class="video-preview">
                            <i class="fas fa-water"></i>
                            <div class="play-button" onclick="openVideoModal('BV1RJ411L7Bd')">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">物理海洋学基础</h3>
                            <p class="video-description">海洋波动、环流与潮汐的基本知识及其应用，为复试物理海洋学内容打下基础。</p>
                            <div class="video-duration">
                                <div><i class="far fa-clock"></i> 35:15</div>
                                <div><i class="fas fa-download"></i> B站精选</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 分数线板块 -->
            <section id="score-section" class="content-section">
                <div class="section-title">
                    <i class="fas fa-chart-line"></i> 国家线和复试线对比分析
                </div>
                
                <div class="score-filters">
                                            <button class="filter-btn active" 
                                data-year="all"
                                aria-label="显示全部年份"
                                title="全部年份">全部年份</button>
                        <button class="filter-btn" 
                                data-year="2020"
                                aria-label="筛选2020年内容"
                                title="2020年">2020年</button>
                        <button class="filter-btn" 
                                data-year="2023"
                                aria-label="筛选2023年内容"
                                title="2023年">2023年</button>
                        <button class="filter-btn" 
                                data-year="2025"
                                aria-label="筛选2025年内容"
                                title="2025年">2025年</button>
                </div>
                
                <div class="score-chart-container">
                    <div class="chart-header">
                        <h3>803流体力学报考人数与分数线 (2020-2025)</h3>
                        <div>
                            <span style="background: var(--reexam-color); padding: 5px 10px; border-radius: 4px; color: white;">复试线</span>
                            <span style="background: var(--national-color); padding: 5px 10px; border-radius: 4px; color: white; margin-left: 10px;">国家线</span>
                            <span style="background: #27ae60; padding: 5px 10px; border-radius: 4px; color: white; margin-left: 10px;">报名人数</span>
                        </div>
                    </div>
                    <div class="chart-box">
                        <canvas id="scoreChart"></canvas>
                    </div>
                    
                    <div class="score-details">
                        <h3><i class="fas fa-info-circle"></i> 分数线详情与差异分析</h3>
                        
                        <!-- 数据统计表格 -->
                        <div class="data-table-container" style="margin-bottom: 30px;">
                            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <thead>
                                    <tr style="background: var(--primary); color: white;">
                                        <th style="padding: 15px; text-align: center; border: none;">年份</th>
                                        <th style="padding: 15px; text-align: center; border: none;">国家线</th>
                                        <th style="padding: 15px; text-align: center; border: none;">复试线</th>
                                        <th style="padding: 15px; text-align: center; border: none;">报名人数</th>
                                        <th style="padding: 15px; text-align: center; border: none;">复试人数</th>
                                        <th style="padding: 15px; text-align: center; border: none;">录取人数</th>
                                        <th style="padding: 15px; text-align: center; border: none;">录取率</th>
                                        <th style="padding: 15px; text-align: center; border: none;">复试比例</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2020年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa; background: #f8f9fa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2021年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">280分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">313分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">32人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">29人</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.33</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2022年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">290分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">292分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">110人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">43人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">35人</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">31.8%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.3</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa; background: #f8f9fa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2023年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">279分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">294分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">105人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">30人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">27人</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">25.7%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.2</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2024年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">120人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">37人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">37人</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">30.8%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.0</td>
                                    </tr>
                                    <tr style="background: #f0f8ff;">
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">2025年</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">274分</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">274分</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">125人</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">35人</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">35人</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold; color: var(--success);">28.0%</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">1.0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        
                        <div class="section-card">
                            <div class="info-item">
                                <div class="info-label">2023年：</div>
                                <div class="info-content">
                                    <p><strong>国家线：279分</strong></p>
                                    <p><strong>复试线：294分</strong> 
                                        <span class="diff-indicator diff-up">比2023国家线高15分</span></p>
                                    <p>当年复试人数：30人，录取：27人</p>
                                    <p>专业报名人数：105人</p>
                                    <p>录取率：25.7%（27÷105）</p>
                                    <p>复试比例：1.2</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-card">
                            <div class="info-item">
                                <div class="info-label">2025年：</div>
                                <div class="info-content">
                                    <p><strong>国家线：274分</strong></p>
                                    <p><strong>复试线：274分</strong> 
                                        <span class="diff-indicator diff-down">与2025国家线相同</span></p>
                                    <p>当年复试人数：35人，录取：35人</p>
                                    <p>专业报名人数：125人</p>
                                    <p>录取率：28.0%（35÷125）</p>
                                    <p>复试比例：1.0</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 数据趋势分析 -->
                        <div class="trend-analysis" style="background: white; border-radius: 10px; padding: 25px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);">
                            <h4 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chart-line"></i> 数据趋势分析
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">报名趋势</h5>
                                    <p style="margin-bottom: 5px;">2020年：-</p>
                                    <p style="margin-bottom: 5px;">2021年：-</p>
                                    <p style="margin-bottom: 5px;">2022年：110人</p>
                                    <p style="margin-bottom: 5px;">2023年：105人 <span style="color: var(--warning);">↓ 4.5%</span></p>
                                    <p style="margin-bottom: 5px;">2024年：120人 <span style="color: var(--success);">↑ 14.3%</span></p>
                                    <p>2025年：125人 <span style="color: var(--success);">↑ 4.2%</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--teacher);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">录取率变化</h5>
                                    <p style="margin-bottom: 5px;">2020年：-</p>
                                    <p style="margin-bottom: 5px;">2021年：-</p>
                                    <p style="margin-bottom: 5px;">2022年：31.8%</p>
                                    <p style="margin-bottom: 5px;">2023年：25.7% <span style="color: var(--warning);">↓ 6.1%</span></p>
                                    <p style="margin-bottom: 5px;">2024年：30.8% <span style="color: var(--success);">↑ 5.1%</span></p>
                                    <p>2025年：28.0% <span style="color: var(--warning);">↓ 2.8%</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--student);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">分数线变化</h5>
                                    <p style="margin-bottom: 5px;">2020年：国家线288分，复试线288分</p>
                                    <p style="margin-bottom: 5px;">2021年：国家线280分，复试线313分</p>
                                    <p style="margin-bottom: 5px;">2022年：国家线290分，复试线292分</p>
                                    <p style="margin-bottom: 5px;">2023年：国家线279分，复试线294分</p>
                                    <p style="margin-bottom: 5px;">2024年：国家线288分，复试线288分</p>
                                    <p>2025年：国家线274分，复试线274分</p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #9b59b6;">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">复试比例变化</h5>
                                    <p style="margin-bottom: 5px;">2020年：-</p>
                                    <p style="margin-bottom: 5px;">2021年：1.33</p>
                                    <p style="margin-bottom: 5px;">2022年：1.3 <span style="color: var(--success);">↓ 0.03</span></p>
                                    <p style="margin-bottom: 5px;">2023年：1.2 <span style="color: var(--success);">↓ 0.1</span></p>
                                    <p style="margin-bottom: 5px;">2024年：1.0 <span style="color: var(--success);">↓ 0.2</span></p>
                                    <p>2025年：1.0 <span style="color: var(--success);">持平</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #e67e22;">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">招生规模变化</h5>
                                    <p style="margin-bottom: 5px;">2020年：-</p>
                                    <p style="margin-bottom: 5px;">2021年：29人</p>
                                    <p style="margin-bottom: 5px;">2022年：35人 <span style="color: var(--success);">↑ 20.7%</span></p>
                                    <p style="margin-bottom: 5px;">2023年：27人 <span style="color: var(--warning);">↓ 22.9%</span></p>
                                    <p style="margin-bottom: 5px;">2024年：37人 <span style="color: var(--success);">↑ 37.0%</span></p>
                                    <p>2025年：35人 <span style="color: var(--warning);">↓ 5.4%</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 题库练习板块 -->
            <section id="question-section" class="content-section">
                <div class="section-title">
                    <i class="fas fa-question-circle"></i> 题库练习系统
                </div>
                
                <div class="question-section">
                    <div class="upload-section">
                        <div>
                            <h3>上传练习题目</h3>
                            <p>支持PDF、Word、图片格式，可批量上传</p>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="upload-btn" 
                                    onclick="openUploadModal('question')"
                                    aria-label="上传练习题目文件"
                                    title="上传题目">
                                <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i> 上传题目
                            </button>
                            <button class="upload-btn" 
                                    onclick="openUploadModal('video')"
                                    aria-label="添加教学视频"
                                    title="添加视频">
                                <i class="fas fa-video" aria-hidden="true"></i> 添加视频
                            </button>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-header">
                            <h3>我的学习进度</h3>
                            <span id="studentProgressText">已完成 0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;">
                                <div class="progress-text">0%</div>
                            </div>
                        </div>
                        
                        <!-- 学生个人学习统计 -->
                        <div class="student-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                            <div class="stat-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-video" style="color: var(--primary); font-size: 20px;"></i>
                                    <div>
                                        <h4 style="margin: 0; color: var(--secondary);">视频学习</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--primary);">0/7 课程</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-question-circle" style="color: var(--accent); font-size: 20px;"></i>
                                    <div>
                                        <h4 style="margin: 0; color: var(--secondary);">题目练习</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--accent);">0/37 题</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-chart-line" style="color: var(--success); font-size: 20px;"></i>
                                    <div>
                                        <h4 style="margin: 0; color: var(--secondary);">平均成绩</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--success);">-- 分</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-clock" style="color: var(--warning); font-size: 20px;"></i>
                                    <div>
                                        <h4 style="margin: 0; color: var(--secondary);">学习时长</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--warning);">0 小时</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="exercise-grid">
                        <div class="exercise-card">
                            <div class="exercise-title">流体静力学基础练习</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 15题</span>
                                <span><i class="far fa-clock"></i> 30分钟</span>
                            </div>
                            <button class="start-btn" onclick="startExercise('fluid_statics', 15)">开始练习</button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">伯努利方程应用</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 12题</span>
                                <span><i class="far fa-clock"></i> 25分钟</span>
                            </div>
                            <button class="start-btn" onclick="startExercise('bernoulli', 12)">开始练习</button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">涡旋运动专题</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 10题</span>
                                <span><i class="far fa-clock"></i> 20分钟</span>
                            </div>
                            <button class="start-btn" onclick="startExercise('vortex', 10)">开始练习</button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">势流理论综合</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 18题</span>
                                <span><i class="far fa-clock"></i> 35分钟</span>
                            </div>
                            <button class="start-btn">开始练习</button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">边界层理论练习</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 8题</span>
                                <span><i class="far fa-clock"></i> 15分钟</span>
                            </div>
                            <button class="start-btn">开始练习</button>
                        </div>
                        
                        <div class="exercise-card">
                            <div class="exercise-title">NS方程应用</div>
                            <div class="exercise-meta">
                                <span><i class="far fa-file-alt"></i> 14题</span>
                                <span><i class="far fa-clock"></i> 30分钟</span>
                            </div>
                            <button class="start-btn">开始练习</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 成绩录入板块 -->
            <section id="grade-section" class="content-section">
                <div class="section-title">
                    <i class="fas fa-graduation-cap"></i> <span id="gradeSectionTitle">成绩录入系统</span>
                </div>
                
                <div class="grade-container">
                    <!-- 教师成绩录入表单 -->
                    <div class="grade-form" id="gradeInputForm">
                                            <input type="text" 
                           name="studentName"
                           placeholder="学生姓名"
                           aria-label="学生姓名">
                    <input type="number" 
                           name="studentScore"
                           placeholder="成绩"
                           aria-label="学生成绩">
                        <button class="add-grade-btn">添加</button>
                    </div>
                    
                    <!-- 学生个人成绩显示 -->
                    <div class="student-grade-display" id="studentGradeDisplay" style="display: none;">
                        <div class="student-grade-card" style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1); margin-bottom: 20px;">
                            <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-user-graduate"></i> 我的成绩单
                            </h3>
                            <div class="grade-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border-radius: 10px;">
                                    <h4 style="margin: 0 0 10px 0;">平均成绩</h4>
                                    <div style="font-size: 32px; font-weight: bold;" id="studentAvgGrade">--</div>
                                </div>
                                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--success), #27ae60); color: white; border-radius: 10px;">
                                    <h4 style="margin: 0 0 10px 0;">最高成绩</h4>
                                    <div style="font-size: 32px; font-weight: bold;" id="studentMaxGrade">--</div>
                                </div>
                                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--warning), #f39c12); color: white; border-radius: 10px;">
                                    <h4 style="margin: 0 0 10px 0;">考试次数</h4>
                                    <div style="font-size: 32px; font-weight: bold;" id="studentExamCount">0</div>
                                </div>
                            </div>
                            <div class="grade-details">
                                <h4 style="color: var(--secondary); margin-bottom: 15px;">详细成绩记录</h4>
                                <div id="studentGradeList" style="background: #f8f9fa; border-radius: 8px; padding: 15px;">
                                    <p style="text-align: center; color: #6c757d; margin: 0;">暂无成绩记录</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grade-results">
                        <div class="grade-card">
                            <div class="grade-title">
                                <i class="fas fa-user-graduate"></i> 学生成绩统计
                            </div>
                            <div class="grade-value">86.5</div>
                            <div class="grade-list">
                                <div class="grade-item">
                                    <span>张三</span>
                                    <span>92</span>
                                </div>
                                <div class="grade-item">
                                    <span>李四</span>
                                    <span>85</span>
                                </div>
                                <div class="grade-item">
                                    <span>王五</span>
                                    <span>78</span>
                                </div>
                                <div class="grade-item">
                                    <span>赵六</span>
                                    <span>91</span>
                                </div>
                                <div class="grade-item">
                                    <span>钱七</span>
                                    <span>87</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grade-card">
                            <div class="grade-title">
                                <i class="fas fa-chart-pie"></i> 成绩分布
                            </div>
                            <div class="grade-value">
                                <canvas id="gradeChart" width="200" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <!-- 提示消息 -->
    <div id="messageContainer"></div>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="copyright">探索流体世界的奥秘 · 理解自然规律的艺术</div>
                <div class="copyright">© 2025 中国海洋大学流体力学学习平台 版本 9.0</div>
            </div>
        </div>
    </footer>
    
    <!-- 视频模态框 -->
    <div class="modal-backdrop" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">流体力学之美，太美了</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="fullscreen-btn" onclick="toggleFullscreen()" title="全屏/退出全屏">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="close-modal" 
                        onclick="closeVideoModal()"
                        aria-label="关闭视频播放窗口"
                        title="关闭">&times;</button>
                </div>
            </div>
            <div class="video-container">
                <iframe id="videoFrame" src="" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
                <div class="video-tips" style="position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 8px; font-size: 14px; display: none;">
                    <i class="fas fa-info-circle"></i> 提示：点击右上角按钮可全屏观看，ESC键退出全屏
                </div>
            </div>
        </div>
    </div>
    
    <!-- 上传模态框 -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-modal-content">
            <div class="modal-header">
                <h3 id="uploadModalTitle">上传内容</h3>
                <button class="close-modal" 
                        onclick="closeUploadModal()"
                        aria-label="关闭上传窗口"
                        title="关闭">&times;</button>
            </div>
            
            <div class="upload-form" id="uploadForm">
                <div class="upload-form-group">
                    <label for="uploadTitle">标题</label>
                                            <input type="text" 
                               id="uploadTitle" 
                               name="uploadTitle"
                               placeholder="请输入标题" 
                               required
                               aria-label="上传内容标题">
                </div>
                
                <div class="upload-form-group">
                    <label for="uploadDescription">描述</label>
                    <textarea id="uploadDescription" placeholder="请输入描述信息"></textarea>
                </div>
                
                <div class="upload-form-group">
                    <label for="uploadCategory">分类</label>
                    <select id="uploadCategory">
                        <option value="basic">基础理论</option>
                        <option value="bernoulli">伯努利方程</option>
                        <option value="vortex">涡旋运动</option>
                        <option value="potential">势流理论</option>
                        <option value="boundary">边界层理论</option>
                        <option value="ns">NS方程</option>
                        <option value="ocean">物理海洋学</option>
                    </select>
                </div>
                
                <div class="upload-form-group" id="fileUploadGroup">
                    <label>文件上传</label>
                    <div class="file-upload-area" id="fileUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>点击或拖拽文件到此处上传</p>
                        <small>支持 PDF、Word、图片格式，最大 50MB</small>
                        <input type="file" 
                               id="fileInput" 
                               name="fileInput"
                               multiple 
                               accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" 
                               style="display: none;"
                               aria-label="选择文件上传">
                    </div>
                </div>
                
                <div class="upload-form-group" id="videoLinkGroup" style="display: none;">
                    <label for="videoLink">视频链接</label>
                                            <input type="url" 
                               id="videoLink" 
                               name="videoLink"
                               placeholder="请输入视频链接（B站、YouTube等）"
                               aria-label="视频链接地址">
                </div>
                
                <div class="upload-form-group" id="videoFileGroup" style="display: none;">
                    <label>本地视频文件</label>
                    <div class="file-upload-area" id="videoFileUploadArea">
                        <i class="fas fa-video"></i>
                        <p>点击或拖拽视频文件到此处上传</p>
                        <small>支持 MP4、MOV、AVI、WebM 格式，建议大小不超过 100MB</small>
                        <input type="file" 
                               id="videoFileInput" 
                               name="videoFileInput"
                               accept="video/mp4,video/mov,video/avi,video/webm" 
                               style="display: none;"
                               aria-label="选择本地视频文件">
                    </div>
                    <div class="upload-progress" id="videoUploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="videoProgressFill" style="width: 0%;"></div>
                        </div>
                        <span class="progress-text" id="videoProgressText">0%</span>
                    </div>
                </div>
                
                <div class="upload-form-group" id="videoSourceGroup" style="display: none;">
                    <label>视频来源</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" 
                                   id="videoSourceLink"
                                   name="videoSource" 
                                   value="link" 
                                   checked 
                                   onchange="toggleVideoSource('link')"
                                   aria-label="选择在线视频链接方式">
                            <span>在线视频链接</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" 
                                   id="videoSourceFile"
                                   name="videoSource" 
                                   value="file" 
                                   onchange="toggleVideoSource('file')"
                                   aria-label="选择本地视频文件方式">
                            <span>本地视频文件</span>
                        </label>
                    </div>
                </div>
                
                <div class="upload-preview" id="uploadPreview">
                    <h4>已选择的文件</h4>
                    <div id="fileList"></div>
                </div>
                
                <div class="upload-buttons">
                    <button class="upload-btn-secondary" 
                            onclick="closeUploadModal()"
                            aria-label="取消上传操作"
                            title="取消">取消</button>
                    <button class="upload-btn-primary" 
                            onclick="submitUpload()"
                            aria-label="确认上传文件"
                            title="确认上传">确认上传</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== 反爬虫和防截屏保护系统 ====================
        
        // 防止控制台调试
        (function() {
            'use strict';
            
            // 检测开发者工具
            let devtools = {
                open: false,
                orientation: null
            };
            
            setInterval(function() {
                if (window.outerHeight - window.innerHeight > 200 || window.outerWidth - window.innerWidth > 200) {
                    if (!devtools.open) {
                        devtools.open = true;
                        console.clear();
                        document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;z-index:99999;">⚠️ 检测到开发者工具，页面已被保护</div>';
                    }
                }
            }, 500);
            
            // 禁用常用快捷键
            document.addEventListener('keydown', function(e) {
                // 禁用F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U, Ctrl+S, Ctrl+A, Ctrl+P
                if (e.keyCode === 123 || 
                    (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                    (e.ctrlKey && (e.keyCode === 85 || e.keyCode === 83 || e.keyCode === 65 || e.keyCode === 80)) ||
                    e.keyCode === 44) { // Print Screen
                    e.preventDefault();
                    e.stopPropagation();
                    showSecurityAlert('检测到不当操作，页面受到保护！');
                    return false;
                }
            });
            
            // 禁用右键菜单
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showSecurityAlert('右键功能已被禁用！');
                return false;
            });
            
            // 禁用文本选择
            document.addEventListener('selectstart', function(e) {
                if (currentUser && currentUser.role === 'student') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // 禁用拖拽
            document.addEventListener('dragstart', function(e) {
                if (currentUser && currentUser.role === 'student') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // 检测页面可见性变化（可能的录屏检测）
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    console.log('页面被隐藏，可能存在录屏行为');
                }
            });
            
            // 防止通过iframe嵌入
            if (window.top !== window.self) {
                window.top.location = window.self.location;
            }
            
        })();
        
        // 安全警告函数
        function showSecurityAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #e74c3c;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                z-index: 99999;
                font-size: 14px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 3000);
        }
        
        // 动态水印生成 - 智能学习模式
        function createDynamicWatermark() {
            if (!currentUser || currentUser.role !== 'student') return;
            
            const watermark = document.getElementById('watermarkOverlay');
            const userName = currentUser.name || '学生用户';
            const timestamp = new Date().toLocaleString();
            
            // 检查当前是否在学习页面（视频或题库）
            const currentSection = document.querySelector('.content-section.active');
            const isLearningPage = currentSection && 
                (currentSection.id === 'video-section' || 
                 currentSection.id === 'exercise-section');
            
            if (isLearningPage) {
                // 学习模式：只显示角落水印，不干扰学习
                watermark.className = 'watermark-overlay learning-mode';
                watermark.innerHTML = `
                    <div style="
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        color: rgba(26, 58, 87, 0.15);
                        font-size: 12px;
                        font-weight: normal;
                        pointer-events: none;
                        user-select: none;
                        white-space: nowrap;
                        background: rgba(255, 255, 255, 0.8);
                        padding: 2px 6px;
                        border-radius: 3px;
                    ">
                        ${userName}
                    </div>
                `;
            } else {
                // 非学习模式：显示完整保护水印
                watermark.className = 'watermark-overlay protection-mode';
                let watermarkHTML = '';
                for (let i = 0; i < 12; i++) {
                    const top = Math.random() * 100;
                    const left = Math.random() * 100;
                    const rotation = Math.random() * 40 - 20;
                    
                    watermarkHTML += `
                        <div style="
                            position: absolute;
                            top: ${top}%;
                            left: ${left}%;
                            transform: rotate(${rotation}deg);
                            color: rgba(26, 58, 87, 0.04);
                            font-size: 12px;
                            font-weight: normal;
                            pointer-events: none;
                            user-select: none;
                            white-space: nowrap;
                        ">
                            ${userName}
                        </div>
                    `;
                }
                watermark.innerHTML = watermarkHTML;
            }
            
            // 定期更新水印
            setTimeout(createDynamicWatermark, 30000);
        }
        
        // 检测截屏API（实验性）
        function detectScreenCapture() {
            if ('mediaDevices' in navigator && 'getDisplayMedia' in navigator.mediaDevices) {
                // 监听屏幕共享API的使用
                const originalGetDisplayMedia = navigator.mediaDevices.getDisplayMedia;
                navigator.mediaDevices.getDisplayMedia = function() {
                    showSecurityAlert('检测到屏幕录制尝试！');
                    console.log('Screen capture detected!');
                    return Promise.reject(new Error('Screen capture blocked'));
                };
            }
            
            // 检测用户媒体设备访问
            if ('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices) {
                const originalGetUserMedia = navigator.mediaDevices.getUserMedia;
                navigator.mediaDevices.getUserMedia = function(constraints) {
                    if (constraints && constraints.video && currentUser && currentUser.role === 'student') {
                        showSecurityAlert('检测到摄像头访问请求！');
                        return Promise.reject(new Error('Camera access blocked for students'));
                    }
                    return originalGetUserMedia.call(this, constraints);
                };
            }
        }
        
        // 高级反调试功能
        function advancedAntiDebug() {
            // 检测调试器断点
            let startTime = performance.now();
            debugger;
            let endTime = performance.now();
            
            if (endTime - startTime > 100) {
                document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;z-index:99999;">🚫 检测到调试器，访问被拒绝</div>';
                return;
            }
            
            // 定期重复检测
            setTimeout(advancedAntiDebug, 1000);
        }
        
        // 检测自动化工具
        function detectAutomation() {
            // 检测常见的自动化工具
            if (window.navigator.webdriver || 
                window.callPhantom || 
                window._phantom || 
                window.phantom ||
                window.Buffer ||
                window.emit ||
                window.spawn) {
                showSecurityAlert('检测到自动化工具！');
                document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;z-index:99999;">🤖 检测到机器人访问</div>';
                return;
            }
            
            // 检测Selenium
            if (typeof window.document.$cdc_asdjflasutopfhvcZLmcfl_ !== 'undefined' ||
                typeof window.document.$chrome_asyncScriptInfo !== 'undefined') {
                showSecurityAlert('检测到Selenium！');
                return;
            }
        }
        
        // 防止页面被嵌入iframe
        function preventFraming() {
            if (window.top !== window.self) {
                window.top.location.replace(window.self.location.href);
            }
        }
        
        // 混淆控制台输出
        function obfuscateConsole() {
            const methods = ['log', 'debug', 'info', 'warn', 'error'];
            methods.forEach(method => {
                const original = console[method];
                console[method] = function() {
                    if (currentUser && currentUser.role === 'student') {
                        return; // 学生端不显示控制台信息
                    }
                    original.apply(console, arguments);
                };
            });
        }
        
        // 初始化安全保护功能
        function initSecurityProtection() {
            if (!currentUser) return;
            
            if (currentUser.role === 'student') {
                // 学生端特殊保护
                setTimeout(() => {
                    createDynamicWatermark();
                    
                    // 添加学生内容保护类
                    const mainContent = document.querySelector('.main-content');
                    if (mainContent) {
                        mainContent.classList.add('student-content');
                    }
                    
                    // 初始化媒体保护
                    initMediaProtection();
                    
                    // 添加页面失焦检测（可能的录屏行为）
                    let blurCount = 0;
                    window.addEventListener('blur', function() {
                        blurCount++;
                        if (blurCount > 3) {
                            showSecurityAlert('检测到异常操作，请专心学习！');
                        }
                    });
                    
                }, 500);
            }
        }
        
        // 更新GitHub连接状态
        function updateGitHubStatus(isOnline) {
            const statusElement = document.getElementById('githubStatus');
            if (!statusElement) return;
            
            if (isOnline) {
                statusElement.className = 'status-indicator online';
                statusElement.innerHTML = '<i class="fas fa-cloud"></i><span>云端同步</span>';
            } else {
                statusElement.className = 'status-indicator offline';
                statusElement.innerHTML = '<i class="fas fa-cloud-slash"></i><span>离线模式</span>';
            }
        }
        
        // 页面加载完成后初始化基础保护
        document.addEventListener('DOMContentLoaded', function() {
            preventFraming();
            detectScreenCapture();
            obfuscateConsole();
            detectAutomation();
            
            // 启动高级反调试（仅在生产环境）
            if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                setTimeout(advancedAntiDebug, 2000);
            }
            
            // 延迟加载GitHub数据，确保不影响登录
            setTimeout(() => {
                loadDataFromGitHub();
            }, 1000);
        });
        
        // ==================== 用户系统 ====================
        
        // ==================== GitHub后台存储系统 ====================
        
        // GitHub仓库配置 - 直接访问模式
        const GITHUB_CONFIG = {
            owner: 'lghui12138',
            repo: 'lghui12138.github.io',
            branch: 'main',
            baseUrl: 'https://raw.githubusercontent.com/lghui12138/lghui12138.github.io/main',
            dataPath: 'data/',
            videosPath: 'videos/',
            exercisesPath: 'exercises/'
        };
        
        // 简化的数据访问类 - 直接读取GitHub文件
        class SimpleGitHubAccess {
            constructor(config) {
                this.config = config;
            }
            
            // 直接从GitHub获取JSON文件
            async getJSONFile(path) {
                try {
                    console.log(`📥 获取文件: ${path}`);
                    const url = `${this.config.baseUrl}/${path}`;
                    const response = await fetch(url);
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log(`✅ 文件获取成功: ${path}`);
                        return data;
                    } else if (response.status === 404) {
                        console.log(`📄 文件不存在: ${path}`);
                        return null;
                    } else {
                        console.error(`❌ 获取失败: ${path} - ${response.status}`);
                        return null;
                    }
                } catch (error) {
                    console.error(`❌ 获取异常 ${path}:`, error.message);
                    return null;
                }
            }
            
            // 获取文件URL
            getFileUrl(path) {
                return `${this.config.baseUrl}/${path}`;
            }
        }
        
        // 数据存储状态
        let isDataLoading = false;
        let isDataSaving = false;
        
        // 简化的GitHub API存储类
        class GitHubStorage {
            constructor(config) {
                this.config = config;
                this.baseUrl = `${config.apiBase}/repos/${config.owner}/${config.repo}`;
            }
            
            // 检查token有效性
            async validateToken() {
                const token = this.config.token;
                if (!token || token === 'demo_token_please_configure') {
                    return false;
                }
                
                try {
                    const response = await fetch(`${this.config.apiBase}/user`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'FluidDynamics-Platform/1.0'
                        }
                    });
                    
                    if (response.ok) {
                        const userData = await response.json();
                        console.log('✅ GitHub连接成功:', userData.login);
                        return true;
                    } else {
                        console.error('❌ GitHub认证失败:', response.status, response.statusText);
                        return false;
                    }
                } catch (error) {
                    console.error('❌ GitHub连接错误:', error);
                    return false;
                }
            }
            
            // 获取文件内容
            async getFile(path) {
                const token = this.config.token;
                if (!token) {
                    console.log('⚠️ 没有GitHub Token，跳过文件获取');
                    return null;
                }
                
                try {
                    console.log(`📥 从GitHub获取文件: ${path}`);
                    const response = await fetch(`${this.baseUrl}/contents/${path}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'FluidDynamics-Platform/1.0'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const content = JSON.parse(atob(data.content));
                        console.log(`✅ 成功获取文件: ${path}`);
                        return content;
                    } else if (response.status === 404) {
                        console.log(`📄 文件不存在: ${path}`);
                        return null;
                    } else {
                        console.error(`❌ 获取文件失败: ${path} - ${response.status}`);
                        return null;
                    }
                } catch (error) {
                    console.error(`❌ 获取文件异常 ${path}:`, error.message);
                    return null;
                }
            }
            
            // 保存文件内容
            async saveFile(path, content, message = '更新数据') {
                const token = this.config.token;
                if (!token) {
                    console.log('⚠️ 没有GitHub Token，无法保存文件');
                    return false;
                }
                
                if (isDataSaving) {
                    console.log('⏳ 数据保存中，跳过重复请求');
                    return false;
                }
                
                isDataSaving = true;
                
                try {
                    console.log(`💾 开始保存文件: ${path}`);
                    
                    // 编码内容
                    const jsonString = JSON.stringify(content, null, 2);
                    const encodedContent = btoa(jsonString);
                    
                    // 获取现有文件的SHA
                    let sha = null;
                    try {
                        const existingResponse = await fetch(`${this.baseUrl}/contents/${path}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'User-Agent': 'FluidDynamics-Platform/1.0'
                            }
                        });
                        
                        if (existingResponse.ok) {
                            const existingData = await existingResponse.json();
                            sha = existingData.sha;
                            console.log(`📝 找到现有文件SHA: ${sha.substring(0, 8)}...`);
                        }
                    } catch (e) {
                        console.log('📝 文件不存在，将创建新文件');
                    }
                    
                    // 构建请求体
                    const requestBody = {
                        message: `${message} - ${new Date().toLocaleString('zh-CN')}`,
                        content: encodedContent
                    };
                    
                    if (sha) {
                        requestBody.sha = sha;
                    }
                    
                    // 发送保存请求
                    const response = await fetch(`${this.baseUrl}/contents/${path}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'User-Agent': 'FluidDynamics-Platform/1.0'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    if (response.ok) {
                        console.log(`✅ 文件保存成功: ${path}`);
                        return true;
                    } else {
                        const errorText = await response.text();
                        console.error(`❌ 保存失败: ${path} - ${response.status}`, errorText);
                        return false;
                    }
                    
                } catch (error) {
                    console.error(`❌ 保存文件异常 ${path}:`, error.message);
                    return false;
                } finally {
                    isDataSaving = false;
                }
            }
        }
        
        // 初始化GitHub存储（如果GitHubStorage不存在，使用简化版本）
        let githubStorage;
        try {
            githubStorage = new GitHubStorage(GITHUB_CONFIG);
        } catch (error) {
            console.log('使用简化GitHub访问');
            githubStorage = new SimpleGitHubAccess(GITHUB_CONFIG);
        }
        
        // 用户账号信息 - 将迁移到GitHub存储
        let accounts = {
            'liuguanghui6330156': { name: '刘光辉', role: 'teacher', password: 'Ll700306', color: 'teacher' },
            'student1': { name: '学生账号', role: 'student', password: '123456', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] },
            'niwenxuan': { name: '倪文轩', role: 'student', password: 'niwenxuan2025', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] },
            'hanwenxu': { name: '韩文旭', role: 'student', password: 'hanwenxu2025', color: 'student', progress: 0, grades: [], videoProgress: 0, questionProgress: 0, studyTime: 0, watchedVideos: [], completedExercises: [] }
        };
        
        // 视频和题库数据
        let videosData = [];
        let exercisesData = [];
        
        // 当前登录用户
        let currentUser = null;
        
        // ==================== 数据管理系统 ====================
        
        // 从GitHub加载所有数据
        async function loadDataFromGitHub() {
            if (isDataLoading) {
                console.log('⏳ 数据加载中，跳过重复请求');
                return;
            }
            
            isDataLoading = true;
            
            try {
                console.log('🔄 开始从GitHub加载数据...');
                
                // 检查是否有有效的GitHub配置
                if (!hasValidGitHubConfig()) {
                    console.log('⚠️ 没有有效的GitHub配置，使用本地数据');
                    updateGitHubStatus(false);
                    showMessage('请配置GitHub Token以启用云端同步', 'info');
                    return;
                }
                
                // 验证token
                const tokenValid = await githubStorage.validateToken();
                if (!tokenValid) {
                    console.warn('⚠️ GitHub Token验证失败');
                    updateGitHubStatus(false);
                    showMessage('GitHub Token无效，请重新配置', 'warning');
                    return;
                } else {
                    updateGitHubStatus(true);
                    showMessage('GitHub连接成功，正在加载数据...', 'info');
                }
                
                // 尝试加载数据（失败也不影响系统运行）
                try {
                    if (githubStorage && typeof githubStorage.getFile === 'function') {
                        const userData = await githubStorage.getFile('data/users.json');
                        if (userData && typeof userData === 'object' && Object.keys(userData).length > 0) {
                            // 合并用户数据，保留原有默认账号
                            accounts = { ...accounts, ...userData };
                            console.log('✅ 用户数据加载成功');
                        }
                    }
                } catch (e) {
                    console.log('📄 用户数据加载失败，使用默认数据:', e.message);
                }
                
                try {
                    const videoData = await githubStorage.getFile('data/videos.json');
                    if (videoData && Array.isArray(videoData)) {
                        videosData = videoData;
                        console.log('✅ 视频数据加载成功:', videosData.length + '个视频');
                        setTimeout(() => rebuildVideoList(), 200);
                    }
                } catch (e) {
                    console.log('📄 视频数据加载失败，使用默认数据');
                }
                
                try {
                    const exerciseData = await githubStorage.getFile('data/exercises.json');
                    if (exerciseData && Array.isArray(exerciseData)) {
                        exercisesData = exerciseData;
                        console.log('✅ 题库数据加载成功:', exercisesData.length + '个题目');
                        setTimeout(() => rebuildExerciseList(), 200);
                    }
                } catch (e) {
                    console.log('📄 题库数据加载失败，使用默认数据');
                }
                
                showMessage('数据加载完成！', 'success');
                console.log('🎉 GitHub数据加载流程完成');
                
            } catch (error) {
                console.error('❌ GitHub数据加载异常:', error.message);
                updateGitHubStatus(false);
                showMessage('连接GitHub失败，使用离线模式', 'warning');
            } finally {
                isDataLoading = false;
            }
        }
        
        // 保存用户数据到GitHub
        async function saveUsersToGitHub() {
            try {
                console.log('💾 准备保存用户数据...');
                const success = await githubStorage.saveFile('data/users.json', accounts, '更新用户数据');
                if (success) {
                    console.log('✅ 用户数据保存成功');
                    return true;
                } else {
                    console.error('❌ 用户数据保存失败');
                    return false;
                }
            } catch (error) {
                console.error('❌ 保存用户数据到GitHub失败:', error);
                return false;
            }
        }
        
        // 保存视频数据到GitHub
        async function saveVideosToGitHub() {
            try {
                console.log('💾 准备保存视频数据...', videosData.length + '个视频');
                
                // 清理视频数据，移除临时的Blob URL
                const cleanVideosData = videosData.map(video => {
                    const cleanVideo = { ...video };
                    // 如果是本地文件，不保存source（Blob URL）
                    if (cleanVideo.type === 'file' && cleanVideo.source && cleanVideo.source.startsWith('blob:')) {
                        delete cleanVideo.source;
                    }
                    return cleanVideo;
                });
                
                const success = await githubStorage.saveFile('data/videos.json', cleanVideosData, '更新视频数据');
                if (success) {
                    console.log('✅ 视频数据保存成功');
                    showMessage('📹 视频已保存到云端', 'success');
                    return true;
                } else {
                    console.error('❌ 视频数据保存失败');
                    showMessage('❌ 视频保存失败', 'error');
                    return false;
                }
            } catch (error) {
                console.error('❌ 保存视频数据到GitHub失败:', error);
                showMessage('❌ 视频保存失败', 'error');
                return false;
            }
        }
        
        // 保存题库数据到GitHub
        async function saveExercisesToGitHub() {
            try {
                console.log('💾 准备保存题库数据...', exercisesData.length + '个题目');
                
                // 清理题库数据，移除不需要的临时数据
                const cleanExercisesData = exercisesData.map(exercise => {
                    const cleanExercise = { ...exercise };
                    // 清理文件数据，只保留元信息
                    if (cleanExercise.files) {
                        cleanExercise.files = cleanExercise.files.map(file => ({
                            name: file.name,
                            size: file.size,
                            type: file.type
                        }));
                    }
                    return cleanExercise;
                });
                
                const success = await githubStorage.saveFile('data/exercises.json', cleanExercisesData, '更新题库数据');
                if (success) {
                    console.log('✅ 题库数据保存成功');
                    showMessage('📚 题库已保存到云端', 'success');
                    return true;
                } else {
                    console.error('❌ 题库数据保存失败');
                    showMessage('❌ 题库保存失败', 'error');
                    return false;
                }
            } catch (error) {
                console.error('❌ 保存题库数据到GitHub失败:', error);
                showMessage('❌ 题库保存失败', 'error');
                return false;
            }
        }
        
        // 重建视频列表
        function rebuildVideoList() {
            const videoGrid = document.querySelector('.video-grid');
            if (!videoGrid) return;
            
            // 清除已有的上传视频（保留原始的特色视频）
            const uploadedCards = videoGrid.querySelectorAll('[data-video-id]');
            uploadedCards.forEach(card => card.remove());
            
            // 重新创建视频卡片
            videosData.forEach(video => {
                recreateVideoCardFromData(video);
            });
        }
        
        // 从数据重建视频卡片
        function recreateVideoCardFromData(videoData) {
            const videoGrid = document.querySelector('.video-grid');
            if (!videoGrid) return;
            
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            videoCard.setAttribute('data-video-id', videoData.id);
            
            const sourceIcon = videoData.type === 'file' ? 'fas fa-file-video' : 'fas fa-link';
            const sourceText = videoData.type === 'file' ? '本地文件' : '在线链接';
            
            // 创建播放按钮
            const playButtonDiv = document.createElement('div');
            playButtonDiv.className = 'play-button';
            playButtonDiv.onclick = function() {
                if (videoData.type === 'file') {
                    // 本地文件需要重新选择
                    showReuploadDialog(videoData);
                } else {
                    // 在线视频直接播放
                    playCustomVideo(videoData.source, videoData.title, videoData.type);
                }
            };
            playButtonDiv.innerHTML = '<i class="fas fa-play"></i>';
            
            // 创建视频预览
            const videoPreviewDiv = document.createElement('div');
            videoPreviewDiv.className = 'video-preview';
            videoPreviewDiv.innerHTML = '<i class="fas fa-video"></i>';
            videoPreviewDiv.appendChild(playButtonDiv);
            
            // 创建视频信息
            const videoInfoDiv = document.createElement('div');
            videoInfoDiv.className = 'video-info';
            
            const uploadTime = videoData.uploadTime ? 
                new Date(videoData.uploadTime).toLocaleDateString() : '新上传';
            
            const statusText = videoData.type === 'file' ? 
                '<div style="color: #f39c12;"><i class="fas fa-exclamation-triangle"></i> 需要重新选择文件</div>' : 
                `<div><i class="${sourceIcon}"></i> ${sourceText}</div>`;
            
            videoInfoDiv.innerHTML = `
                <h3 class="video-title">${escapeHtml(videoData.title)}</h3>
                <p class="video-description">${escapeHtml(videoData.description)}</p>
                <div class="video-duration">
                    <div><i class="far fa-clock"></i> ${uploadTime}</div>
                    ${statusText}
                </div>
            `;
            
            // 组装视频卡片
            videoCard.appendChild(videoPreviewDiv);
            videoCard.appendChild(videoInfoDiv);
            
            // 插入到特色视频后面
            const featuredVideo = videoGrid.querySelector('.video-card.featured');
            if (featuredVideo) {
                featuredVideo.parentNode.insertBefore(videoCard, featuredVideo.nextSibling);
            } else {
                videoGrid.appendChild(videoCard);
            }
        }
        
        // 重建题库列表
        function rebuildExerciseList() {
            const exerciseGrid = document.querySelector('.exercise-grid');
            if (!exerciseGrid) return;
            
            // 清除已有的上传题目
            const uploadedCards = exerciseGrid.querySelectorAll('[data-exercise-id]');
            uploadedCards.forEach(card => card.remove());
            
            // 重新创建题目卡片
            exercisesData.forEach(exercise => {
                recreateExerciseCardFromData(exercise);
            });
        }
        
        // 从数据重建题目卡片
        function recreateExerciseCardFromData(exerciseData) {
            const exerciseGrid = document.querySelector('.exercise-grid');
            if (!exerciseGrid) return;
            
            const exerciseCard = document.createElement('div');
            exerciseCard.className = 'exercise-card';
            exerciseCard.setAttribute('data-exercise-id', exerciseData.id);
            
            const uploadTime = exerciseData.uploadTime ? 
                new Date(exerciseData.uploadTime).toLocaleDateString() : '新上传';
            
            exerciseCard.innerHTML = `
                <div class="exercise-title">${escapeHtml(exerciseData.title)}</div>
                <div class="exercise-meta">
                    <span><i class="fas fa-tag"></i> ${exerciseData.category || '未分类'}</span>
                    <span><i class="far fa-clock"></i> ${uploadTime}</span>
                </div>
                <div class="exercise-description">${escapeHtml(exerciseData.description)}</div>
                <div class="exercise-actions">
                    <button class="exercise-btn" onclick="startExercise('${exerciseData.id}')">
                        <i class="fas fa-play"></i> 开始练习
                    </button>
                </div>
            `;
            
            exerciseGrid.appendChild(exerciseCard);
        }
        
        // 分数线数据
        const scoreData = {
            years: [2020, 2021, 2022, 2023, 2024, 2025],
            reexamScores: [288, 313, 292, 294, 288, 274],    // 复试线
            nationalScores: [288, 280, 290, 279, 288, 274],  // 国家线
            applicants: [null, null, 110, 105, 120, 125],    // 报名人数
            admitted: [null, 29, 35, 27, 37, 35],            // 录取人数
            reexamCandidates: [null, 32, 43, 30, 37, 35],    // 复试人数
            reexamRatio: [null, 1.33, 1.3, 1.2, 1, 1]       // 复试比例
        };
        
        // 强制同步登录处理函数
        function handleLogin() {
            try {
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                const loginError = document.getElementById('loginError');
                
                console.log('🔐 开始登录流程');
                console.log('📝 输入信息:', { username: username, hasPassword: !!password, passwordLength: password.length });
                console.log('📊 当前accounts对象:', accounts);
                console.log('📋 可用账号列表:', Object.keys(accounts));
                
                // 隐藏之前的错误信息
                if (loginError) {
                    loginError.style.display = 'none';
                }
                
                // 验证输入
                if (!username || !password) {
                    console.log('❌ 输入验证失败');
                    showLoginError('请输入账号和密码');
                    return false;
                }
                
                // 查找账号
                const account = accounts[username];
                console.log('🔍 账号查找结果:', account);
                
                if (!account) {
                    console.log('❌ 账号不存在');
                    showLoginError('用户名不存在');
                    return false;
                }
                
                // 验证密码
                console.log('🔑 密码验证:', { 
                    input: password, 
                    stored: account.password, 
                    match: password === account.password 
                });
                
                if (account.password !== password) {
                    console.log('❌ 密码错误');
                    showLoginError('密码错误');
                    return false;
                }
                
                console.log('✅ 登录验证成功，执行登录');
                login(username);
                return true;
                
            } catch (error) {
                console.error('💥 登录过程出错:', error);
                showLoginError('登录过程出现错误');
                return false;
            }
        }

        // 修复所有表单辅助功能
        function fixFormAccessibility() {
            console.log('🔧 修复表单辅助功能');
            
            // 查找所有缺少标签的input元素
            const inputs = document.querySelectorAll('input');
            let fixedCount = 0;
            
            inputs.forEach((input, index) => {
                // 检查是否有aria-label或对应的label
                const hasAriaLabel = input.hasAttribute('aria-label');
                const hasAriaLabelledBy = input.hasAttribute('aria-labelledby');
                const hasLabel = input.id && document.querySelector(`label[for="${input.id}"]`);
                
                if (!hasAriaLabel && !hasAriaLabelledBy && !hasLabel) {
                    // 根据placeholder、name或type生成标签
                    let label = input.placeholder || 
                               input.name || 
                               input.type || 
                               `输入字段${index + 1}`;
                    
                    input.setAttribute('aria-label', label);
                    console.log(`🏷️ 为input添加标签: ${label}`);
                    fixedCount++;
                }
                
                // 确保所有input都有name属性
                if (!input.name && input.id) {
                    input.name = input.id;
                }
                
                // 为密码字段添加autocomplete
                if (input.type === 'password' && !input.autocomplete) {
                    input.autocomplete = 'current-password';
                }
                
                // 为用户名字段添加autocomplete
                if ((input.type === 'text' || input.type === 'email') && 
                    (input.name === 'username' || input.id === 'username') && 
                    !input.autocomplete) {
                    input.autocomplete = 'username';
                }
            });
            
            console.log(`✅ 修复了 ${fixedCount} 个表单元素的辅助功能`);
        }

        // 强制初始化登录系统
        function initializeLogin() {
            console.log('🚀 强制初始化登录系统');
            
            // 首先修复表单辅助功能
            fixFormAccessibility();
            
            // 检查accounts数据
            console.log('📊 账号数据检查:', {
                accountsExists: !!accounts,
                accountCount: Object.keys(accounts).length,
                teacherExists: !!accounts['liuguanghui6330156'],
                studentExists: !!accounts['student1']
            });
            
            // 查找DOM元素
            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            console.log('🔍 DOM元素检查:', {
                form: !!loginForm,
                button: !!loginBtn,
                username: !!usernameInput,
                password: !!passwordInput
            });
            
            // 如果元素不存在，等待后重试
            if (!loginForm || !loginBtn || !usernameInput || !passwordInput) {
                console.log('⏳ DOM元素未就绪，1秒后重试');
                setTimeout(initializeLogin, 1000);
                return;
            }
            
            // 清除之前的事件监听器
            const newForm = loginForm.cloneNode(true);
            loginForm.parentNode.replaceChild(newForm, loginForm);
            
            // 重新获取元素引用
            const form = document.getElementById('loginForm');
            const btn = document.getElementById('loginBtn');
            const username = document.getElementById('username');
            const password = document.getElementById('password');
            
            // 绑定事件
            if (form) {
                form.addEventListener('submit', function(e) {
                    console.log('🚀 表单提交事件触发');
                    e.preventDefault();
                    e.stopPropagation();
                    handleLogin();
                    return false;
                });
            }
            
            if (btn) {
                btn.addEventListener('click', function(e) {
                    console.log('🚀 按钮点击事件触发');
                    e.preventDefault();
                    e.stopPropagation();
                    handleLogin();
                    return false;
                });
            }
            
            if (password) {
                password.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        console.log('🚀 回车键登录');
                        e.preventDefault();
                        e.stopPropagation();
                        handleLogin();
                        return false;
                    }
                });
            }
            
            console.log('✅ 登录系统初始化完成');
        }

        // 多重初始化确保系统启动
        document.addEventListener('DOMContentLoaded', initializeLogin);
        window.addEventListener('load', initializeLogin);
        
                 // 备用初始化
         setTimeout(initializeLogin, 500);
         setTimeout(initializeLogin, 1500);
         setTimeout(initializeLogin, 3000);
        
        // 登录函数
        function login(username) {
            currentUser = username;
            const accountInfo = accounts[username];
            
            // 设置用户信息
            document.getElementById('usernameText').textContent = accountInfo.name;
            document.getElementById('userIcon').textContent = accountInfo.name.charAt(0);
            const roleBadge = document.getElementById('roleBadge');
            
            if (accountInfo.role === 'teacher') {
                roleBadge.textContent = '教师';
                roleBadge.className = 'role-badge teacher-badge';
                // 教师可以看到所有功能
                showTeacherFeatures();
            } else {
                roleBadge.textContent = '学生';
                roleBadge.className = 'role-badge student-badge';
                // 学生只能看到学习相关功能
                showStudentFeatures();
            }
            
            // 隐藏登录界面，显示平台界面
            document.getElementById('loginContainer').style.display = 'none';
            const platformContainer = document.getElementById('platformContainer');
            platformContainer.style.display = 'block';
            
            // 显示默认内容区域（复习规划）
            switchSection('review-section');
            
            // 初始化安全保护功能
            initSecurityProtection();
            
            // 加载已上传的视频
            setTimeout(() => {
                loadUploadedVideos();
            }, 500);
            
            // 创建分数线图表
            createScoreChart();
            
            // 添加过滤器点击事件
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateScoreChart(this.dataset.year);
                });
            });
            
            // 初始化成绩图表
            initGradeChart();
        }
        
        // 显示教师功能
        function showTeacherFeatures() {
            // 显示所有导航项
            document.querySelectorAll('nav a').forEach(link => {
                link.style.display = 'block';
            });
            
            // 显示上传功能
            const uploadSections = document.querySelectorAll('.upload-section');
            uploadSections.forEach(section => {
                section.style.display = 'flex';
            });
            
            // 显示教师成绩录入界面
            const gradeInputForm = document.getElementById('gradeInputForm');
            const studentGradeDisplay = document.getElementById('studentGradeDisplay');
            if (gradeInputForm) gradeInputForm.style.display = 'flex';
            if (studentGradeDisplay) studentGradeDisplay.style.display = 'none';
            
            // 设置教师模式标题
            const gradeSectionTitle = document.getElementById('gradeSectionTitle');
            if (gradeSectionTitle) {
                gradeSectionTitle.textContent = '成绩录入系统';
            }
        }
        
        // 显示学生功能
        function showStudentFeatures() {
            // 隐藏教师专用导航项
            const teacherNavItems = document.querySelectorAll('nav a[onclick*="grade-section"]');
            teacherNavItems.forEach(link => {
                link.style.display = 'none';
            });
            
            // 隐藏上传功能
            const uploadSections = document.querySelectorAll('.upload-section');
            uploadSections.forEach(section => {
                section.style.display = 'none';
            });
            
            // 显示学生成绩界面
            const gradeInputForm = document.getElementById('gradeInputForm');
            const studentGradeDisplay = document.getElementById('studentGradeDisplay');
            if (gradeInputForm) gradeInputForm.style.display = 'none';
            if (studentGradeDisplay) studentGradeDisplay.style.display = 'block';
            
            // 设置学生模式标题
            const gradeSectionTitle = document.getElementById('gradeSectionTitle');
            if (gradeSectionTitle) {
                gradeSectionTitle.textContent = '我的成绩';
            }
            
            // 更新学生进度显示
            updateStudentProgress();
            // 更新学生成绩显示
            updateStudentGradeDisplay();
        }
        
        // 更新学生进度显示
        function updateStudentProgress() {
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                // 更新题库进度
                const progressFill = document.querySelector('.progress-fill');
                const progressText = document.querySelector('.progress-text');
                const progressSpan = document.getElementById('studentProgressText');
                
                const progress = accountInfo.progress || 0;
                
                if (progressFill && progressText) {
                    progressFill.style.width = progress + '%';
                    progressText.textContent = progress + '%';
                }
                
                if (progressSpan) {
                    progressSpan.textContent = `已完成 ${progress}%`;
                }
                
                // 更新学习统计
                updateStudentStats(accountInfo);
            }
        }
        
        // 更新学生统计信息
        function updateStudentStats(accountInfo) {
            // 计算视频学习进度
            const videoProgress = accountInfo.videoProgress || 0;
            const videoText = document.querySelector('.stat-card:nth-child(1) p');
            if (videoText) {
                videoText.textContent = `${videoProgress}/7 课程`;
            }
            
            // 计算题目练习进度
            const questionProgress = accountInfo.questionProgress || 0;
            const questionText = document.querySelector('.stat-card:nth-child(2) p');
            if (questionText) {
                questionText.textContent = `${questionProgress}/37 题`;
            }
            
            // 计算平均成绩
            const grades = accountInfo.grades || [];
            const avgGradeText = document.querySelector('.stat-card:nth-child(3) p');
            if (avgGradeText) {
                if (grades.length > 0) {
                    const avgGrade = grades.reduce((sum, grade) => sum + grade, 0) / grades.length;
                    avgGradeText.textContent = `${avgGrade.toFixed(1)} 分`;
                } else {
                    avgGradeText.textContent = '-- 分';
                }
            }
            
            // 计算学习时长
            const studyTime = accountInfo.studyTime || 0;
            const timeText = document.querySelector('.stat-card:nth-child(4) p');
            if (timeText) {
                timeText.textContent = `${studyTime} 小时`;
            }
        }
        
        // 记录视频学习进度
        function recordVideoProgress(videoId) {
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                // 初始化视频学习记录
                if (!accountInfo.watchedVideos) {
                    accountInfo.watchedVideos = [];
                }
                
                // 检查是否已经看过这个视频
                if (!accountInfo.watchedVideos.includes(videoId)) {
                    accountInfo.watchedVideos.push(videoId);
                    accountInfo.videoProgress = accountInfo.watchedVideos.length;
                    
                    // 更新总体进度
                    const totalProgress = Math.round((accountInfo.videoProgress + accountInfo.questionProgress) / 2);
                    accountInfo.progress = Math.min(totalProgress, 100);
                    
                    // 更新显示
                    updateStudentProgress();
                    
                    // 显示学习进度提示
                    showMessage(`恭喜！您已完成 ${accountInfo.videoProgress}/7 个视频课程的学习`, 'success');
                }
            }
        }
        
        // 开始题目练习
        function startExercise(exerciseType, questionCount) {
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                // 初始化练习记录
                if (!accountInfo.completedExercises) {
                    accountInfo.completedExercises = [];
                }
                
                // 检查是否已经完成过这个练习
                if (!accountInfo.completedExercises.includes(exerciseType)) {
                    // 模拟练习完成
                    accountInfo.completedExercises.push(exerciseType);
                    accountInfo.questionProgress = accountInfo.completedExercises.length * 12; // 每个练习约12题
                    
                    // 更新总体进度
                    const totalProgress = Math.round((accountInfo.videoProgress + accountInfo.questionProgress) / 2);
                    accountInfo.progress = Math.min(totalProgress, 100);
                    
                    // 更新显示
                    updateStudentProgress();
                    
                    // 显示练习完成提示
                    showMessage(`恭喜！您已完成 ${exerciseType} 练习，共 ${questionCount} 题`, 'success');
                } else {
                    showMessage('您已经完成过这个练习了', 'info');
                }
            } else {
                showMessage('请先登录学生账号', 'warning');
            }
        }
        
        // 更新学生成绩显示
        function updateStudentGradeDisplay() {
            const accountInfo = accounts[currentUser];
            if (accountInfo && accountInfo.role === 'student') {
                const grades = accountInfo.grades || [];
                
                // 更新成绩统计
                const avgGradeElement = document.getElementById('studentAvgGrade');
                const maxGradeElement = document.getElementById('studentMaxGrade');
                const examCountElement = document.getElementById('studentExamCount');
                const gradeListElement = document.getElementById('studentGradeList');
                
                if (grades.length > 0) {
                    const avgGrade = grades.reduce((sum, grade) => sum + grade, 0) / grades.length;
                    const maxGrade = Math.max(...grades);
                    
                    if (avgGradeElement) avgGradeElement.textContent = avgGrade.toFixed(1);
                    if (maxGradeElement) maxGradeElement.textContent = maxGrade;
                    if (examCountElement) examCountElement.textContent = grades.length;
                    
                    // 生成成绩列表
                    if (gradeListElement) {
                        const gradeListHTML = grades.map((grade, index) => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e9ecef; margin-bottom: 10px;">
                                <span style="font-weight: 500;">第${index + 1}次考试</span>
                                <span style="font-weight: bold; color: var(--primary);">${grade} 分</span>
                            </div>
                        `).join('');
                        gradeListElement.innerHTML = gradeListHTML;
                    }
                } else {
                    if (avgGradeElement) avgGradeElement.textContent = '--';
                    if (maxGradeElement) maxGradeElement.textContent = '--';
                    if (examCountElement) examCountElement.textContent = '0';
                    if (gradeListElement) {
                        gradeListElement.innerHTML = '<p style="text-align: center; color: #6c757d; margin: 0;">暂无成绩记录</p>';
                    }
                }
            }
        }
        
        // 退出登录
        function logout() {
            // 清空表单
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            // 显示登录界面
            document.getElementById('loginContainer').style.display = 'flex';
            
            // 隐藏平台界面
            document.getElementById('platformContainer').style.display = 'none';
        }
        
        // 切换内容区域
        function switchSection(sectionId) {
            // 移除所有导航的active状态
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // 设置当前导航为active
            const currentLink = document.querySelector(`a[onclick="switchSection('${sectionId}')"]`);
            if (currentLink) {
                currentLink.classList.add('active');
            }
            
            // 隐藏所有内容区域
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // 显示选中的内容区域
            document.getElementById(sectionId).classList.add('active');
            
            // 根据页面类型调整保护级别
            adjustProtectionLevel(sectionId);
        }
        
        // 根据页面类型调整保护级别
        function adjustProtectionLevel(sectionId) {
            if (!currentUser || currentUser.role !== 'student') return;
            
            const mainContent = document.querySelector('.main-content');
            const isLearningPage = (sectionId === 'video-section' || sectionId === 'exercise-section');
            
            if (isLearningPage) {
                // 学习页面：减少干扰，优化体验
                if (mainContent) {
                    mainContent.classList.remove('student-content');
                    mainContent.classList.add('learning-content');
                }
                
                // 立即更新水印为学习模式
                createDynamicWatermark();
                
                console.log('切换到学习模式，减少视觉干扰');
            } else {
                // 非学习页面：恢复完整保护
                if (mainContent) {
                    mainContent.classList.remove('learning-content');
                    mainContent.classList.add('student-content', 'non-learning');
                }
                
                // 立即更新水印为保护模式
                createDynamicWatermark();
                
                console.log('切换到保护模式');
            }
        }
        
        // 打开视频模态框
        function openVideoModal(videoId) {
            const modal = document.getElementById('videoModal');
            const videoFrame = document.getElementById('videoFrame');
            const videoTips = document.querySelector('.video-tips');
            
            // 视频标题映射
            const videoTitles = {
                'BV16T421D7k4': '流体力学之美，太美了',
                'BV1GJ411x7h7': '流体力学基础原理',
                'BV1Yb4y1Y7Jp': '伯努利方程详解',
                'BV1XJ411L7Bd': '流体动力学与涡旋',
                'BV1QJ411Y7N8': 'NS方程解析',
                'BV1NJ411L7Bd': '流体力学工程应用',
                'BV1PJ411L7Bd': '边界层理论精讲',
                'BV1RJ411L7Bd': '物理海洋学基础'
            };
            
            if (videoId === 'custom') {
                // 自定义上传的视频
                const videoLink = document.getElementById('videoLink')?.value || '';
                if (videoLink.includes('bilibili.com')) {
                    // 提取B站视频ID
                    const bvidMatch = videoLink.match(/BV\w+/);
                    if (bvidMatch) {
                        videoFrame.src = `https://player.bilibili.com/player.html?bvid=${bvidMatch[0]}&autoplay=1&page=1&high_quality=1&danmaku=0&fullscreen=1&quality=120&volume=0.8`;
                    } else {
                        videoFrame.src = videoLink;
                    }
                } else {
                    videoFrame.src = videoLink;
                }
                document.getElementById('modalTitle').textContent = '流体力学教学视频';
            } else if (videoTitles[videoId]) {
                // B站视频
                videoFrame.src = `https://player.bilibili.com/player.html?bvid=${videoId}&autoplay=1&page=1&high_quality=1&danmaku=0&fullscreen=1&quality=120&volume=0.8`;
                document.getElementById('modalTitle').textContent = videoTitles[videoId];
                
                // 如果是学生，记录视频学习进度
                if (currentUser && accounts[currentUser] && accounts[currentUser].role === 'student') {
                    recordVideoProgress(videoId);
                }
            } else {
                // 示例视频
                videoFrame.src = '';
                document.getElementById('modalTitle').textContent = '流体力学教学视频';
            }
            
            modal.classList.add('active');
            
            // 显示提示信息
            setTimeout(() => {
                videoTips.style.display = 'block';
                setTimeout(() => {
                    videoTips.style.display = 'none';
                }, 5000);
            }, 2000);
        }
        
        // 关闭视频模态框
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const videoFrame = document.getElementById('videoFrame');
            const modalContent = document.querySelector('.modal-content');
            
            // 退出全屏模式
            modalContent.classList.remove('fullscreen');
            
            // 停止视频播放
            videoFrame.src = '';
            
            modal.classList.remove('active');
            
            // 恢复水印显示
            if (currentUser && currentUser.role === 'student') {
                setTimeout(() => {
                    createDynamicWatermark();
                }, 300);
            }
        }
        
        // 切换全屏模式
        function toggleFullscreen() {
            const modalContent = document.querySelector('.modal-content');
            const fullscreenBtn = document.querySelector('.fullscreen-btn i');
            
            if (modalContent.classList.contains('fullscreen')) {
                // 退出全屏
                modalContent.classList.remove('fullscreen');
                fullscreenBtn.className = 'fas fa-expand';
            } else {
                // 进入全屏
                modalContent.classList.add('fullscreen');
                fullscreenBtn.className = 'fas fa-compress';
            }
        }
        
        // 监听ESC键退出全屏
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modalContent = document.querySelector('.modal-content');
                if (modalContent.classList.contains('fullscreen')) {
                    toggleFullscreen();
                }
            }
        });
        
        // 创建分数线图表
        function createScoreChart(year = 'all') {
            const canvas = document.getElementById('scoreChart');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                
                // 过滤数据
                let displayYears = [...scoreData.years];
                let reexamScores = [...scoreData.reexamScores];
                let nationalScores = [...scoreData.nationalScores];
                let applicants = [...scoreData.applicants];
                
                if (year !== 'all') {
                    const index = scoreData.years.indexOf(parseInt(year));
                    if (index !== -1) {
                        displayYears = [scoreData.years[index]];
                        reexamScores = [scoreData.reexamScores[index]];
                        nationalScores = [scoreData.nationalScores[index]];
                        applicants = [scoreData.applicants[index]];
                    }
                }
                
                // 创建图表
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: displayYears,
                                        datasets: [
                    {
                        label: '复试线',
                        data: reexamScores,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#3498db',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        tension: 0.2,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: '国家线',
                        data: nationalScores,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#e74c3c',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        tension: 0.2,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: '报名人数',
                        data: applicants,
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#27ae60',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        tension: 0.2,
                        fill: false,
                        yAxisID: 'y1'
                    }
                ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                beginAtZero: false,
                                min: 260,
                                max: 320,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                title: {
                                    display: true,
                                    text: '分数'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: false,
                                min: 100,
                                max: 130,
                                grid: {
                                    drawOnChartArea: false,
                                },
                                title: {
                                    display: true,
                                    text: '报名人数'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: '年份'
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            }
        }
        
        // 更新分数线图表
        function updateScoreChart(year) {
            // 先销毁旧图表
            const canvas = document.getElementById('scoreChart');
            if (canvas) {
                const chart = Chart.getChart(canvas);
                if (chart) {
                    chart.destroy();
                }
            }
            createScoreChart(year);
        }
        
        // 初始化成绩图表
        function initGradeChart() {
            const ctx = document.getElementById('gradeChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['90-100分', '80-89分', '70-79分', '60-69分', '60分以下'],
                    datasets: [{
                        data: [15, 30, 25, 20, 10],
                        backgroundColor: [
                            '#27ae60',
                            '#2ecc71',
                            '#f1c40f',
                            '#e67e22',
                            '#e74c3c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // 添加成绩
        document.querySelector('.add-grade-btn').addEventListener('click', function() {
            const nameInput = document.querySelector('.grade-form input[type="text"]');
            const gradeInput = document.querySelector('.grade-form input[type="number"]');
            
            if (!nameInput.value || !gradeInput.value) {
                showAlert('请填写学生姓名和成绩');
                return;
            }
            
            const gradeList = document.querySelector('.grade-list');
            const newItem = document.createElement('div');
            newItem.className = 'grade-item';
            newItem.innerHTML = `
                <span>${nameInput.value}</span>
                <span>${gradeInput.value}</span>
            `;
            gradeList.appendChild(newItem);
            
            // 清空输入框
            nameInput.value = '';
            gradeInput.value = '';
        });
        
        // 移动端菜单切换
        function toggleMobileMenu() {
            const nav = document.getElementById('mainNav');
            nav.classList.toggle('active');
        }
        
        // 上传功能相关变量
        let currentUploadType = '';
        let selectedFiles = [];
        let selectedVideoFile = null;
        
        // 打开上传模态框
        function openUploadModal(type) {
            currentUploadType = type;
            const modal = document.getElementById('uploadModal');
            const title = document.getElementById('uploadModalTitle');
            const fileGroup = document.getElementById('fileUploadGroup');
            const videoLinkGroup = document.getElementById('videoLinkGroup');
            const videoFileGroup = document.getElementById('videoFileGroup');
            const videoSourceGroup = document.getElementById('videoSourceGroup');
            
            if (type === 'video') {
                title.textContent = '添加视频';
                fileGroup.style.display = 'none';
                videoSourceGroup.style.display = 'block';
                // 默认显示链接选项
                toggleVideoSource('link');
            } else {
                title.textContent = '上传题目';
                fileGroup.style.display = 'block';
                videoLinkGroup.style.display = 'none';
                videoFileGroup.style.display = 'none';
                videoSourceGroup.style.display = 'none';
            }
            
            modal.classList.add('active');
            initFileUpload();
            if (type === 'video') {
                initVideoFileUpload();
            }
        }
        
        // 关闭上传模态框
        function closeUploadModal() {
            const modal = document.getElementById('uploadModal');
            modal.classList.remove('active');
            
            // 清空表单
            document.getElementById('uploadTitle').value = '';
            document.getElementById('uploadDescription').value = '';
            document.getElementById('videoLink').value = '';
            document.getElementById('videoFileInput').value = '';
            selectedFiles = [];
            selectedVideoFile = null;
            updateFilePreview();
            hideVideoUploadProgress();
            
            // 重置视频来源选择
            const linkRadio = document.querySelector('input[name="videoSource"][value="link"]');
            if (linkRadio) linkRadio.checked = true;
        }
        
        // 初始化文件上传
        function initFileUpload() {
            const fileArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');
            
            // 点击上传区域
            fileArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            // 文件选择
            fileInput.addEventListener('change', handleFileSelect);
            
            // 拖拽上传
            fileArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileArea.classList.add('dragover');
            });
            
            fileArea.addEventListener('dragleave', () => {
                fileArea.classList.remove('dragover');
            });
            
            fileArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });
        }
        
        // 处理文件选择
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }
        
        // 处理文件
        function handleFiles(files) {
            const validFiles = files.filter(file => {
                const validTypes = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png'];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                return validTypes.includes(fileExtension) && file.size <= 50 * 1024 * 1024; // 50MB限制
            });
            
            selectedFiles = selectedFiles.concat(validFiles);
            updateFilePreview();
        }
        
        // 更新文件预览
        function updateFilePreview() {
            const preview = document.getElementById('uploadPreview');
            const fileList = document.getElementById('fileList');
            
            if (selectedFiles.length === 0) {
                preview.classList.remove('active');
                return;
            }
            
            preview.classList.add('active');
            fileList.innerHTML = '';
            
            selectedFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'upload-preview-item';
                item.innerHTML = `
                    <div class="file-info">
                        <i class="fas fa-file"></i>
                        <span>${file.name} (${formatFileSize(file.size)})</span>
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                fileList.appendChild(item);
            });
        }
        
        // 移除文件
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFilePreview();
        }
        
        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // 提交上传
        function submitUpload() {
            const title = document.getElementById('uploadTitle').value;
            const description = document.getElementById('uploadDescription').value;
            const category = document.getElementById('uploadCategory').value;
            
            if (!title.trim()) {
                showAlert('请输入标题');
                return;
            }
            
            if (currentUploadType === 'video') {
                const videoSource = document.querySelector('input[name="videoSource"]:checked').value;
                
                if (videoSource === 'link') {
                    const videoLink = document.getElementById('videoLink').value;
                    if (!videoLink.trim()) {
                        showAlert('请输入视频链接');
                        return;
                    }
                    // 创建在线视频数据对象
                    const videoData = {
                        id: 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        title: title,
                        description: description,
                        source: videoLink,
                        type: 'link',
                        category: category,
                        uploadTime: new Date().toISOString()
                    };
                    
                    // 添加到视频数据
                    videosData.push(videoData);
                    
                    // 保存到GitHub
                    saveVideosToGitHub();
                    
                    // 添加到页面显示
                    recreateVideoCardFromData(videoData);
                } else if (videoSource === 'file') {
                    if (!selectedVideoFile) {
                        showAlert('请选择要上传的视频文件');
                        return;
                    }
                    // 处理本地视频文件上传
                    uploadVideoFile(title, description, selectedVideoFile, category);
                    return; // 不立即关闭模态框，等待上传完成
                }
            } else {
                if (selectedFiles.length === 0) {
                    showAlert('请选择要上传的文件');
                    return;
                }
                // 创建题目数据对象
                const exerciseData = {
                    id: 'exercise_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    title: title,
                    description: description,
                    category: category,
                    files: selectedFiles.map(file => ({
                        name: file.name,
                        size: file.size,
                        type: file.type
                    })),
                    uploadTime: new Date().toISOString()
                };
                
                // 添加到题库数据
                exercisesData.push(exerciseData);
                
                // 保存到GitHub
                saveExercisesToGitHub();
                
                // 添加到页面显示
                recreateExerciseCardFromData(exerciseData);
            }
            
            closeUploadModal();
            showMessage('上传成功！');
        }
        
        // 存储上传的视频数据 - 持久化存储
        let uploadedVideos = [];
        
        // 从localStorage加载已上传的视频
        function loadUploadedVideos() {
            try {
                const saved = localStorage.getItem('uploadedVideos');
                if (saved) {
                    uploadedVideos = JSON.parse(saved);
                    console.log('加载已保存的视频:', uploadedVideos.length + '个');
                    
                    // 重新创建视频卡片
                    uploadedVideos.forEach(video => {
                        recreateVideoCard(video);
                    });
                }
            } catch (error) {
                console.error('加载视频数据失败:', error);
                uploadedVideos = [];
            }
        }
        
        // 保存视频数据到localStorage
        function saveUploadedVideos() {
            try {
                // 创建一个简化版本，不包含blob URL（因为blob URL无法序列化）
                const videosToSave = uploadedVideos.map(video => ({
                    id: video.id,
                    title: video.title,
                    description: video.description,
                    type: video.type,
                    category: video.category,
                    fileName: video.fileName,
                    fileSize: video.fileSize,
                    fileType: video.fileType,
                    uploadTime: video.uploadTime
                }));
                
                localStorage.setItem('uploadedVideos', JSON.stringify(videosToSave));
                console.log('视频数据已保存');
            } catch (error) {
                console.error('保存视频数据失败:', error);
            }
        }
        
        // 添加视频到列表
        function addVideoToList(title, description, linkOrFile, category, type = 'link') {
            const videoGrid = document.querySelector('.video-grid');
            if (!videoGrid) {
                console.error('Video grid not found');
                return;
            }
            
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            
            const sourceIcon = type === 'file' ? 'fas fa-file-video' : 'fas fa-link';
            const sourceText = type === 'file' ? '本地文件' : '在线链接';
            
            // 生成唯一ID
            const videoId = 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // 设置视频卡片ID
            videoCard.setAttribute('data-video-id', videoId);
            
            // 存储视频数据
            const videoData = {
                id: videoId,
                title: title,
                description: description,
                source: linkOrFile,
                type: type,
                category: category,
                uploadTime: new Date().toISOString()
            };
            
            // 如果是本地文件，存储文件信息
            if (type === 'file' && selectedVideoFile) {
                videoData.fileName = selectedVideoFile.name;
                videoData.fileSize = selectedVideoFile.size;
                videoData.fileType = selectedVideoFile.type;
                // 重新创建blob URL（因为原来的可能已失效）
                videoData.source = URL.createObjectURL(selectedVideoFile);
            }
            
            uploadedVideos.push(videoData);
            
            // 保存到localStorage
            saveUploadedVideos();
            
            // 创建播放按钮容器
            const playButtonDiv = document.createElement('div');
            playButtonDiv.className = 'play-button';
            playButtonDiv.onclick = function() {
                playCustomVideoById(videoId);
            };
            playButtonDiv.innerHTML = '<i class="fas fa-play"></i>';
            
            // 创建视频预览容器
            const videoPreviewDiv = document.createElement('div');
            videoPreviewDiv.className = 'video-preview';
            videoPreviewDiv.innerHTML = '<i class="fas fa-video"></i>';
            videoPreviewDiv.appendChild(playButtonDiv);
            
            // 创建视频信息容器
            const videoInfoDiv = document.createElement('div');
            videoInfoDiv.className = 'video-info';
            videoInfoDiv.innerHTML = `
                <h3 class="video-title">${escapeHtml(title)}</h3>
                <p class="video-description">${escapeHtml(description)}</p>
                <div class="video-duration">
                    <div><i class="far fa-clock"></i> 新上传</div>
                    <div><i class="${sourceIcon}"></i> ${sourceText}</div>
                </div>
            `;
            
            // 组装视频卡片
            videoCard.appendChild(videoPreviewDiv);
            videoCard.appendChild(videoInfoDiv);
            
            // 插入到特色视频后面
            const featuredVideo = videoGrid.querySelector('.video-card.featured');
            if (featuredVideo) {
                featuredVideo.parentNode.insertBefore(videoCard, featuredVideo.nextSibling);
            } else {
                videoGrid.appendChild(videoCard);
            }
            
            console.log('Video added to list:', { id: videoId, title, type, source: linkOrFile });
            
            // 重新初始化媒体保护
            if (currentUser && currentUser.role === 'student') {
                setTimeout(() => {
                    initMediaProtection();
                }, 100);
            }
        }
        
        // 初始化媒体保护
        function initMediaProtection() {
            if (!currentUser || currentUser.role !== 'student') return;
            
            // 对于视频元素，只禁用右键菜单，保留播放控件
            const videoElements = document.querySelectorAll('video');
            videoElements.forEach(element => {
                // 移除旧的事件监听器（如果有）
                element.removeEventListener('contextmenu', handleVideoContextMenu);
                // 添加新的事件监听器
                element.addEventListener('contextmenu', handleVideoContextMenu);
            });
            
            // 禁用图片和iframe的交互
            const mediaElements = document.querySelectorAll('img, iframe');
            mediaElements.forEach(element => {
                element.style.pointerEvents = 'none';
                element.removeEventListener('contextmenu', handleMediaContextMenu);
                element.addEventListener('contextmenu', handleMediaContextMenu);
            });
        }
        
        // 视频右键菜单处理
        function handleVideoContextMenu(e) {
            e.preventDefault();
            showSecurityAlert('视频内容受版权保护！');
            return false;
        }
        
        // 媒体右键菜单处理
        function handleMediaContextMenu(e) {
            e.preventDefault();
            showSecurityAlert('媒体内容受版权保护！');
            return false;
        }
        
        // HTML转义函数
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // 重新创建视频卡片（用于页面刷新后恢复）
        function recreateVideoCard(videoData) {
            const videoGrid = document.querySelector('.video-grid');
            if (!videoGrid) return;
            
            // 检查是否已经存在这个视频卡片
            const existingCard = document.querySelector(`[data-video-id="${videoData.id}"]`);
            if (existingCard) return;
            
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            videoCard.setAttribute('data-video-id', videoData.id);
            
            const sourceIcon = videoData.type === 'file' ? 'fas fa-file-video' : 'fas fa-link';
            const sourceText = videoData.type === 'file' ? '本地文件' : '在线链接';
            
            // 创建播放按钮容器
            const playButtonDiv = document.createElement('div');
            playButtonDiv.className = 'play-button';
            playButtonDiv.onclick = function() {
                playCustomVideoById(videoData.id);
            };
            playButtonDiv.innerHTML = '<i class="fas fa-play"></i>';
            
            // 创建视频预览容器
            const videoPreviewDiv = document.createElement('div');
            videoPreviewDiv.className = 'video-preview';
            videoPreviewDiv.innerHTML = '<i class="fas fa-video"></i>';
            videoPreviewDiv.appendChild(playButtonDiv);
            
            // 创建视频信息容器
            const videoInfoDiv = document.createElement('div');
            videoInfoDiv.className = 'video-info';
            
            // 格式化上传时间
            const uploadTime = videoData.uploadTime ? 
                new Date(videoData.uploadTime).toLocaleDateString() : '新上传';
            
            // 检查本地文件是否需要重新选择
            const needsReupload = videoData.type === 'file' && 
                (!videoData.source || !videoData.source.startsWith('blob:'));
            
            const statusText = needsReupload ? 
                '<div style="color: #f39c12;"><i class="fas fa-exclamation-triangle"></i> 需要重新选择文件</div>' : 
                `<div><i class="${sourceIcon}"></i> ${sourceText}</div>`;
            
            videoInfoDiv.innerHTML = `
                <h3 class="video-title">${escapeHtml(videoData.title)}</h3>
                <p class="video-description">${escapeHtml(videoData.description)}</p>
                <div class="video-duration">
                    <div><i class="far fa-clock"></i> ${uploadTime}</div>
                    ${statusText}
                </div>
            `;
            
            // 组装视频卡片
            videoCard.appendChild(videoPreviewDiv);
            videoCard.appendChild(videoInfoDiv);
            
            // 插入到特色视频后面
            const featuredVideo = videoGrid.querySelector('.video-card.featured');
            if (featuredVideo) {
                featuredVideo.parentNode.insertBefore(videoCard, featuredVideo.nextSibling);
            } else {
                videoGrid.appendChild(videoCard);
            }
            
            console.log('重新创建视频卡片:', videoData.title);
        }
        
        // 通过ID播放自定义视频
        function playCustomVideoById(videoId) {
            const videoData = uploadedVideos.find(v => v.id === videoId);
            if (videoData) {
                console.log('Playing video:', videoData);
                
                // 如果是本地文件且没有有效的source，提示重新上传
                if (videoData.type === 'file' && (!videoData.source || !videoData.source.startsWith('blob:'))) {
                    showReuploadDialog(videoData);
                    return;
                }
                
                playCustomVideo(videoData.source, videoData.title, videoData.type);
            } else {
                console.error('Video not found:', videoId);
                showSecurityAlert('视频数据未找到');
            }
        }
        
        // 添加题目到列表
        function addQuestionToList(title, description, files, category) {
            const exerciseGrid = document.querySelector('.exercise-grid');
            const exerciseCard = document.createElement('div');
            exerciseCard.className = 'exercise-card';
            exerciseCard.innerHTML = `
                <div class="exercise-title">${title}</div>
                <div class="exercise-meta">
                    <span><i class="far fa-file-alt"></i> ${files.length}个文件</span>
                    <span><i class="far fa-clock"></i> 新上传</span>
                </div>
                <button class="start-btn">开始练习</button>
            `;
            
            exerciseGrid.appendChild(exerciseCard);
        }
        
        // 点击导航链接时关闭移动端菜单
        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    document.getElementById('mainNav').classList.remove('active');
                }
            });
        });
        
        // 窗口大小改变时处理响应式
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                document.getElementById('mainNav').classList.remove('active');
            }
        });
        
        // 点击模态框外部关闭
        document.addEventListener('click', (e) => {
            const uploadModal = document.getElementById('uploadModal');
            const videoModal = document.getElementById('videoModal');
            
            if (e.target === uploadModal) {
                closeUploadModal();
            }
            if (e.target === videoModal) {
                closeVideoModal();
            }
        });
        
        // 键盘事件处理
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeUploadModal();
                closeVideoModal();
            }
        });
        
        // 触摸设备优化
        if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');
        }
        
        // 显示美化的提示消息
        function showMessage(message, type = 'success') {
            // 移除现有的消息
            const existingMessage = document.querySelector('.message-toast');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // 图标映射
            const iconMap = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            // 创建新的消息元素
            const messageElement = document.createElement('div');
            messageElement.className = `message-toast ${type}`;
            messageElement.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas ${iconMap[type] || 'fa-info-circle'}"></i>
                    <span style="flex: 1;">${message}</span>
                    ${type === 'info' ? '<div class="loading-spinner"></div>' : ''}
                </div>
            `;
            
            // 添加到页面
            document.body.appendChild(messageElement);
            
            // 显示动画
            setTimeout(() => {
                messageElement.classList.add('show');
            }, 100);
            
            // 自动隐藏（info类型显示更久）
            const hideDelay = type === 'info' ? 5000 : 3000;
            setTimeout(() => {
                messageElement.classList.remove('show');
                setTimeout(() => {
                    if (messageElement.parentNode) {
                        messageElement.parentNode.removeChild(messageElement);
                    }
                }, 300);
            }, hideDelay);
        }
        
        // 切换视频来源
        function toggleVideoSource(source) {
            const videoLinkGroup = document.getElementById('videoLinkGroup');
            const videoFileGroup = document.getElementById('videoFileGroup');
            
            if (source === 'link') {
                videoLinkGroup.style.display = 'block';
                videoFileGroup.style.display = 'none';
            } else if (source === 'file') {
                videoLinkGroup.style.display = 'none';
                videoFileGroup.style.display = 'block';
            }
        }
        
        // 初始化视频文件上传
        function initVideoFileUpload() {
            const videoFileArea = document.getElementById('videoFileUploadArea');
            const videoFileInput = document.getElementById('videoFileInput');
            
            // 点击上传区域
            videoFileArea.addEventListener('click', function() {
                videoFileInput.click();
            });
            
            // 文件选择事件
            videoFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    selectedVideoFile = file;
                    updateVideoFilePreview(file);
                }
            });
            
            // 拖拽上传
            videoFileArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                videoFileArea.classList.add('dragover');
            });
            
            videoFileArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                videoFileArea.classList.remove('dragover');
            });
            
            videoFileArea.addEventListener('drop', function(e) {
                e.preventDefault();
                videoFileArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('video/')) {
                        selectedVideoFile = file;
                        videoFileInput.files = files;
                        updateVideoFilePreview(file);
                    } else {
                        showAlert('请选择视频文件');
                    }
                }
            });
        }
        
        // 更新视频文件预览
        function updateVideoFilePreview(file) {
            const videoFileArea = document.getElementById('videoFileUploadArea');
            const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
            
            videoFileArea.innerHTML = `
                <i class="fas fa-video" style="color: var(--success);"></i>
                <p><strong>${file.name}</strong></p>
                <small>大小: ${sizeInMB} MB | 类型: ${file.type}</small>
                <div style="margin-top: 10px;">
                    <button type="button" onclick="clearVideoFile()" style="background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                        <i class="fas fa-times"></i> 重新选择
                    </button>
                </div>
            `;
        }
        
        // 清除选择的视频文件
        function clearVideoFile() {
            selectedVideoFile = null;
            document.getElementById('videoFileInput').value = '';
            const videoFileArea = document.getElementById('videoFileUploadArea');
            videoFileArea.innerHTML = `
                <i class="fas fa-video"></i>
                <p>点击或拖拽视频文件到此处上传</p>
                <small>支持 MP4、MOV、AVI、WebM 格式，建议大小不超过 100MB</small>
            `;
        }
        
        // 上传视频文件
        function uploadVideoFile(title, description, file, category) {
            const progressContainer = document.getElementById('videoUploadProgress');
            const progressFill = document.getElementById('videoProgressFill');
            const progressText = document.getElementById('videoProgressText');
            
            // 显示进度条
            progressContainer.style.display = 'block';
            
            // 模拟上传进度
            let progress = 0;
            const uploadInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 95) progress = 95;
                
                progressFill.style.width = progress + '%';
                progressText.textContent = Math.round(progress) + '%';
            }, 200);
            
            // 模拟上传完成
            setTimeout(() => {
                clearInterval(uploadInterval);
                progressFill.style.width = '100%';
                progressText.textContent = '100%';
                
                // 创建视频数据对象
                const videoData = {
                    id: 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    title: title,
                    description: description,
                    type: 'file',
                    category: category,
                    fileName: file.name,
                    fileSize: file.size,
                    fileType: file.type,
                    uploadTime: new Date().toISOString()
                };
                
                // 添加到视频数据
                videosData.push(videoData);
                
                // 保存到GitHub
                saveVideosToGitHub();
                
                // 添加到页面显示
                recreateVideoCardFromData(videoData);
                
                setTimeout(() => {
                    closeUploadModal();
                    showMessage('视频上传成功！请查看视频课程页面');
                    
                    // 自动切换到视频课程页面
                    setTimeout(() => {
                        switchSection('video-section');
                    }, 1000);
                }, 500);
            }, 2000 + Math.random() * 2000); // 2-4秒模拟上传时间
        }
        
        // 隐藏视频上传进度
        function hideVideoUploadProgress() {
            const progressContainer = document.getElementById('videoUploadProgress');
            const progressFill = document.getElementById('videoProgressFill');
            const progressText = document.getElementById('videoProgressText');
            
            progressContainer.style.display = 'none';
            progressFill.style.width = '0%';
            progressText.textContent = '0%';
        }
        
        // 智能视频播放器 - 根据视频类型自动选择最佳播放方式
        function playCustomVideo(source, title, type) {
            const modal = document.getElementById('videoModal');
            const modalTitle = document.getElementById('modalTitle');
            const videoContainer = modal.querySelector('.video-container');
            
            if (!modal || !modalTitle || !videoContainer) {
                console.error('Video modal elements not found');
                showSecurityAlert('视频播放器初始化失败');
                return;
            }
            
            modalTitle.textContent = title;
            console.log('Playing video:', { source, title, type });
            
            // 清除之前的内容
            videoContainer.innerHTML = '';
            
            if (type === 'file') {
                // 本地视频文件 - 完整功能播放器
                createAdvancedVideoPlayer(videoContainer, source, title);
            } else {
                // 在线视频链接 - 智能识别
                if (source.includes('bilibili.com') || source.includes('b23.tv')) {
                    createBilibiliPlayer(videoContainer, source, title);
                } else if (source.includes('youtube.com') || source.includes('youtu.be')) {
                    createYouTubePlayer(videoContainer, source, title);
                } else if (isDirectVideoUrl(source)) {
                    // 直接的视频文件链接
                    createAdvancedVideoPlayer(videoContainer, source, title);
                } else {
                    // 通用iframe处理
                    createGenericPlayer(videoContainer, source, title);
                }
            }
            
            modal.classList.add('active');
            
            // 应用媒体保护
            setTimeout(() => {
                initMediaProtection();
            }, 100);
        }
        
        // 创建高级视频播放器（支持倍速和全屏）
        function createAdvancedVideoPlayer(container, source, title) {
            container.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%;">
                    <video id="customVideoPlayer" controls 
                           style="width: 100%; height: 100%; border-radius: 8px;" 
                           preload="metadata"
                           crossorigin="anonymous">
                        <source src="${source}" type="video/mp4">
                        <source src="${source}" type="video/webm">
                        <source src="${source}" type="video/ogg">
                        您的浏览器不支持视频播放。
                    </video>
                    
                    <!-- 增强控制栏 -->
                    <div id="customControls" style="
                        position: absolute;
                        bottom: 15px;
                        right: 15px;
                        background: rgba(0,0,0,0.9);
                        padding: 12px 16px;
                        border-radius: 8px;
                        display: flex;
                        gap: 15px;
                        align-items: center;
                        color: white;
                        font-size: 13px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                        backdrop-filter: blur(5px);
                    ">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-tachometer-alt"></i>
                            <label>倍速:</label>
                            <select id="playbackRate" style="
                                background: #333; 
                                color: white; 
                                border: 1px solid #555; 
                                padding: 4px 8px; 
                                border-radius: 4px;
                                font-size: 12px;
                            ">
                                <option value="0.5">0.5x</option>
                                <option value="0.75">0.75x</option>
                                <option value="1" selected>1.0x</option>
                                <option value="1.25">1.25x</option>
                                <option value="1.5">1.5x</option>
                                <option value="2">2.0x</option>
                                <option value="3">3.0x</option>
                                <option value="4">4.0x</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-expand"></i>
                            <button id="fullscreenBtn" style="
                                background: #007bff; 
                                color: white; 
                                border: none; 
                                padding: 6px 12px; 
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 12px;
                            ">全屏</button>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-cog"></i>
                            <label>清晰度:</label>
                            <select id="videoQuality" style="
                                background: #333; 
                                color: white; 
                                border: 1px solid #555; 
                                padding: 4px 8px; 
                                border-radius: 4px;
                                font-size: 12px;
                            ">
                                <option value="auto" selected>自动</option>
                                <option value="1080p">1080P</option>
                                <option value="720p">720P</option>
                                <option value="480p">480P</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 播放提示 -->
                    <div id="playbackHint" style="
                        position: absolute;
                        top: 20px;
                        left: 20px;
                        background: rgba(0,0,0,0.7);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        display: none;
                    ">
                        <i class="fas fa-info-circle"></i> 
                        双击全屏 | 空格暂停 | F键切换全屏
                    </div>
                </div>
            `;
            
            // 初始化高级播放器
            initAdvancedVideoPlayer();
        }
        
        // 创建B站播放器
        function createBilibiliPlayer(container, source, title) {
            const bvid = extractBilibiliId(source);
            container.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%;">
                    <iframe id="bilibiliPlayer" 
                            src="//player.bilibili.com/player.html?bvid=${bvid}&page=1&autoplay=0&high_quality=1" 
                            scrolling="no" border="0" frameborder="no" framespacing="0" 
                            allowfullscreen="true" 
                            style="width: 100%; height: 100%; border-radius: 8px;">
                    </iframe>
                    
                    <!-- B站播放器提示 -->
                    <div style="
                        position: absolute;
                        top: 15px;
                        right: 15px;
                        background: rgba(0,188,212,0.9);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    ">
                        <i class="fab fa-bilibili"></i>
                        <span>B站视频 - 倍速和全屏请在播放器内操作</span>
                    </div>
                </div>
            `;
        }
        
        // 创建YouTube播放器
        function createYouTubePlayer(container, source, title) {
            const videoId = extractYouTubeId(source);
            container.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%;">
                    <iframe id="youtubePlayer"
                            src="https://www.youtube.com/embed/${videoId}?enablejsapi=1&controls=1&modestbranding=1" 
                            frameborder="0" 
                            allowfullscreen 
                            style="width: 100%; height: 100%; border-radius: 8px;">
                    </iframe>
                    
                    <!-- YouTube播放器提示 -->
                    <div style="
                        position: absolute;
                        top: 15px;
                        right: 15px;
                        background: rgba(255,0,0,0.9);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    ">
                        <i class="fab fa-youtube"></i>
                        <span>YouTube视频 - 倍速和全屏请在播放器内操作</span>
                    </div>
                </div>
            `;
        }
        
        // 创建通用播放器
        function createGenericPlayer(container, source, title) {
            container.innerHTML = `
                <div style="position: relative; width: 100%; height: 100%;">
                    <iframe src="${source}" 
                            frameborder="0" 
                            allowfullscreen 
                            style="width: 100%; height: 100%; border-radius: 8px;">
                    </iframe>
                    
                    <!-- 通用播放器提示 -->
                    <div style="
                        position: absolute;
                        top: 15px;
                        right: 15px;
                        background: rgba(108,117,125,0.9);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    ">
                        <i class="fas fa-play-circle"></i>
                        <span>外部视频 - 功能由源站提供</span>
                    </div>
                </div>
            `;
        }
        
        // 判断是否为直接视频文件URL
        function isDirectVideoUrl(url) {
            const videoExtensions = ['.mp4', '.webm', '.ogg', '.avi', '.mov', '.wmv', '.flv', '.m4v'];
            const urlLower = url.toLowerCase();
            return videoExtensions.some(ext => urlLower.includes(ext)) || 
                   urlLower.includes('video') || 
                   urlLower.includes('.m3u8'); // HLS流
        }
                            您的浏览器不支持视频播放。
                        </video>
                    `;
                }
            }
            
            modal.classList.add('active');
            
            // 播放视频时临时隐藏水印，提供最佳观看体验
            if (currentUser && currentUser.role === 'student') {
                const watermark = document.getElementById('watermarkOverlay');
                if (watermark) {
                    watermark.style.opacity = '0';
                }
            }
        }
        
        // 提取B站视频ID
        function extractBilibiliId(url) {
            const match = url.match(/(?:bilibili\.com\/video\/|b23\.tv\/)([A-Za-z0-9]+)/);
            return match ? match[1] : '';
        }
        
        // 提取YouTube视频ID
        function extractYouTubeId(url) {
            const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_-]+)/);
            return match ? match[1] : '';
        }
        
        // 显示重新上传对话框
        function showReuploadDialog(videoData) {
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10001;
            `;
            
            dialog.innerHTML = `
                <div style="
                    background: white;
                    padding: 30px;
                    border-radius: 12px;
                    max-width: 500px;
                    text-align: center;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                ">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">
                        <i class="fas fa-video"></i> 视频文件需要重新选择
                    </h3>
                    <p style="margin-bottom: 20px; color: var(--text);">
                        视频"${escapeHtml(videoData.title)}"需要重新选择文件才能播放
                        <br><small>原文件：${videoData.fileName || '未知'}</small>
                    </p>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="selectVideoFile('${videoData.id}')" style="
                            background: var(--primary);
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                        ">
                            <i class="fas fa-upload"></i> 重新选择文件
                        </button>
                        <button onclick="closeReuploadDialog()" style="
                            background: #ccc;
                            color: #666;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                        ">
                            取消
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialog);
            window.currentReuploadDialog = dialog;
        }
        
        // 关闭重新上传对话框
        function closeReuploadDialog() {
            if (window.currentReuploadDialog) {
                document.body.removeChild(window.currentReuploadDialog);
                window.currentReuploadDialog = null;
            }
        }
        
        // 选择视频文件重新上传
        function selectVideoFile(videoId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'video/mp4,video/mov,video/avi,video/webm';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // 更新视频数据
                    const videoIndex = uploadedVideos.findIndex(v => v.id === videoId);
                    if (videoIndex !== -1) {
                        const newBlobUrl = URL.createObjectURL(file);
                        uploadedVideos[videoIndex].source = newBlobUrl;
                        uploadedVideos[videoIndex].fileName = file.name;
                        uploadedVideos[videoIndex].fileSize = file.size;
                        uploadedVideos[videoIndex].fileType = file.type;
                        
                        // 保存更新
                        saveUploadedVideos();
                        
                        // 播放视频
                        playCustomVideo(newBlobUrl, uploadedVideos[videoIndex].title, 'file');
                        
                        showMessage('文件已更新，正在播放...');
                    }
                }
                closeReuploadDialog();
            };
            
            input.click();
        }
        
        // 初始化高级视频播放器
        function initAdvancedVideoPlayer() {
            const video = document.getElementById('customVideoPlayer');
            const playbackRateSelect = document.getElementById('playbackRate');
            const qualitySelect = document.getElementById('videoQuality');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const customControls = document.getElementById('customControls');
            const playbackHint = document.getElementById('playbackHint');
            
            if (!video) {
                console.error('Video element not found');
                return;
            }
            
            // 学生端特殊保护 - 允许全屏但禁用下载
            if (currentUser && currentUser.role === 'student') {
                // 禁用右键菜单但保留播放控件
                video.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    showSecurityAlert('视频内容受版权保护！');
                    return false;
                });
                
                // 只禁用下载和画中画，允许全屏
                video.controlsList = "nodownload noremoteplayback";
                
                // 监控录屏尝试
                video.addEventListener('enterpictureinpicture', function(e) {
                    e.preventDefault();
                    showSecurityAlert('禁止画中画模式！');
                    return false;
                });
            } else {
                // 教师端可以使用所有功能
                video.controlsList = "";
            }
            
            // 倍速控制 - 增强版
            if (playbackRateSelect) {
                playbackRateSelect.addEventListener('change', function() {
                    const rate = parseFloat(this.value);
                    video.playbackRate = rate;
                    console.log('播放速度设置为:', rate + 'x');
                    
                    // 显示倍速变化提示
                    showSpeedChangeNotification(rate);
                });
                
                // 确保初始倍速为1x
                video.playbackRate = 1.0;
                playbackRateSelect.value = '1';
            }
            
            // 全屏按钮控制
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        video.requestFullscreen().then(() => {
                            fullscreenBtn.textContent = '退出';
                            fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> 退出';
                        }).catch(err => {
                            console.log('全屏失败:', err);
                            showMessage('全屏功能不可用', 'warning');
                        });
                    } else {
                        document.exitFullscreen().then(() => {
                            fullscreenBtn.textContent = '全屏';
                            fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> 全屏';
                        });
                    }
                });
            }
            
            // 清晰度控制（模拟）
            qualitySelect.addEventListener('change', function() {
                console.log('清晰度设置为:', this.value);
                // 这里可以根据需要切换不同清晰度的视频源
            });
            
            // 视频加载事件
            video.addEventListener('loadstart', function() {
                console.log('视频开始加载');
                // 显示播放提示
                if (playbackHint) {
                    playbackHint.style.display = 'block';
                    setTimeout(() => {
                        playbackHint.style.display = 'none';
                    }, 3000);
                }
            });
            
            video.addEventListener('loadeddata', function() {
                console.log('视频数据加载完成');
                // 显示自定义控制栏
                if (customControls) {
                    customControls.style.display = 'flex';
                }
            });
            
            video.addEventListener('error', function(e) {
                console.error('视频加载错误:', e);
                showSecurityAlert('视频加载失败，请检查文件格式');
            });
            
            // 播放状态监控
            video.addEventListener('play', function() {
                console.log('视频开始播放');
                // 学生端播放时的特殊处理
                if (currentUser && currentUser.role === 'student') {
                    // 记录学习进度
                    recordStudyProgress('video', video.src);
                }
            });
            
            video.addEventListener('pause', function() {
                console.log('视频暂停');
            });
            
            // 控制栏自动隐藏
            let controlsTimeout;
            const showControls = () => {
                customControls.style.opacity = '1';
                clearTimeout(controlsTimeout);
                controlsTimeout = setTimeout(() => {
                    if (!video.paused) {
                        customControls.style.opacity = '0.7';
                    }
                }, 3000);
            };
            
            video.addEventListener('mousemove', showControls);
            video.addEventListener('click', showControls);
            
            // 初始显示控制栏
            showControls();
            
            // 添加全屏功能增强
            addFullscreenEnhancements(video);
            
            // 添加键盘快捷键支持
            addKeyboardShortcuts(video, playbackRateSelect);
        }
        
        // 显示倍速变化提示
        function showSpeedChangeNotification(rate) {
            // 移除现有提示
            const existingNotification = document.querySelector('.speed-notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // 创建新提示
            const notification = document.createElement('div');
            notification.className = 'speed-notification';
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                z-index: 10000;
                pointer-events: none;
                animation: speedNotificationFade 1.5s ease-out forwards;
            `;
            notification.textContent = `${rate}x`;
            
            // 添加CSS动画
            if (!document.querySelector('#speedNotificationStyle')) {
                const style = document.createElement('style');
                style.id = 'speedNotificationStyle';
                style.textContent = `
                    @keyframes speedNotificationFade {
                        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                        20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                        80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(notification);
            
            // 自动移除
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 1500);
        }
        
        // 添加全屏功能增强
        function addFullscreenEnhancements(video) {
            // 双击全屏
            video.addEventListener('dblclick', function() {
                if (!document.fullscreenElement) {
                    video.requestFullscreen().catch(err => {
                        console.log('全屏失败:', err);
                        showMessage('全屏功能不可用', 'warning');
                    });
                } else {
                    document.exitFullscreen();
                }
            });
            
            // 全屏状态变化监听
            document.addEventListener('fullscreenchange', function() {
                const customControls = document.getElementById('customControls');
                const fullscreenBtn = document.getElementById('fullscreenBtn');
                
                if (document.fullscreenElement) {
                    // 全屏模式
                    if (customControls) {
                        customControls.style.bottom = '30px';
                        customControls.style.right = '30px';
                        customControls.style.background = 'rgba(0,0,0,0.95)';
                        customControls.style.fontSize = '14px';
                    }
                    if (fullscreenBtn) {
                        fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> 退出';
                    }
                } else {
                    // 退出全屏
                    if (customControls) {
                        customControls.style.bottom = '15px';
                        customControls.style.right = '15px';
                        customControls.style.background = 'rgba(0,0,0,0.9)';
                        customControls.style.fontSize = '13px';
                    }
                    if (fullscreenBtn) {
                        fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> 全屏';
                    }
                }
            });
        }
        
        // 添加键盘快捷键支持
        function addKeyboardShortcuts(video, playbackRateSelect) {
            video.addEventListener('keydown', function(e) {
                // 防止在学生端使用某些快捷键
                if (currentUser && currentUser.role === 'student') {
                    // 学生端只允许基本的播放控制
                    switch(e.key) {
                        case ' ': // 空格键暂停/播放
                            e.preventDefault();
                            if (video.paused) {
                                video.play();
                            } else {
                                video.pause();
                            }
                            break;
                        case 'f':
                        case 'F': // F键全屏
                            e.preventDefault();
                            if (!document.fullscreenElement) {
                                video.requestFullscreen();
                            } else {
                                document.exitFullscreen();
                            }
                            break;
                    }
                } else {
                    // 教师端完整快捷键支持
                    switch(e.key) {
                        case ' ': // 空格键暂停/播放
                            e.preventDefault();
                            if (video.paused) {
                                video.play();
                            } else {
                                video.pause();
                            }
                            break;
                        case 'f':
                        case 'F': // F键全屏
                            e.preventDefault();
                            if (!document.fullscreenElement) {
                                video.requestFullscreen();
                            } else {
                                document.exitFullscreen();
                            }
                            break;
                        case 'ArrowLeft': // 左箭头后退10秒
                            e.preventDefault();
                            video.currentTime = Math.max(0, video.currentTime - 10);
                            break;
                        case 'ArrowRight': // 右箭头前进10秒
                            e.preventDefault();
                            video.currentTime = Math.min(video.duration, video.currentTime + 10);
                            break;
                        case 'ArrowUp': // 上箭头提高音量
                            e.preventDefault();
                            video.volume = Math.min(1, video.volume + 0.1);
                            break;
                        case 'ArrowDown': // 下箭头降低音量
                            e.preventDefault();
                            video.volume = Math.max(0, video.volume - 0.1);
                            break;
                    }
                }
            });
            
            // 确保视频元素可以接收键盘事件
            video.setAttribute('tabindex', '0');
        }
        
        // 记录学习进度
        function recordStudyProgress(type, content) {
            if (!currentUser || currentUser.role !== 'student') return;
            
            const username = Object.keys(accounts).find(key => accounts[key] === currentUser);
            if (username && accounts[username]) {
                if (type === 'video') {
                    if (!accounts[username].watchedVideos) {
                        accounts[username].watchedVideos = [];
                    }
                    if (!accounts[username].watchedVideos.includes(content)) {
                        accounts[username].watchedVideos.push(content);
                        accounts[username].videoProgress = accounts[username].watchedVideos.length;
                        
                        // 保存到GitHub
                        saveUsersToGitHub();
                        console.log('视频学习进度已记录');
                    }
                } else if (type === 'exercise') {
                    if (!accounts[username].startedExercises) {
                        accounts[username].startedExercises = [];
                    }
                    if (!accounts[username].startedExercises.includes(content)) {
                        accounts[username].startedExercises.push(content);
                        
                        // 保存到GitHub
                        saveUsersToGitHub();
                        console.log('题目学习进度已记录');
                    }
                }
            }
        }
        
        // 修改密码相关函数
        function showChangePasswordModal() {
            const modal = document.getElementById('changePasswordModal');
            modal.classList.add('active');
            
            // 绑定表单提交事件
            const form = document.getElementById('changePasswordForm');
            if (form && !form.hasAttribute('data-bound')) {
                form.setAttribute('data-bound', 'true');
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    changePassword();
                });
            }
        }
        
        function closeChangePasswordModal() {
            const modal = document.getElementById('changePasswordModal');
            modal.classList.remove('active');
            
            // 清空表单
            document.getElementById('changeUsername').value = '';
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
        
        async function changePassword() {
            const username = document.getElementById('changeUsername').value.trim();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // 验证输入
            if (!username || !currentPassword || !newPassword || !confirmPassword) {
                showAlert('请填写所有字段');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('两次输入的新密码不一致');
                return;
            }
            
            if (newPassword.length < 6) {
                showAlert('新密码长度至少6位');
                return;
            }
            
            // 验证用户名和当前密码
            if (!accounts[username] || accounts[username].password !== currentPassword) {
                showAlert('用户名或当前密码错误');
                return;
            }
            
            // 修改密码
            accounts[username].password = newPassword;
            
            // 保存到GitHub
            const success = await saveUsersToGitHub();
            if (success) {
                showMessage('密码修改成功！', 'success');
                closeChangePasswordModal();
            } else {
                showAlert('密码修改失败，请重试');
            }
        }
        
        // 开始练习题目
        function startExercise(exerciseId) {
            const exercise = exercisesData.find(e => e.id === exerciseId);
            if (!exercise) {
                showAlert('题目不存在');
                return;
            }
            
            // 记录学习进度
            if (currentUser && currentUser.role === 'student') {
                recordStudyProgress('exercise', exerciseId);
            }
            
            // 显示题目详情模态框
            showExerciseModal(exercise);
        }
        
        // 显示题目详情模态框
        function showExerciseModal(exercise) {
            const modal = document.createElement('div');
            modal.className = 'modal-backdrop active';
            modal.id = 'exerciseModal';
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3><i class="fas fa-question-circle"></i> ${escapeHtml(exercise.title)}</h3>
                        <button class="close-modal" onclick="closeExerciseModal()">&times;</button>
                    </div>
                    <div style="padding: 20px;">
                        <div class="exercise-description" style="margin-bottom: 20px; font-size: 16px; line-height: 1.6;">
                            ${escapeHtml(exercise.description)}
                        </div>
                        
                        <div class="exercise-files" style="margin-bottom: 20px;">
                            <h4>相关文件：</h4>
                            ${exercise.files.map(file => `
                                <div style="padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 6px;">
                                    <i class="fas fa-file"></i> ${file.name} (${(file.size / 1024).toFixed(1)}KB)
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="exercise-actions" style="text-align: center;">
                            <button class="upload-btn-primary" onclick="completeExercise('${exercise.id}')">
                                <i class="fas fa-check"></i> 标记为已完成
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // 关闭题目模态框
        function closeExerciseModal() {
            const modal = document.getElementById('exerciseModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        // 完成练习
        function completeExercise(exerciseId) {
            if (currentUser && currentUser.role === 'student') {
                const username = Object.keys(accounts).find(key => accounts[key] === currentUser);
                if (username && accounts[username]) {
                    if (!accounts[username].completedExercises) {
                        accounts[username].completedExercises = [];
                    }
                    if (!accounts[username].completedExercises.includes(exerciseId)) {
                        accounts[username].completedExercises.push(exerciseId);
                        accounts[username].questionProgress = accounts[username].completedExercises.length;
                        
                        // 保存到GitHub
                        saveUsersToGitHub();
                        showMessage('练习已完成！', 'success');
                    }
                }
            }
            closeExerciseModal();
        }
        
        // 显示登录错误
        function showLoginError(message) {
            const loginError = document.getElementById('loginError');
            if (loginError) {
                loginError.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
                loginError.style.display = 'block';
            }
            showMessage(message, 'error');
        }
        
        // 替换alert为更好的提示
        function showAlert(message, type = 'error') {
            showMessage(message, type);
        }
    </script>
</body>
</html>
