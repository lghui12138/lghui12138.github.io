<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https:; frame-ancestors 'none'; base-uri 'self';">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, notranslate">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e6fa8" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0d4f73" media="(prefers-color-scheme: dark)">
    <meta name="color-scheme" content="light">
    <title>流体力学学习平台 - 中国海洋大学</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="流体力学">
    
    <!-- External Resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous" defer></script>
    <script src="https://vjs.zencdn.net/8.7.0/video.min.js" crossorigin="anonymous" defer></script>
    <link href="https://vjs.zencdn.net/8.7.0/video-js.css" rel="stylesheet">
    
    <!-- Advanced Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" crossorigin="anonymous" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js" crossorigin="anonymous" defer></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/umd/ffmpeg.js" crossorigin="anonymous" defer></script>
    
    <!-- Video.js Plugins -->
    <script src="https://vjs.zencdn.net/7.21.1/lang/zh-CN.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-quality-levels@2.1.0/dist/videojs-contrib-quality-levels.min.js" defer></script>
    
    <!-- OCR and Image Processing Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/opencv.js@1.7.0/opencv.js" defer></script>
    
    <!-- Additional Security Headers -->
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), interest-cohort=()">
    <meta name="pinterest" content="nopin">
    <meta property="og:type" content="website">
    <meta property="og:title" content="流体力学学习平台">
    <meta property="og:description" content="中国海洋大学803流体力学专业学习平台">
    <meta property="og:image" content="/public/logo.png">
    <meta name="twitter:card" content="summary">
    
    <style>
        /* 安全防护：反调试和反自动化 */
        @media print {
            * {
                display: none !important;
            }
            
            body::before {
                content: "此内容受版权保护，禁止打印和截图" !important;
                display: block !important;
                position: fixed !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                text-align: center !important;
                font-size: 48px !important;
                color: red !important;
                z-index: 999999 !important;
                background: white !important;
                padding: 50px !important;
                border: 5px solid red !important;
            }
        }

        /* 完善的CSS变量系统 */
        :root {
            /* 主色调 - 海洋主题 */
            --primary: #1e6fa8;
            --primary-light: #3a86c7;
            --primary-dark: #155a89;
            --primary-alpha: rgba(30, 111, 168, 0.1);
            
            --secondary: #2c9ab7;
            --secondary-light: #4db8d6;
            --secondary-dark: #1e7a94;
            --secondary-alpha: rgba(44, 154, 183, 0.1);
            
            --accent: #4db8d6;
            --accent-light: #6fc7e0;
            --accent-dark: #3a9bbf;
            --accent-alpha: rgba(77, 184, 214, 0.1);
            
            /* 状态颜色 */
            --success: #27ae60;
            --success-light: #2ecc71;
            --success-dark: #1e8449;
            --success-alpha: rgba(39, 174, 96, 0.1);
            
            --warning: #f39c12;
            --warning-light: #f4d03f;
            --warning-dark: #d68910;
            --warning-alpha: rgba(243, 156, 18, 0.1);
            
            --error: #e74c3c;
            --error-light: #ec7063;
            --error-dark: #c0392b;
            --error-alpha: rgba(231, 76, 60, 0.1);
            
            --info: #3498db;
            --info-light: #5dade2;
            --info-dark: #2980b9;
            --info-alpha: rgba(52, 152, 219, 0.1);
            
            /* 中性颜色 */
            --dark: #2c3e50;
            --dark-light: #34495e;
            --dark-alpha: rgba(44, 62, 80, 0.1);
            
            --light: #ecf0f1;
            --light-dark: #d5dbdb;
            --light-alpha: rgba(236, 240, 241, 0.1);
            
            --white: #ffffff;
            --black: #000000;
            --gray: #95a5a6;
            --gray-light: #bdc3c7;
            --gray-dark: #7f8c8d;
            
            /* 边框和分隔线 */
            --border: #bdc3c7;
            --border-light: #d5dbdb;
            --border-dark: #95a5a6;
            --border-alpha: rgba(189, 195, 199, 0.3);
            
            /* 海洋主题特定颜色 */
            --ocean-blue: #1e6fa8;
            --wave-color: #2c9ab7;
            --deep-blue: #0d4f73;
            --light-blue: #87ceeb;
            --foam-white: #f8f9fa;
            
            /* 渐变 */
            --gradient-ocean: linear-gradient(135deg, #1e6fa8, #4db8d6, #87ceeb);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-light));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--secondary-light));
            --gradient-accent: linear-gradient(135deg, var(--accent), var(--accent-light));
            --gradient-sunset: linear-gradient(135deg, #ff7b7b, #667eea);
            --gradient-water: linear-gradient(0deg, #667eea, #764ba2);
            
            /* 动画和过渡 */
            --transition-ultra-fast: 0.1s ease;
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --transition-ultra-slow: 0.8s ease;
            
            /* 阴影系统 */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.02);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            --shadow-ocean: 0 8px 32px 0 rgba(30, 111, 168, 0.15);
            --shadow-wave: 0 4px 20px 0 rgba(44, 154, 183, 0.2);
            
            /* 间距系统 */
            --space-0: 0;
            --space-1: 0.25rem;    /* 4px */
            --space-2: 0.5rem;     /* 8px */
            --space-3: 0.75rem;    /* 12px */
            --space-4: 1rem;       /* 16px */
            --space-5: 1.25rem;    /* 20px */
            --space-6: 1.5rem;     /* 24px */
            --space-7: 1.75rem;    /* 28px */
            --space-8: 2rem;       /* 32px */
            --space-9: 2.25rem;    /* 36px */
            --space-10: 2.5rem;    /* 40px */
            --space-12: 3rem;      /* 48px */
            --space-16: 4rem;      /* 64px */
            --space-20: 5rem;      /* 80px */
            --space-24: 6rem;      /* 96px */
            --space-32: 8rem;      /* 128px */
            
            /* 圆角系统 */
            --radius-none: 0;
            --radius-sm: 0.125rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-full: 9999px;
            
            /* 字体系统 */
            --font-sans: 'PingFang SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            --font-serif: 'Times New Roman', Times, serif;
            --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            
            /* 字体大小 */
            --text-xs: 0.75rem;     /* 12px */
            --text-sm: 0.875rem;    /* 14px */
            --text-base: 1rem;      /* 16px */
            --text-lg: 1.125rem;    /* 18px */
            --text-xl: 1.25rem;     /* 20px */
            --text-2xl: 1.5rem;     /* 24px */
            --text-3xl: 1.875rem;   /* 30px */
            --text-4xl: 2.25rem;    /* 36px */
            --text-5xl: 3rem;       /* 48px */
            --text-6xl: 3.75rem;    /* 60px */
            
            /* 字体粗细 */
            --font-thin: 100;
            --font-light: 300;
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;
            --font-bold: 700;
            --font-extrabold: 800;
            --font-black: 900;
            
            /* 行高 */
            --leading-none: 1;
            --leading-tight: 1.25;
            --leading-snug: 1.375;
            --leading-normal: 1.5;
            --leading-relaxed: 1.625;
            --leading-loose: 2;
            
            /* 断点 */
            --breakpoint-sm: 640px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 1024px;
            --breakpoint-xl: 1280px;
            --breakpoint-2xl: 1536px;
            
            /* Z-index层级 */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
        }

        /* 防截图和反调试样式 */
        * {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-touch-callout: none !important;
            -webkit-tap-highlight-color: transparent !important;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        /* 防止拖拽保存 */
        img, video, audio, canvas, svg {
            -webkit-user-drag: none !important;
            -khtml-user-drag: none !important;
            -moz-user-drag: none !important;
            -o-user-drag: none !important;
            user-drag: none !important;
            pointer-events: none !important;
        }

        /* 全面的样式重置和基础设置 */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
            line-height: var(--leading-normal);
            text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            tab-size: 4;
            -o-tab-size: 4;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        body {
            font-family: var(--font-sans);
            font-weight: var(--font-normal);
            color: var(--dark);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            transition: all var(--transition-normal);
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-feature-settings: "kern" 1;
            font-kerning: auto;
        }

        /* 改善文本选择体验 */
        ::selection {
            background: var(--primary-alpha);
            color: var(--primary-dark);
        }

        ::-moz-selection {
            background: var(--primary-alpha);
            color: var(--primary-dark);
        }

        /* 优化聚焦轮廓 */
        :focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        :focus:not(:focus-visible) {
            outline: none;
        }

        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: var(--radius-full);
            transition: background var(--transition-fast);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-dark);
        }

        /* 高级动画定义 */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes ripple {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(4); opacity: 0; }
        }

        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeInScale {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(77, 184, 214, 0.5); }
            50% { box-shadow: 0 0 20px rgba(77, 184, 214, 0.8); }
        }

        @keyframes wave {
            0% { transform: rotate(0deg); }
            10% { transform: rotate(14deg); }
            20% { transform: rotate(-8deg); }
            30% { transform: rotate(14deg); }
            40% { transform: rotate(-4deg); }
            50% { transform: rotate(10deg); }
            60% { transform: rotate(0deg); }
            100% { transform: rotate(0deg); }
        }

        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes blink {
            0%, 50% { border-color: transparent; }
            51%, 100% { border-color: var(--primary); }
        }

        @keyframes progressFill {
            0% { width: 0%; }
            100% { width: var(--progress-width, 0%); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 高级文件上传样式 */
        .upload-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95));
            backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
            border: 2px dashed rgba(30, 111, 168, 0.3);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .upload-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            border-radius: var(--radius-2xl);
            z-index: -1;
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .upload-container:hover::before {
            opacity: 0.1;
        }

        .upload-container.drag-over {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.05);
            transform: scale(1.02);
        }

        .upload-tabs {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-6);
            background: rgba(240, 244, 248, 0.8);
            padding: var(--space-1);
            border-radius: var(--radius-xl);
        }

        .upload-tab {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: none;
            background: transparent;
            color: var(--secondary);
            font-weight: 500;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
        }

        .upload-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .upload-tab:hover:not(.active) {
            color: var(--primary);
            background: rgba(255, 255, 255, 0.5);
        }

        .upload-content {
            display: none;
        }

        .upload-content.active {
            display: block;
        }

        .drop-zone {
            border: 2px dashed rgba(30, 111, 168, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--space-12);
            text-align: center;
            background: rgba(248, 250, 252, 0.5);
            transition: all var(--transition-normal);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .drop-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(77, 184, 214, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .drop-zone:hover::before {
            left: 100%;
        }

        .drop-zone.drag-over {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.1);
            transform: scale(1.02);
        }

        .drop-zone i {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: var(--space-4);
            animation: float 3s ease-in-out infinite;
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .upload-progress {
            display: none;
            margin-top: var(--space-6);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(230, 236, 241, 0.8);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: var(--radius-full);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }

        .upload-text textarea {
            width: 100%;
            min-height: 200px;
            padding: var(--space-4);
            border: 1px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-lg);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            resize: vertical;
            background: rgba(255, 255, 255, 0.9);
            transition: all var(--transition-normal);
        }

        .upload-text textarea:focus {
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 3px rgba(77, 184, 214, 0.1);
        }

        /* OCR图片上传和处理样式 */
        .image-upload-container {
            border: 2px dashed rgba(30, 111, 168, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            text-align: center;
            background: rgba(248, 250, 252, 0.5);
            transition: all var(--transition-normal);
            cursor: pointer;
            position: relative;
            margin-bottom: var(--space-6);
        }

        .image-upload-container:hover {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.1);
        }

        .image-upload-container.processing {
            border-color: var(--warning);
            background: rgba(243, 156, 18, 0.1);
        }

        .image-upload-container.drag-over {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.2);
            transform: scale(1.02);
        }

        .image-preview {
            max-width: 100%;
            max-height: 400px;
            margin: var(--space-4) 0;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .ocr-progress {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
            display: none;
        }

        .ocr-progress.active {
            display: block;
        }

        .ocr-step {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2) 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .ocr-step:last-child {
            border-bottom: none;
        }

        .ocr-step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .ocr-step-icon.pending {
            background: rgba(189, 195, 199, 0.3);
            color: var(--secondary);
        }

        .ocr-step-icon.processing {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning);
            animation: spin 1s linear infinite;
        }

        .ocr-step-icon.completed {
            background: rgba(39, 174, 96, 0.2);
            color: var(--success);
        }

        .ocr-step-icon.error {
            background: rgba(231, 76, 60, 0.2);
            color: var(--error);
        }

        .ocr-result {
            background: white;
            border: 1px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
            max-height: 300px;
            overflow-y: auto;
        }

        .ocr-result h4 {
            margin-bottom: var(--space-3);
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .ocr-result textarea {
            width: 100%;
            min-height: 200px;
            border: 1px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            resize: vertical;
        }

        .image-tools {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-4);
            flex-wrap: wrap;
            justify-content: center;
        }

        .image-tool-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .image-tool-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .image-tool-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .confidence-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-3);
            font-size: 0.875rem;
        }

        .confidence-bar {
            flex: 1;
            height: 6px;
            background: rgba(230, 236, 241, 0.8);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
        }

        .confidence-fill.high {
            background: var(--success);
        }

        .confidence-fill.medium {
            background: var(--warning);
        }

        .confidence-fill.low {
            background: var(--error);
        }

        html {
            scroll-behavior: smooth;
            line-height: 1.6;
        }

        body {
            background: var(--gradient-ocean);
            color: var(--dark);
            overflow-x: hidden;
            min-height: 100vh;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        .visually-hidden {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        *:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary);
            color: white;
            padding: 8px;
            z-index: 10000;
            text-decoration: none;
            border-radius: var(--radius-md);
        }

        .skip-link:focus {
            top: 6px;
        }

        /* 登录系统样式 */
        .login-system {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-ocean);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.5s ease;
        }

        /* 流体动力学背景动画 */
        @keyframes fluidWave {
            0%, 100% { 
                transform: translateY(0) scale(1) rotate(0deg); 
                background-position: 0% 50%;
            }
            25% { 
                transform: translateY(-10px) scale(1.02) rotate(1deg); 
                background-position: 25% 50%;
            }
            50% { 
                transform: translateY(5px) scale(0.98) rotate(-1deg); 
                background-position: 50% 50%;
            }
            75% { 
                transform: translateY(-5px) scale(1.01) rotate(0.5deg); 
                background-position: 75% 50%;
            }
        }

        @keyframes bubbleFloat {
            0%, 100% { transform: translateY(0px) translateX(0px); opacity: 0.7; }
            25% { transform: translateY(-20px) translateX(10px); opacity: 0.9; }
            50% { transform: translateY(-40px) translateX(-5px); opacity: 0.5; }
            75% { transform: translateY(-20px) translateX(-10px); opacity: 0.8; }
        }

        @keyframes waveFlow {
            0% { transform: translateX(-100%) rotate(0deg); }
            100% { transform: translateX(100%) rotate(360deg); }
        }

        /* 登录页面背景 */
        body.login-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        body.login-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(79, 172, 254, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(0, 242, 254, 0.3) 0%, transparent 60%),
                linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%);
            background-size: 100% 100%, 150% 150%, 200% 200%, 50px 50px;
            animation: fluidWave 20s ease-in-out infinite;
            z-index: -1;
        }

        body.login-page::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><radialGradient id="wave1" cx="30%" cy="20%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.4"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient><radialGradient id="wave2" cx="70%" cy="80%"><stop offset="0%" stop-color="%234facfe" stop-opacity="0.3"/><stop offset="100%" stop-color="%234facfe" stop-opacity="0"/></radialGradient><radialGradient id="wave3" cx="50%" cy="50%"><stop offset="0%" stop-color="%2300f2fe" stop-opacity="0.2"/><stop offset="100%" stop-color="%2300f2fe" stop-opacity="0"/></radialGradient></defs><ellipse cx="300" cy="200" rx="400" ry="150" fill="url(%23wave1)"/><ellipse cx="900" cy="600" rx="350" ry="200" fill="url(%23wave2)"/><ellipse cx="600" cy="400" rx="300" ry="180" fill="url(%23wave3)"/><path d="M0,400 Q200,300 400,400 T800,400 T1200,400 L1200,800 L0,800 Z" fill="%2300f2fe" opacity="0.2"/><path d="M0,500 Q300,400 600,500 T1200,500 L1200,800 L0,800 Z" fill="%234facfe" opacity="0.15"/></svg>') no-repeat center center;
            background-size: cover;
            opacity: 0.6;
            z-index: -1;
            animation: fluidWave 25s ease-in-out infinite reverse;
        }

        /* 浮动气泡效果 */
        .floating-bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: bubbleFloat 8s ease-in-out infinite;
        }

        .floating-bubble:nth-child(1) {
            width: 60px;
            height: 60px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-bubble:nth-child(2) {
            width: 40px;
            height: 40px;
            top: 60%;
            left: 80%;
            animation-delay: 2s;
        }

        .floating-bubble:nth-child(3) {
            width: 80px;
            height: 80px;
            top: 80%;
            left: 20%;
            animation-delay: 4s;
        }

        .floating-bubble:nth-child(4) {
            width: 50px;
            height: 50px;
            top: 30%;
            left: 70%;
            animation-delay: 6s;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            padding: var(--space-12);
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 10;
            animation: fadeInScale 0.8s ease-out;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #667eea, #764ba2, #4facfe, #00f2fe);
            border-radius: var(--radius-2xl);
            z-index: -1;
            opacity: 0.3;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.5; }
        }

        @keyframes fadeInScale {
            from { 
                transform: scale(0.8); 
                opacity: 0; 
            }
            to { 
                transform: scale(1); 
                opacity: 1; 
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: var(--space-8);
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-2);
            position: relative;
        }

        .login-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            border-radius: 2px;
            animation: titleUnderline 2s ease-in-out infinite;
        }

        @keyframes titleUnderline {
            0%, 100% { width: 60px; opacity: 0.8; }
            50% { width: 80px; opacity: 1; }
        }

        .login-subtitle {
            font-size: 1.125rem;
            color: var(--secondary);
            margin-bottom: var(--space-6);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .form-input {
            width: 100%;
            padding: var(--space-4);
            border: 2px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            transition: all var(--transition-normal);
        }

        .form-input:focus {
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 3px rgba(77, 184, 214, 0.1);
            transform: translateY(-1px);
        }

        .login-button {
            width: 100%;
            padding: var(--space-4);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .login-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .login-button:hover::before {
            left: 100%;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }

        .login-button:active {
            transform: translateY(0);
        }

        .login-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: var(--space-4);
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.error {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .message.success {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }

        .forgot-password {
            text-align: center;
            margin-top: var(--space-6);
        }

        .forgot-password a {
            color: var(--accent);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color var(--transition-normal);
        }

        .forgot-password a:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        /* 主平台样式 */
        .platform {
            display: none;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f9ff 0%, #e6f0ff 100%);
        }

        .platform.active {
            display: block;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .featured-banner {
            background: var(--deep-blue);
            color: white;
            text-align: center;
            padding: var(--space-2);
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            cursor: pointer;
            transition: transform var(--transition-normal);
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-icon {
            font-size: 2rem;
            color: var(--light-blue);
            background: rgba(255, 255, 255, 0.15);
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: var(--space-2);
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            transition: all var(--transition-normal);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-1);
            min-width: 80px;
            text-align: center;
            white-space: nowrap;
        }

        .nav-link i {
            font-size: var(--text-lg);
            margin-bottom: var(--space-1);
        }

        .nav-link span {
            font-size: var(--text-xs);
            line-height: 1.2;
            word-break: keep-all;
            white-space: nowrap;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            background: rgba(255, 255, 255, 0.15);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .user-info:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        .logout-button {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.125rem;
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            transition: all var(--transition-normal);
        }

        .logout-button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6);
            min-height: calc(100vh - 200px);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 2.25rem;
            color: var(--primary);
            margin-bottom: var(--space-8);
            position: relative;
            padding-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 4px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius-sm);
        }

        .section-icon {
            background: rgba(30, 111, 168, 0.15);
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-size: 1.5rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
            margin-bottom: var(--space-6);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        .footer {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: var(--space-8) 0;
            text-align: center;
            margin-top: var(--space-16);
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            transition: all var(--transition-normal);
        }

        .mobile-menu-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--primary);
                flex-direction: column;
                padding: var(--space-4);
                box-shadow: var(--shadow-lg);
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .login-container {
                margin: var(--space-4);
                padding: var(--space-8);
            }
        }

        /* 高级视频播放器控件 */
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https:; frame-ancestors 'none'; base-uri 'self';">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, notranslate">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e6fa8" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0d4f73" media="(prefers-color-scheme: dark)">
    <meta name="color-scheme" content="light">
    <title>流体力学学习平台 - 中国海洋大学</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="流体力学">
    
    <!-- External Resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous" defer></script>
    <script src="https://vjs.zencdn.net/8.7.0/video.min.js" crossorigin="anonymous" defer></script>
    <link href="https://vjs.zencdn.net/8.7.0/video-js.css" rel="stylesheet">
    
    <!-- Advanced Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" crossorigin="anonymous" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js" crossorigin="anonymous" defer></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/umd/ffmpeg.js" crossorigin="anonymous" defer></script>
    
    <!-- Video.js Plugins -->
    <script src="https://vjs.zencdn.net/7.21.1/lang/zh-CN.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-quality-levels@2.1.0/dist/videojs-contrib-quality-levels.min.js" defer></script>
    
    <!-- OCR and Image Processing Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/opencv.js@1.7.0/opencv.js" defer></script>
    
    <!-- Additional Security Headers -->
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), interest-cohort=()">
    <meta name="pinterest" content="nopin">
    <meta property="og:type" content="website">
    <meta property="og:title" content="流体力学学习平台">
    <meta property="og:description" content="中国海洋大学803流体力学专业学习平台">
    <meta property="og:image" content="/public/logo.png">
    <meta name="twitter:card" content="summary">
    
    <style>
        /* 安全防护：反调试和反自动化 */
        @media print {
            * {
                display: none !important;
            }
            
            body::before {
                content: "此内容受版权保护，禁止打印和截图" !important;
                display: block !important;
                position: fixed !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                text-align: center !important;
                font-size: 48px !important;
                color: red !important;
                z-index: 999999 !important;
                background: white !important;
                padding: 50px !important;
                border: 5px solid red !important;
            }
        }

        /* 完善的CSS变量系统 */
        :root {
            /* 主色调 - 海洋主题 */
            --primary: #1e6fa8;
            --primary-light: #3a86c7;
            --primary-dark: #155a89;
            --primary-alpha: rgba(30, 111, 168, 0.1);
            
            --secondary: #2c9ab7;
            --secondary-light: #4db8d6;
            --secondary-dark: #1e7a94;
            --secondary-alpha: rgba(44, 154, 183, 0.1);
            
            --accent: #4db8d6;
            --accent-light: #6fc7e0;
            --accent-dark: #3a9bbf;
            --accent-alpha: rgba(77, 184, 214, 0.1);
            
            /* 状态颜色 */
            --success: #27ae60;
            --success-light: #2ecc71;
            --success-dark: #1e8449;
            --success-alpha: rgba(39, 174, 96, 0.1);
            
            --warning: #f39c12;
            --warning-light: #f4d03f;
            --warning-dark: #d68910;
            --warning-alpha: rgba(243, 156, 18, 0.1);
            
            --error: #e74c3c;
            --error-light: #ec7063;
            --error-dark: #c0392b;
            --error-alpha: rgba(231, 76, 60, 0.1);
            
            --info: #3498db;
            --info-light: #5dade2;
            --info-dark: #2980b9;
            --info-alpha: rgba(52, 152, 219, 0.1);
            
            /* 中性颜色 */
            --dark: #2c3e50;
            --dark-light: #34495e;
            --dark-alpha: rgba(44, 62, 80, 0.1);
            
            --light: #ecf0f1;
            --light-dark: #d5dbdb;
            --light-alpha: rgba(236, 240, 241, 0.1);
            
            --white: #ffffff;
            --black: #000000;
            --gray: #95a5a6;
            --gray-light: #bdc3c7;
            --gray-dark: #7f8c8d;
            
            /* 边框和分隔线 */
            --border: #bdc3c7;
            --border-light: #d5dbdb;
            --border-dark: #95a5a6;
            --border-alpha: rgba(189, 195, 199, 0.3);
            
            /* 海洋主题特定颜色 */
            --ocean-blue: #1e6fa8;
            --wave-color: #2c9ab7;
            --deep-blue: #0d4f73;
            --light-blue: #87ceeb;
            --foam-white: #f8f9fa;
            
            /* 渐变 */
            --gradient-ocean: linear-gradient(135deg, #1e6fa8, #4db8d6, #87ceeb);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-light));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--secondary-light));
            --gradient-accent: linear-gradient(135deg, var(--accent), var(--accent-light));
            --gradient-sunset: linear-gradient(135deg, #ff7b7b, #667eea);
            --gradient-water: linear-gradient(0deg, #667eea, #764ba2);
            
            /* 动画和过渡 */
            --transition-ultra-fast: 0.1s ease;
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --transition-ultra-slow: 0.8s ease;
            
            /* 阴影系统 */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.02);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            --shadow-ocean: 0 8px 32px 0 rgba(30, 111, 168, 0.15);
            --shadow-wave: 0 4px 20px 0 rgba(44, 154, 183, 0.2);
            
            /* 间距系统 */
            --space-0: 0;
            --space-1: 0.25rem;    /* 4px */
            --space-2: 0.5rem;     /* 8px */
            --space-3: 0.75rem;    /* 12px */
            --space-4: 1rem;       /* 16px */
            --space-5: 1.25rem;    /* 20px */
            --space-6: 1.5rem;     /* 24px */
            --space-7: 1.75rem;    /* 28px */
            --space-8: 2rem;       /* 32px */
            --space-9: 2.25rem;    /* 36px */
            --space-10: 2.5rem;    /* 40px */
            --space-12: 3rem;      /* 48px */
            --space-16: 4rem;      /* 64px */
            --space-20: 5rem;      /* 80px */
            --space-24: 6rem;      /* 96px */
            --space-32: 8rem;      /* 128px */
            
            /* 圆角系统 */
            --radius-none: 0;
            --radius-sm: 0.125rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-full: 9999px;
            
            /* 字体系统 */
            --font-sans: 'PingFang SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            --font-serif: 'Times New Roman', Times, serif;
            --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            
            /* 字体大小 */
            --text-xs: 0.75rem;     /* 12px */
            --text-sm: 0.875rem;    /* 14px */
            --text-base: 1rem;      /* 16px */
            --text-lg: 1.125rem;    /* 18px */
            --text-xl: 1.25rem;     /* 20px */
            --text-2xl: 1.5rem;     /* 24px */
            --text-3xl: 1.875rem;   /* 30px */
            --text-4xl: 2.25rem;    /* 36px */
            --text-5xl: 3rem;       /* 48px */
            --text-6xl: 3.75rem;    /* 60px */
            
            /* 字体粗细 */
            --font-thin: 100;
            --font-light: 300;
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;
            --font-bold: 700;
            --font-extrabold: 800;
            --font-black: 900;
            
            /* 行高 */
            --leading-none: 1;
            --leading-tight: 1.25;
            --leading-snug: 1.375;
            --leading-normal: 1.5;
            --leading-relaxed: 1.625;
            --leading-loose: 2;
            
            /* 断点 */
            --breakpoint-sm: 640px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 1024px;
            --breakpoint-xl: 1280px;
            --breakpoint-2xl: 1536px;
            
            /* Z-index层级 */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
        }

        /* 防截图和反调试样式 */
        * {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-touch-callout: none !important;
            -webkit-tap-highlight-color: transparent !important;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        /* 防止拖拽保存 */
        img, video, audio, canvas, svg {
            -webkit-user-drag: none !important;
            -khtml-user-drag: none !important;
            -moz-user-drag: none !important;
            -o-user-drag: none !important;
            user-drag: none !important;
            pointer-events: none !important;
        }

        /* 全面的样式重置和基础设置 */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
            line-height: var(--leading-normal);
            text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            tab-size: 4;
            -o-tab-size: 4;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        body {
            font-family: var(--font-sans);
            font-weight: var(--font-normal);
            color: var(--dark);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            transition: all var(--transition-normal);
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-feature-settings: "kern" 1;
            font-kerning: auto;
        }

        /* 改善文本选择体验 */
        ::selection {
            background: var(--primary-alpha);
            color: var(--primary-dark);
        }

        ::-moz-selection {
            background: var(--primary-alpha);
            color: var(--primary-dark);
        }

        /* 优化聚焦轮廓 */
        :focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        :focus:not(:focus-visible) {
            outline: none;
        }

        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: var(--radius-full);
            transition: background var(--transition-fast);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-dark);
        }

        /* 高级动画定义 */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes ripple {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(4); opacity: 0; }
        }

        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeInScale {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(77, 184, 214, 0.5); }
            50% { box-shadow: 0 0 20px rgba(77, 184, 214, 0.8); }
        }

        @keyframes wave {
            0% { transform: rotate(0deg); }
            10% { transform: rotate(14deg); }
            20% { transform: rotate(-8deg); }
            30% { transform: rotate(14deg); }
            40% { transform: rotate(-4deg); }
            50% { transform: rotate(10deg); }
            60% { transform: rotate(0deg); }
            100% { transform: rotate(0deg); }
        }

        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes blink {
            0%, 50% { border-color: transparent; }
            51%, 100% { border-color: var(--primary); }
        }

        @keyframes progressFill {
            0% { width: 0%; }
            100% { width: var(--progress-width, 0%); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 高级文件上传样式 */
        .upload-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95));
            backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
            border: 2px dashed rgba(30, 111, 168, 0.3);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .upload-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            border-radius: var(--radius-2xl);
            z-index: -1;
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .upload-container:hover::before {
            opacity: 0.1;
        }

        .upload-container.drag-over {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.05);
            transform: scale(1.02);
        }

        .upload-tabs {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-6);
            background: rgba(240, 244, 248, 0.8);
            padding: var(--space-1);
            border-radius: var(--radius-xl);
        }

        .upload-tab {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: none;
            background: transparent;
            color: var(--secondary);
            font-weight: 500;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
        }

        .upload-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .upload-tab:hover:not(.active) {
            color: var(--primary);
            background: rgba(255, 255, 255, 0.5);
        }

        .upload-content {
            display: none;
        }

        .upload-content.active {
            display: block;
        }

        .drop-zone {
            border: 2px dashed rgba(30, 111, 168, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--space-12);
            text-align: center;
            background: rgba(248, 250, 252, 0.5);
            transition: all var(--transition-normal);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .drop-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(77, 184, 214, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .drop-zone:hover::before {
            left: 100%;
        }

        .drop-zone.drag-over {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.1);
            transform: scale(1.02);
        }

        .drop-zone i {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: var(--space-4);
            animation: float 3s ease-in-out infinite;
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .upload-progress {
            display: none;
            margin-top: var(--space-6);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(230, 236, 241, 0.8);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: var(--radius-full);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }

        .upload-text textarea {
            width: 100%;
            min-height: 200px;
            padding: var(--space-4);
            border: 1px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-lg);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            resize: vertical;
            background: rgba(255, 255, 255, 0.9);
            transition: all var(--transition-normal);
        }

        .upload-text textarea:focus {
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 3px rgba(77, 184, 214, 0.1);
        }

        /* OCR图片上传和处理样式 */
        .image-upload-container {
            border: 2px dashed rgba(30, 111, 168, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            text-align: center;
            background: rgba(248, 250, 252, 0.5);
            transition: all var(--transition-normal);
            cursor: pointer;
            position: relative;
            margin-bottom: var(--space-6);
        }

        .image-upload-container:hover {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.1);
        }

        .image-upload-container.processing {
            border-color: var(--warning);
            background: rgba(243, 156, 18, 0.1);
        }

        .image-upload-container.drag-over {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.2);
            transform: scale(1.02);
        }

        .image-preview {
            max-width: 100%;
            max-height: 400px;
            margin: var(--space-4) 0;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .ocr-progress {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
            display: none;
        }

        .ocr-progress.active {
            display: block;
        }

        .ocr-step {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2) 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .ocr-step:last-child {
            border-bottom: none;
        }

        .ocr-step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .ocr-step-icon.pending {
            background: rgba(189, 195, 199, 0.3);
            color: var(--secondary);
        }

        .ocr-step-icon.processing {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning);
            animation: spin 1s linear infinite;
        }

        .ocr-step-icon.completed {
            background: rgba(39, 174, 96, 0.2);
            color: var(--success);
        }

        .ocr-step-icon.error {
            background: rgba(231, 76, 60, 0.2);
            color: var(--error);
        }

        .ocr-result {
            background: white;
            border: 1px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
            max-height: 300px;
            overflow-y: auto;
        }

        .ocr-result h4 {
            margin-bottom: var(--space-3);
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .ocr-result textarea {
            width: 100%;
            min-height: 200px;
            border: 1px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            resize: vertical;
        }

        .image-tools {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-4);
            flex-wrap: wrap;
            justify-content: center;
        }

        .image-tool-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .image-tool-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .image-tool-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .confidence-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-3);
            font-size: 0.875rem;
        }

        .confidence-bar {
            flex: 1;
            height: 6px;
            background: rgba(230, 236, 241, 0.8);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
        }

        .confidence-fill.high {
            background: var(--success);
        }

        .confidence-fill.medium {
            background: var(--warning);
        }

        .confidence-fill.low {
            background: var(--error);
        }

        html {
            scroll-behavior: smooth;
            line-height: 1.6;
        }

        body {
            background: var(--gradient-ocean);
            color: var(--dark);
            overflow-x: hidden;
            min-height: 100vh;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        .visually-hidden {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        *:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary);
            color: white;
            padding: 8px;
            z-index: 10000;
            text-decoration: none;
            border-radius: var(--radius-md);
        }

        .skip-link:focus {
            top: 6px;
        }

        /* 登录系统样式 */
        .login-system {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-ocean);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.5s ease;
        }

        /* 流体动力学背景动画 */
        @keyframes fluidWave {
            0%, 100% { 
                transform: translateY(0) scale(1) rotate(0deg); 
                background-position: 0% 50%;
            }
            25% { 
                transform: translateY(-10px) scale(1.02) rotate(1deg); 
                background-position: 25% 50%;
            }
            50% { 
                transform: translateY(5px) scale(0.98) rotate(-1deg); 
                background-position: 50% 50%;
            }
            75% { 
                transform: translateY(-5px) scale(1.01) rotate(0.5deg); 
                background-position: 75% 50%;
            }
        }

        @keyframes bubbleFloat {
            0%, 100% { transform: translateY(0px) translateX(0px); opacity: 0.7; }
            25% { transform: translateY(-20px) translateX(10px); opacity: 0.9; }
            50% { transform: translateY(-40px) translateX(-5px); opacity: 0.5; }
            75% { transform: translateY(-20px) translateX(-10px); opacity: 0.8; }
        }

        @keyframes waveFlow {
            0% { transform: translateX(-100%) rotate(0deg); }
            100% { transform: translateX(100%) rotate(360deg); }
        }

        /* 登录页面背景 */
        body.login-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        body.login-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(79, 172, 254, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(0, 242, 254, 0.3) 0%, transparent 60%),
                linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%);
            background-size: 100% 100%, 150% 150%, 200% 200%, 50px 50px;
            animation: fluidWave 20s ease-in-out infinite;
            z-index: -1;
        }

        body.login-page::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><radialGradient id="wave1" cx="30%" cy="20%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.4"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient><radialGradient id="wave2" cx="70%" cy="80%"><stop offset="0%" stop-color="%234facfe" stop-opacity="0.3"/><stop offset="100%" stop-color="%234facfe" stop-opacity="0"/></radialGradient><radialGradient id="wave3" cx="50%" cy="50%"><stop offset="0%" stop-color="%2300f2fe" stop-opacity="0.2"/><stop offset="100%" stop-color="%2300f2fe" stop-opacity="0"/></radialGradient></defs><ellipse cx="300" cy="200" rx="400" ry="150" fill="url(%23wave1)"/><ellipse cx="900" cy="600" rx="350" ry="200" fill="url(%23wave2)"/><ellipse cx="600" cy="400" rx="300" ry="180" fill="url(%23wave3)"/><path d="M0,400 Q200,300 400,400 T800,400 T1200,400 L1200,800 L0,800 Z" fill="%2300f2fe" opacity="0.2"/><path d="M0,500 Q300,400 600,500 T1200,500 L1200,800 L0,800 Z" fill="%234facfe" opacity="0.15"/></svg>') no-repeat center center;
            background-size: cover;
            opacity: 0.6;
            z-index: -1;
            animation: fluidWave 25s ease-in-out infinite reverse;
        }

        /* 浮动气泡效果 */
        .floating-bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: bubbleFloat 8s ease-in-out infinite;
        }

        .floating-bubble:nth-child(1) {
            width: 60px;
            height: 60px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-bubble:nth-child(2) {
            width: 40px;
            height: 40px;
            top: 60%;
            left: 80%;
            animation-delay: 2s;
        }

        .floating-bubble:nth-child(3) {
            width: 80px;
            height: 80px;
            top: 80%;
            left: 20%;
            animation-delay: 4s;
        }

        .floating-bubble:nth-child(4) {
            width: 50px;
            height: 50px;
            top: 30%;
            left: 70%;
            animation-delay: 6s;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            padding: var(--space-12);
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-xl);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 10;
            animation: fadeInScale 0.8s ease-out;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #667eea, #764ba2, #4facfe, #00f2fe);
            border-radius: var(--radius-2xl);
            z-index: -1;
            opacity: 0.3;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.5; }
        }

        @keyframes fadeInScale {
            from { 
                transform: scale(0.8); 
                opacity: 0; 
            }
            to { 
                transform: scale(1); 
                opacity: 1; 
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: var(--space-8);
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-2);
            position: relative;
        }

        .login-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            border-radius: 2px;
            animation: titleUnderline 2s ease-in-out infinite;
        }

        @keyframes titleUnderline {
            0%, 100% { width: 60px; opacity: 0.8; }
            50% { width: 80px; opacity: 1; }
        }

        .login-subtitle {
            font-size: 1.125rem;
            color: var(--secondary);
            margin-bottom: var(--space-6);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .form-input {
            width: 100%;
            padding: var(--space-4);
            border: 2px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            transition: all var(--transition-normal);
        }

        .form-input:focus {
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 3px rgba(77, 184, 214, 0.1);
            transform: translateY(-1px);
        }

        .login-button {
            width: 100%;
            padding: var(--space-4);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .login-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .login-button:hover::before {
            left: 100%;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }

        .login-button:active {
            transform: translateY(0);
        }

        .login-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: var(--space-4);
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.error {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .message.success {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }

        .forgot-password {
            text-align: center;
            margin-top: var(--space-6);
        }

        .forgot-password a {
            color: var(--accent);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color var(--transition-normal);
        }

        .forgot-password a:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        /* 主平台样式 */
        .platform {
            display: none;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f9ff 0%, #e6f0ff 100%);
        }

        .platform.active {
            display: block;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .featured-banner {
            background: var(--deep-blue);
            color: white;
            text-align: center;
            padding: var(--space-2);
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            cursor: pointer;
            transition: transform var(--transition-normal);
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-icon {
            font-size: 2rem;
            color: var(--light-blue);
            background: rgba(255, 255, 255, 0.15);
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: var(--space-2);
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            transition: all var(--transition-normal);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-1);
            min-width: 80px;
            text-align: center;
            white-space: nowrap;
        }

        .nav-link i {
            font-size: var(--text-lg);
            margin-bottom: var(--space-1);
        }

        .nav-link span {
            font-size: var(--text-xs);
            line-height: 1.2;
            word-break: keep-all;
            white-space: nowrap;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            background: rgba(255, 255, 255, 0.15);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .user-info:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        .logout-button {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.125rem;
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            transition: all var(--transition-normal);
        }

        .logout-button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6);
            min-height: calc(100vh - 200px);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 2.25rem;
            color: var(--primary);
            margin-bottom: var(--space-8);
            position: relative;
            padding-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 4px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius-sm);
        }

        .section-icon {
            background: rgba(30, 111, 168, 0.15);
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-size: 1.5rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
            margin-bottom: var(--space-6);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        .footer {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: var(--space-8) 0;
            text-align: center;
            margin-top: var(--space-16);
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            transition: all var(--transition-normal);
        }

        .mobile-menu-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--primary);
                flex-direction: column;
                padding: var(--space-4);
                box-shadow: var(--shadow-lg);
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .login-container {
                margin: var(--space-4);
                padding: var(--space-8);
            }
        }

        /* 高级视频播放器控件 */
        .video-player-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            padding: var(--space-4);
            transform: translateY(100%);
            transition: transform var(--transition-normal);
        }

        .video-container:hover .video-player-controls {
            transform: translateY(0);
        }

        .video-progress {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .video-progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-full);
            cursor: pointer;
            position: relative;
        }

        .video-progress-fill {
            height: 100%;
            background: var(--accent);
            border-radius: var(--radius-full);
            width: 0%;
            transition: width 0.1s ease;
        }

        .video-progress-thumb {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .video-progress-bar:hover .video-progress-thumb {
            opacity: 1;
        }

        .video-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
        }

        .video-control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.125rem;
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            transition: all var(--transition-normal);
        }

        .video-control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .video-time {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .video-quality-selector {
            position: relative;
        }

        .video-quality-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border-radius: var(--radius-lg);
            padding: var(--space-2);
            display: none;
            min-width: 100px;
        }

        .video-quality-menu.show {
            display: block;
        }

        .video-quality-option {
            display: block;
            width: 100%;
            background: none;
            border: none;
            color: white;
            padding: var(--space-2);
            text-align: left;
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: background var(--transition-normal);
        }

        .video-quality-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* 高级模态框和弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(10px);
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: white;
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            transition: transform var(--transition-normal);
        }

        .modal-overlay.active .modal-content {
            transform: translate(-50%, -50%) scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-6);
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(30, 111, 168, 0.05), rgba(77, 184, 214, 0.05));
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--secondary);
            cursor: pointer;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            transition: all var(--transition-normal);
        }

        .modal-close:hover {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error);
        }

        .modal-body {
            padding: var(--space-6);
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-3);
            padding: var(--space-6);
            border-top: 1px solid var(--border);
            background: rgba(248, 250, 252, 0.5);
        }

        /* 交互式练习题样式 */
        .question-container {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--accent);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
        }

        .question-number {
            background: var(--accent);
            color: white;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .question-timer {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--secondary);
            font-size: 0.875rem;
        }

        .question-title {
            font-size: 1.125rem;
            color: var(--dark);
            margin-bottom: var(--space-6);
            line-height: 1.6;
        }

        .question-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
        }

        .question-option {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            padding: var(--space-4);
            border: 2px solid rgba(30, 111, 168, 0.1);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            background: rgba(248, 250, 252, 0.3);
        }

        .question-option:hover {
            border-color: rgba(30, 111, 168, 0.3);
            background: rgba(30, 111, 168, 0.05);
        }

        .question-option.selected {
            border-color: var(--accent);
            background: rgba(77, 184, 214, 0.1);
        }

        .question-option.correct {
            border-color: var(--success);
            background: rgba(39, 174, 96, 0.1);
        }

        .question-option.incorrect {
            border-color: var(--error);
            background: rgba(231, 76, 60, 0.1);
        }

        .option-label {
            background: var(--secondary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .option-text {
            flex: 1;
            color: var(--dark);
            line-height: 1.5;
        }

        .question-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-hint {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
            display: none;
        }

        .question-hint.show {
            display: block;
            animation: slideInDown 0.3s ease;
        }

        .hint-btn {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.3);
            color: var(--warning);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .hint-btn:hover {
            background: rgba(243, 156, 18, 0.2);
        }

        .submit-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-weight: 500;
            transition: all var(--transition-normal);
        }

        .submit-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* 水印和版权保护 */
        .watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            opacity: 0.05;
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 100px,
                rgba(30, 111, 168, 0.1) 100px,
                rgba(30, 111, 168, 0.1) 200px
            );
        }

        .watermark::before {
            content: attr(data-student);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 4rem;
            font-weight: bold;
            color: rgba(30, 111, 168, 0.1);
            white-space: nowrap;
            animation: float 6s ease-in-out infinite;
        }

        /* =================== 通用UI组件样式系统 =================== */
        
        /* 优化的按钮组件 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            font-size: var(--text-base);
            font-weight: var(--font-medium);
            line-height: var(--leading-tight);
            border: 1px solid transparent;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            user-select: none;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-full);
            transform: translate(-50%, -50%);
            transition: all var(--transition-fast);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: var(--white);
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: var(--white);
            border-color: var(--secondary);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-accent {
            background: var(--gradient-accent);
            color: var(--white);
            border-color: var(--accent);
            box-shadow: var(--shadow-sm);
        }

        .btn-accent:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-outline {
            background: var(--white);
            color: var(--primary);
            border-color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
        }

        .btn-ghost {
            background: transparent;
            color: var(--primary);
            border-color: transparent;
        }

        .btn-ghost:hover {
            background: var(--primary-alpha);
        }

        .btn-sm {
            padding: var(--space-2) var(--space-4);
            font-size: var(--text-sm);
        }

        .btn-lg {
            padding: var(--space-4) var(--space-8);
            font-size: var(--text-lg);
        }

        .btn-xl {
            padding: var(--space-5) var(--space-10);
            font-size: var(--text-xl);
        }

        /* 优化的输入框组件 */
        .input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            font-size: var(--text-base);
            line-height: var(--leading-normal);
            color: var(--dark);
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
            font-family: inherit;
        }

        .input:hover {
            border-color: var(--border-dark);
        }

        .input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-alpha);
            outline: none;
        }

        .input::placeholder {
            color: var(--gray);
        }

        .input-sm {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-sm);
        }

        .input-lg {
            padding: var(--space-4) var(--space-5);
            font-size: var(--text-lg);
        }

        /* 增强的卡片组件 */
        .card-enhanced {
            background: var(--white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
            overflow: hidden;
            position: relative;
        }

        .card-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-ocean);
        }

        .card-enhanced:hover {
            box-shadow: var(--shadow-ocean);
            transform: translateY(-4px);
        }

        .card-enhanced .card-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--border-light);
            background: var(--foam-white);
        }

        .card-enhanced .card-body {
            padding: var(--space-6);
        }

        .card-enhanced .card-footer {
            padding: var(--space-6);
            border-top: 1px solid var(--border-light);
            background: var(--foam-white);
        }

        /* 优化的通知组件 */
        .toast-enhanced {
            position: fixed;
            top: var(--space-6);
            right: var(--space-6);
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: var(--space-4) var(--space-6);
            z-index: var(--z-toast);
            transform: translateX(400px);
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            max-width: 400px;
            backdrop-filter: blur(8px);
        }

        .toast-enhanced.show {
            transform: translateX(0);
        }

        .toast-enhanced::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            border-radius: var(--radius-full);
        }

        .toast-enhanced.success::before {
            background: var(--success);
        }

        .toast-enhanced.error::before {
            background: var(--error);
        }

        .toast-enhanced.warning::before {
            background: var(--warning);
        }

        .toast-enhanced.info::before {
            background: var(--info);
        }

        /* 优化的标签组件 */
        .badge-enhanced {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-3);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            line-height: var(--leading-none);
            border-radius: var(--radius-full);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            overflow: hidden;
        }

        .badge-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left var(--transition-slow);
        }

        .badge-enhanced:hover::before {
            left: 100%;
        }

        .badge-primary {
            background: var(--primary-alpha);
            color: var(--primary-dark);
        }

        .badge-success {
            background: var(--success-alpha);
            color: var(--success-dark);
        }

        .badge-warning {
            background: var(--warning-alpha);
            color: var(--warning-dark);
        }

        .badge-error {
            background: var(--error-alpha);
            color: var(--error-dark);
        }

        .badge-info {
            background: var(--info-alpha);
            color: var(--info-dark);
        }

        /* 优化的进度条组件 */
        .progress-enhanced {
            width: 100%;
            height: 12px;
            background: var(--light);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }

        .progress-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 4px,
                rgba(255, 255, 255, 0.1) 4px,
                rgba(255, 255, 255, 0.1) 8px
            );
            animation: progressPattern 1s linear infinite;
        }

        .progress-enhanced .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width var(--transition-normal);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
        }

        .progress-enhanced .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: progressShine 2s infinite;
        }

        @keyframes progressPattern {
            0% { transform: translateX(-8px); }
            100% { transform: translateX(0); }
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* =================== 高级动画效果系统 =================== */
        
        /* 粒子动画效果 */
        @keyframes particleFloat {
            0%, 100% { 
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            25% { 
                transform: translateY(-20px) rotate(90deg);
                opacity: 0.8;
            }
            50% { 
                transform: translateY(-10px) rotate(180deg);
                opacity: 0.6;
            }
            75% { 
                transform: translateY(-30px) rotate(270deg);
                opacity: 0.8;
            }
        }

        /* 流体波动效果 */
        @keyframes fluidWave {
            0% { 
                border-radius: 50% 40% 30% 60%;
                transform: rotate(0deg) scale(1);
            }
            25% { 
                border-radius: 40% 60% 50% 30%;
                transform: rotate(90deg) scale(1.05);
            }
            50% { 
                border-radius: 60% 30% 40% 50%;
                transform: rotate(180deg) scale(0.95);
            }
            75% { 
                border-radius: 30% 50% 60% 40%;
                transform: rotate(270deg) scale(1.02);
            }
            100% { 
                border-radius: 50% 40% 30% 60%;
                transform: rotate(360deg) scale(1);
            }
        }

        /* 彩虹流光效果 */
        @keyframes rainbowGlow {
            0% { filter: hue-rotate(0deg) brightness(1); }
            25% { filter: hue-rotate(90deg) brightness(1.2); }
            50% { filter: hue-rotate(180deg) brightness(1); }
            75% { filter: hue-rotate(270deg) brightness(1.2); }
            100% { filter: hue-rotate(360deg) brightness(1); }
        }

        /* 深度阴影动画 */
        @keyframes depthShadow {
            0% { 
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                transform: translateY(0);
            }
            50% { 
                box-shadow: 0 15px 35px rgba(0,0,0,0.2);
                transform: translateY(-3px);
            }
            100% { 
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                transform: translateY(0);
            }
        }

        /* 液体填充动画 */
        @keyframes liquidFill {
            0% { 
                background-position: 0% 100%;
                background-size: 200% 200%;
            }
            50% { 
                background-position: 100% 0%;
                background-size: 300% 300%;
            }
            100% { 
                background-position: 0% 100%;
                background-size: 200% 200%;
            }
        }

        /* 磁性吸引效果 */
        @keyframes magneticPull {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.02) rotate(1deg); }
            50% { transform: scale(1.05) rotate(0deg); }
            75% { transform: scale(1.02) rotate(-1deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* 数字滚动动画 */
        @keyframes numberRoll {
            0% { transform: translateY(100%); opacity: 0; }
            50% { transform: translateY(-10%); opacity: 0.8; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* 霓虹灯效果 */
        @keyframes neonGlow {
            0%, 100% { 
                text-shadow: 
                    0 0 5px var(--accent),
                    0 0 10px var(--accent),
                    0 0 15px var(--accent),
                    0 0 20px var(--accent);
            }
            50% { 
                text-shadow: 
                    0 0 10px var(--accent),
                    0 0 20px var(--accent),
                    0 0 30px var(--accent),
                    0 0 40px var(--accent);
            }
        }

        /* 动画类应用 */
        .particle-animation {
            position: relative;
            overflow: hidden;
        }

        .particle-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(77, 184, 214, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: particleFloat 8s ease-in-out infinite;
            pointer-events: none;
        }

        .fluid-animation {
            background: var(--gradient-ocean);
            animation: fluidWave 6s ease-in-out infinite;
        }

        .rainbow-glow {
            animation: rainbowGlow 4s linear infinite;
        }

        .depth-shadow {
            animation: depthShadow 3s ease-in-out infinite;
        }

        .liquid-fill {
            background: linear-gradient(45deg, 
                var(--primary) 0%, 
                var(--secondary) 25%, 
                var(--accent) 50%, 
                var(--secondary) 75%, 
                var(--primary) 100%);
            animation: liquidFill 5s ease-in-out infinite;
        }

        .magnetic-pull:hover {
            animation: magneticPull 0.6s ease-in-out;
        }

        .number-roll {
            animation: numberRoll 0.8s ease-out;
        }

        .neon-glow {
            animation: neonGlow 2s ease-in-out infinite alternate;
        }

        /* 交互式3D卡片效果 */
        .card-3d {
            perspective: 1000px;
            transform-style: preserve-3d;
            transition: all var(--transition-normal);
        }

        .card-3d:hover {
            transform: rotateY(10deg) rotateX(5deg);
            box-shadow: 
                20px 20px 40px rgba(0,0,0,0.1),
                -20px -20px 40px rgba(255,255,255,0.1);
        }

        .card-3d::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform var(--transition-slow);
        }

        .card-3d:hover::before {
            transform: translateX(100%);
        }

        /* 高级按钮效果 */
        .btn-advanced {
            position: relative;
            background: var(--gradient-primary);
            border: none;
            color: var(--white);
            padding: var(--space-4) var(--space-8);
            border-radius: var(--radius-xl);
            font-weight: var(--font-semibold);
            cursor: pointer;
            overflow: hidden;
            transition: all var(--transition-normal);
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: var(--shadow-lg);
        }

        .btn-advanced::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all var(--transition-normal);
        }

        .btn-advanced:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-advanced:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-2xl);
        }

        .btn-advanced:active {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        /* 波纹点击效果 */
        .ripple-effect {
            position: relative;
            overflow: hidden;
        }

        .ripple-effect::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
        }

        .ripple-effect:active::after {
            width: 200px;
            height: 200px;
            opacity: 0;
        }

        /* 加载指示器增强 */
        .loading-enhanced {
            display: inline-block;
            width: 60px;
            height: 60px;
            position: relative;
        }

        .loading-enhanced::before,
        .loading-enhanced::after {
            content: '';
            position: absolute;
            border: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-enhanced::before {
            width: 60px;
            height: 60px;
            border-top-color: transparent;
        }

        .loading-enhanced::after {
            width: 40px;
            height: 40px;
            top: 10px;
            left: 10px;
            border-bottom-color: transparent;
            animation-direction: reverse;
            animation-duration: 0.8s;
        }

        /* 梯度文字效果 */
        .gradient-text {
            background: var(--gradient-ocean);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: liquidFill 3s ease-in-out infinite;
        }

        /* 添加动画关键帧 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* 学生特定样式 */
        .student-only {
            display: none;
        }

        .teacher-only {
            display: none;
        }

        body.student .student-only {
            display: block;
        }

        body.teacher .teacher-only {
            display: block;
        }

        /* 密码修改样式 */
        .password-change-form {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            margin-top: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .password-change-form .form-group {
            margin-bottom: var(--space-4);
        }

        .password-change-form .form-input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 1px solid rgba(30, 111, 168, 0.2);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            transition: all var(--transition-normal);
        }

        .password-change-form .form-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(77, 184, 214, 0.1);
        }

        /* GitHub连接状态 */
        .github-status {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            margin-bottom: var(--space-4);
        }

        .github-status.connected {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }

        .github-status.disconnected {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .github-status.connecting {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        /* 消息提示样式增强 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--accent);
            z-index: 10001;
            transform: translateX(400px);
            transition: transform var(--transition-normal);
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--error);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        /* 加载状态样式 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* 精确响应式设计 */
        @media (max-width: 1440px) {
            .main-content {
                max-width: 1000px;
            }
        }

        @media (max-width: 1200px) {
            .upload-tabs {
                flex-wrap: wrap;
            }
            
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: var(--space-4);
            }
            
            .exercise-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .timeline-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .header-content {
                padding: 0 var(--space-4);
            }
            
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--primary);
                flex-direction: column;
                padding: var(--space-4);
                box-shadow: var(--shadow-lg);
                z-index: 1000;
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .grade-form {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }
        }

        @media (max-width: 768px) {
            .login-container {
                margin: var(--space-4);
                padding: var(--space-6);
                max-width: 90vw;
            }
            
            .upload-container {
                padding: var(--space-4);
                margin-bottom: var(--space-6);
            }
            
            .drop-zone {
                padding: var(--space-6);
            }
            
            .modal-content {
                max-width: 95vw;
                margin: var(--space-2);
            }
            
            .question-container {
                padding: var(--space-4);
            }
            
            .video-player-controls {
                padding: var(--space-2);
            }
            
            .section-title {
                font-size: 1.75rem;
                flex-direction: column;
                text-align: center;
                gap: var(--space-2);
            }
            
            .user-info {
                flex-direction: column;
                gap: var(--space-1);
                text-align: center;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
                gap: var(--space-4);
            }
            
            .exercise-grid {
                grid-template-columns: 1fr;
                gap: var(--space-4);
            }
        }

        @media (max-width: 576px) {
            .main-content {
                padding: var(--space-4) var(--space-3);
            }
            
            .upload-tabs {
                flex-direction: column;
                gap: var(--space-2);
            }
            
            .upload-tab {
                padding: var(--space-2) var(--space-3);
                font-size: 0.875rem;
            }
            
            .question-option {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-2);
            }
            
            .card {
                padding: var(--space-4);
            }
            
            .form-group {
                margin-bottom: var(--space-3);
            }
            
            .login-title {
                font-size: 1.5rem;
            }
            
            .login-subtitle {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .logo-text {
                font-size: 1rem;
            }
            
            .logo-icon {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }
            
            .watermark::before {
                font-size: 1.5rem;
            }
            
            .section-icon {
                width: 40px;
                height: 40px;
                font-size: 1.25rem;
            }
            
            .upload-container {
                padding: var(--space-3);
            }
            
            .drop-zone {
                padding: var(--space-4);
            }
            
            .drop-zone i {
                font-size: 2rem;
            }
        }

        @media (max-width: 360px) {
            .main-content {
                padding: var(--space-3) var(--space-2);
            }
            
            .login-container {
                padding: var(--space-4);
                margin: var(--space-2);
            }
            
            .card {
                padding: var(--space-3);
            }
            
            .modal-content {
                max-width: 98vw;
                margin: var(--space-1);
            }
        }

        /* 超宽屏适配 */
        @media (min-width: 1920px) {
            .main-content {
                max-width: 1400px;
            }
            
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
            
            .exercise-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
        }

        /* 高分辨率屏幕适配 */
        @media (min-resolution: 2dppx) {
            .logo-icon,
            .section-icon {
                transform: scale(0.9);
            }
        }

        /* 复习规划样式 */
        .review-planner {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-6);
        }

        .timeline-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--space-6);
            margin-top: var(--space-6);
        }

        .timeline-month {
            margin-bottom: var(--space-8);
        }

        .month-title {
            font-size: 1.25rem;
            color: var(--secondary);
            margin-bottom: var(--space-4);
            padding-left: var(--space-3);
            border-left: 3px solid var(--accent);
        }

        .plan-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--space-4);
            padding: var(--space-3);
            background: rgba(236, 240, 241, 0.5);
            border-radius: var(--radius-lg);
            transition: all var(--transition-normal);
        }

        .plan-item:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateX(5px);
        }

        .week-label {
            background: var(--accent);
            color: white;
            font-weight: 600;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-md);
            min-width: 80px;
            text-align: center;
            margin-right: var(--space-4);
        }

        .plan-content {
            flex: 1;
        }

        .plan-content h4 {
            margin-bottom: var(--space-2);
            color: var(--dark);
        }

        .plan-content p {
            font-size: 0.875rem;
            color: #5e7c9c;
        }

        .status-check {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-left: var(--space-3);
        }

        .status-check.completed {
            background: var(--success);
            border-color: var(--success);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-check.completed::before {
            content: "✓";
            color: white;
            font-size: 0.875rem;
        }

        /* 视频课程样式 */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-6);
            margin-top: var(--space-6);
        }

        .video-card {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .video-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }
        
        .video-card.featured {
            border: 2px solid var(--accent);
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            position: relative;
        }
        
        .video-card.featured::before {
            content: '推荐';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 1;
        }

        .video-preview {
            height: 160px;
            background: linear-gradient(45deg, var(--primary), #316399);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-preview i {
            font-size: 3.75rem;
            color: rgba(255, 255, 255, 0.15);
        }

        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-size: 1.375rem;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .play-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            background: white;
        }

        .video-info {
            padding: var(--space-6);
            position: relative;
        }

        .video-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: var(--space-3);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* 教师端管理按钮 */
        .content-actions {
            position: absolute;
            top: var(--space-2);
            right: var(--space-2);
            display: flex;
            gap: var(--space-1);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .video-card:hover .content-actions,
        .exercise-card:hover .content-actions {
            opacity: 1;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            transition: all var(--transition-normal);
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .action-btn.edit {
            background: rgba(52, 152, 219, 0.8);
        }

        .action-btn.delete {
            background: rgba(231, 76, 60, 0.8);
        }

        .action-btn.edit:hover {
            background: rgba(52, 152, 219, 1);
        }

        .action-btn.delete:hover {
            background: rgba(231, 76, 60, 1);
        }

        .video-description {
            color: #5e7c9c;
            font-size: 0.875rem;
            margin-bottom: var(--space-4);
            line-height: 1.5;
        }

        .video-duration {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #6d8db0;
            font-size: 0.875rem;
        }

        /* 题库练习样式 */
        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-top: var(--space-6);
        }

        .exercise-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--accent);
            transition: all var(--transition-normal);
        }

        .exercise-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .exercise-title {
            font-weight: 700;
            font-size: 1.0625rem;
            margin-bottom: var(--space-4);
            color: var(--primary);
        }

        .exercise-meta {
            display: flex;
            justify-content: space-between;
            color: var(--secondary);
            font-size: 0.875rem;
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid #e3edfa;
        }

        .start-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: 0.875rem;
            width: 100%;
            text-align: center;
            transition: all var(--transition-normal);
            font-weight: 500;
        }

        .start-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        /* 复习规划样式 */
        .university-info {
            margin-bottom: var(--space-8);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .info-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: all var(--transition-normal);
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .info-card h3 {
            color: var(--primary);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .info-card p {
            margin-bottom: var(--space-2);
            line-height: var(--leading-relaxed);
        }

        .reference-book {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--light);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
        }

        .book-icon {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .review-tips {
            background: var(--accent-alpha);
            border: 1px solid var(--accent);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-top: var(--space-6);
        }

        .review-tips h3 {
            color: var(--accent-dark);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .review-tips p {
            margin-bottom: var(--space-3);
            line-height: var(--leading-relaxed);
        }

        .review-planner {
            background: var(--white);
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
        }

        .planner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 2px solid var(--border);
        }

        .planner-header h3 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .progress-header {
            background: var(--accent);
            color: white;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
        }

        .timeline-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
        }

        .timeline-month {
            position: relative;
        }

        .timeline-month::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--accent);
        }

        .month-title {
            color: var(--primary);
            margin-bottom: var(--space-4);
            padding-left: var(--space-8);
            position: relative;
        }

        .month-title::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--accent);
            border-radius: 50%;
            border: 3px solid var(--white);
        }

        .plan-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
            padding-left: var(--space-8);
        }

        .week-label {
            background: var(--secondary);
            color: white;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .plan-content {
            flex: 1;
            background: var(--light);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--accent);
        }

        .plan-content h4 {
            color: var(--primary);
            margin-bottom: var(--space-2);
        }

        .plan-content p {
            color: var(--secondary);
            font-size: var(--text-sm);
            line-height: var(--leading-relaxed);
        }

        .plan-status {
            display: flex;
            align-items: center;
        }

        .status-check {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .status-check.completed {
            background: var(--success);
            border-color: var(--success);
            position: relative;
        }

        .status-check.completed::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: var(--text-xs);
            font-weight: bold;
        }

        .review-notes {
            background: var(--light);
            padding: var(--space-6);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
        }

        .review-notes h4 {
            color: var(--primary);
            margin-bottom: var(--space-4);
        }

        .review-notes ul {
            list-style: none;
            padding: 0;
        }

        .review-notes li {
            padding: var(--space-2) 0;
            padding-left: var(--space-4);
            position: relative;
            line-height: var(--leading-relaxed);
        }

        .review-notes li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--accent);
            font-weight: bold;
        }

        /* 分数线样式 */
        .score-chart-container {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            margin-top: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
        }

        .chart-box {
            height: 400px;
            position: relative;
        }

        .score-filters {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: var(--space-2) var(--space-4);
            border: 1px solid #e3edfa;
            border-radius: var(--radius-full);
            background: white;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* 成绩管理样式 */
        .grade-container {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            margin-top: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .grade-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: var(--space-4);
            margin-bottom: var(--space-8);
        }

        .grade-form input {
            padding: var(--space-3) var(--space-4);
            border: 1px solid #ddd;
            border-radius: var(--radius-lg);
            font-size: 1rem;
        }

        .add-grade-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            padding: 0 var(--space-6);
        }

        .add-grade-btn:hover {
            background: var(--secondary);
        }

        /* 响应式设计增强 */
        @media (max-width: 992px) {
            .timeline-container {
                grid-template-columns: 1fr;
            }
            
            .grade-form {
                grid-template-columns: 1fr;
            }
            
            .score-filters {
                flex-wrap: wrap;
                gap: var(--space-2);
            }
        }

        @media (max-width: 480px) {
            .login-title {
                font-size: 1.5rem;
            }
            
            .login-container {
                padding: var(--space-6);
            }
            
            .header-content {
                padding: var(--space-3);
            }
            
            .logo-text {
                font-size: 1.125rem;
            }
            
            .main-content {
                padding: var(--space-6) var(--space-4);
            }
        }
        
        /* 确保所有文本都可选择（但仍保护敏感内容） */
        .video-title,
        .exercise-title,
        .video-description,
        .modal-body p,
        .card p,
        .plan-content {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }

        /* 全屏模式优化 */
        .modal-overlay:fullscreen {
            background: #000;
        }
        
        .modal-overlay:fullscreen .modal-content {
            max-width: 100vw;
            max-height: 100vh;
            width: 100%;
            height: 100%;
            border-radius: 0;
        }

        .modal-overlay:fullscreen .video-container {
            height: calc(100vh - 120px);
        }

        /* 视频播放器全屏适配 */
        video:fullscreen {
            width: 100vw !important;
            height: 100vh !important;
            object-fit: contain;
        }

        iframe:fullscreen {
            width: 100vw !important;
            height: 100vh !important;
        }

        /* 确保视频控件在全屏时可见 */
        .video-player-controls {
            z-index: 10001;
        }

        /* 动画优化 */
        .video-card,
        .exercise-card {
            will-change: transform;
        }

        .action-btn {
            will-change: transform, opacity;
        }

        /* 触摸设备优化 */
        @media (hover: none) and (pointer: coarse) {
            .content-actions {
                opacity: 1;
            }
            
            .video-card:hover,
            .exercise-card:hover {
                transform: none;
            }
            
            .action-btn:hover {
                transform: none;
            }
        }

        /* 超高分辨率显示优化 */
        @media (min-resolution: 3dppx) {
            .video-preview i,
            .section-icon i,
            .logo-icon i {
                transform: scale(0.8);
            }
        }

        /* =================== 完善的响应式设计系统 =================== */

        /* 极小屏设备 (< 320px) */
        @media (max-width: 319px) {
            .main-content {
                padding: var(--space-2) var(--space-1);
            }
            
            .login-container {
                padding: var(--space-3);
                margin: var(--space-1);
                max-width: calc(100vw - 16px);
            }
            
            .login-title {
                font-size: var(--text-lg);
            }
            
            .login-subtitle {
                font-size: var(--text-sm);
            }
            
            .header-content {
                padding: 0 var(--space-2);
            }
            
            .nav-menu {
                padding: var(--space-2);
                font-size: var(--text-sm);
            }
            
            .card {
                padding: var(--space-2);
                margin-bottom: var(--space-3);
            }
            
            .modal-content {
                max-width: 98vw;
                margin: var(--space-1);
            }
            
            .modal-header,
            .modal-body,
            .modal-footer {
                padding: var(--space-3);
            }
        }

        /* 小屏手机 (320px - 374px) */
        @media (min-width: 320px) and (max-width: 374px) {
            .video-grid,
            .exercise-grid {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }
            
            .timeline-container {
                grid-template-columns: 1fr;
                gap: var(--space-4);
            }
            
            .form-group {
                margin-bottom: var(--space-3);
            }
            
            .upload-tabs {
                flex-direction: column;
                gap: var(--space-1);
            }
            
            .upload-tab {
                padding: var(--space-2) var(--space-3);
                font-size: var(--text-sm);
                text-align: center;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .btn-group {
                flex-direction: column;
                gap: var(--space-2);
            }
        }

        /* 中等手机 (375px - 424px) */
        @media (min-width: 375px) and (max-width: 424px) {
            .section-title {
                font-size: var(--text-2xl);
            }
            
            .video-card,
            .exercise-card {
                border-radius: var(--radius-lg);
            }
            
            .drop-zone {
                padding: var(--space-6);
            }
            
            .image-tools {
                flex-wrap: wrap;
                gap: var(--space-2);
            }
            
            .image-tool-btn {
                flex: 1;
                min-width: 120px;
            }
        }

        /* 大屏手机 (425px - 767px) */
        @media (min-width: 425px) and (max-width: 767px) {
            .video-grid,
            .exercise-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: var(--space-4);
            }
            
            .upload-tabs {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .modal-content {
                max-width: 90vw;
                margin: var(--space-4);
            }
            
            .btn-group {
                flex-direction: row;
                flex-wrap: wrap;
                gap: var(--space-2);
            }
            
            .btn-group .btn {
                flex: 1;
                min-width: 120px;
            }
        }

        /* 练习模态框样式 */
        .exercise-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .exercise-modal.active {
            opacity: 1;
        }

        .exercise-modal-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .exercise-modal.active .exercise-modal-content {
            transform: scale(1);
        }

        .exercise-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--border);
        }

        .exercise-modal-header h3 {
            margin: 0;
            color: var(--primary);
        }

        .exercise-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }

        .exercise-info {
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        .exercise-info p {
            margin: 0;
            color: var(--secondary);
            font-size: var(--text-sm);
        }

        .exercise-actions {
            display: flex;
            gap: var(--space-4);
            justify-content: center;
        }

        .exercise-actions .btn {
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-lg);
            font-weight: 600;
            transition: all var(--transition-normal);
        }

        .exercise-actions .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
        }

        .exercise-actions .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .exercise-actions .btn-secondary {
            background: var(--secondary);
            color: white;
            border: none;
        }

        .exercise-actions .btn-secondary:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
        }

        /* 平板竖屏 (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .video-grid,
            .exercise-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: var(--space-5);
            }
            
            .timeline-container {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                gap: var(--space-6);
            }
            
            .grade-form {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-4);
            }
            
            .upload-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: var(--space-6);
                align-items: start;
            }
            
            .modal-content {
                max-width: 80vw;
                margin: var(--space-8);
            }
        }

        /* 平板横屏 & 小笔记本 (1024px - 1279px) */
        @media (min-width: 1024px) and (max-width: 1279px) {
            .main-content {
                max-width: 1000px;
                padding: var(--space-8) var(--space-6);
            }
            
            .video-grid,
            .exercise-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: var(--space-6);
            }
            
            .timeline-container {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-8);
            }
            
            .header-content {
                padding: 0 var(--space-6);
            }
            
            .nav-menu {
                gap: var(--space-4);
            }
            
            .nav-link {
                padding: var(--space-3) var(--space-4);
            }
        }

        /* 桌面 (1280px - 1535px) */
        @media (min-width: 1280px) and (max-width: 1535px) {
            .main-content {
                max-width: 1200px;
                padding: var(--space-8);
            }
            
            .video-grid,
            .exercise-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: var(--space-6);
            }
            
            .timeline-container {
                grid-template-columns: repeat(3, 1fr);
                gap: var(--space-8);
            }
            
            .upload-container {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: var(--space-8);
                align-items: start;
            }
            
            .modal-content {
                max-width: 70vw;
                margin: var(--space-12);
            }
        }

        /* 大桌面 (1536px+) */
        @media (min-width: 1536px) {
            .main-content {
                max-width: 1400px;
                padding: var(--space-12);
            }
            
            .video-grid,
            .exercise-grid {
                grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
                gap: var(--space-8);
            }
            
            .timeline-container {
                grid-template-columns: repeat(4, 1fr);
                gap: var(--space-10);
            }
            
            .section-title {
                font-size: var(--text-4xl);
                margin-bottom: var(--space-8);
            }
            
            .card {
                padding: var(--space-8);
            }
            
            .modal-content {
                max-width: 60vw;
                margin: var(--space-16);
            }
        }

        /* 超宽屏 (2560px+) */
        @media (min-width: 2560px) {
            .main-content {
                max-width: 1800px;
                padding: var(--space-16);
            }
            
            .video-grid,
            .exercise-grid {
                grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
                gap: var(--space-10);
            }
            
            .timeline-container {
                grid-template-columns: repeat(5, 1fr);
                gap: var(--space-12);
            }
            
            .header-content {
                padding: 0 var(--space-16);
            }
            
            .section-title {
                font-size: var(--text-5xl);
                margin-bottom: var(--space-12);
            }
        }

        /* 打印样式优化 */
        @media print {
            .header,
            .nav-menu,
            .mobile-menu-toggle,
            .upload-container,
            .settings-section,
            .action-btn,
            .btn,
            .modal-overlay,
            .toast,
            .watermark {
                display: none !important;
            }
            
            .main-content {
                max-width: 100% !important;
                margin: 0 !important;
                padding: 1cm !important;
            }
            
            .card {
                break-inside: avoid;
                margin-bottom: 1cm;
            }
            
            .section-title {
                break-after: avoid;
            }
            
            body {
                background: white !important;
                color: black !important;
                font-size: 12pt !important;
                line-height: 1.4 !important;
            }
        }

        /* 横屏设备特定优化 */
        @media (orientation: landscape) and (max-height: 500px) {
            .header {
                padding: var(--space-2) 0;
            }
            
            .header-content {
                padding: 0 var(--space-3);
            }
            
            .logo-text {
                font-size: var(--text-lg);
            }
            
            .nav-menu {
                gap: var(--space-2);
            }
            
            .nav-link {
                padding: var(--space-2) var(--space-3);
                font-size: var(--text-sm);
            }
            
            .main-content {
                padding-top: var(--space-4);
            }
            
            .modal-content {
                max-height: 85vh;
            }
        }

        /* 高对比度模式支持 */
        @media (prefers-contrast: high) {
            :root {
                --border: #000000;
                --shadow-sm: 0 2px 4px 0 rgba(0, 0, 0, 0.3);
                --shadow-md: 0 4px 8px 0 rgba(0, 0, 0, 0.3);
                --shadow-lg: 0 8px 16px 0 rgba(0, 0, 0, 0.3);
            }
            
            .card,
            .input,
            .btn {
                border: 2px solid var(--dark);
            }
            
            .btn-primary,
            .btn-secondary,
            .btn-accent {
                background: var(--dark);
                color: var(--white);
            }
        }

        /* 减少动画偏好支持 */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
            
            .watermark::before {
                animation: none;
            }
            
            .progress-enhanced::before,
            .progress-enhanced .progress-bar::after {
                animation: none;
            }
        }
        
        /* 成绩列表样式 */
        .grade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-3);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all var(--transition-normal);
        }
        
        .grade-item:hover {
            background: rgba(255, 255, 255, 1);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .grade-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        
        .grade-name {
            font-weight: 600;
            color: var(--primary);
            font-size: 1rem;
        }
        
        .grade-score {
            color: var(--secondary);
            font-size: 0.875rem;
        }
        
        .grade-actions {
            display: flex;
            gap: var(--space-2);
        }
        
        .edit-btn, .delete-btn {
            background: none;
            border: none;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            font-size: 0.875rem;
        }
        
        .edit-btn {
            color: var(--accent);
        }
        
        .edit-btn:hover {
            background: rgba(77, 184, 214, 0.1);
        }
        
        .delete-btn {
            color: var(--error);
        }
        
        .delete-btn:hover {
            background: rgba(231, 76, 60, 0.1);
        }
    </style>
</head>
<body class="login-page">
    <!-- 跳过链接，提高可访问性 -->
    <a href="#main-content" class="skip-link">跳转到主要内容</a>
    
    <!-- 浮动气泡效果 -->
    <div class="floating-bubble"></div>
    <div class="floating-bubble"></div>
    <div class="floating-bubble"></div>
    <div class="floating-bubble"></div>
    
    <!-- 登录系统 -->
    <div id="loginSystem" class="login-system">
        <div class="login-container">
            <div class="login-header">
                <h1 class="login-title">流体力学学习平台</h1>
                <p class="login-subtitle">中国海洋大学 | 803流体力学</p>
                <div style="text-align: center;">
                    <small style="color: var(--secondary); font-style: italic;">
                        探索流动世界的奥秘 · 理解自然规律的艺术
                    </small>
                </div>
            </div>
            
            <div id="loginMessage" class="message" role="alert" aria-live="polite"></div>
            
            <form id="loginForm" class="login-form" novalidate>
                <div class="form-group">
                    <label for="username" class="form-label">
                        <i class="fas fa-user" aria-hidden="true"></i>
                        用户名
                    </label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username"
                        class="form-input" 
                        placeholder="请输入用户名"
                        autocomplete="username"
                        required
                        maxlength="50">
                </div>
                
                <div class="form-group">
                    <label for="password" class="form-label">
                        <i class="fas fa-lock" aria-hidden="true"></i>
                        密码
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password"
                        class="form-input" 
                        placeholder="请输入密码"
                        autocomplete="current-password"
                        required
                        minlength="6"
                        maxlength="100">
                </div>
                
                <button type="submit" id="loginButton" class="login-button">
                    <span id="loginButtonText">登录</span>
                    <div id="loginButtonSpinner" class="loading" style="display: none;"></div>
                </button>
            </form>
            
            <div class="forgot-password">
                <a href="#" onclick="showPasswordResetModal()" aria-label="找回密码">
                    忘记密码？
                </a>
            </div>
        </div>
    </div>
    
    <!-- 主平台界面 -->
    <div id="platform" class="platform">
        <header class="header">
            <div class="featured-banner">
                今日推荐：流体力学之美 - 探索流动世界的奥秘
            </div>
            
            <div class="header-content">
                <div class="logo" onclick="showSection('home')" role="button" tabindex="0" aria-label="返回首页">
                    <div class="logo-icon">
                        <i class="fas fa-water" aria-hidden="true"></i>
                    </div>
                    <h1 class="logo-text">流体力学学习平台</h1>
                </div>
                
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="切换移动端菜单">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>
                
                <nav id="mainNav" role="navigation" aria-label="主导航">
                    <ul class="nav-menu">
                        <li><a href="#" class="nav-link active" onclick="showSection('home')" aria-current="page">
                            <i class="fas fa-home" aria-hidden="true"></i><span>首页</span></a></li>
                        <li><a href="#" class="nav-link" onclick="showSection('review')">
                            <i class="fas fa-book" aria-hidden="true"></i><span>复习规划</span></a></li>
                        <li><a href="#" class="nav-link" onclick="showSection('videos')">
                            <i class="fas fa-video" aria-hidden="true"></i><span>视频课程</span></a></li>
                        <li class="teacher-only"><a href="#" class="nav-link" onclick="showSection('uploadVideo')">
                            <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i><span>上传视频</span></a></li>
                        <li><a href="#" class="nav-link" onclick="showSection('exercises')">
                            <i class="fas fa-question-circle" aria-hidden="true"></i><span>题库练习</span></a></li>
                        <li class="teacher-only"><a href="#" class="nav-link" onclick="showSection('uploadExercise')">
                            <i class="fas fa-file-upload" aria-hidden="true"></i><span>上传练习</span></a></li>
                        <li><a href="#" class="nav-link" onclick="showSection('scores')">
                            <i class="fas fa-chart-line" aria-hidden="true"></i><span>分数线</span></a></li>
                        <li class="teacher-only"><a href="#" class="nav-link" onclick="showSection('grades')">
                            <i class="fas fa-graduation-cap" aria-hidden="true"></i><span>成绩录入</span></a></li>
                        <li><a href="#" class="nav-link" onclick="showSection('settings')">
                            <i class="fas fa-cogs" aria-hidden="true"></i><span>设置</span></a></li>
                    </ul>
                </nav>
                
                <div class="user-section">
                    <div class="user-info">
                        <div id="userAvatar" class="user-avatar">用</div>
                        <div>
                            <div id="displayUsername" style="font-weight: 600;">用户</div>
                            <div id="userRole" style="font-size: 0.75rem; opacity: 0.8;">学生</div>
                        </div>
                    </div>
                    
                    <button class="logout-button" onclick="logout()" aria-label="退出登录" title="退出登录">
                        <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <main id="main-content" class="main-content">
            <!-- 首页 -->
            <section id="homeSection" class="content-section active">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-home" aria-hidden="true"></i>
                    </div>
                    <h2>欢迎来到流体力学学习平台</h2>
                </div>
                
                <div class="card">
                    <h3 style="margin-bottom: var(--space-4); color: var(--primary);">平台简介</h3>
                    <p style="line-height: 1.6; margin-bottom: var(--space-4);">
                        本平台是为中国海洋大学803流体力学考研学生打造的专业学习系统，
                        提供完整的复习规划、精品视频课程、全面的题库练习和详细的分数线分析。
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4); margin-top: var(--space-6);">
                        <div style="text-align: center; padding: var(--space-4); border-radius: var(--radius-lg); background: rgba(30, 111, 168, 0.1); cursor: pointer; transition: all 0.3s ease;" onclick="showSection('review')" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 25px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-book" style="font-size: 2rem; color: var(--primary); margin-bottom: var(--space-2);"></i>
                            <h4 style="color: var(--primary); margin-bottom: var(--space-1);">系统复习</h4>
                            <p style="font-size: 0.875rem; color: var(--secondary);">科学规划复习进度</p>
                        </div>
                        <div style="text-align: center; padding: var(--space-4); border-radius: var(--radius-lg); background: rgba(44, 154, 183, 0.1); cursor: pointer; transition: all 0.3s ease;" onclick="showSection('videos')" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 25px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-video" style="font-size: 2rem; color: var(--secondary); margin-bottom: var(--space-2);"></i>
                            <h4 style="color: var(--secondary); margin-bottom: var(--space-1);">精品课程</h4>
                            <p style="font-size: 0.875rem; color: var(--secondary);">高质量教学视频</p>
                        </div>
                        <div style="text-align: center; padding: var(--space-4); border-radius: var(--radius-lg); background: rgba(77, 184, 214, 0.1); cursor: pointer; transition: all 0.3s ease;" onclick="showSection('exercises')" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 25px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-question-circle" style="font-size: 2rem; color: var(--accent); margin-bottom: var(--space-2);"></i>
                            <h4 style="color: var(--accent); margin-bottom: var(--space-1);">题库练习</h4>
                            <p style="font-size: 0.875rem; color: var(--secondary);">全面的习题训练</p>
                        </div>
                    </div>
                </div>
            </section>



            <!-- 视频课程 -->
            <section id="videosSection" class="content-section">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-video" aria-hidden="true"></i>
                    </div>
                    <h2>流体力学视频课程</h2>
                </div>
                
                <div id="videoGrid" class="video-grid">
                    <!-- 视频卡片将通过JavaScript动态生成 -->
                </div>
            </section>

            <!-- 题库练习 -->
            <section id="exercisesSection" class="content-section">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-question-circle" aria-hidden="true"></i>
                    </div>
                    <h2>题库练习系统</h2>
                </div>
                
                <div id="exerciseGrid" class="exercise-grid">
                    <!-- 练习卡片将通过JavaScript动态生成 -->
                </div>
            </section>

            <!-- 复习规划 -->
            <section id="reviewSection" class="content-section">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-book" aria-hidden="true"></i>
                    </div>
                    <h2>专业课复习规划 (803流体力学)</h2>
                </div>
                
                <div class="university-info">
                    <div class="info-grid">
                        <div class="info-card">
                            <h3><i class="fas fa-university"></i> 院校专业情况简述</h3>
                            <p><strong>2025年招生情况：</strong></p>
                            <p>• 统考名额：38人（默认）→ 35人（复试时）</p>
                            <p>• 调剂名额：0人</p>
                            <p>• 复试人数：35人</p>
                            <p>• 录取人数：35人</p>
                            <p>• 复试比例：1.0</p>
                            <p>• 专业报名人数：125人</p>
                            <p>• 录取率：28.0%</p>
                            <p>• 分数线：274分（国家线）</p>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-graduation-cap"></i> 考试要求</h3>
                            <p>要求考生能系统理解流体力学的基本概念和基本原理，掌握流体力学的基本思想与方法，具有较好的流体力学知识以及运用所学知识分析问题和解决问题的能力。</p>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-file-alt"></i> 考试形式</h3>
                            <p>闭卷考试，满分150分，考试时间180分钟</p>
                            <p>基础理论（40%），理想流体（30%），粘性流体（30%）</p>
                        </div>
                    </div>
                    
                    <div class="info-grid" style="margin-top: 25px;">
                        <div class="info-card">
                            <h3><i class="fas fa-book-open"></i> 初试参考书目</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>流体力学（第二版）</strong>
                                    <p>吴望一 | 北京大学出版社 | 2021年</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-book"></i> 初试辅助书籍</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>流体力学（第二版）</strong>
                                    <p>周光炯 | 高等教育出版社</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-book"></i> 复试参考书目</h3>
                            <div class="reference-book">
                                <div class="book-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div>
                                    <strong>物理海洋学</strong>
                                    <p>董昌明 | 科学出版社 | 2019年</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-tips">
                        <h3><i class="fas fa-lightbulb"></i> 复习建议</h3>
                        <p><strong>基础阶段：</strong>学习基础知识，先读流体力学第二版，看郑桂珍网课</p>
                        <p><strong>强化阶段：</strong>基础知识串讲，带练</p>
                        <p><strong>真题阶段：</strong>真题做两遍，重点真题讲解</p>
                        <p><strong>复试准备：</strong>物理海洋学占复试内容的80%，需重点复习</p>
                    </div>
                </div>
                
                <div class="review-planner" style="margin-top: 25px;">
                    <div class="planner-header">
                        <h3><i class="fas fa-calendar-alt"></i> 专业课复习时间表</h3>
                        <div class="progress-header">
                            <span>完成进度：35%</span>
                        </div>
                    </div>
                    
                    <div class="timeline-container">
                        <div class="timeline-month">
                            <h3 class="month-title">7月 - 基础巩固</h3>
                            <div class="plan-item">
                                <div class="week-label">第1周</div>
                                <div class="plan-content">
                                    <h4>流体的物理性质</h4>
                                    <p>连续介质模型、牛顿流体与非牛顿流体、流体的粘滞性</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check completed"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第2周</div>
                                <div class="plan-content">
                                    <h4>本构方程和亥姆霍兹定理</h4>
                                    <p>应力张量、本构方程、速度分解定理</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check completed"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第3-4周</div>
                                <div class="plan-content">
                                    <h4>理想流体动量方程</h4>
                                    <p>欧拉方程、伯努利方程及应用</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">8月 - 核心原理</h3>
                            <div class="plan-item">
                                <div class="week-label">第1周</div>
                                <div class="plan-content">
                                    <h4>流体力学方程组</h4>
                                    <p>连续性方程、动量方程、能量方程</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第2周</div>
                                <div class="plan-content">
                                    <h4>涡旋运动</h4>
                                    <p>涡量、环量、涡旋运动基本定理</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第3-4周</div>
                                <div class="plan-content">
                                    <h4>势流理论基础</h4>
                                    <p>速度势函数、流函数、基本势流叠加原理</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">9月 - 专题深化</h3>
                            <div class="plan-item">
                                <div class="week-label">第1-2周</div>
                                <div class="plan-content">
                                    <h4>势流理论深化</h4>
                                    <p>布拉修斯定理、镜像法、机翼理论</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">10月 - 应用实践</h3>
                            <div class="plan-item">
                                <div class="week-label">第1周</div>
                                <div class="plan-content">
                                    <h4>相似原理与量纲分析</h4>
                                    <p>量纲齐次性原理、π定理应用、流动相似准数</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">第2-4周</div>
                                <div class="plan-content">
                                    <h4>粘性流体理论</h4>
                                    <p>NS方程、层流与湍流、边界层理论</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-month">
                            <h3 class="month-title">11-12月 - 真题冲刺</h3>
                            <div class="plan-item">
                                <div class="week-label">11月</div>
                                <div class="plan-content">
                                    <h4>真题精讲</h4>
                                    <p>历年真题解析与考点归纳</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                            <div class="plan-item">
                                <div class="week-label">12月</div>
                                <div class="plan-content">
                                    <h4>错题串讲</h4>
                                    <p>高频错题分析与解题技巧</p>
                                </div>
                                <div class="plan-status">
                                    <div class="status-check"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="review-planner" style="margin-top: 25px;">
                    <div class="planner-header">
                        <h3><i class="fas fa-tasks"></i> 课后复习注意事项</h3>
                    </div>
                    
                    <div class="review-notes">
                        <h4>复习规划补充说明</h4>
                        <ul>
                            <li>需保证质量完成课后任务，9月可以开始尝试做真题</li>
                            <li>不会的真题可以通过微信群或课堂提问</li>
                            <li>每周至少投入10小时进行专业课复习</li>
                            <li>重点掌握伯努利方程、NS方程和边界层理论</li>
                            <li>复试需同时准备物理海洋学内容</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- 分数线 -->
            <section id="scoresSection" class="content-section">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-chart-line" aria-hidden="true"></i>
                    </div>
                    <h2>国家线和复试线对比分析</h2>
                </div>
                
                <div class="score-filters">
                    <button class="filter-btn active" onclick="filterScores('all')">全部年份</button>
                    <button class="filter-btn" onclick="filterScores('2020')">2020年</button>
                    <button class="filter-btn" onclick="filterScores('2021')">2021年</button>
                    <button class="filter-btn" onclick="filterScores('2022')">2022年</button>
                    <button class="filter-btn" onclick="filterScores('2023')">2023年</button>
                    <button class="filter-btn" onclick="filterScores('2024')">2024年</button>
                    <button class="filter-btn" onclick="filterScores('2025')">2025年</button>
                </div>
                
                <div class="score-chart-container">
                    <div class="chart-header">
                        <h3>803流体力学报考人数与分数线 (2020-2025)</h3>
                        <div>
                            <span style="background: var(--reexam-color); padding: 5px 10px; border-radius: 4px; color: white;">复试线</span>
                            <span style="background: var(--national-color); padding: 5px 10px; border-radius: 4px; color: white; margin-left: 10px;">国家线</span>
                            <span style="background: #27ae60; padding: 5px 10px; border-radius: 4px; color: white; margin-left: 10px;">报名人数</span>
                        </div>
                    </div>
                    <div class="chart-box">
                        <canvas id="scoreChart"></canvas>
                    </div>
                    
                    <div class="score-details">
                        <h3><i class="fas fa-info-circle"></i> 分数线详情与差异分析</h3>
                        
                        <!-- 数据统计表格 -->
                        <div class="data-table-container" style="margin-bottom: 30px;">
                            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <thead>
                                    <tr style="background: var(--primary); color: white;">
                                        <th style="padding: 15px; text-align: center; border: none;">年份</th>
                                        <th style="padding: 15px; text-align: center; border: none;">国家线</th>
                                        <th style="padding: 15px; text-align: center; border: none;">复试线</th>
                                        <th style="padding: 15px; text-align: center; border: none;">报名人数</th>
                                        <th style="padding: 15px; text-align: center; border: none;">复试人数</th>
                                        <th style="padding: 15px; text-align: center; border: none;">录取人数</th>
                                        <th style="padding: 15px; text-align: center; border: none;">录取率</th>
                                        <th style="padding: 15px; text-align: center; border: none;">复试比例</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2020年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa; background: #f8f9fa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2021年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">280分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">313分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">32人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">29人</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">-</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.33</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2022年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">290分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">292分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">110人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">43人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">35人</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">31.8%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.3</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa; background: #f8f9fa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2023年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">279分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">294分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">105人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">30人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">27人</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">25.7%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.2</td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e3edfa;">
                                        <td style="padding: 12px; text-align: center; border: none;">2024年</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">288分</td>
                                        <td style="padding: 12px; text-align: center; border: none;">120人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">37人</td>
                                        <td style="padding: 12px; text-align: center; border: none;">37人</td>
                                        <td style="padding: 12px; text-align: center; border: none; color: var(--success);">30.8%</td>
                                        <td style="padding: 12px; text-align: center; border: none;">1.0</td>
                                    </tr>
                                    <tr style="background: #f0f8ff;">
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">2025年</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">274分</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">274分</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">125人</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">35人</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">35人</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold; color: var(--success);">28.0%</td>
                                        <td style="padding: 12px; text-align: center; border: none; font-weight: bold;">1.0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- 数据趋势分析 -->
                        <div class="trend-analysis" style="background: white; border-radius: 10px; padding: 25px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(26, 58, 87, 0.1);">
                            <h4 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chart-line"></i> 数据趋势分析
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">报名趋势</h5>
                                    <p style="margin-bottom: 5px;">2020年：-</p>
                                    <p style="margin-bottom: 5px;">2021年：-</p>
                                    <p style="margin-bottom: 5px;">2022年：110人</p>
                                    <p style="margin-bottom: 5px;">2023年：105人 <span style="color: var(--warning);">↓ 4.5%</span></p>
                                    <p style="margin-bottom: 5px;">2024年：120人 <span style="color: var(--success);">↑ 14.3%</span></p>
                                    <p>2025年：125人 <span style="color: var(--success);">↑ 4.2%</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--teacher);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">录取率变化</h5>
                                    <p style="margin-bottom: 5px;">2020年：-</p>
                                    <p style="margin-bottom: 5px;">2021年：-</p>
                                    <p style="margin-bottom: 5px;">2022年：31.8%</p>
                                    <p style="margin-bottom: 5px;">2023年：25.7% <span style="color: var(--warning);">↓ 6.1%</span></p>
                                    <p style="margin-bottom: 5px;">2024年：30.8% <span style="color: var(--success);">↑ 5.1%</span></p>
                                    <p>2025年：28.0% <span style="color: var(--warning);">↓ 2.8%</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--student);">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">分数线变化</h5>
                                    <p style="margin-bottom: 5px;">2020年：国家线288分，复试线288分</p>
                                    <p style="margin-bottom: 5px;">2021年：国家线280分，复试线313分</p>
                                    <p style="margin-bottom: 5px;">2022年：国家线290分，复试线292分</p>
                                    <p style="margin-bottom: 5px;">2023年：国家线279分，复试线294分</p>
                                    <p style="margin-bottom: 5px;">2024年：国家线288分，复试线288分</p>
                                    <p>2025年：国家线274分，复试线274分</p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #9b59b6;">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">复试比例变化</h5>
                                    <p style="margin-bottom: 5px;">2020年：-</p>
                                    <p style="margin-bottom: 5px;">2021年：1.33</p>
                                    <p style="margin-bottom: 5px;">2022年：1.3 <span style="color: var(--success);">↓ 0.03</span></p>
                                    <p style="margin-bottom: 5px;">2023年：1.2 <span style="color: var(--success);">↓ 0.1</span></p>
                                    <p style="margin-bottom: 5px;">2024年：1.0 <span style="color: var(--success);">↓ 0.2</span></p>
                                    <p>2025年：1.0 <span style="color: var(--success);">持平</span></p>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #e67e22;">
                                    <h5 style="color: var(--secondary); margin-bottom: 10px;">招生规模变化</h5>
                                    <p style="margin-bottom: 5px;">2020年：-</p>
                                    <p style="margin-bottom: 5px;">2021年：29人</p>
                                    <p style="margin-bottom: 5px;">2022年：35人 <span style="color: var(--success);">↑ 20.7%</span></p>
                                    <p style="margin-bottom: 5px;">2023年：27人 <span style="color: var(--warning);">↓ 22.9%</span></p>
                                    <p style="margin-bottom: 5px;">2024年：37人 <span style="color: var(--success);">↑ 37.0%</span></p>
                                    <p>2025年：35人 <span style="color: var(--warning);">↓ 5.4%</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 成绩录入 -->
            <section id="gradesSection" class="content-section">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-graduation-cap" aria-hidden="true"></i>
                    </div>
                    <h2>成绩录入管理</h2>
                </div>
                
                <div class="grade-container">
                    <form class="grade-form" onsubmit="addGrade(event)">
                        <input type="text" placeholder="学生姓名" id="studentName" required>
                        <input type="number" placeholder="成绩" id="gradeScore" min="0" max="150" required>
                        <button type="submit" class="add-grade-btn">添加成绩</button>
                    </form>
                    
                    <!-- 成绩统计图表 -->
                    <div style="margin: 32px 0;">
                        <canvas id="gradeChart" height="120"></canvas>
                    </div>
                    
                    <div id="gradesList" style="margin-top: var(--space-6);">
                        <p style="text-align: center; color: var(--secondary); padding: var(--space-8);">
                            暂无成绩记录
                        </p>
                    </div>
                </div>
            </section>

            <!-- 视频上传 -->
            <section id="uploadVideoSection" class="content-section">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i>
                    </div>
                    <h2>视频课程上传</h2>
                </div>
                
                <div class="upload-container">
                    <div class="upload-tabs">
                        <button class="upload-tab active" onclick="switchUploadTab('link')">链接上传</button>
                        <button class="upload-tab" onclick="switchUploadTab('file')">文件上传</button>
                        <button class="upload-tab" onclick="switchUploadTab('bilibili')">B站视频</button>
                        <button class="upload-tab" onclick="switchUploadTab('douyin')">抖音视频</button>
                    </div>
                    
                    <div id="linkUpload" class="upload-content active">
                        <div class="form-group">
                            <label class="form-label">视频链接</label>
                            <input type="url" class="form-input" placeholder="请输入视频链接" id="videoLink">
                        </div>
                        <div class="form-group">
                            <label class="form-label">视频标题</label>
                            <input type="text" class="form-input" placeholder="请输入视频标题" id="videoTitle">
                        </div>
                        <div class="form-group">
                            <label class="form-label">视频描述</label>
                            <textarea class="form-input" rows="4" placeholder="请输入视频描述" id="videoDescription"></textarea>
                        </div>
                        <button onclick="uploadVideoLink()" class="submit-btn">上传视频</button>
                    </div>
                    
                    <div id="fileUpload" class="upload-content">
                        <div class="drop-zone" onclick="document.getElementById('videoFile').click()">
                            <input type="file" id="videoFile" class="file-input" accept="video/*" onchange="handleVideoFile(this)">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h3>拖拽视频文件到此处</h3>
                            <p>或点击选择文件</p>
                            <small>支持 MP4, AVI, MOV, WMV 等格式</small>
                        </div>
                        <div class="upload-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="videoUploadProgress"></div>
                            </div>
                            <p id="videoUploadStatus">等待上传...</p>
                        </div>
                    </div>
                    
                    <div id="bilibiliUpload" class="upload-content">
                        <div class="form-group">
                            <label class="form-label">B站视频BV号</label>
                            <input type="text" class="form-input" placeholder="例如：BV16T421D7k4" id="bilibiliId">
                        </div>
                        <div class="form-group">
                            <label class="form-label">视频标题（可选）</label>
                            <input type="text" class="form-input" placeholder="自动获取或手动输入" id="bilibiliTitle">
                        </div>
                        <button onclick="addBilibiliVideo()" class="submit-btn">添加B站视频</button>
                    </div>
                    
                    <div id="douyinUpload" class="upload-content">
                        <div class="form-group">
                            <label class="form-label">抖音视频链接</label>
                            <input type="url" class="form-input" placeholder="请输入抖音视频链接，例如：https://v.douyin.com/..." id="douyinLink">
                        </div>
                        <div class="form-group">
                            <label class="form-label">视频标题</label>
                            <input type="text" class="form-input" placeholder="请输入视频标题" id="douyinTitle">
                        </div>
                        <div class="form-group">
                            <label class="form-label">视频描述</label>
                            <textarea class="form-input" rows="4" placeholder="请输入视频描述" id="douyinDescription"></textarea>
                        </div>
                        <div class="upload-info" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff0050;">
                            <p style="margin: 0; color: #666; font-size: 14px;">
                                <i class="fab fa-tiktok" style="color: #ff0050; margin-right: 8px;"></i>
                                <strong>使用说明：</strong>
                            </p>
                            <ol style="margin: 8px 0 0 0; padding-left: 20px; color: #666; font-size: 13px;">
                                <li>先在抖音平台手动上传您的视频</li>
                                <li>设置为横版、1080p、高质量、公开发布</li>
                                <li>复制视频的分享链接</li>
                                <li>将链接粘贴到上面的输入框中</li>
                            </ol>
                        </div>
                        <button onclick="addDouyinVideo()" class="submit-btn">添加抖音视频</button>
                    </div>
                </div>
            </section>

            <!-- 练习上传 -->
            <section id="uploadExerciseSection" class="content-section">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-file-upload" aria-hidden="true"></i>
                    </div>
                    <h2>练习题目上传</h2>
                </div>
                
                <div class="upload-container">
                    <div class="upload-tabs">
                        <button class="upload-tab active" onclick="switchExerciseTab('json')">JSON格式</button>
                        <button class="upload-tab" onclick="switchExerciseTab('text')">文本输入</button>
                        <button class="upload-tab" onclick="switchExerciseTab('image')">图片识别</button>
                        <button class="upload-tab" onclick="switchExerciseTab('file')">文件上传</button>
                    </div>
                    
                    <div id="jsonExercise" class="upload-content active">
                        <div class="upload-text">
                            <textarea placeholder='请输入JSON格式的练习题目，格式如下：
{
  "title": "流体静力学基础",
  "questions": [
    {
      "question": "题目内容",
      "options": ["选项A", "选项B", "选项C", "选项D"],
      "correct": 0,
      "explanation": "答案解释"
    }
  ]
}' id="exerciseJson"></textarea>
                        </div>
                        <button onclick="uploadExerciseJson()" class="submit-btn">上传练习</button>
                    </div>
                    
                    <div id="textExercise" class="upload-content">
                        <div class="form-group">
                            <label class="form-label">练习标题</label>
                            <input type="text" class="form-input" placeholder="请输入练习标题" id="exerciseTitle">
                        </div>
                        <div class="form-group">
                            <label class="form-label">题目内容</label>
                            <textarea class="form-input" rows="10" placeholder="请输入题目内容，每道题目用空行分隔" id="exerciseContent"></textarea>
                        </div>
                        <button onclick="uploadExerciseText()" class="submit-btn">创建练习</button>
                    </div>
                    
                    <div id="imageExercise" class="upload-content">
                        <div class="form-group">
                            <label class="form-label">练习标题</label>
                            <input type="text" class="form-input" placeholder="请输入练习标题" id="imageExerciseTitle">
                        </div>
                        
                        <div class="image-upload-container" id="imageUploadContainer" onclick="document.getElementById('imageInput').click()">
                            <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                            <i class="fas fa-image" style="font-size: 3rem; color: var(--accent); margin-bottom: var(--space-4);"></i>
                            <h3>上传题目图片</h3>
                            <p>支持 JPG、PNG、GIF 等格式</p>
                            <small>拖拽图片到此处或点击选择文件</small>
                        </div>
                        
                        <div id="imagePreviewContainer" style="display: none;">
                            <img id="imagePreview" class="image-preview" alt="题目图片预览">
                            <div class="image-tools">
                                <button class="image-tool-btn" onclick="enhanceImage()">
                                    <i class="fas fa-magic"></i> 图像增强
                                </button>
                                <button class="image-tool-btn" onclick="rotateImage()">
                                    <i class="fas fa-redo"></i> 旋转图片
                                </button>
                                <button class="image-tool-btn" onclick="startOCR()">
                                    <i class="fas fa-eye"></i> 开始识别
                                </button>
                                <button class="image-tool-btn" onclick="clearImage()">
                                    <i class="fas fa-trash"></i> 清除图片
                                </button>
                            </div>
                        </div>
                        
                        <div class="ocr-progress" id="ocrProgress">
                            <h4><i class="fas fa-cogs"></i> OCR 识别进度</h4>
                            <div class="ocr-step">
                                <div class="ocr-step-icon pending" id="step1Icon">1</div>
                                <span>图像预处理</span>
                            </div>
                            <div class="ocr-step">
                                <div class="ocr-step-icon pending" id="step2Icon">2</div>
                                <span>文字检测</span>
                            </div>
                            <div class="ocr-step">
                                <div class="ocr-step-icon pending" id="step3Icon">3</div>
                                <span>文字识别</span>
                            </div>
                            <div class="ocr-step">
                                <div class="ocr-step-icon pending" id="step4Icon">4</div>
                                <span>格式化处理</span>
                            </div>
                        </div>
                        
                        <div class="ocr-result" id="ocrResult" style="display: none;">
                            <h4>
                                <i class="fas fa-text-width"></i> 识别结果
                                <div class="confidence-indicator">
                                    <span>识别准确度：</span>
                                    <div class="confidence-bar">
                                        <div class="confidence-fill" id="confidenceFill"></div>
                                    </div>
                                    <span id="confidenceText">0%</span>
                                </div>
                            </h4>
                            <textarea id="ocrText" placeholder="OCR识别的文字将显示在这里，您可以手动编辑和完善..."></textarea>
                            <div style="margin-top: var(--space-4); display: flex; gap: var(--space-3);">
                                <button onclick="formatAsExercise()" class="submit-btn">
                                    <i class="fas fa-magic"></i> 智能格式化
                                </button>
                                <button onclick="createExerciseFromOCR()" class="submit-btn">
                                    <i class="fas fa-plus"></i> 创建练习
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="fileExercise" class="upload-content">
                        <div class="drop-zone" onclick="document.getElementById('exerciseFile').click()">
                            <input type="file" id="exerciseFile" class="file-input" accept=".json,.txt,.doc,.docx" onchange="handleExerciseFile(this)">
                            <i class="fas fa-file-upload"></i>
                            <h3>拖拽练习文件到此处</h3>
                            <p>或点击选择文件</p>
                            <small>支持 JSON, TXT, DOC, DOCX 格式</small>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 设置页面 -->
            <section id="settingsSection" class="content-section">
                <div class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-cogs" aria-hidden="true"></i>
                    </div>
                    <h2>系统设置</h2>
                </div>
                
                <!-- GitHub连接状态 (仅教师可见) -->
                <div class="card teacher-only">
                    <h3 style="margin-bottom: var(--space-4); color: var(--primary);">GitHub 数据同步</h3>
                    <div id="githubStatus" class="github-status disconnected">
                        <i class="fab fa-github"></i>
                        <span>未连接到 GitHub</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">GitHub Token</label>
                        <input type="password" class="form-input" placeholder="请输入 GitHub Personal Access Token" id="githubToken">
                    </div>
                    <div class="form-group">
                        <label class="form-label">仓库名称</label>
                        <input type="text" class="form-input" placeholder="例如：username/repository" id="githubRepo">
                    </div>
                    <button onclick="connectGitHub()" class="submit-btn">连接 GitHub</button>
                </div>
                
                <!-- 密码修改 -->
                <div class="password-change-form">
                    <h3 style="margin-bottom: var(--space-6); color: var(--primary);">修改密码</h3>
                    <form onsubmit="changePassword(event)">
                        <div class="form-group">
                            <label class="form-label">当前密码</label>
                            <input type="password" class="form-input" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">新密码</label>
                            <input type="password" class="form-input" id="newPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label class="form-label">确认新密码</label>
                            <input type="password" class="form-input" id="confirmPassword" required minlength="6">
                        </div>
                        <button type="submit" class="submit-btn">修改密码</button>
                    </form>
                </div>
                
                <!-- 数据管理 -->
                <div class="card">
                    <h3 style="margin-bottom: var(--space-4); color: var(--primary);">数据管理</h3>
                    <div style="display: flex; gap: var(--space-4); flex-wrap: wrap;">
                        <button onclick="exportData()" class="submit-btn">导出数据</button>
                        <button onclick="importData()" class="submit-btn">导入数据</button>
                        <button onclick="clearLocalData()" class="submit-btn" style="background: var(--error);">清除本地数据</button>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="footer">
            <div style="max-width: 1200px; margin: 0 auto; padding: 0 var(--space-6);">
                <p>© 2025 中国海洋大学流体力学学习平台 版本 9.0</p>
                <p style="margin-top: var(--space-2); font-size: 0.875rem; opacity: 0.8;">
                    探索流动世界的奥秘 · 理解自然规律的艺术
                </p>
            </div>
        </footer>
    </div>

    <!-- 水印 -->
    <div class="watermark" data-student="流体力学学习平台"></div>
    
    <!-- 加载覆盖层 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>
    
    <script>
        'use strict';
        
        // 安全防护：反调试和反自动化
        let devtoolsOpen = false;
        let devtoolsCheckInterval;
        
        // 增强的安全防护系统
        const SecurityManager = {
            violations: 0,
            
            detectDevTools: function() {
                const threshold = 160;
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtoolsOpen) {
                        devtoolsOpen = true;
                        console.clear();
                        console.warn('%c⚠️ 检测到开发者工具', 'color: red; font-size: 20px; font-weight: bold;');
                        console.warn('%c本平台受版权保护，禁止调试和逆向工程！', 'color: red; font-size: 16px;');
                        this.handleViolation('开发者工具');
                    }
                } else {
                    devtoolsOpen = false;
                }
            },

            handleViolation: function(type) {
                this.violations++;
                ErrorHandler.log('warn', `安全违规: ${type}`, {
                    timestamp: Date.now(),
                    user: currentUser ? currentUser.username : 'anonymous',
                    violations: this.violations
                });
                
                if (this.violations > 3) {
                    this.enforceProtection();
                }
            },

            enforceProtection: function() {
                document.body.style.filter = 'blur(5px)';
                showToast('检测到多次安全违规，已启用保护模式', 'warning');
                
                setTimeout(() => {
                    document.body.style.filter = 'none';
                }, 5000);
            },

            detectAutomation: function() {
                if (window.navigator.webdriver || 
                    window.callPhantom || 
                    window._phantom ||
                    /headless|phantom|selenium/i.test(navigator.userAgent)) {
                    this.handleViolation('自动化工具');
                }
            },

            preventIframe: function() {
                if (window.top !== window.self) {
                    window.top.location = window.self.location;
                }
            },

            init: function() {
                this.preventIframe();
                this.detectAutomation();
                
                // 定期检测
                setInterval(() => {
                    this.detectDevTools();
                }, 500);
            }
        };

        // 检测开发者工具（保持向后兼容）
        function detectDevTools() {
            SecurityManager.detectDevTools();
        }

        // 禁用常见调试快捷键
        document.addEventListener('keydown', function(e) {
            // F12
            if (e.keyCode === 123) {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+I
            if (e.ctrlKey && e.shiftKey && e.keyCode === 73) {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+J
            if (e.ctrlKey && e.shiftKey && e.keyCode === 74) {
                e.preventDefault();
                return false;
            }
            // Ctrl+U
            if (e.ctrlKey && e.keyCode === 85) {
                e.preventDefault();
                return false;
            }
            // Ctrl+S
            if (e.ctrlKey && e.keyCode === 83) {
                e.preventDefault();
                return false;
            }
        });

        // 禁用右键菜单
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        // 禁用拖拽
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });

        // 检测截图（部分浏览器支持）
        if ('getDisplayMedia' in navigator.mediaDevices) {
            const originalGetDisplayMedia = navigator.mediaDevices.getDisplayMedia;
            navigator.mediaDevices.getDisplayMedia = function() {
                console.warn('检测到可能的截图行为');
                // 实际应用中可以记录或阻止
                return originalGetDisplayMedia.apply(this, arguments);
            };
        }

        // 混淆console输出
        const originalLog = console.log;
        console.log = function() {
            // 在实际应用中可以选择不输出或输出误导信息
            return originalLog.apply(console, arguments);
        };

        // 用户账号数据
        const accounts = {
            'liuguanghui6330156': { 
                name: '刘光辉', 
                role: 'teacher', 
                password: 'Ll700306', 
                avatar: '刘',
                github: { connected: false, token: '', repo: '' }
            },
            'student1': { 
                name: '学生账号', 
                role: 'student', 
                password: '123456', 
                avatar: '学',
                github: { connected: false, token: '', repo: '' }
            },
            'niwenxuan': { 
                name: '倪文轩', 
                role: 'student', 
                password: 'niwenxuan2025', 
                avatar: '倪',
                github: { connected: false, token: '', repo: '' }
            },
            'hanwenxu': { 
                name: '韩文旭', 
                role: 'student', 
                password: 'hanwenxu2025', 
                avatar: '韩',
                github: { connected: false, token: '', repo: '' }
            }
        };

        // 保持向后兼容
        const USER_ACCOUNTS = accounts;
        
        // 扩展的视频数据
        let videosData = [
            {
                id: 'video1',
                title: '动量输运、牛顿内摩擦定律、欧拉坐标',
                description: '详细讲解流体力学中的动量输运原理、牛顿内摩擦定律的物理意义和数学表达，以及欧拉坐标系统在流体运动描述中的应用。深入理解流体内部的动量传递机制和粘性效应。',
                source: 'https://v.douyin.com/7vrVT-4KmbI/',
                sourceType: 'douyin',
                duration: '抖音视频',
                views: '教师原创',
                category: '基础理论',
                featured: true,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                tags: ['动量输运', '牛顿内摩擦定律', '欧拉坐标'],
                quality: ['精品内容'],
                thumbnail: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 225"><rect width="400" height="225" fill="%23ff0050"/><text x="200" y="112" text-anchor="middle" fill="white" font-size="16" font-family="Arial">抖音视频封面</text><text x="200" y="135" text-anchor="middle" fill="white" font-size="12" font-family="Arial">动量输运、牛顿内摩擦定律</text></svg>',
                subtitles: true,
                interactive: false
            },
            {
                id: 'video2',
                title: '欧拉、拉格朗日坐标系统',
                description: '全面对比欧拉坐标和拉格朗日坐标两种描述流体运动的方法，详解流线和迹线的概念与区别，帮助理解流体运动的数学描述和物理意义。',
                source: 'https://v.douyin.com/X-ud2xkwvII/',
                sourceType: 'douyin',
                duration: '抖音视频',
                views: '教师原创',
                category: '基础理论',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-11-25',
                tags: ['欧拉坐标', '拉格朗日坐标', '流线', '迹线'],
                quality: ['精品内容'],
                thumbnail: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 225"><rect width="400" height="225" fill="%23ff0050"/><text x="200" y="112" text-anchor="middle" fill="white" font-size="16" font-family="Arial">抖音视频封面</text><text x="200" y="135" text-anchor="middle" fill="white" font-size="12" font-family="Arial">欧拉、拉格朗日坐标系统</text></svg>',
                subtitles: true,
                interactive: false
            },
            {
                id: 'video3',
                title: '流体力学之美，太美了',
                description: '探索流体世界的奇妙现象与科学原理，揭示自然界的流动艺术。通过精美的可视化展示，帮助学生理解复杂的流体现象。',
                source: 'BV16T421D7k4',
                sourceType: 'bilibili',
                duration: '18:45',
                views: '32,458',
                category: '基础理论',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                tags: ['流体力学', '基础理论', '可视化'],
                quality: ['720p', '1080p'],
                thumbnail: 'https://i2.hdslb.com/bfs/archive/placeholder.jpg',
                subtitles: true,
                interactive: false
            },
            {
                id: 'video2',
                title: '伯努利方程详解',
                description: '深入讲解伯努利方程的推导过程和实际应用。从基本原理出发，逐步推导方程，并结合实际案例进行分析。',
                source: 'sample2',
                sourceType: 'local',
                duration: '25:30',
                views: '18,923',
                category: '核心原理',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-11-25',
                tags: ['伯努利方程', '核心原理', '数学推导'],
                quality: ['480p', '720p'],
                thumbnail: '/videos/thumbnails/bernoulli.jpg',
                subtitles: true,
                interactive: true
            },
            {
                id: 'video3',
                title: '涡旋运动与环量',
                description: '详细讲解涡旋运动的基本概念和环量的计算方法。通过动画演示涡旋的形成和发展过程。',
                source: 'sample3',
                sourceType: 'local',
                duration: '22:15',
                views: '15,672',
                category: '高级理论',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-11-20',
                tags: ['涡旋', '环量', '高级理论'],
                quality: ['720p', '1080p'],
                thumbnail: '/videos/thumbnails/vortex.jpg',
                subtitles: false,
                interactive: true
            },
            {
                id: 'video4',
                title: '势流理论应用',
                description: '势流理论在实际工程中的应用案例分析。结合具体工程实例，展示势流理论的实用价值。',
                source: 'sample4',
                sourceType: 'local',
                duration: '30:20',
                views: '12,845',
                category: '应用实践',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-11-15',
                tags: ['势流', '应用', '工程案例'],
                quality: ['480p', '720p', '1080p'],
                thumbnail: '/videos/thumbnails/potential.jpg',
                subtitles: true,
                interactive: false
            },
            {
                id: 'video_001',
                title: '流体力学基础理论体系',
                description: '系统讲解流体力学的基本概念、基本方程和基本方法，包括连续介质假设、流体性质、运动学描述等核心内容。适合初学者建立完整的理论框架。',
                source: 'https://www.bilibili.com/video/BV1Ux411L7Zd',
                sourceType: 'bilibili',
                duration: '45:30',
                views: 15420,
                category: '基础理论',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                tags: ['理论基础', '连续介质', '流体性质'],
                quality: ['720p'],
                thumbnail: '',
                subtitles: false,
                interactive: false
            },
            {
                id: 'video_002',
                title: '流体静力学与压强分布',
                description: '深入分析流体静力学基本方程，讲解静压强的分布规律、压强测量方法、液体对壁面的作用力计算等工程实际问题。',
                source: 'https://www.bilibili.com/video/BV1Jx411m7Qr',
                sourceType: 'bilibili',
                duration: '38:15',
                views: 12680,
                category: '流体静力学',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                tags: ['静力学', '压强分布', '工程应用'],
                quality: ['720p'],
                thumbnail: '',
                subtitles: false,
                interactive: false
            },
            {
                id: 'video_003',
                title: '伯努利方程及其工程应用',
                description: '详细推导伯努利方程，分析其适用条件和物理意义，通过大量工程实例展示如何应用伯努利方程解决实际问题。',
                source: 'https://www.bilibili.com/video/BV1mx411L7Zp',
                sourceType: 'bilibili',
                duration: '52:40',
                views: 18950,
                category: '流体动力学',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                tags: ['伯努利方程', '能量守恒', '工程应用'],
                quality: ['720p'],
                thumbnail: '',
                subtitles: false,
                interactive: false
            },
            {
                id: 'video_004',
                title: '粘性流动与雷诺数',
                description: '讲解流体粘性的本质，分析层流与湍流的区别，深入理解雷诺数的物理意义及其在流动转捩中的作用。',
                source: 'https://www.bilibili.com/video/BV1Wx411m7Qp',
                sourceType: 'bilibili',
                duration: '41:20',
                views: 14230,
                category: '粘性流动',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                tags: ['粘性流动', '雷诺数', '层流湍流'],
                quality: ['720p'],
                thumbnail: '',
                subtitles: false,
                interactive: false
            },
            {
                id: 'video_005',
                title: '边界层理论与应用',
                description: '系统介绍普朗特边界层理论，分析边界层的形成机理、发展规律和工程意义，讲解边界层分离现象及其控制方法。',
                source: 'https://www.bilibili.com/video/BV1Lx411L7Zm',
                sourceType: 'bilibili',
                duration: '49:55',
                views: 11780,
                category: '边界层理论',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                tags: ['边界层', '普朗特理论', '分离控制'],
                quality: ['720p'],
                thumbnail: '',
                subtitles: false,
                interactive: false
            },
            {
                id: 'video_006',
                title: '管道流动与阻力计算',
                description: '分析管道内流体流动的特点，讲解沿程阻力和局部阻力的计算方法，介绍管网计算的基本原理和工程应用。',
                source: 'https://www.bilibili.com/video/BV1Px411m7Qw',
                sourceType: 'bilibili',
                duration: '44:10',
                views: 16540,
                category: '管道流动',
                featured: false,
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                tags: ['管道流动', '阻力计算', '管网设计'],
                quality: ['720p'],
                thumbnail: '',
                subtitles: false,
                interactive: false
            }
        ];
        
        // 完整的练习数据 - 40题完整题库
        let exercisesData = [
            {
                id: 'exercise_001',
                title: '流体静力学综合练习',
                description: '涵盖流体静力学基本概念、压强分布、浮力计算等核心知识点的综合练习题集。',
                category: '流体静力学',
                difficulty: '基础',
                questionCount: 20,
                duration: '35分钟',
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                attempts: 0,
                averageScore: 0,
                questions: [
                    {
                        id: 1,
                        type: 'choice',
                        question: '在静止流体中，压强的传递遵循什么定律？',
                        options: ['帕斯卡定律', '阿基米德定律', '胡克定律', '牛顿定律'],
                        correct: 0,
                        explanation: '帕斯卡定律指出，在静止流体中，压强能够等值地传递到流体的各个部分。',
                        hint: '考虑压强传递的物理机制',
                        points: 5
                    },
                    {
                        id: 2,
                        type: 'choice', 
                        question: '流体静力学基本方程dp = -ρg dz中，负号表示什么物理意义？',
                        options: ['压强随高度增加而减小', '压强随高度增加而增大', '密度为负值', '重力加速度向下'],
                        correct: 0,
                        explanation: '负号表示压强随高度增加而减小，这是因为重力的作用。',
                        hint: '考虑重力方向与压强变化的关系',
                        points: 5
                    },
                    {
                        id: 3,
                        type: 'choice',
                        question: '阿基米德定律描述的是什么现象？',
                        options: ['浮力等于排开液体的重力', '浮力等于物体的重力', '浮力等于液体的重力', '浮力等于物体的体积'],
                        correct: 0,
                        explanation: '阿基米德定律指出，浸在液体中的物体受到向上的浮力，浮力的大小等于物体排开液体的重力。',
                        hint: '浮力与排开液体体积的关系',
                        points: 5
                    },
                    {
                        id: 4,
                        type: 'choice',
                        question: '在静止流体中，等压面是什么形状？',
                        options: ['水平面', '垂直面', '斜面', '任意曲面'],
                        correct: 0,
                        explanation: '在重力场中，静止流体的等压面是水平面，这是因为重力只影响垂直方向的压强分布。',
                        hint: '考虑重力场中等压面的特点',
                        points: 5
                    },
                    {
                        id: 5,
                        type: 'choice',
                        question: '流体静力学中，绝对压强与表压强的关系是？',
                        options: ['绝对压强 = 表压强 + 大气压强', '绝对压强 = 表压强 - 大气压强', '绝对压强 = 表压强', '绝对压强 = 大气压强 - 表压强'],
                        correct: 0,
                        explanation: '绝对压强是相对于真空的压强，表压强是相对于大气压的压强，两者关系为绝对压强 = 表压强 + 大气压强。',
                        hint: '绝对压强和表压强的定义',
                        points: 5
                    }
                ]
            },
            {
                id: 'exercise_002',
                title: '伯努利方程应用专题',
                description: '通过典型工程案例深入理解伯努利方程的应用条件和计算方法。',
                category: '流体动力学',
                difficulty: '中级',
                questionCount: 15,
                duration: '30分钟',
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                attempts: 0,
                averageScore: 0,
                questions: [
                    {
                        id: 1,
                        type: 'choice',
                        question: '伯努利方程的适用条件不包括以下哪项？',
                        options: ['定常流动', '无粘性流体', '不可压缩流体', '有旋流动'],
                        correct: 3,
                        explanation: '伯努利方程适用于定常、无粘性、不可压缩的无旋流动。',
                        hint: '伯努利方程的推导条件',
                        points: 5
                    },
                    {
                        id: 2,
                        type: 'choice',
                        question: '伯努利方程中，动能项的形式是？',
                        options: ['ρv²/2', 'ρv²', 'ρv/2', 'ρv'],
                        correct: 0,
                        explanation: '伯努利方程中的动能项为ρv²/2，表示单位体积流体的动能。',
                        hint: '动能的物理表达式',
                        points: 5
                    },
                    {
                        id: 3,
                        type: 'choice',
                        question: '在文丘里管中，流速最大的位置是？',
                        options: ['入口处', '喉部', '出口处', '中间位置'],
                        correct: 1,
                        explanation: '根据连续性方程，在文丘里管的喉部，截面积最小，流速最大。',
                        hint: '连续性方程的应用',
                        points: 5
                    },
                    {
                        id: 4,
                        type: 'choice',
                        question: '皮托管测量的是什么？',
                        options: ['静压', '动压', '总压', '差压'],
                        correct: 2,
                        explanation: '皮托管测量的是总压，即静压与动压之和。',
                        hint: '皮托管的测量原理',
                        points: 5
                    },
                    {
                        id: 5,
                        type: 'choice',
                        question: '伯努利方程中的势能项是？',
                        options: ['ρgz', 'ρg', 'gz', 'ρz'],
                        correct: 0,
                        explanation: '伯努利方程中的势能项为ρgz，表示单位体积流体的重力势能。',
                        hint: '重力势能的表达式',
                        points: 5
                    }
                ]
            },
            {
                id: 'exercise_003',
                title: '边界层理论基础',
                description: '边界层概念、边界层方程、边界层厚度等核心理论的练习题集。',
                category: '边界层理论',
                difficulty: '高级', 
                questionCount: 12,
                duration: '25分钟',
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                attempts: 0,
                averageScore: 0,
                questions: [
                    {
                        id: 1,
                        type: 'choice',
                        question: '边界层理论的提出者是？',
                        options: ['雷诺', '普朗特', '伯努利', '欧拉'],
                        correct: 1,
                        explanation: '普朗特(Prandtl)在1904年提出了边界层理论，被誉为现代流体力学之父。',
                        hint: '边界层理论的历史背景',
                        points: 5
                    },
                    {
                        id: 2,
                        type: 'choice',
                        question: '边界层厚度的定义是？',
                        options: ['速度达到主流速度99%的距离', '速度达到主流速度90%的距离', '速度为零的距离', '速度最大的距离'],
                        correct: 0,
                        explanation: '边界层厚度定义为从壁面到速度达到主流速度99%处的垂直距离。',
                        hint: '边界层厚度的标准定义',
                        points: 5
                    },
                    {
                        id: 3,
                        type: 'choice',
                        question: '平板边界层中，位移厚度的物理意义是？',
                        options: ['边界层的实际厚度', '主流被排开的距离', '动量损失厚度', '能量损失厚度'],
                        correct: 1,
                        explanation: '位移厚度表示由于边界层存在，主流被排开的距离。',
                        hint: '位移厚度的定义',
                        points: 5
                    },
                    {
                        id: 4,
                        type: 'choice',
                        question: '边界层分离的条件是？',
                        options: ['压力梯度为正', '压力梯度为负', '压力梯度为零', '速度梯度为零'],
                        correct: 0,
                        explanation: '当压力梯度为正（逆压梯度）时，边界层容易发生分离。',
                        hint: '边界层分离的物理机制',
                        points: 5
                    },
                    {
                        id: 5,
                        type: 'choice',
                        question: '湍流边界层的厚度比层流边界层？',
                        options: ['厚', '薄', '相同', '无法比较'],
                        correct: 0,
                        explanation: '湍流边界层的厚度比层流边界层厚，这是因为湍流的混合作用更强。',
                        hint: '湍流与层流的特性差异',
                        points: 5
                    }
                ]
            },
            {
                id: 'exercise_004',
                title: '粘性流体流动',
                description: '粘性流体流动的基本概念和计算方法，重点讲解Navier-Stokes方程及其应用。',
                category: '粘性流体',
                difficulty: '高级',
                questionCount: 10,
                duration: '30分钟',
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                attempts: 0,
                averageScore: 0,
                questions: [
                    {
                        id: 1,
                        type: 'choice',
                        question: 'Navier-Stokes方程中的粘性项代表什么物理意义？',
                        options: ['流体的惯性力', '流体内部的摩擦力', '压力梯度的作用', '重力的影响'],
                        correct: 1,
                        explanation: 'Navier-Stokes方程中的粘性项（拉普拉斯项）表示流体内部由于粘性而产生的摩擦力。',
                        hint: '粘性系数与速度梯度的关系',
                        points: 8
                    },
                    {
                        id: 2,
                        type: 'choice',
                        question: '雷诺数的物理意义是？',
                        options: ['惯性力与粘性力的比值', '压力力与粘性力的比值', '重力与粘性力的比值', '表面张力与粘性力的比值'],
                        correct: 0,
                        explanation: '雷诺数Re = ρvL/μ，表示惯性力与粘性力的比值，是判断流动状态的重要参数。',
                        hint: '雷诺数的定义和物理意义',
                        points: 8
                    },
                    {
                        id: 3,
                        type: 'choice',
                        question: '圆管层流中，速度分布是什么形状？',
                        options: ['抛物线', '直线', '指数函数', '对数函数'],
                        correct: 0,
                        explanation: '圆管层流中，速度分布呈抛物线形状，中心速度最大，壁面速度为零。',
                        hint: '圆管层流的解析解',
                        points: 8
                    },
                    {
                        id: 4,
                        type: 'choice',
                        question: '粘性流体中，剪切应力与速度梯度的关系是？',
                        options: ['τ = μ∂u/∂y', 'τ = μ∂u/∂x', 'τ = ρ∂u/∂y', 'τ = ρ∂u/∂x'],
                        correct: 0,
                        explanation: '根据牛顿粘性定律，剪切应力τ = μ∂u/∂y，其中μ是粘性系数。',
                        hint: '牛顿粘性定律',
                        points: 8
                    },
                    {
                        id: 5,
                        type: 'choice',
                        question: '湍流中，雷诺应力是什么？',
                        options: ['粘性应力', '压力应力', '脉动速度产生的应力', '重力应力'],
                        correct: 2,
                        explanation: '雷诺应力是由于速度脉动产生的附加应力，是湍流特有的现象。',
                        hint: '湍流的统计特性',
                        points: 8
                    }
                ]
            },
            {
                id: 'exercise_005',
                title: '势流理论应用',
                description: '势流理论的基本概念和计算方法，包括速度势、流函数、复势等重要概念。',
                category: '势流理论',
                difficulty: '中级',
                questionCount: 8,
                duration: '25分钟',
                uploadedBy: 'liuguanghui6330156',
                uploadDate: '2024-12-01',
                attempts: 0,
                averageScore: 0,
                questions: [
                    {
                        id: 1,
                        type: 'choice',
                        question: '速度势函数存在的充分必要条件是？',
                        options: ['流体无粘性', '流动无旋', '流体不可压缩', '流动定常'],
                        correct: 1,
                        explanation: '速度势函数存在的充分必要条件是流动无旋，即旋度为零。',
                        hint: '势函数的数学条件',
                        points: 6
                    },
                    {
                        id: 2,
                        type: 'choice',
                        question: '流函数ψ的等值线代表什么？',
                        options: ['等压线', '等速线', '流线', '等温线'],
                        correct: 2,
                        explanation: '流函数ψ的等值线代表流线，这是流函数的重要物理意义。',
                        hint: '流函数的物理意义',
                        points: 6
                    },
                    {
                        id: 3,
                        type: 'choice',
                        question: '复势W(z) = φ + iψ中，φ代表什么？',
                        options: ['流函数', '速度势', '压力势', '温度势'],
                        correct: 1,
                        explanation: '复势W(z) = φ + iψ中，φ是速度势，ψ是流函数。',
                        hint: '复势的组成',
                        points: 6
                    },
                    {
                        id: 4,
                        type: 'choice',
                        question: '均匀流的复势是？',
                        options: ['W = Uz', 'W = U/z', 'W = Uz²', 'W = U/z²'],
                        correct: 0,
                        explanation: '均匀流的复势为W = Uz，其中U是均匀流的速度。',
                        hint: '均匀流的数学描述',
                        points: 6
                    },
                    {
                        id: 5,
                        type: 'choice',
                        question: '点源的复势是？',
                        options: ['W = m ln z', 'W = m/z', 'W = mz', 'W = m/z²'],
                        correct: 0,
                        explanation: '点源的复势为W = m ln z，其中m是源强。',
                        hint: '点源的数学描述',
                        points: 6
                    }
                ]
            }
        ];

        // 流体力学概念题库
        const fluidMechanicsConcepts = {
            basic: [
                {
                    question: "连续介质假设的基本含义是什么？",
                    options: [
                        "流体是由连续分布的物质组成的",
                        "流体分子之间没有间隙",
                        "流体的密度处处相等",
                        "流体不能被压缩"
                    ],
                    correct: 0,
                    explanation: "连续介质假设认为流体是由连续分布的物质组成，忽略分子间的间隙和分子运动的细节。"
                },
                {
                    question: "牛顿流体的主要特征是什么？",
                    options: [
                        "粘度随温度变化",
                        "剪应力与剪应变率成正比",
                        "密度恒定不变",
                        "不能承受剪应力"
                    ],
                    correct: 1,
                    explanation: "牛顿流体的特征是其剪应力与剪应变率成正比，比例常数为动力粘度。"
                }
            ],
            intermediate: [
                {
                    question: "伯努利方程的适用条件不包括以下哪项？",
                    options: [
                        "理想流体",
                        "定常流动",
                        "无旋流动",
                        "可压缩流体"
                    ],
                    correct: 3,
                    explanation: "伯努利方程适用于理想、定常、无旋的不可压缩流体。"
                }
            ],
            advanced: [
                {
                    question: "湍流的主要特征是什么？",
                    options: [
                        "流线规整有序",
                        "雷诺数很小",
                        "脉动和混合强烈",
                        "粘性力占主导"
                    ],
                    correct: 2,
                    explanation: "湍流的主要特征是流体的脉动和混合作用强烈，流动不规则。"
                }
            ]
        };
        
        // 分数线数据
        const scoreData = {
            '2020': { national: 288, reexam: 288 },
            '2021': { national: 280, reexam: 313 },
            '2022': { national: 290, reexam: 292 },
            '2023': { national: 279, reexam: 294 },
            '2024': { national: 288, reexam: 288 },
            '2025': { national: 274, reexam: 274 }
        };

        // 中国海洋大学招生数据
        const admissionData = {
            '2020': { applicants: null, reexamCount: null, admitted: null, rate: null, ratio: null },
            '2021': { applicants: null, reexamCount: 32, admitted: 29, rate: null, ratio: 1.33 },
            '2022': { applicants: 110, reexamCount: 43, admitted: 35, rate: 31.8, ratio: 1.3 },
            '2023': { applicants: 105, reexamCount: 30, admitted: 27, rate: 25.7, ratio: 1.2 },
            '2024': { applicants: 120, reexamCount: 37, admitted: 37, rate: 30.8, ratio: 1.0 },
            '2025': { applicants: 125, reexamCount: 35, admitted: 35, rate: 28.0, ratio: 1.0 }
        };

        // 考试内容结构
        const examStructure = {
            school: "中国海洋大学",
            code: "803",
            subject: "流体力学",
            sections: [
                {
                    name: "基础理论",
                    weight: "40%",
                    topics: ["流体物理性质", "流体运动描述", "基本方程组"]
                },
                {
                    name: "理想流体",
                    weight: "30%",
                    topics: ["无旋流动", "涡旋运动", "伯努利方程"]
                },
                {
                    name: "粘性流体",
                    weight: "30%",
                    topics: ["层流流动", "边界层理论", "湍流简介"]
                }
            ]
        };

        // 参考书目
        const referenceBooks = {
            primary: {
                title: "流体力学（第二版）",
                author: "吴望一",
                press: "北京大学出版社",
                year: "2021"
            },
            secondary: [
                {
                    title: "流体力学（第二版）",
                    author: "周光炯",
                    press: "高等教育出版社",
                    year: "2019"
                }
            ],
            reexam: {
                title: "物理海洋学",
                author: "董昌明",
                press: "科学出版社",
                year: "2019"
            }
        };

        // 复试信息
        const reexamInfo = {
            subject: "F0102海洋科学综合考试",
            form: "现场面试(20分钟)",
            content: [
                {
                    subject: "物理海洋学",
                    weight: "80%",
                    topics: ["波浪理论", "海洋环流", "潮汐潮流"]
                },
                {
                    subject: "流体力学",
                    weight: "20%",
                    topics: ["基本概念应用"]
                }
            ]
        };

        // 复习规划数据
        const studyPlan = {
            months: [
                {
                    month: "7月",
                    title: "基础巩固",
                    topics: ["流体的物理性质", "本构方程和亥姆霍兹定理", "理想流体动量方程"],
                    hours: 4,
                    tasks: ["基础回顾", "完成老师交代任务"],
                    notes: "任务需保证质量完成"
                },
                {
                    month: "8月",
                    title: "核心原理",
                    topics: ["流体力学方程组", "涡旋运动", "势流理论基础知识"],
                    hours: 4,
                    tasks: ["基础回顾", "完成老师交代任务"],
                    notes: "任务需保证质量完成"
                },
                {
                    month: "9月",
                    title: "专题深化",
                    topics: ["势流理论深化（包括布拉修斯定理）"],
                    hours: 2,
                    tasks: ["基础回顾", "完成老师交代任务"],
                    notes: "任务需保证质量完成，可以开始尝试做真题"
                },
                {
                    month: "10月",
                    title: "应用实践",
                    topics: ["相似原理", "Π定理", "粘性流体理论", "真题讲解"],
                    hours: 4,
                    tasks: ["做真题", "完成老师交代任务"],
                    notes: "任务需保证质量完成"
                },
                {
                    month: "11月",
                    title: "真题冲刺",
                    topics: ["真题讲解"],
                    hours: 4,
                    tasks: ["做完真题", "完成老师交代任务"],
                    notes: "吃透真题"
                },
                {
                    month: "12月",
                    title: "错题串讲",
                    topics: ["串讲真题错题"],
                    hours: 2,
                    tasks: ["真题回顾", "完成老师交代任务"],
                    notes: "吃透真题"
                }
            ],
            tips: [
                "需保证质量完成课后任务，9月可以开始尝试做真题",
                "不会的真题可以告诉我，微信群讲或课上讲",
                "每周至少投入10小时进行专业课复习",
                "重点掌握伯努利方程、NS方程和边界层理论",
                "复试需同时准备物理海洋学内容"
            ]
        };
        
        // GitHub 数据管理类
        class GitHubStorage {
            constructor() {
                this.token = '';
                this.repo = '';
                this.baseUrl = 'https://api.github.com';
                this.isConnected = false;
            }

            async connect(token, repo) {
                this.token = token;
                this.repo = repo;
                
                try {
                    // 验证token和repo的有效性
                    const response = await this.makeRequest(`/repos/${repo}`);
                    if (response.ok) {
                        this.isConnected = true;
                        this.updateStatus('connected', `已连接到 ${repo}`);
                        return { success: true, message: '连接成功' };
                    } else {
                        throw new Error('仓库不存在或无权限访问');
                    }
                } catch (error) {
                    this.isConnected = false;
                    this.updateStatus('disconnected', `连接失败: ${error.message}`);
                    return { success: false, message: error.message };
                }
            }

            async makeRequest(endpoint, options = {}) {
                const url = `${this.baseUrl}${endpoint}`;
                const headers = {
                    'Authorization': `token ${this.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json',
                    ...options.headers
                };

                return fetch(url, {
                    ...options,
                    headers
                });
            }

            async saveData(path, data, message = '更新数据') {
                if (!this.isConnected) {
                    throw new Error('未连接到GitHub');
                }

                try {
                    // 首先尝试获取文件的SHA
                    let sha = null;
                    try {
                        const response = await this.makeRequest(`/repos/${this.repo}/contents/${path}`);
                        if (response.ok) {
                            const fileData = await response.json();
                            sha = fileData.sha;
                        }
                    } catch (error) {
                        // 文件不存在，继续创建
                    }

                    const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
                    const body = {
                        message,
                        content,
                        ...(sha && { sha })
                    };

                    const response = await this.makeRequest(`/repos/${this.repo}/contents/${path}`, {
                        method: 'PUT',
                        body: JSON.stringify(body)
                    });

                    if (response.ok) {
                        return { success: true, message: '数据保存成功' };
                    } else {
                        throw new Error('保存失败');
                    }
                } catch (error) {
                    return { success: false, message: error.message };
                }
            }

            async loadData(path) {
                if (!this.isConnected) {
                    throw new Error('未连接到GitHub');
                }

                try {
                    const response = await this.makeRequest(`/repos/${this.repo}/contents/${path}`);
                    if (response.ok) {
                        const fileData = await response.json();
                        const content = decodeURIComponent(escape(atob(fileData.content)));
                        return { success: true, data: JSON.parse(content) };
                    } else {
                        throw new Error('文件不存在');
                    }
                } catch (error) {
                    return { success: false, message: error.message };
                }
            }

            async uploadBinary(path, blob, message = '上传文件') {
                if (!this.isConnected) {
                    throw new Error('未连接到GitHub');
                }

                try {
                    const reader = new FileReader();
                    return new Promise((resolve, reject) => {
                        reader.onload = async () => {
                            try {
                                const content = btoa(reader.result);
                                const body = {
                                    message,
                                    content
                                };

                                const response = await this.makeRequest(`/repos/${this.repo}/contents/${path}`, {
                                    method: 'PUT',
                                    body: JSON.stringify(body)
                                });

                                if (response.ok) {
                                    resolve({ success: true, message: '文件上传成功' });
                                } else {
                                    throw new Error('上传失败');
                                }
                            } catch (error) {
                                reject({ success: false, message: error.message });
                            }
                        };
                        reader.onerror = () => reject({ success: false, message: '文件读取失败' });
                        reader.readAsBinaryString(blob);
                    });
                } catch (error) {
                    return { success: false, message: error.message };
                }
            }

            updateStatus(status, message) {
                const statusEl = document.getElementById('githubStatus');
                if (statusEl) {
                    statusEl.className = `github-status ${status}`;
                    statusEl.innerHTML = `<i class="fab fa-github"></i><span>${message}</span>`;
                }
            }
        }

        // 创建GitHub存储实例
        const githubStorage = new GitHubStorage();

        // 应用状态
        let currentUser = null;
        let isLoggedIn = false;
        let currentSection = 'home';
        let loginAttempts = 0;
        const MAX_LOGIN_ATTEMPTS = 5;
        const LOCKOUT_DURATION = 15 * 60 * 1000;
        let lockoutEndTime = null;
        
        // 练习相关状态
        let currentExercise = null;
        let currentQuestion = 0;
        let userAnswers = [];
        let exerciseStartTime = null;
        let questionTimer = null;

        // 视频播放器状态
        let currentVideoPlayer = null;
        let videoQuality = '720p';
        let videoSpeed = 1;
        let isFullscreen = false;

        // OCR相关状态
        let currentImage = null;
        let ocrWorker = null;
        let imageRotation = 0;
        let ocrInProgress = false;
        
        // DOM元素缓存
        const DOM = {};
        
        /**
         * 防抖函数
         */
        function debounce(func, wait, immediate = false) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    timeout = null;
                    if (!immediate) func.apply(this, args);
                };
                const callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(this, args);
            };
        }
        
        /**
         * 输入验证和清理
         */
        function sanitizeInput(input, type = 'text') {
            if (typeof input !== 'string') return '';
            input = input.trim();
            
            switch (type) {
                case 'username':
                    return input.replace(/[^a-zA-Z0-9_]/g, '').substring(0, 50);
                case 'password':
                    return input.substring(0, 100);
                default:
                    return input.substring(0, 1000);
            }
        }
        
        /**
         * 显示消息
         */
        function showMessage(message, type = 'info', duration = 5000) {
            const messageEl = DOM.loginMessage;
            if (!messageEl) return;
            
            messageEl.className = `message show ${type}`;
            messageEl.textContent = message;
            
            if (duration > 0) {
                setTimeout(() => {
                    messageEl.classList.remove('show');
                    setTimeout(() => {
                        messageEl.textContent = '';
                        messageEl.className = 'message';
                    }, 300);
                }, duration);
            }
        }
        
        /**
         * 设置按钮加载状态
         */
        function setLoginButtonLoading(loading) {
            const button = DOM.loginButton;
            const buttonText = DOM.loginButtonText;
            const spinner = DOM.loginButtonSpinner;
            
            if (!button || !buttonText || !spinner) return;
            
            if (loading) {
                button.disabled = true;
                buttonText.style.display = 'none';
                spinner.style.display = 'inline-block';
            } else {
                button.disabled = false;
                buttonText.style.display = 'inline';
                spinner.style.display = 'none';
            }
        }
        
        /**
         * 检查是否被锁定
         */
        function isLockedOut() {
            if (!lockoutEndTime) return false;
            
            const now = Date.now();
            if (now < lockoutEndTime) {
                const remainingTime = Math.ceil((lockoutEndTime - now) / 1000 / 60);
                return remainingTime;
            } else {
                lockoutEndTime = null;
                loginAttempts = 0;
                return false;
            }
        }
        
        /**
         * 验证用户凭据
         */
        function validateCredentials(username, password) {
            // 不要清理用户名，保持原始输入用于匹配
            const originalUsername = username.trim();
            const originalPassword = password.trim();
            
            if (!originalUsername || !originalPassword) {
                return { error: '用户名和密码不能为空' };
            }
            
            const lockoutMinutes = isLockedOut();
            if (lockoutMinutes) {
                return { error: `登录失败次数过多，请等待 ${lockoutMinutes} 分钟后重试` };
            }
            
            // 优先从accounts对象查找
            let user = accounts[originalUsername];
            
            // 如果accounts中没有，从USER_ACCOUNTS查找（向后兼容）
            if (!user) {
                user = USER_ACCOUNTS[originalUsername];
            }
            
            if (!user) {
                loginAttempts++;
                return { error: '用户名或密码错误' };
            }
            
            if (user.password !== originalPassword) {
                loginAttempts++;
                
                if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                    lockoutEndTime = Date.now() + LOCKOUT_DURATION;
                    return { error: `登录失败次数过多，账户已被锁定 ${LOCKOUT_DURATION / 60000} 分钟` };
                }
                
                const remainingAttempts = MAX_LOGIN_ATTEMPTS - loginAttempts;
                return { error: `用户名或密码错误，还有 ${remainingAttempts} 次尝试机会` };
            }
            
            loginAttempts = 0;
            lockoutEndTime = null;
            
            return { user: { ...user, username: originalUsername } };
        }
        
        /**
         * 执行登录
         */
        async function performLogin(username, password) {
            setLoginButtonLoading(true);
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const result = validateCredentials(username, password);
                
                if (result.error) {
                    showMessage(result.error, 'error', 6000);
                    
                    DOM.loginForm.style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        DOM.loginForm.style.animation = '';
                    }, 500);
                    
                    return;
                }
                
                currentUser = result.user;
                isLoggedIn = true;
                
                showMessage(`登录成功！欢迎 ${currentUser.name}`, 'success', 2000);
                
                try {
                    sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                    sessionStorage.setItem('loginTime', Date.now().toString());
                } catch (error) {
                    console.warn('无法保存会话状态:', error);
                }
                
                setTimeout(() => {
                    showPlatform();
                }, 1500);
                
            } catch (error) {
                console.error('登录过程中发生错误:', error);
                showMessage('登录过程中发生错误，请稍后重试', 'error');
            } finally {
                setLoginButtonLoading(false);
            }
        }
        
        /**
         * 显示主平台界面
         */
        function showPlatform() {
            if (!currentUser) return;
            
            DOM.loginSystem.style.display = 'none';
            DOM.platform.classList.add('active');
            
            updateUserDisplay();
            showSection('home');
            
            // 初始化AI助手
            setTimeout(() => {
                console.log('登录后初始化AI助手...');
                if (window.AIAssistant && window.AIAssistant.init) {
                    window.AIAssistant.init();
                }
            }, 1000);
        }
        
        /**
         * 更新用户显示信息
         */
        function updateUserDisplay() {
            if (!currentUser) return;
            
            if (DOM.userAvatar) {
                DOM.userAvatar.textContent = currentUser.avatar || currentUser.name.charAt(0);
            }
            
            if (DOM.displayUsername) {
                DOM.displayUsername.textContent = currentUser.name;
            }
            
            if (DOM.userRole) {
                DOM.userRole.textContent = currentUser.role === 'teacher' ? '教师' : '学生';
            }
            
            // 立即渲染动态内容
            renderVideoGrid();
            renderExerciseGrid();
        }
        
        /**
         * 显示指定的内容区域
         */
        function showSection(sectionName) {
            if (!isLoggedIn) return;
            
            currentSection = sectionName;
            
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            const targetSection = document.getElementById(`${sectionName}Section`);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                link.removeAttribute('aria-current');
            });
            
            const activeLink = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
            if (activeLink) {
                activeLink.classList.add('active');
                activeLink.setAttribute('aria-current', 'page');
            }
            
            // 根据用户角色显示/隐藏特定功能
            updateUIForUserRole();
            
            // 动态渲染内容
            if (sectionName === 'videos') {
                renderVideoGrid();
            } else if (sectionName === 'exercises') {
                renderExerciseGrid();
            }
            
            const titles = {
                home: '首页',
                review: '复习规划', 
                videos: '视频课程',
                uploadVideo: '上传视频',
                exercises: '题库练习',
                uploadExercise: '上传练习',
                scores: '分数线分析',
                grades: '成绩录入',
                settings: '系统设置'
            };
            
            document.title = `${titles[sectionName] || '流体力学学习平台'} - 中国海洋大学`;
        }

        /**
         * 根据用户角色更新UI
         */
        function updateUIForUserRole() {
            if (!currentUser) return;
            
            // 更新body类名以应用角色特定样式
            document.body.className = currentUser.role;
            
            // 根据角色显示/隐藏功能
            if (currentUser.role === 'teacher') {
                showTeacherFeatures();
            } else {
                hideTeacherFeatures();
            }
            
            // 更新水印显示学生信息
            if (currentUser.role === 'student') {
                const watermark = document.querySelector('.watermark');
                if (watermark) {
                    watermark.setAttribute('data-student', `${currentUser.name} - ${currentUser.username}`);
                }
            }
        }

        /**
         * 显示教师功能
         */
        function showTeacherFeatures() {
            const teacherElements = document.querySelectorAll('.teacher-only');
            teacherElements.forEach(el => el.style.display = 'block');
        }

        /**
         * 显示学生功能
         */
        function showStudentFeatures() {
            const studentElements = document.querySelectorAll('.student-only');
            studentElements.forEach(el => el.style.display = 'block');
        }

        /**
         * 隐藏教师功能
         */
        function hideTeacherFeatures() {
            const teacherElements = document.querySelectorAll('.teacher-only');
            teacherElements.forEach(el => el.style.display = 'none');
        }

        /**
         * 上传标签页切换
         */
        function switchUploadTab(tabName) {
            document.querySelectorAll('.upload-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.upload-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}Upload`).classList.add('active');
        }

        /**
         * 练习上传标签页切换
         */
        function switchExerciseTab(tabName) {
            document.querySelectorAll('#uploadExerciseSection .upload-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#uploadExerciseSection .upload-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}Exercise`).classList.add('active');
        }

        /**
         * 处理视频链接上传
         */
        async function uploadVideoLink() {
            const link = document.getElementById('videoLink').value;
            const title = document.getElementById('videoTitle').value;
            const description = document.getElementById('videoDescription').value;
            
            if (!link || !title) {
                showToast('请填写视频链接和标题', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const newVideo = {
                    id: `video_${Date.now()}`,
                    title,
                    description,
                    source: link,
                    sourceType: 'external',
                    duration: '未知',
                    views: '0',
                    category: '自定义',
                    featured: false,
                    uploadedBy: currentUser.username,
                    uploadDate: new Date().toISOString().split('T')[0],
                    tags: ['自定义'],
                    quality: ['720p'],
                    thumbnail: '',
                    subtitles: false,
                    interactive: false
                };
                
                videosData.push(newVideo);
                
                // 保存到本地存储
                localStorage.setItem('videosData', JSON.stringify(videosData));
                
                // 如果连接了GitHub，也保存到云端
                if (githubStorage.isConnected) {
                    await githubStorage.saveData('data/videos.json', videosData, '添加新视频');
                }
                
                showToast('视频上传成功！', 'success');
                
                // 清空表单
                document.getElementById('videoLink').value = '';
                document.getElementById('videoTitle').value = '';
                document.getElementById('videoDescription').value = '';
                
                // 刷新视频列表
                if (currentSection === 'videos') {
                    showSection('videos');
                }
                
            } catch (error) {
                showToast(`上传失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        /**
         * 处理视频文件上传
         */
        function handleVideoFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            // 验证文件类型
            const validTypes = ['video/mp4', 'video/avi', 'video/mov', 'video/wmv'];
            if (!validTypes.includes(file.type)) {
                showToast('不支持的视频格式', 'error');
                return;
            }
            
            // 验证文件大小（限制为500MB）
            const maxSize = 500 * 1024 * 1024;
            if (file.size > maxSize) {
                showToast('文件大小不能超过500MB', 'error');
                return;
            }
            
            uploadVideoFile(file);
        }

        /**
         * 上传视频文件
         */
        async function uploadVideoFile(file) {
            showLoading(true);
            
            try {
                // 模拟上传进度
                const progressEl = document.getElementById('videoUploadProgress');
                const statusEl = document.getElementById('videoUploadStatus');
                const uploadContainer = document.querySelector('#fileUpload .upload-progress');
                
                uploadContainer.style.display = 'block';
                
                for (let i = 0; i <= 100; i += 10) {
                    progressEl.style.width = i + '%';
                    statusEl.textContent = `上传中... ${i}%`;
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                // 创建视频记录
                const newVideo = {
                    id: `video_${Date.now()}`,
                    title: file.name.replace(/\.[^/.]+$/, ""), // 移除文件扩展名
                    description: '用户上传的视频文件',
                    source: `local_${Date.now()}`,
                    sourceType: 'local',
                    duration: '未知',
                    views: '0',
                    category: '自定义',
                    featured: false,
                    uploadedBy: currentUser.username,
                    uploadDate: new Date().toISOString().split('T')[0],
                    tags: ['用户上传'],
                    quality: ['720p'],
                    thumbnail: '',
                    subtitles: false,
                    interactive: false,
                    fileSize: file.size,
                    fileName: file.name
                };
                
                videosData.push(newVideo);
                
                // 保存到本地存储
                localStorage.setItem('videosData', JSON.stringify(videosData));
                localStorage.setItem(`video_${newVideo.id}`, file);
                
                statusEl.textContent = '上传完成！';
                showToast('视频上传成功！', 'success');
                
                setTimeout(() => {
                    uploadContainer.style.display = 'none';
                    progressEl.style.width = '0%';
                }, 2000);
                
            } catch (error) {
                showToast(`上传失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        /**
         * 添加B站视频
         */
        async function addBilibiliVideo() {
            const bvId = document.getElementById('bilibiliId').value;
            const title = document.getElementById('bilibiliTitle').value;
            
            if (!bvId) {
                showToast('请输入B站视频BV号', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const newVideo = {
                    id: `video_${Date.now()}`,
                    title: title || `B站视频 ${bvId}`,
                    description: '来自Bilibili的视频内容',
                    source: bvId,
                    sourceType: 'bilibili',
                    duration: '未知',
                    views: '0',
                    category: 'B站视频',
                    featured: false,
                    uploadedBy: currentUser.username,
                    uploadDate: new Date().toISOString().split('T')[0],
                    tags: ['B站', '外部视频'],
                    quality: ['720p', '1080p'],
                    thumbnail: `https://i2.hdslb.com/bfs/archive/${bvId}.jpg`,
                    subtitles: false,
                    interactive: false
                };
                
                videosData.push(newVideo);
                
                // 保存到本地存储
                localStorage.setItem('videosData', JSON.stringify(videosData));
                
                showToast('B站视频添加成功！', 'success');
                
                // 清空表单
                document.getElementById('bilibiliId').value = '';
                document.getElementById('bilibiliTitle').value = '';
                
            } catch (error) {
                showToast(`添加失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        /**
         * 添加抖音视频
         */
        async function addDouyinVideo() {
            const douyinLink = document.getElementById('douyinLink').value;
            const title = document.getElementById('douyinTitle').value;
            const description = document.getElementById('douyinDescription').value;
            
            if (!douyinLink) {
                showToast('请输入抖音视频链接', 'error');
                return;
            }
            
            if (!title) {
                showToast('请输入视频标题', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const newVideo = {
                    id: `video_${Date.now()}`,
                    title: title,
                    description: description || '来自抖音的视频内容',
                    source: douyinLink,
                    sourceType: 'douyin',
                    duration: '抖音视频',
                    views: '教师原创',
                    category: '抖音视频',
                    featured: false,
                    uploadedBy: currentUser.username,
                    uploadDate: new Date().toISOString().split('T')[0],
                    tags: ['抖音', '教师原创'],
                    quality: ['精品内容'],
                    thumbnail: `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 225"><rect width="400" height="225" fill="%23ff0050"/><text x="200" y="112" text-anchor="middle" fill="white" font-size="16" font-family="Arial">抖音视频封面</text><text x="200" y="135" text-anchor="middle" fill="white" font-size="12" font-family="Arial">${title}</text></svg>`,
                    subtitles: true,
                    interactive: false
                };
                
                videosData.push(newVideo);
                
                // 保存到本地存储
                localStorage.setItem('videosData', JSON.stringify(videosData));
                
                showToast('抖音视频添加成功！', 'success');
                
                // 清空表单
                document.getElementById('douyinLink').value = '';
                document.getElementById('douyinTitle').value = '';
                document.getElementById('douyinDescription').value = '';
                
            } catch (error) {
                showToast(`添加失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        /**
         * 上传JSON格式练习
         */
        async function uploadExerciseJson() {
            const jsonContent = document.getElementById('exerciseJson').value;
            
            if (!jsonContent.trim()) {
                showToast('请输入JSON内容', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const exerciseData = JSON.parse(jsonContent);
                
                // 验证数据格式
                if (!exerciseData.title || !exerciseData.questions || !Array.isArray(exerciseData.questions)) {
                    throw new Error('JSON格式不正确，请检查title和questions字段');
                }
                
                const newExercise = {
                    id: `exercise_${Date.now()}`,
                    title: exerciseData.title,
                    description: exerciseData.description || '用户上传的练习',
                    questionCount: exerciseData.questions.length,
                    duration: exerciseData.duration || '30分钟',
                    difficulty: exerciseData.difficulty || '中等',
                    category: exerciseData.category || '自定义',
                    uploadedBy: currentUser.username,
                    uploadDate: new Date().toISOString().split('T')[0],
                    attempts: 0,
                    averageScore: 0,
                    questions: exerciseData.questions.map((q, index) => ({
                        id: `q_${Date.now()}_${index}`,
                        question: q.question,
                        options: q.options,
                        correct: q.correct,
                        explanation: q.explanation || '',
                        hint: q.hint || '',
                        points: q.points || 5
                    }))
                };
                
                exercisesData.push(newExercise);
                
                // 保存到本地存储
                localStorage.setItem('exercisesData', JSON.stringify(exercisesData));
                
                // 如果连接了GitHub，也保存到云端
                if (githubStorage.isConnected) {
                    await githubStorage.saveData('data/exercises.json', exercisesData, '添加新练习');
                }
                
                showToast('练习上传成功！', 'success');
                
                // 清空表单
                document.getElementById('exerciseJson').value = '';
                
            } catch (error) {
                showToast(`上传失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        /**
         * 上传文本格式练习
         */
        async function uploadExerciseText() {
            const title = document.getElementById('exerciseTitle').value;
            const content = document.getElementById('exerciseContent').value;
            
            if (!title || !content.trim()) {
                showToast('请填写练习标题和内容', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                // 简单解析文本内容（这里只是示例，实际需要更复杂的解析逻辑）
                const questions = content.split('\n\n').filter(q => q.trim()).map((questionText, index) => ({
                    id: `q_${Date.now()}_${index}`,
                    question: questionText.trim(),
                    options: ['选项A', '选项B', '选项C', '选项D'], // 默认选项
                    correct: 0,
                    explanation: '请补充解释',
                    hint: '',
                    points: 5
                }));
                
                const newExercise = {
                    id: `exercise_${Date.now()}`,
                    title: title,
                    description: '基于文本内容创建的练习',
                    questionCount: questions.length,
                    duration: '30分钟',
                    difficulty: '中等',
                    category: '自定义',
                    uploadedBy: currentUser.username,
                    uploadDate: new Date().toISOString().split('T')[0],
                    attempts: 0,
                    averageScore: 0,
                    questions: questions
                };
                
                exercisesData.push(newExercise);
                
                // 保存到本地存储
                localStorage.setItem('exercisesData', JSON.stringify(exercisesData));
                
                // 如果连接了GitHub，也保存到云端
                if (githubStorage.isConnected) {
                    await githubStorage.saveData('data/exercises.json', exercisesData, '添加新练习');
                }
                
                showToast('练习创建成功！', 'success');
                
                // 清空表单
                document.getElementById('exerciseTitle').value = '';
                document.getElementById('exerciseContent').value = '';
                
            } catch (error) {
                showToast(`创建失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        /**
         * 处理练习文件上传
         */
        function handleExerciseFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            // 验证文件类型
            const validTypes = ['application/json', 'text/plain', 'application/msword', 
                              'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!validTypes.includes(file.type) && !file.name.endsWith('.txt') && 
                !file.name.endsWith('.json') && !file.name.endsWith('.doc') && 
                !file.name.endsWith('.docx')) {
                showToast('不支持的文件格式', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let content = e.target.result;
                    
                    if (file.type === 'application/json' || file.name.endsWith('.json')) {
                        // JSON文件处理
                        document.getElementById('exerciseJson').value = content;
                        switchExerciseTab('json');
                        showToast('JSON文件内容已导入', 'success');
                    } else {
                        // 文本文件处理
                        document.getElementById('exerciseContent').value = content;
                        document.getElementById('exerciseTitle').value = file.name.replace(/\.[^/.]+$/, "");
                        switchExerciseTab('text');
                        showToast('文本文件内容已导入', 'success');
                    }
                } catch (error) {
                    showToast(`文件读取失败：${error.message}`, 'error');
                }
            };
            
            reader.readAsText(file);
        }

        /**
         * OCR图片处理功能
         */
        
        // 处理图片上传
        function handleImageUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // 验证文件类型
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/bmp', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showToast('不支持的图片格式，请上传 JPG、PNG、GIF 等格式的图片', 'error');
                return;
            }
            
            // 验证文件大小（限制为10MB）
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                showToast('图片文件过大，请选择小于10MB的图片', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentImage = e.target.result;
                displayImagePreview(currentImage);
                showImageTools();
            };
            reader.readAsDataURL(file);
        }

        // 显示图片预览
        function displayImagePreview(imageSrc) {
            const preview = document.getElementById('imagePreview');
            const container = document.getElementById('imagePreviewContainer');
            const uploadContainer = document.getElementById('imageUploadContainer');
            
            preview.src = imageSrc;
            container.style.display = 'block';
            uploadContainer.style.display = 'none';
        }

        // 显示图片工具
        function showImageTools() {
            const tools = document.querySelector('.image-tools');
            if (tools) {
                tools.style.display = 'flex';
            }
        }

        // 图像增强
        function enhanceImage() {
            if (!currentImage) return;
            
            showToast('正在增强图像...', 'info');
            
            try {
                // 创建canvas进行图像处理
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // 绘制原图
                    ctx.drawImage(img, 0, 0);
                    
                    // 获取图像数据
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    
                    // 应用对比度和亮度增强
                    for (let i = 0; i < data.length; i += 4) {
                        // 增加对比度
                        data[i] = Math.min(255, Math.max(0, (data[i] - 128) * 1.5 + 128));     // R
                        data[i + 1] = Math.min(255, Math.max(0, (data[i + 1] - 128) * 1.5 + 128)); // G
                        data[i + 2] = Math.min(255, Math.max(0, (data[i + 2] - 128) * 1.5 + 128)); // B
                    }
                    
                    // 重新绘制处理后的图像
                    ctx.putImageData(imageData, 0, 0);
                    
                    // 更新预览
                    currentImage = canvas.toDataURL('image/png');
                    displayImagePreview(currentImage);
                    
                    showToast('图像增强完成', 'success');
                };
                
                img.src = currentImage;
            } catch (error) {
                showToast('图像增强失败：' + error.message, 'error');
            }
        }

        // 旋转图片
        function rotateImage() {
            if (!currentImage) return;
            
            imageRotation = (imageRotation + 90) % 360;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                // 根据旋转角度调整canvas尺寸
                if (imageRotation % 180 === 0) {
                    canvas.width = img.width;
                    canvas.height = img.height;
                } else {
                    canvas.width = img.height;
                    canvas.height = img.width;
                }
                
                // 设置旋转中心点
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate((imageRotation * Math.PI) / 180);
                ctx.drawImage(img, -img.width / 2, -img.height / 2);
                
                currentImage = canvas.toDataURL('image/png');
                displayImagePreview(currentImage);
                
                showToast(`图片已旋转 ${imageRotation}°`, 'success');
            };
            
            img.src = currentImage;
        }

        // 开始OCR识别
        async function startOCR() {
            if (!currentImage || ocrInProgress) return;
            
            ocrInProgress = true;
            const progressContainer = document.getElementById('ocrProgress');
            const resultContainer = document.getElementById('ocrResult');
            
            // 显示进度
            progressContainer.classList.add('active');
            resultContainer.style.display = 'none';
            
            try {
                // 初始化OCR工作器
                if (!ocrWorker) {
                    updateOCRStep(1, 'processing');
                    ocrWorker = await Tesseract.createWorker('chi_sim+eng', 1, {
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                const progress = Math.round(m.progress * 100);
                                updateOCRStep(3, 'processing', `文字识别 ${progress}%`);
                            }
                        }
                    });
                    updateOCRStep(1, 'completed');
                }
                
                // 文字检测
                updateOCRStep(2, 'processing');
                await new Promise(resolve => setTimeout(resolve, 500)); // 模拟检测时间
                updateOCRStep(2, 'completed');
                
                // 文字识别
                updateOCRStep(3, 'processing');
                const { data: { text, confidence } } = await ocrWorker.recognize(currentImage);
                updateOCRStep(3, 'completed');
                
                // 格式化处理
                updateOCRStep(4, 'processing');
                const formattedText = formatOCRText(text);
                updateOCRStep(4, 'completed');
                
                // 显示结果
                displayOCRResult(formattedText, confidence);
                
                showToast('OCR识别完成！', 'success');
                
            } catch (error) {
                console.error('OCR识别失败:', error);
                updateOCRStep(null, 'error');
                showToast('OCR识别失败：' + error.message, 'error');
            } finally {
                ocrInProgress = false;
            }
        }

        // 更新OCR步骤状态
        function updateOCRStep(step, status, text) {
            if (step) {
                const icon = document.getElementById(`step${step}Icon`);
                if (icon) {
                    icon.className = `ocr-step-icon ${status}`;
                    if (status === 'completed') {
                        icon.innerHTML = '<i class="fas fa-check"></i>';
                    } else if (status === 'error') {
                        icon.innerHTML = '<i class="fas fa-times"></i>';
                    } else if (status === 'processing') {
                        icon.innerHTML = '<i class="fas fa-spinner"></i>';
                    }
                }
            } else if (status === 'error') {
                // 标记所有未完成的步骤为错误
                for (let i = 1; i <= 4; i++) {
                    const icon = document.getElementById(`step${i}Icon`);
                    if (icon && icon.classList.contains('pending')) {
                        icon.className = 'ocr-step-icon error';
                        icon.innerHTML = '<i class="fas fa-times"></i>';
                    }
                }
            }
        }

        // 格式化OCR文本
        function formatOCRText(text) {
            // 移除多余的空格和换行
            let formatted = text.replace(/\s+/g, ' ').trim();
            
            // 尝试识别题目模式
            formatted = formatted.replace(/(\d+\s*[\.、]\s*)/g, '\n\n$1'); // 题号分隔
            formatted = formatted.replace(/([A-D]\s*[\.、]\s*)/g, '\n$1'); // 选项分隔
            formatted = formatted.replace(/\n\s*\n/g, '\n\n'); // 规范化换行
            
            return formatted.trim();
        }

        // 显示OCR结果
        function displayOCRResult(text, confidence) {
            const resultContainer = document.getElementById('ocrResult');
            const textArea = document.getElementById('ocrText');
            const confidenceFill = document.getElementById('confidenceFill');
            const confidenceText = document.getElementById('confidenceText');
            
            // 显示识别的文字
            textArea.value = text;
            
            // 显示准确度
            const confidencePercent = Math.round(confidence);
            confidenceText.textContent = `${confidencePercent}%`;
            confidenceFill.style.width = `${confidencePercent}%`;
            
            // 根据准确度设置颜色
            if (confidencePercent >= 80) {
                confidenceFill.className = 'confidence-fill high';
            } else if (confidencePercent >= 60) {
                confidenceFill.className = 'confidence-fill medium';
            } else {
                confidenceFill.className = 'confidence-fill low';
            }
            
            // 显示结果区域
            resultContainer.style.display = 'block';
        }

        // 智能格式化为练习题
        function formatAsExercise() {
            const textArea = document.getElementById('ocrText');
            let text = textArea.value;
            
            if (!text.trim()) {
                showToast('请先进行OCR识别或输入文字', 'error');
                return;
            }
            
            try {
                // 智能解析题目结构
                const formatted = parseExerciseText(text);
                textArea.value = formatted;
                showToast('智能格式化完成，请检查并调整格式', 'success');
            } catch (error) {
                showToast('格式化失败：' + error.message, 'error');
            }
        }

        // 解析练习文本
        function parseExerciseText(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            let formatted = '';
            let currentQuestion = null;
            
            for (const line of lines) {
                // 检测题号
                if (/^\d+\s*[\.、]/.test(line)) {
                    if (currentQuestion) {
                        formatted += formatQuestion(currentQuestion) + '\n\n';
                    }
                    currentQuestion = {
                        question: line,
                        options: [],
                        type: 'multiple'
                    };
                }
                // 检测选项
                else if (/^[A-D]\s*[\.、]/.test(line) && currentQuestion) {
                    currentQuestion.options.push(line);
                }
                // 其他内容添加到当前题目
                else if (currentQuestion) {
                    currentQuestion.question += ' ' + line;
                } else {
                    formatted += line + '\n';
                }
            }
            
            // 处理最后一题
            if (currentQuestion) {
                formatted += formatQuestion(currentQuestion);
            }
            
            return formatted;
        }

        // 格式化单个题目
        function formatQuestion(question) {
            let result = question.question + '\n';
            
            if (question.options.length > 0) {
                result += question.options.join('\n') + '\n';
                result += '正确答案: A\n';
                result += '解释: 请补充答案解释';
            }
            
            return result;
        }

        // 从OCR结果创建练习
        async function createExerciseFromOCR() {
            const title = document.getElementById('imageExerciseTitle').value;
            const text = document.getElementById('ocrText').value;
            
            if (!title.trim()) {
                showToast('请输入练习标题', 'error');
                return;
            }
            
            if (!text.trim()) {
                showToast('请先进行OCR识别或输入题目内容', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                // 解析题目
                const questions = parseOCRToQuestions(text);
                
                if (questions.length === 0) {
                    throw new Error('未能解析出有效的题目，请检查格式');
                }
                
                const newExercise = {
                    id: `exercise_${Date.now()}`,
                    title: title,
                    description: `基于OCR识别创建的练习（共${questions.length}题）`,
                    questionCount: questions.length,
                    duration: `${Math.max(15, questions.length * 2)}分钟`,
                    difficulty: '中等',
                    category: 'OCR识别',
                    uploadedBy: currentUser.username,
                    uploadDate: new Date().toISOString().split('T')[0],
                    attempts: 0,
                    averageScore: 0,
                    questions: questions
                };
                
                exercisesData.push(newExercise);
                saveDataToStorage();
                renderExerciseGrid();
                
                showToast(`练习"${title}"创建成功，共包含${questions.length}道题目！`, 'success');
                
                // 清空表单
                clearImageUpload();
                
            } catch (error) {
                showToast(`创建失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        // 解析OCR文本为题目对象
        function parseOCRToQuestions(text) {
            const questions = [];
            const blocks = text.split(/\n\s*\n/).filter(block => block.trim());
            
            let questionIndex = 0;
            
            for (const block of blocks) {
                const lines = block.split('\n').map(line => line.trim()).filter(line => line);
                if (lines.length === 0) continue;
                
                let question = '';
                let options = [];
                let correct = 0;
                let explanation = '';
                
                // 查找题目文本
                let questionLines = [];
                let optionLines = [];
                let explanationLines = [];
                let currentSection = 'question';
                
                for (const line of lines) {
                    if (/^[A-D]\s*[\.、]/.test(line)) {
                        currentSection = 'options';
                        optionLines.push(line.replace(/^[A-D]\s*[\.、]\s*/, ''));
                    } else if (/^(正确答案|答案)\s*[:：]\s*[A-D]/i.test(line)) {
                        const match = line.match(/[A-D]/);
                        if (match) {
                            correct = match[0].charCodeAt(0) - 'A'.charCodeAt(0);
                        }
                    } else if (/^(解释|说明|解析)\s*[:：]/i.test(line)) {
                        currentSection = 'explanation';
                        explanationLines.push(line.replace(/^(解释|说明|解析)\s*[:：]\s*/i, ''));
                    } else {
                        if (currentSection === 'question') {
                            questionLines.push(line);
                        } else if (currentSection === 'explanation') {
                            explanationLines.push(line);
                        }
                    }
                }
                
                question = questionLines.join(' ').replace(/^\d+\s*[\.、]\s*/, '');
                
                if (question && optionLines.length >= 2) {
                    questions.push({
                        id: `q_ocr_${Date.now()}_${questionIndex++}`,
                        question: question,
                        options: optionLines,
                        correct: correct,
                        explanation: explanationLines.join(' ') || '暂无解释',
                        hint: '',
                        points: 5
                    });
                }
            }
            
            return questions;
        }

        // 清除图片上传
        function clearImage() {
            clearImageUpload();
            showToast('图片已清除', 'info');
        }

        function clearImageUpload() {
            currentImage = null;
            imageRotation = 0;
            
            document.getElementById('imageInput').value = '';
            document.getElementById('imageExerciseTitle').value = '';
            document.getElementById('imagePreviewContainer').style.display = 'none';
            document.getElementById('imageUploadContainer').style.display = 'block';
            document.getElementById('ocrProgress').classList.remove('active');
            document.getElementById('ocrResult').style.display = 'none';
            
            // 重置进度图标
            for (let i = 1; i <= 4; i++) {
                const icon = document.getElementById(`step${i}Icon`);
                if (icon) {
                    icon.className = 'ocr-step-icon pending';
                    icon.innerHTML = i;
                }
            }
        }
        
        /**
         * 切换移动端菜单
         */
        function toggleMobileMenu() {
            const navMenu = document.querySelector('.nav-menu');
            if (navMenu) {
                navMenu.classList.toggle('active');
            }
        }
        
        /**
         * 退出登录
         */
        function logout() {
            if (!confirm('确定要退出登录吗？')) return;
            
            currentUser = null;
            isLoggedIn = false;
            
            try {
                sessionStorage.removeItem('currentUser');
                sessionStorage.removeItem('loginTime');
            } catch (error) {
                console.warn('清理会话状态失败:', error);
            }
            
            DOM.platform.classList.remove('active');
            DOM.loginSystem.style.display = 'flex';
            
            if (DOM.loginForm) {
                DOM.loginForm.reset();
            }
            
            if (DOM.loginMessage) {
                DOM.loginMessage.textContent = '';
                DOM.loginMessage.className = 'message';
            }
        }
        
        /**
         * 显示密码重置模态框
         */
        function showPasswordResetModal() {
            showMessage('密码重置功能正在开发中，请联系管理员', 'info');
        }

        /**
         * 显示Toast提示
         */
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: var(--space-2);">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // 触发显示动画
            setTimeout(() => toast.classList.add('show'), 100);
            
            // 自动隐藏
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        /**
         * 显示/隐藏加载状态
         */
        function showLoading(show = true) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                if (show) {
                    overlay.classList.add('active');
                } else {
                    overlay.classList.remove('active');
                }
            }
        }

        /**
         * 连接GitHub
         */
        async function connectGitHub() {
            const token = document.getElementById('githubToken').value;
            const repo = document.getElementById('githubRepo').value;
            
            if (!token || !repo) {
                showToast('请填写GitHub Token和仓库名称', 'error');
                return;
            }
            
            showLoading(true);
            githubStorage.updateStatus('connecting', '正在连接...');
            
            try {
                const result = await githubStorage.connect(token, repo);
                
                if (result.success) {
                    // 保存连接信息到用户配置
                    if (currentUser) {
                        currentUser.github = {
                            connected: true,
                            token: token,
                            repo: repo
                        };
                        accounts[currentUser.username] = currentUser;
                        localStorage.setItem('accounts', JSON.stringify(accounts));
                    }
                    
                    showToast('GitHub连接成功！', 'success');
                } else {
                    showToast(`连接失败：${result.message}`, 'error');
                }
            } catch (error) {
                showToast(`连接失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        /**
         * 修改密码
         */
        async function changePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('请填写完整信息', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('新密码与确认密码不一致', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('新密码长度至少6位', 'error');
                return;
            }
            
            if (currentPassword !== currentUser.password) {
                showToast('当前密码错误', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                // 更新密码
                currentUser.password = newPassword;
                accounts[currentUser.username] = currentUser;
                
                // 保存到本地存储
                localStorage.setItem('accounts', JSON.stringify(accounts));
                
                // 如果连接了GitHub，同步到云端
                if (githubStorage.isConnected) {
                    await githubStorage.saveData('data/accounts.json', accounts, '更新用户密码');
                }
                
                showToast('密码修改成功！', 'success');
                
                // 清空表单
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
            } catch (error) {
                showToast(`密码修改失败：${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        /**
         * 导出数据
         */
        function exportData() {
            try {
                const data = {
                    accounts: accounts,
                    videos: videosData,
                    exercises: exercisesData,
                    scores: scoreData,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fluid_dynamics_data_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('数据导出成功！', 'success');
            } catch (error) {
                showToast(`导出失败：${error.message}`, 'error');
            }
        }

        /**
         * 导入数据
         */
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('导入数据将覆盖当前数据，确定继续吗？')) {
                            if (data.accounts) Object.assign(accounts, data.accounts);
                            if (data.videos) videosData.splice(0, videosData.length, ...data.videos);
                            if (data.exercises) exercisesData.splice(0, exercisesData.length, ...data.exercises);
                            if (data.scores) Object.assign(scoreData, data.scores);
                            
                            // 保存到本地存储
                            localStorage.setItem('accounts', JSON.stringify(accounts));
                            localStorage.setItem('videosData', JSON.stringify(videosData));
                            localStorage.setItem('exercisesData', JSON.stringify(exercisesData));
                            localStorage.setItem('scoreData', JSON.stringify(scoreData));
                            
                            showToast('数据导入成功！请刷新页面查看', 'success');
                        }
                    } catch (error) {
                        showToast(`导入失败：${error.message}`, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        /**
         * 清除本地数据
         */
        function clearLocalData() {
            if (confirm('确定要清除所有本地数据吗？此操作不可恢复！')) {
                if (confirm('再次确认：清除数据后需要重新登录，确定继续吗？')) {
                    localStorage.clear();
                    showToast('本地数据已清除，页面将重新加载', 'success');
                    setTimeout(() => location.reload(), 2000);
                }
            }
        }
        
        /**
         * 渲染视频卡片
         */
        function renderVideoGrid() {
            const videoGrid = document.getElementById('videoGrid');
            if (!videoGrid) return;
            
            videoGrid.innerHTML = '';
            
            videosData.forEach(video => {
                const videoCard = document.createElement('div');
                videoCard.className = `video-card${video.featured ? ' featured' : ''}`;
                
                // 根据视频类型设置图标和播放按钮
                let iconClass = 'fas fa-play-circle';
                let playButtonContent = '<i class="fas fa-play"></i>';
                let playButtonOnClick = `playVideo('${video.id}')`;
                
                if (video.sourceType === 'douyin') {
                    iconClass = 'fab fa-tiktok';
                    playButtonContent = '<i class="fab fa-tiktok"></i>';
                    playButtonOnClick = `openDouyinVideo('${video.source}')`;
                } else if (video.sourceType === 'bilibili') {
                    iconClass = 'fab fa-bilibili';
                    playButtonContent = '<i class="fas fa-play"></i>';
                    playButtonOnClick = `openVideoModal('${video.source}')`;
                }
                
                videoCard.innerHTML = `
                    <div class="video-preview">
                        <i class="${iconClass}" style="${video.sourceType === 'douyin' ? 'color: #ff0050;' : ''}"></i>
                        ${video.featured ? '<div class="featured-tag"><i class="fas fa-star"></i> 平台推荐</div>' : ''}
                        ${video.sourceType === 'douyin' ? `
                        <div class="platform-badge" style="position: absolute; top: 10px; right: 10px; background: #ff0050; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                            <i class="fab fa-tiktok"></i> 抖音
                        </div>
                        ` : ''}
                        <div class="play-button" onclick="${playButtonOnClick}">
                            ${playButtonContent}
                        </div>
                    </div>
                    <div class="video-info">
                        ${currentUser && currentUser.role === 'teacher' ? `
                        <div class="content-actions teacher-only">
                            <button class="action-btn edit" onclick="editVideo('${video.id}')" title="编辑视频">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteVideo('${video.id}')" title="删除视频">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        ` : ''}
                        <h3 class="video-title">${video.title}</h3>
                        <p class="video-description">${video.description}</p>
                        <div class="video-duration">
                            <span><i class="far fa-clock"></i> ${video.duration}</span>
                            <span><i class="far fa-eye"></i> ${video.views}</span>
                            ${video.sourceType === 'douyin' ? '<span><i class="fab fa-tiktok" style="color: #ff0050;"></i> 教师原创</span>' : ''}
                            ${video.featured ? '<span><i class="fas fa-star" style="color: #ffd700;"></i> 精品内容</span>' : ''}
                        </div>
                    </div>
                `;
                
                videoGrid.appendChild(videoCard);
            });
        }

        /**
         * 渲染练习卡片
         */
        function renderExerciseGrid() {
            const exerciseGrid = document.getElementById('exerciseGrid');
            if (!exerciseGrid) return;
            
            exerciseGrid.innerHTML = '';
            
            // 只显示有题目的练习
            const validExercises = exercisesData.filter(exercise => 
                exercise.questions && exercise.questions.length > 0
            );
            
            if (validExercises.length === 0) {
                exerciseGrid.innerHTML = `
                    <div class="no-exercises">
                        <i class="fas fa-inbox" style="font-size: 3rem; color: var(--secondary); margin-bottom: var(--space-4);"></i>
                        <h3>暂无练习题</h3>
                        <p>教师可以上传新的练习题</p>
                    </div>
                `;
                return;
            }
            
            validExercises.forEach(exercise => {
                const exerciseCard = document.createElement('div');
                exerciseCard.className = 'exercise-card';
                
                exerciseCard.innerHTML = `
                    ${currentUser && currentUser.role === 'teacher' ? `
                    <div class="content-actions teacher-only">
                        <button class="action-btn edit" onclick="editExercise('${exercise.id}')" title="编辑练习">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteExercise('${exercise.id}')" title="删除练习">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    ` : ''}
                    <h3 class="exercise-title">${exercise.title}</h3>
                    <div class="exercise-meta">
                        <span><i class="fas fa-list"></i> ${exercise.questions ? exercise.questions.length : 0}题</span>
                        <span><i class="fas fa-clock"></i> ${exercise.duration}</span>
                        <span><i class="fas fa-star"></i> ${exercise.difficulty}</span>
                    </div>
                    <button class="start-btn" onclick="startExercise('${exercise.id}')">开始练习</button>
                `;
                
                exerciseGrid.appendChild(exerciseCard);
            });
        }

        /**
         * 播放视频
         */
        function playVideo(videoId) {
            const video = videosData.find(v => v.id === videoId);
            if (video) {
                showAdvancedVideoModal(video);
            } else {
                showToast('视频未找到', 'error');
            }
        }

        /**
         * 显示高级视频模态框
         */
        function showAdvancedVideoModal(video) {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'videoModal';
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 90vw; width: 1000px;">
                    <div class="modal-header">
                        <h3>${video.title}</h3>
                        <button onclick="closeVideoModal()" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="video-container" style="height: 500px; position: relative; background: #000;">
                        ${getVideoPlayer(video)}
                        <div class="video-player-controls">
                            <div class="video-progress">
                                <div class="video-progress-bar" onclick="seekVideo(event)">
                                    <div class="video-progress-fill" id="videoProgress"></div>
                                    <div class="video-progress-thumb" id="videoThumb"></div>
                                </div>
                                <span class="video-time" id="videoTime">00:00 / ${video.duration}</span>
                            </div>
                            <div class="video-controls">
                                <div style="display: flex; align-items: center; gap: var(--space-2);">
                                    <button class="video-control-btn" onclick="togglePlayPause()" id="playPauseBtn">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="video-control-btn" onclick="toggleMute()" id="muteBtn">
                                        <i class="fas fa-volume-up"></i>
                                    </button>
                                    <div class="video-quality-selector">
                                        <button class="video-control-btn" onclick="toggleQualityMenu()">
                                            <i class="fas fa-cog"></i> ${videoQuality}
                                        </button>
                                        <div class="video-quality-menu" id="qualityMenu">
                                            ${video.quality.map(q => `
                                                <button class="video-quality-option" onclick="changeQuality('${q}')">${q}</button>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: var(--space-2);">
                                    <button class="video-control-btn" onclick="changeSpeed(0.5)">0.5x</button>
                                    <button class="video-control-btn" onclick="changeSpeed(1)">1x</button>
                                    <button class="video-control-btn" onclick="changeSpeed(1.25)">1.25x</button>
                                    <button class="video-control-btn" onclick="changeSpeed(1.5)">1.5x</button>
                                    <button class="video-control-btn" onclick="changeSpeed(2)">2x</button>
                                    <button class="video-control-btn" onclick="toggleFullscreen()">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4);">
                            <p><i class="fas fa-tag"></i> 分类：${video.category}</p>
                            <p><i class="fas fa-calendar"></i> 上传：${video.uploadDate}</p>
                            <p><i class="fas fa-user"></i> 发布者：${accounts[video.uploadedBy]?.name || '未知'}</p>
                            <p><i class="fas fa-hashtag"></i> 标签：${video.tags.join(', ')}</p>
                        </div>
                        <div style="margin-top: var(--space-4);">
                            <h4>视频描述</h4>
                            <p style="line-height: 1.6; color: var(--secondary); margin-top: var(--space-2);">
                                ${video.description}
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('active'), 10);
        }

        /**
         * 获取视频播放器
         */
        function getVideoPlayer(video) {
            switch (video.sourceType) {
                case 'bilibili':
                    return `
                        <iframe 
                            src="//player.bilibili.com/player.html?bvid=${video.source}&page=1&high_quality=1" 
                            scrolling="no" 
                            border="0" 
                            frameborder="no" 
                            framespacing="0" 
                            allowfullscreen="true"
                            style="width: 100%; height: 100%;">
                        </iframe>
                    `;
                case 'youtube':
                    return `
                        <iframe 
                            src="https://www.youtube.com/embed/${video.source}?enablejsapi=1" 
                            frameborder="0" 
                            allowfullscreen
                            style="width: 100%; height: 100%;">
                        </iframe>
                    `;
                case 'local':
                    return `
                        <video 
                            id="localVideo" 
                            controls 
                            style="width: 100%; height: 100%;"
                            src="${video.source}"
                            poster="${video.thumbnail}">
                            您的浏览器不支持视频播放。
                        </video>
                    `;
                default:
                    return `
                        <div class="video-placeholder">
                            <i class="fas fa-play-circle"></i>
                            <p>视频播放器</p>
                            <small>${video.description}</small>
                        </div>
                    `;
            }
        }
        
        /**
         * 显示视频模态框
         */
        function showVideoModal(video) {
            const modal = document.createElement('div');
            modal.className = 'video-modal';
            modal.innerHTML = `
                <div class="video-modal-content">
                    <div class="video-modal-header">
                        <h3>${video.title}</h3>
                        <button onclick="closeVideoModal()" class="close-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="video-container">
                        <div class="video-placeholder">
                            <i class="fas fa-play-circle"></i>
                            <p>视频播放器</p>
                            <small>${video.description}</small>
                        </div>
                    </div>
                    <div class="video-info">
                        <p><i class="far fa-clock"></i> ${video.duration}</p>
                        <p><i class="far fa-eye"></i> ${video.views} 次观看</p>
                        <p><i class="fas fa-tag"></i> ${video.category}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('active'), 10);
        }
        
        /**
         * 关闭视频模态框
         */
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }

        /**
         * 打开抖音视频
         */
        function openDouyinVideo(douyinUrl) {
            try {
                // 尝试在新窗口中打开抖音视频
                const newWindow = window.open(douyinUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                if (newWindow) {
                    showMessage('🚀 已打开抖音视频页面', 'info');
                } else {
                    showMessage('❌ 无法打开抖音页面，请检查浏览器弹窗设置', 'error');
                }
            } catch (error) {
                showMessage('❌ 打开抖音视频失败，请手动访问链接', 'error');
                console.error('打开抖音视频失败:', error);
            }
        }

        /**
         * 视频播放器控制函数
         */
        function togglePlayPause() {
            const video = document.getElementById('localVideo');
            const btn = document.getElementById('playPauseBtn');
            
            if (video) {
                if (video.paused) {
                    video.play();
                    btn.innerHTML = '<i class="fas fa-pause"></i>';
                } else {
                    video.pause();
                    btn.innerHTML = '<i class="fas fa-play"></i>';
                }
            }
        }

        function toggleMute() {
            const video = document.getElementById('localVideo');
            const btn = document.getElementById('muteBtn');
            
            if (video) {
                video.muted = !video.muted;
                btn.innerHTML = video.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
            }
        }

        function changeSpeed(speed) {
            const video = document.getElementById('localVideo');
            if (video) {
                video.playbackRate = speed;
                videoSpeed = speed;
            }
        }

        function changeQuality(quality) {
            videoQuality = quality;
            const menu = document.getElementById('qualityMenu');
            if (menu) {
                menu.classList.remove('show');
            }
            showToast(`视频质量已切换到 ${quality}`, 'success');
        }

        function toggleQualityMenu() {
            const menu = document.getElementById('qualityMenu');
            if (menu) {
                menu.classList.toggle('show');
            }
        }

        function toggleFullscreen() {
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('localVideo');
            
            if (video) {
                if (!document.fullscreenElement) {
                    video.requestFullscreen().catch(err => {
                        console.warn('无法进入全屏模式:', err);
                    });
                } else {
                    document.exitFullscreen();
                }
            } else if (modal) {
                if (!document.fullscreenElement) {
                    modal.requestFullscreen().catch(err => {
                        console.warn('无法进入全屏模式:', err);
                    });
                } else {
                    document.exitFullscreen();
                }
            }
        }

        function seekVideo(event) {
            const video = document.getElementById('localVideo');
            if (video) {
                const rect = event.currentTarget.getBoundingClientRect();
                const pos = (event.clientX - rect.left) / rect.width;
                video.currentTime = pos * video.duration;
            }
        }

        /**
         * 教师端管理功能
         */
        function editVideo(videoId) {
            const video = videosData.find(v => v.id === videoId);
            if (!video) return;
            
            const newTitle = prompt('请输入新的视频标题:', video.title);
            if (newTitle && newTitle !== video.title) {
                video.title = newTitle;
                saveDataToStorage();
                renderVideoGrid();
                showToast('视频标题已更新', 'success');
            }
        }

        function deleteVideo(videoId) {
            if (!confirm('确定要删除这个视频吗？此操作不可恢复！')) return;
            
            const index = videosData.findIndex(v => v.id === videoId);
            if (index > -1) {
                const video = videosData[index];
                videosData.splice(index, 1);
                saveDataToStorage();
                renderVideoGrid();
                showToast(`视频"${video.title}"已删除`, 'success');
            }
        }

        function editExercise(exerciseId) {
            const exercise = exercisesData.find(e => e.id === exerciseId);
            if (!exercise) return;
            
            const newTitle = prompt('请输入新的练习标题:', exercise.title);
            if (newTitle && newTitle !== exercise.title) {
                exercise.title = newTitle;
                saveDataToStorage();
                renderExerciseGrid();
                showToast('练习标题已更新', 'success');
            }
        }

        function deleteExercise(exerciseId) {
            if (!confirm('确定要删除这个练习吗？此操作不可恢复！')) return;
            
            const index = exercisesData.findIndex(e => e.id === exerciseId);
            if (index > -1) {
                const exercise = exercisesData[index];
                exercisesData.splice(index, 1);
                saveDataToStorage();
                renderExerciseGrid();
                showToast(`练习"${exercise.title}"已删除`, 'success');
            }
        }

        /**
         * 保存数据到存储
         */
        function saveDataToStorage() {
            try {
                localStorage.setItem('videosData', JSON.stringify(videosData));
                localStorage.setItem('exercisesData', JSON.stringify(exercisesData));
                
                // 如果连接了GitHub，同步到云端
                if (githubStorage.isConnected) {
                    githubStorage.saveData('data/videos.json', videosData, '更新视频数据');
                    githubStorage.saveData('data/exercises.json', exercisesData, '更新练习数据');
                }
            } catch (error) {
                console.warn('保存数据失败:', error);
            }
        }
        
        /**
         * 开始练习
         */
        function startExercise(type) {
            const exercise = exercisesData.find(e => e.id === type);
            if (!exercise) {
                showMessage('练习未找到', 'error');
                return;
            }
            
            // 显示练习模态框
            showExerciseModal(exercise);
        }
        
        /**
         * 显示练习模态框
         */
        function showExerciseModal(exercise) {
            const modal = document.createElement('div');
            modal.className = 'exercise-modal';
            modal.innerHTML = `
                <div class="exercise-modal-content">
                    <div class="exercise-modal-header">
                        <h3>${exercise.title}</h3>
                        <button onclick="closeExerciseModal()" class="close-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="exercise-content">
                        <div class="exercise-info">
                            <p><i class="fas fa-list"></i> ${exercise.questionCount}题</p>
                            <p><i class="fas fa-clock"></i> ${exercise.duration}</p>
                            <p><i class="fas fa-star"></i> ${exercise.difficulty}</p>
                        </div>
                        <div class="exercise-actions">
                            <button onclick="startExerciseQuestions('${exercise.id}')" class="btn btn-primary">
                                <i class="fas fa-play"></i> 开始练习
                            </button>
                            <button onclick="submitExerciseForAIReview('${exercise.id}')" class="btn btn-secondary">
                                <i class="fas fa-robot"></i> AI批改
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('active'), 10);
        }
        
        /**
         * 关闭练习模态框
         */
        function closeExerciseModal() {
            const modal = document.querySelector('.exercise-modal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        /**
         * 开始练习题目
         */
        function startExerciseQuestions(exerciseId) {
            const exercise = exercisesData.find(e => e.id === exerciseId);
            if (!exercise || !exercise.questions || exercise.questions.length === 0) {
                showMessage('该练习暂无题目', 'error');
                return;
            }
            
            // 关闭模态框
            closeExerciseModal();
            
            // 显示做题界面
            showExerciseQuestions(exercise);
        }
        
        /**
         * 显示做题界面
         */
        function showExerciseQuestions(exercise) {
            let currentIndex = 0;
            const modal = document.createElement('div');
            modal.className = 'exercise-questions-modal';
            modal.id = 'exerciseQuestionsModal';
            modal.innerHTML = `
                <div class="modal-header" style="display:flex;justify-content:space-between;align-items:center;">
                    <span>${exercise.title}</span>
                    <div>
                        <button id="fullscreenBtn" title="全屏" style="margin-right:8px;"><i class="fas fa-expand"></i></button>
                        <button onclick="document.body.removeChild(document.getElementById('exerciseQuestionsModal'))" title="关闭"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <div class="modal-body" id="exerciseModalBody" style="max-height:60vh;overflow-y:auto;"></div>
                <div class="modal-footer" style="display:flex;justify-content:space-between;align-items:center;">
                    <button id="prevQuestionBtn">上一题</button>
                    <span id="questionProgress"></span>
                    <button id="nextQuestionBtn">下一题</button>
                </div>
            `;
            document.body.appendChild(modal);
            const body = modal.querySelector('#exerciseModalBody');
            const progress = modal.querySelector('#questionProgress');
            function renderQuestion(idx) {
                const q = exercise.questions[idx];
                if (!q) return;
                let optionsHtml = '';
                if (Array.isArray(q.options) && q.options.length > 0) {
                    optionsHtml = q.options.map((opt, i) => `
                        <label class="option-label" style="display:flex;align-items:center;margin:8px 0;font-size:1.1em;">
                            <input type="radio" name="q${q.id}" value="${i}" class="option-input" style="margin-right:8px;transform:scale(1.3);">
                            <span class="option-text">${opt}</span>
                        </label>
                    `).join('');
                } else {
                    optionsHtml = '<div style="color:red;">选项数据缺失</div>';
                }
                body.innerHTML = `
                    <div class="question-item" data-question-id="${q.id}">
                        <div class="question-header"><span class="question-number">第${idx+1}题</span><span class="question-points">${q.points||5}分</span></div>
                        <div class="question-content"><p class="question-text">${q.question}</p><div class="options-container">${optionsHtml}</div></div>
                        <div class="question-hint" style="display:none;"><i class="fas fa-lightbulb"></i> 提示：${q.hint||''}</div>
                        <div class="question-explanation" style="display:none;"><i class="fas fa-check-circle"></i> 解析：${q.explanation||''}</div>
                    </div>
                `;
                progress.textContent = `${idx+1} / ${exercise.questions.length}`;
                modal.querySelector('#prevQuestionBtn').disabled = idx === 0;
                modal.querySelector('#nextQuestionBtn').disabled = idx === exercise.questions.length-1;
            }
            renderQuestion(currentIndex);
            modal.querySelector('#prevQuestionBtn').onclick = () => {
                if (currentIndex > 0) { currentIndex--; renderQuestion(currentIndex); }
            };
            modal.querySelector('#nextQuestionBtn').onclick = () => {
                if (currentIndex < exercise.questions.length-1) { currentIndex++; renderQuestion(currentIndex); }
            };
            // 全屏按钮
            modal.querySelector('#fullscreenBtn').onclick = () => {
                if (modal.requestFullscreen) modal.requestFullscreen();
            };
        }
        
        /**
         * 添加做题界面样式
         */
        function addExerciseQuestionsStyles() {
            if (document.getElementById('exerciseQuestionsStyles')) return;
            
            const style = document.createElement('style');
            style.id = 'exerciseQuestionsStyles';
            style.textContent = `
                .exercise-questions-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.85);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    backdrop-filter: blur(5px);
                }
                
                .exercise-questions-modal.active {
                    opacity: 1;
                }
                
                .exercise-questions-content {
                    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
                    border-radius: 20px;
                    width: 95%;
                    max-width: 900px;
                    max-height: 95vh;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                }
                
                .exercise-questions-header {
                    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
                    color: white;
                    padding: 25px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    position: relative;
                    overflow: hidden;
                }
                
                .exercise-questions-header::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
                    opacity: 0.3;
                }
                
                .exercise-questions-header h3 {
                    margin: 0;
                    font-size: 24px;
                    font-weight: 700;
                    z-index: 1;
                    position: relative;
                }
                
                .exercise-progress {
                    background: rgba(255, 255, 255, 0.25);
                    padding: 10px 20px;
                    border-radius: 25px;
                    font-weight: bold;
                    font-size: 16px;
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    z-index: 1;
                    position: relative;
                }
                
                .exercise-questions-body {
                    flex: 1;
                    padding: 30px;
                    overflow-y: auto;
                    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
                }
                
                .question-item {
                    margin-bottom: 35px;
                    padding: 25px;
                    border: 2px solid #e3edfa;
                    border-radius: 15px;
                    background: white;
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
                    transition: all 0.3s ease;
                    position: relative;
                    overflow: hidden;
                }
                
                .question-item::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 4px;
                    height: 100%;
                    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
                }
                
                .question-item:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.12);
                    border-color: var(--accent);
                }
                
                .question-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 20px;
                    padding-bottom: 15px;
                    border-bottom: 2px solid #f0f0f0;
                }
                
                .question-number {
                    font-weight: bold;
                    color: var(--primary);
                    font-size: 20px;
                    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                }
                
                .question-points {
                    background: linear-gradient(135deg, var(--accent) 0%, var(--success) 100%);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 14px;
                    font-weight: bold;
                    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
                }
                
                .question-text {
                    font-size: 18px;
                    line-height: 1.7;
                    margin-bottom: 25px;
                    color: var(--text);
                    font-weight: 500;
                    text-align: justify;
                }
                
                .options-container {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }
                
                .option-label {
                    display: flex;
                    align-items: center;
                    padding: 15px 20px;
                    border: 2px solid #e3edfa;
                    border-radius: 12px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    background: white;
                    position: relative;
                    overflow: hidden;
                }
                
                .option-label::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(52, 152, 219, 0.1), transparent);
                    transition: left 0.5s ease;
                }
                
                .option-label:hover {
                    border-color: var(--accent);
                    background: linear-gradient(135deg, #f0f8ff 0%, #e3f2fd 100%);
                    transform: translateX(5px);
                }
                
                .option-label:hover::before {
                    left: 100%;
                }
                
                .option-input {
                    margin-right: 15px;
                    transform: scale(1.2);
                    accent-color: var(--accent);
                }
                
                .option-text {
                    flex: 1;
                    font-size: 16px;
                    font-weight: 500;
                    color: var(--text);
                }
                
                .question-hint, .question-explanation {
                    margin-top: 20px;
                    padding: 20px;
                    border-radius: 12px;
                    font-size: 15px;
                    line-height: 1.6;
                    position: relative;
                    overflow: hidden;
                }
                
                .question-hint {
                    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
                    border: 2px solid #ffc107;
                    color: #856404;
                }
                
                .question-hint::before {
                    content: '💡';
                    position: absolute;
                    top: 10px;
                    right: 15px;
                    font-size: 20px;
                }
                
                .question-explanation {
                    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
                    border: 2px solid #28a745;
                    color: #155724;
                }
                
                .question-explanation::before {
                    content: '✅';
                    position: absolute;
                    top: 10px;
                    right: 15px;
                    font-size: 20px;
                }
                
                .exercise-questions-footer {
                    padding: 25px;
                    display: flex;
                    gap: 15px;
                    justify-content: center;
                    border-top: 2px solid #e3edfa;
                    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
                }
                
                .btn {
                    padding: 15px 25px;
                    border: none;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: bold;
                    font-size: 16px;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    position: relative;
                    overflow: hidden;
                    min-width: 140px;
                    justify-content: center;
                }
                
                .btn::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    transition: left 0.5s ease;
                }
                
                .btn:hover::before {
                    left: 100%;
                }
                
                .btn-primary {
                    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
                    color: white;
                    box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
                }
                
                .btn-secondary {
                    background: linear-gradient(135deg, var(--secondary) 0%, #6c757d 100%);
                    color: white;
                    box-shadow: 0 6px 20px rgba(108, 117, 125, 0.3);
                }
                
                .btn-success {
                    background: linear-gradient(135deg, var(--success) 0%, #28a745 100%);
                    color: white;
                    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
                }
                
                .btn:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                }
                
                .btn:active {
                    transform: translateY(-1px);
                }
                
                /* 滚动条样式 */
                .exercise-questions-body::-webkit-scrollbar {
                    width: 8px;
                }
                
                .exercise-questions-body::-webkit-scrollbar-track {
                    background: #f1f1f1;
                    border-radius: 4px;
                }
                
                .exercise-questions-body::-webkit-scrollbar-thumb {
                    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
                    border-radius: 4px;
                }
                
                .exercise-questions-body::-webkit-scrollbar-thumb:hover {
                    background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
                }
            `;
            document.head.appendChild(style);
        }
        
        /**
         * 关闭做题界面
         */
        function closeExerciseQuestions() {
            const modal = document.querySelector('.exercise-questions-modal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        /**
         * 显示提示
         */
        function showHint() {
            const currentQuestion = document.querySelector('.question-item:first-child');
            if (currentQuestion) {
                const hint = currentQuestion.querySelector('.question-hint');
                if (hint) {
                    hint.style.display = 'block';
                }
            }
        }
        
        /**
         * 检查答案
         */
        function checkAnswer() {
            const currentQuestion = document.querySelector('.question-item:first-child');
            if (currentQuestion) {
                const questionId = currentQuestion.dataset.questionId;
                const selectedOption = currentQuestion.querySelector(`input[name="q${questionId}"]:checked`);
                
                if (!selectedOption) {
                    showMessage('请先选择一个答案', 'warning');
                    return;
                }
                
                const selectedValue = parseInt(selectedOption.value);
                const question = exercisesData.flatMap(e => e.questions).find(q => q.id == questionId);
                
                if (question) {
                    const explanation = currentQuestion.querySelector('.question-explanation');
                    if (explanation) {
                        explanation.style.display = 'block';
                    }
                    
                    if (selectedValue === question.correct) {
                        showMessage('回答正确！', 'success');
                    } else {
                        showMessage('回答错误，请查看解析', 'error');
                    }
                }
            }
        }
        
        /**
         * 提交练习
         */
        function submitExercise() {
            const questions = document.querySelectorAll('.question-item');
            let answeredCount = 0;
            let correctCount = 0;
            
            questions.forEach(questionItem => {
                const questionId = questionItem.dataset.questionId;
                const selectedOption = questionItem.querySelector(`input[name="q${questionId}"]:checked`);
                
                if (selectedOption) {
                    answeredCount++;
                    const selectedValue = parseInt(selectedOption.value);
                    const question = exercisesData.flatMap(e => e.questions).find(q => q.id == questionId);
                    
                    if (question && selectedValue === question.correct) {
                        correctCount++;
                    }
                }
            });
            
            const totalQuestions = questions.length;
            const score = Math.round((correctCount / totalQuestions) * 100);
            
            showMessage(`练习完成！得分：${score}分 (${correctCount}/${totalQuestions})`, 'success');
            
            // 显示详细结果
            setTimeout(() => {
                alert(`练习结果：
                
总题数：${totalQuestions}
已答题：${answeredCount}
正确题：${correctCount}
得分：${score}分

${score >= 80 ? '🎉 优秀！继续保持！' : score >= 60 ? '👍 良好，继续努力！' : '💪 加油，多练习！'}`);
                
                closeExerciseQuestions();
            }, 1000);
        }
        
        /**
         * 提交练习给AI批改
         */
        async function submitExerciseForAIReview(exerciseId) {
            const exercise = exercisesData.find(e => e.id === exerciseId);
            if (!exercise) {
                showMessage('练习未找到', 'error');
                return;
            }
            
            // 打开AI助手并发送批改请求
            AIAssistant.toggleChat();
            setTimeout(() => {
                AIAssistant.addMessage(`请帮我批改"${exercise.title}"这个练习，我有以下问题需要解答：`, 'user');
                AIAssistant.generateAIResponse(`请帮我批改"${exercise.title}"这个练习，我有以下问题需要解答：`);
            }, 500);
            
            closeExerciseModal();
        }
        
        /**
         * 筛选分数线
         */
        function filterScores(year) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            showMessage(`显示${year}年分数线数据`, 'info');
            
            // 更新图表
            updateScoreChart(year);
        }
        
        /**
         * 高级数据可视化系统
         */
        const DataVisualization = {
            chartInstances: {},
            
            // 创建增强的分数线图表
            createAdvancedScoreChart: function(year) {
                const ctx = document.getElementById('scoreChart');
                if (!ctx) return;

                const data = scoreData[year] || scoreData['2024'];
                
                if (this.chartInstances.scoreChart) {
                    this.chartInstances.scoreChart.destroy();
                }

                this.chartInstances.scoreChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['国家线', '复试线'],
                        datasets: [{
                            label: `${year}年分数线`,
                            data: [data.national, data.reexam],
                            backgroundColor: [
                                'rgba(231, 76, 60, 0.8)',
                                'rgba(52, 152, 219, 0.8)'
                            ],
                            borderColor: [
                                'rgba(231, 76, 60, 1)',
                                'rgba(52, 152, 219, 1)'
                            ],
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: 'rgba(77, 184, 214, 0.5)',
                                borderWidth: 1,
                                cornerRadius: 8,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.parsed.y}分`;
                                    },
                                    afterBody: function(context) {
                                        const diff = Math.abs(data.reexam - data.national);
                                        return [`分差: ${diff}分`];
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                }
                            },
                            y: {
                                beginAtZero: false,
                                min: 250,
                                max: 400,
                                grid: {
                                    borderDash: [5, 5],
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '分';
                                    },
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 2000,
                            easing: 'easeInOutQuart',
                            onComplete: function() {
                                // 添加数字动画
                                this.data.datasets[0].data.forEach((value, index) => {
                                    const meta = this.getDatasetMeta(0);
                                    const element = meta.data[index];
                                    const ctx = this.ctx;
                                    
                                    ctx.fillStyle = '#2c3e50';
                                    ctx.font = 'bold 16px Arial';
                                    ctx.textAlign = 'center';
                                    ctx.fillText(value + '分', element.x, element.y - 10);
                                });
                            }
                        }
                    }
                });
            },

            // 创建学习进度环形图
            createProgressRing: function(containerId, progress, title, color = 'rgba(77, 184, 214, 1)') {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.innerHTML = `
                    <div class="progress-ring-container">
                        <svg class="progress-ring" width="120" height="120">
                            <circle class="progress-ring-background" 
                                cx="60" cy="60" r="50" 
                                stroke="rgba(230, 236, 241, 0.3)" 
                                stroke-width="8" 
                                fill="transparent"/>
                            <circle class="progress-ring-progress" 
                                cx="60" cy="60" r="50" 
                                stroke="${color}" 
                                stroke-width="8" 
                                fill="transparent"
                                stroke-dasharray="314.16"
                                stroke-dashoffset="${314.16 - (314.16 * progress) / 100}"
                                stroke-linecap="round"/>
                        </svg>
                        <div class="progress-ring-text">
                            <div class="progress-value gradient-text">${progress}%</div>
                            <div class="progress-label">${title}</div>
                        </div>
                    </div>
                `;

                // 添加CSS
                if (!document.getElementById('progressRingStyles')) {
                    const style = document.createElement('style');
                    style.id = 'progressRingStyles';
                    style.textContent = `
                        .progress-ring-container {
                            position: relative;
                            display: inline-block;
                        }
                        .progress-ring {
                            transform: rotate(-90deg);
                            transition: all 1s ease-in-out;
                        }
                        .progress-ring-progress {
                            transition: stroke-dashoffset 2s ease-in-out;
                        }
                        .progress-ring-text {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            text-align: center;
                        }
                        .progress-value {
                            font-size: var(--text-xl);
                            font-weight: var(--font-bold);
                            line-height: 1;
                        }
                        .progress-label {
                            font-size: var(--text-xs);
                            color: var(--gray-dark);
                            margin-top: var(--space-1);
                        }
                    `;
                    document.head.appendChild(style);
                }
            },

            // 创建实时活动图
            createActivityChart: function(containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;

                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                container.appendChild(canvas);

                // 生成模拟数据
                const activityData = [];
                const labels = [];
                const now = new Date();
                for (let i = 23; i >= 0; i--) {
                    const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                    labels.push(time.getHours() + ':00');
                    activityData.push(Math.floor(Math.random() * 50) + 10);
                }

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '学习活跃度',
                            data: activityData,
                            borderColor: 'rgba(77, 184, 214, 1)',
                            backgroundColor: 'rgba(77, 184, 214, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgba(77, 184, 214, 1)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: '24小时学习活跃度',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    borderDash: [3, 3],
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '人';
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 2000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }
        };

        /**
         * 更新分数线图表
         */
        function updateScoreChart(year) {
            const ctx = document.getElementById('scoreChart');
            if (!ctx) {
                console.warn('分数线图表容器未找到');
                return;
            }
            
            // 检查Chart.js是否可用
            if (typeof Chart === 'undefined') {
                console.error('Chart.js未加载，无法创建图表');
                // 尝试重新加载Chart.js
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                script.onload = () => {
                    console.log('Chart.js重新加载成功');
                    setTimeout(() => updateScoreChart(year), 500);
                };
                document.head.appendChild(script);
                return;
            }
            
            if (window.scoreChart) {
                window.scoreChart.destroy();
            }
            
            console.log('📊 更新分数线图表:', year);
            console.log('📋 可用数据:', scoreData);
            console.log('📈 Chart.js版本:', Chart.version);
            
            // 确保图表容器有尺寸和样式
            ctx.style.width = '100%';
            ctx.style.height = '400px';
            ctx.style.display = 'block';
            
            // 添加图表容器的CSS样式
            const chartContainer = ctx.parentElement;
            if (chartContainer) {
                chartContainer.style.padding = '20px';
                chartContainer.style.background = 'white';
                chartContainer.style.borderRadius = '10px';
                chartContainer.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
                chartContainer.style.margin = '20px 0';
            }
            
            // 准备数据
            const years = Object.keys(scoreData).sort();
            const nationalScores = years.map(year => scoreData[year].national);
            const reexamScores = years.map(year => scoreData[year].reexam);
            const applicants = years.map(year => admissionData[year]?.applicants || 0);
            
            // 如果是特定年份，只显示该年份数据
            if (year !== 'all') {
                const yearData = scoreData[year];
                if (yearData) {
                    window.scoreChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['国家线', '复试线'],
                            datasets: [{
                                label: `${year}年分数线`,
                                data: [yearData.national, yearData.reexam],
                                backgroundColor: [
                                    'rgba(231, 76, 60, 0.8)',
                                    'rgba(52, 152, 219, 0.8)'
                                ],
                                borderColor: [
                                    'rgba(231, 76, 60, 1)',
                                    'rgba(52, 152, 219, 1)'
                                ],
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 400,
                                    ticks: {
                                        stepSize: 50
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }
            } else {
                // 显示所有年份的曲线图
                window.scoreChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: years,
                        datasets: [
                            {
                                label: '复试线',
                                data: reexamScores,
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                borderWidth: 3,
                                pointBackgroundColor: '#3498db',
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                tension: 0.2,
                                fill: true,
                                yAxisID: 'y'
                            },
                            {
                                label: '国家线',
                                data: nationalScores,
                                borderColor: '#e74c3c',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                borderWidth: 3,
                                pointBackgroundColor: '#e74c3c',
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                tension: 0.2,
                                fill: true,
                                yAxisID: 'y'
                            },
                            {
                                label: '报名人数',
                                data: applicants,
                                borderColor: '#27ae60',
                                backgroundColor: 'rgba(39, 174, 96, 0.1)',
                                borderWidth: 3,
                                pointBackgroundColor: '#27ae60',
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                tension: 0.2,
                                fill: false,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                beginAtZero: false,
                                min: 260,
                                max: 320,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                title: {
                                    display: true,
                                    text: '分数'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: true,
                                max: 150,
                                grid: {
                                    drawOnChartArea: false
                                },
                                title: {
                                    display: true,
                                    text: '报名人数'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        /**
         * 添加成绩
         */
        function addGrade(event) {
            event.preventDefault();
            
            const studentName = document.getElementById('studentName').value;
            const gradeScore = document.getElementById('gradeScore').value;
            
            if (!studentName || !gradeScore) {
                showMessage('请填写完整信息', 'error');
                return;
            }
            
            // 验证成绩范围
            const score = parseInt(gradeScore);
            if (score < 0 || score > 150) {
                showMessage('成绩必须在0-150分之间', 'error');
                return;
            }
            
            // 添加到成绩列表
            addGradeToList(studentName, score);
            
            showMessage(`已添加 ${studentName} 的成绩：${gradeScore}分`, 'success');
            
            document.getElementById('studentName').value = '';
            document.getElementById('gradeScore').value = '';
        }
        
        /**
         * 添加成绩到列表
         */
        function addGradeToList(name, score) {
            const gradesList = document.getElementById('gradesList');
            
            // 如果是第一次添加，清除"暂无成绩记录"的提示
            if (gradesList.querySelector('p')) {
                gradesList.innerHTML = '';
            }
            
            const gradeItem = document.createElement('div');
            gradeItem.className = 'grade-item';
            gradeItem.innerHTML = `
                <div class="grade-info">
                    <span class="grade-name">${name}</span>
                    <span class="grade-score">${score}</span>
                </div>
                <div class="grade-actions">
                    <button onclick="editGrade(this)" class="edit-btn">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteGrade(this)" class="delete-btn">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            gradesList.appendChild(gradeItem);
            updateGradeChart();
        }
        
        /**
         * 编辑成绩
         */
        function editGrade(button) {
            const gradeItem = button.closest('.grade-item');
            const nameSpan = gradeItem.querySelector('.grade-name');
            const scoreSpan = gradeItem.querySelector('.grade-score');
            
            const newName = prompt('请输入新的姓名:', nameSpan.textContent);
            const newScore = prompt('请输入新的成绩:', scoreSpan.textContent);
            
            if (newName && newScore) {
                nameSpan.textContent = newName;
                scoreSpan.textContent = newScore;
                showMessage('成绩已更新', 'success');
                updateGradeChart();
            }
        }
        
        /**
         * 删除成绩
         */
        function deleteGrade(button) {
            if (confirm('确定要删除这条成绩记录吗？')) {
                const gradeItem = button.closest('.grade-item');
                gradeItem.remove();
                showMessage('成绩已删除', 'success');
                updateGradeChart();
            }
        }
        
        /**
         * 更新成绩统计图表
         */
        function updateGradeChart() {
            const grades = Array.from(document.querySelectorAll('.grade-item .grade-score')).map(el => parseInt(el.textContent));
            const bins = [0, 0, 0, 0, 0];
            grades.forEach(score => {
                if (score >= 90) bins[0]++;
                else if (score >= 80) bins[1]++;
                else if (score >= 70) bins[2]++;
                else if (score >= 60) bins[3]++;
                else bins[4]++;
            });
            const ctx = document.getElementById('gradeChart').getContext('2d');
            if (window.gradeChartInstance) window.gradeChartInstance.destroy();
            window.gradeChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['90-100', '80-89', '70-79', '60-69', '60以下'],
                    datasets: [{
                        label: '人数',
                        data: bins,
                        backgroundColor: [
                            '#27ae60','#2ecc71','#f1c40f','#e67e22','#e74c3c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, stepSize: 1 } }
                }
            });
        }
        window.addEventListener('DOMContentLoaded', () => setTimeout(updateGradeChart, 500));
        
        /**
         * 缓存DOM元素
         */
        function cacheDOM() {
            DOM.loginSystem = document.getElementById('loginSystem');
            DOM.platform = document.getElementById('platform');
            DOM.loginForm = document.getElementById('loginForm');
            DOM.loginMessage = document.getElementById('loginMessage');
            DOM.loginButton = document.getElementById('loginButton');
            DOM.loginButtonText = document.getElementById('loginButtonText');
            DOM.loginButtonSpinner = document.getElementById('loginButtonSpinner');
            DOM.usernameInput = document.getElementById('username');
            DOM.passwordInput = document.getElementById('password');
            DOM.userAvatar = document.getElementById('userAvatar');
            DOM.displayUsername = document.getElementById('displayUsername');
            DOM.userRole = document.getElementById('userRole');
        }
        
        /**
         * 绑定事件监听器
         */
        function bindEvents() {
            DOM.loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const username = DOM.usernameInput.value;
                const password = DOM.passwordInput.value;
                
                await performLogin(username, password);
            });
            
            DOM.usernameInput.addEventListener('input', debounce((e) => {
                const value = e.target.value;
                const isValid = value.length >= 3;
                e.target.classList.toggle('invalid', !isValid);
            }, 300));
            
            DOM.passwordInput.addEventListener('input', debounce((e) => {
                const value = e.target.value;
                const isValid = value.length >= 6;
                e.target.classList.toggle('invalid', !isValid);
            }, 300));
        }
        
        /**
         * 尝试恢复会话
         */
        function tryRestoreSession() {
            try {
                const savedUser = sessionStorage.getItem('currentUser');
                const loginTime = sessionStorage.getItem('loginTime');
                
                if (savedUser && loginTime) {
                    const user = JSON.parse(savedUser);
                    const loginTimestamp = parseInt(loginTime, 10);
                    const now = Date.now();
                    
                    const SESSION_DURATION = 24 * 60 * 60 * 1000;
                    if (user && (now - loginTimestamp) < SESSION_DURATION) {
                        currentUser = user;
                        isLoggedIn = true;
                        showPlatform();
                        return true;
                    } else {
                        sessionStorage.removeItem('currentUser');
                        sessionStorage.removeItem('loginTime');
                    }
                }
            } catch (error) {
                console.warn('会话恢复失败:', error);
                sessionStorage.removeItem('currentUser');
                sessionStorage.removeItem('loginTime');
            }
            
            return false;
        }
        
        /**
         * 性能优化工具集
         */
        const PerformanceOptimizer = {
            throttle: function(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            },

            debounce: function(func, delay) {
                let timeoutId;
                return function(...args) {
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => func.apply(this, args), delay);
                }
            },

            lazyLoadImages: function() {
                const images = document.querySelectorAll('img[data-src]');
                if ('IntersectionObserver' in window) {
                    const imageObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                img.src = img.dataset.src;
                                img.classList.remove('lazy');
                                imageObserver.unobserve(img);
                            }
                        });
                    });
                    images.forEach(img => imageObserver.observe(img));
                }
            },

            optimizeAnimations: function() {
                const isLowEnd = navigator.hardwareConcurrency <= 2 || 
                               navigator.deviceMemory <= 2 ||
                               /Android.*Chrome/.test(navigator.userAgent);
                
                if (isLowEnd) {
                    document.documentElement.style.setProperty('--transition-fast', '0.1s');
                    document.documentElement.style.setProperty('--transition-normal', '0.15s');
                    document.documentElement.style.setProperty('--transition-slow', '0.2s');
                }
            }
        };

        /**
         * 无障碍功能增强
         */
        const AccessibilityEnhancer = {
            setupKeyboardNavigation: function() {
                document.addEventListener('keydown', (e) => {
                    // ESC键关闭模态框
                    if (e.key === 'Escape') {
                        const modal = document.querySelector('.modal-overlay.active');
                        if (modal) {
                            closeVideoModal();
                        }
                    }
                    
                    // Enter键激活按钮
                    if (e.key === 'Enter' && e.target.tagName === 'BUTTON') {
                        e.target.click();
                    }
                });
            },

            setupAriaSupport: function() {
                const updateAriaLabels = () => {
                    const currentSection = document.querySelector('.content-section.active');
                    if (currentSection) {
                        const title = currentSection.querySelector('h2')?.textContent || '流体力学学习平台';
                        document.title = `${title} - 中国海洋大学`;
                    }
                };

                // 监听DOM变化
                const observer = new MutationObserver(updateAriaLabels);
                const mainContent = document.getElementById('main-content');
                if (mainContent) {
                    observer.observe(mainContent, {
                        childList: true,
                        subtree: true,
                        attributes: true,
                        attributeFilter: ['class']
                    });
                }
            },

            setupFontSizeControl: function() {
                let fontSize = parseInt(localStorage.getItem('fontSize')) || 16;
                
                const updateFontSize = (size) => {
                    fontSize = Math.max(12, Math.min(24, size));
                    document.documentElement.style.fontSize = fontSize + 'px';
                    localStorage.setItem('fontSize', fontSize);
                };

                updateFontSize(fontSize);

                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        if (e.key === '=' || e.key === '+') {
                            e.preventDefault();
                            updateFontSize(fontSize + 1);
                            showToast(`字体大小已调整为 ${fontSize + 1}px`, 'info');
                        } else if (e.key === '-') {
                            e.preventDefault();
                            updateFontSize(fontSize - 1);
                            showToast(`字体大小已调整为 ${fontSize - 1}px`, 'info');
                        } else if (e.key === '0') {
                            e.preventDefault();
                            updateFontSize(16);
                            showToast('字体大小已重置为默认', 'info');
                        }
                    }
                });
            }
        };

        /**
         * 增强的错误处理系统
         */
        const ErrorHandler = {
            errors: [],
            
            log: function(level, message, data = null) {
                const timestamp = new Date().toISOString();
                const error = { timestamp, level, message, data };
                this.errors.push(error);
                
                if (this.errors.length > 50) {
                    this.errors = this.errors.slice(-25);
                }
                
                switch (level) {
                    case 'error':
                        console.error(`[${timestamp}] ERROR: ${message}`, data);
                        break;
                    case 'warn':
                        console.warn(`[${timestamp}] WARN: ${message}`, data);
                        break;
                    case 'info':
                        console.info(`[${timestamp}] INFO: ${message}`, data);
                        break;
                    default:
                        console.log(`[${timestamp}] DEBUG: ${message}`, data);
                }
            },
            
            handleGlobalError: function() {
                window.addEventListener('error', (e) => {
                    this.log('error', '全局JavaScript错误', {
                        message: e.message,
                        filename: e.filename,
                        lineno: e.lineno,
                        colno: e.colno
                    });
                });
                
                window.addEventListener('unhandledrejection', (e) => {
                    this.log('error', '未处理的Promise拒绝', {
                        reason: e.reason
                    });
                });
            }
        };

        /**
         * 应用程序初始化
         */
        function initializeApp() {
            try {
                ErrorHandler.log('info', '正在初始化流体力学学习平台...');
                
                // 设置全局错误处理
                ErrorHandler.handleGlobalError();
                
                // 性能优化
                PerformanceOptimizer.optimizeAnimations();
                PerformanceOptimizer.lazyLoadImages();
                
                // 无障碍功能
                AccessibilityEnhancer.setupKeyboardNavigation();
                AccessibilityEnhancer.setupAriaSupport();
                AccessibilityEnhancer.setupFontSizeControl();
                
                // 启动安全防护
                SecurityManager.init();
                devtoolsCheckInterval = setInterval(detectDevTools, 500);

                // 添加拖拽上传支持
                setupDragAndDrop();
                
                // 注册Service Worker
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js')
                        .then(registration => {
                            console.info('Service Worker 注册成功');
                        })
                        .catch(error => {
                            console.warn('Service Worker 注册失败:', error);
                        });
                }
                
                // 重写fetch以添加安全头部
                const originalFetch = window.fetch;
                window.fetch = function(...args) {
                    if (args[1]) {
                        args[1].headers = {
                            ...args[1].headers,
                            'X-Content-Type-Options': 'nosniff',
                            'X-Frame-Options': 'DENY',
                            'X-XSS-Protection': '1; mode=block'
                        };
                    }
                    return originalFetch.apply(this, args);
                };
                
                cacheDOM();
                bindEvents();
                
                // 从本地存储加载数据
                loadLocalData();
                
                if (!tryRestoreSession()) {
                    console.info('显示登录界面');
                } else {
                                    // 如果已登录，初始化图表和功能
                setTimeout(() => {
                    try {
                        console.log('🚀 开始初始化系统功能...');
                        
                        // 确保Chart.js已加载
                        if (typeof Chart !== 'undefined') {
                            updateScoreChart('2024');
                        } else {
                            console.warn('Chart.js未加载，延迟初始化图表...');
                            setTimeout(() => {
                                if (typeof Chart !== 'undefined') {
                                    updateScoreChart('2024');
                                } else {
                                    console.error('Chart.js加载失败');
                                }
                            }, 2000);
                        }
                        
                        updateUIForUserRole();
                        renderVideoGrid();
                        renderExerciseGrid();
                        
                        // 优先启动AI助手
                        console.log('🤖 初始化AI助手...');
                        if (window.AIAssistant && window.AIAssistant.init) {
                            window.AIAssistant.init();
                            
                            // 立即测试AI连接
                            setTimeout(() => {
                                console.log('🔍 立即测试AI连接...');
                                window.AIAssistant.testAIConnection();
                            }, 500);
                        } else {
                            console.warn('AI助手未找到，尝试重新初始化...');
                            if (typeof AIAssistant !== 'undefined') {
                                AIAssistant.init();
                                setTimeout(() => {
                                    AIAssistant.testAIConnection();
                                }, 500);
                            }
                        }
                        
                        SmartRecommendation.analyzeAndRecommend();
                        
                        // 如果用户之前连接了GitHub，尝试重新连接
                        if (currentUser && currentUser.github && currentUser.github.connected) {
                            githubStorage.connect(currentUser.github.token, currentUser.github.repo);
                        }
                        
                        console.log('✅ 系统初始化完成');
                    } catch (error) {
                        console.error('❌ 初始化时出错:', error);
                    }
                }, 1000);
                }
                
                console.info('流体力学学习平台初始化完成！');
                
            } catch (error) {
                console.error('应用程序初始化失败:', error);
                
                document.body.innerHTML = `
                    <div style="padding: 2rem; text-align: center; background: rgba(231, 76, 60, 0.1); margin: 2rem; border-radius: 1rem;">
                        <h2 style="color: var(--error); margin-bottom: 1rem;">系统初始化失败</h2>
                        <p style="margin-bottom: 2rem;">应用程序无法正常启动，请刷新页面重试。</p>
                        <button onclick="location.reload()" style="padding: 0.5rem 2rem; background: var(--primary); color: white; border: none; border-radius: 0.5rem; cursor: pointer;">刷新页面</button>
                    </div>
                `;
            }
        }

        /**
         * 从本地存储加载数据
         */
        function loadLocalData() {
            try {
                const savedAccounts = localStorage.getItem('accounts');
                if (savedAccounts) {
                    Object.assign(accounts, JSON.parse(savedAccounts));
                }
                
                const savedVideos = localStorage.getItem('videosData');
                if (savedVideos) {
                    videosData.splice(0, videosData.length, ...JSON.parse(savedVideos));
                }
                
                const savedExercises = localStorage.getItem('exercisesData');
                if (savedExercises) {
                    exercisesData.splice(0, exercisesData.length, ...JSON.parse(savedExercises));
                }
                
                const savedScores = localStorage.getItem('scoreData');
                if (savedScores) {
                    Object.assign(scoreData, JSON.parse(savedScores));
                }
            } catch (error) {
                console.warn('加载本地数据失败:', error);
            }
        }

        /**
         * 设置拖拽上传功能
         */
        function setupDragAndDrop() {
            // 阻止默认拖拽行为
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                document.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // 图片上传区域拖拽支持
            const imageUploadContainer = document.getElementById('imageUploadContainer');
            if (imageUploadContainer) {
                ['dragenter', 'dragover'].forEach(eventName => {
                    imageUploadContainer.addEventListener(eventName, highlight, false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    imageUploadContainer.addEventListener(eventName, unhighlight, false);
                });

                imageUploadContainer.addEventListener('drop', handleImageDrop, false);
            }

            function highlight(e) {
                e.currentTarget.classList.add('drag-over');
            }

            function unhighlight(e) {
                e.currentTarget.classList.remove('drag-over');
            }

            function handleImageDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;

                if (files.length > 0) {
                    const file = files[0];
                    // 模拟文件输入
                    const input = document.getElementById('imageInput');
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    input.files = dataTransfer.files;
                    handleImageUpload(input);
                }
            }
        }
        
        // 暴露全局函数
        window.showSection = showSection;
        window.toggleMobileMenu = toggleMobileMenu;
        window.logout = logout;
        window.showPasswordResetModal = showPasswordResetModal;
        window.playVideo = playVideo;
        window.startExercise = startExercise;
        window.startExerciseQuestions = startExerciseQuestions;
        window.showExerciseQuestions = showExerciseQuestions;
        window.closeExerciseQuestions = closeExerciseQuestions;
        window.showHint = showHint;
        window.checkAnswer = checkAnswer;
        window.submitExercise = submitExercise;
        window.showExerciseModal = showExerciseModal;
        window.closeExerciseModal = closeExerciseModal;
        window.submitExerciseForAIReview = submitExerciseForAIReview;
        window.filterScores = filterScores;
        window.addGrade = addGrade;
        window.closeVideoModal = closeVideoModal;
        window.editGrade = editGrade;
        window.deleteGrade = deleteGrade;
        
        // AI助手全局函数
        window.AIAssistant = window.AIAssistant || {};
        window.AIAssistant.toggleChat = window.AIAssistant.toggleChat || function() {};
        window.AIAssistant.sendMessage = window.AIAssistant.sendMessage || function() {};
        window.AIAssistant.sendQuickReply = window.AIAssistant.sendQuickReply || function() {};
        
        // 新增功能函数
        window.switchUploadTab = switchUploadTab;
        window.switchExerciseTab = switchExerciseTab;
        window.uploadVideoLink = uploadVideoLink;
        window.handleVideoFile = handleVideoFile;
        window.addBilibiliVideo = addBilibiliVideo;
        window.addDouyinVideo = addDouyinVideo;
        window.uploadExerciseJson = uploadExerciseJson;
        window.uploadExerciseText = uploadExerciseText;
        window.handleExerciseFile = handleExerciseFile;
        window.connectGitHub = connectGitHub;
        window.changePassword = changePassword;
        window.exportData = exportData;
        window.importData = importData;
        window.clearLocalData = clearLocalData;
        window.showToast = showToast;
        window.showLoading = showLoading;
        
        // 视频播放器功能
        window.togglePlayPause = togglePlayPause;
        window.toggleMute = toggleMute;
        window.changeSpeed = changeSpeed;
        window.changeQuality = changeQuality;
        window.toggleQualityMenu = toggleQualityMenu;
        window.toggleFullscreen = toggleFullscreen;
        window.seekVideo = seekVideo;
        
        // 教师端管理功能
        window.editVideo = editVideo;
        window.deleteVideo = deleteVideo;
        window.editExercise = editExercise;
        window.deleteExercise = deleteExercise;
        window.renderVideoGrid = renderVideoGrid;
        window.renderExerciseGrid = renderExerciseGrid;
        
        // OCR图片识别功能
        window.handleImageUpload = handleImageUpload;
        window.enhanceImage = enhanceImage;
        window.rotateImage = rotateImage;
        window.startOCR = startOCR;
        window.clearImage = clearImage;
        window.formatAsExercise = formatAsExercise;
        window.createExerciseFromOCR = createExerciseFromOCR;
        
        // 系统完整性检查
        window.SystemChecker = {
            checkFeatures: function() {
                const features = {
                    login: typeof login === 'function',
                    videoPlayer: typeof playVideo === 'function',
                    ocrProcessing: typeof startOCR === 'function',
                    dataManagement: typeof saveDataToStorage === 'function',
                    githubIntegration: typeof connectGitHub === 'function',
                    responseiveDesign: window.innerWidth > 0,
                    accessibility: typeof AccessibilityEnhancer === 'object',
                    security: typeof SecurityManager === 'object',
                    performance: typeof PerformanceOptimizer === 'object'
                };
                
                const failedFeatures = Object.entries(features)
                    .filter(([name, working]) => !working)
                    .map(([name]) => name);
                
                if (failedFeatures.length > 0) {
                    ErrorHandler.log('error', '系统功能检查失败', {
                        failedFeatures,
                        totalFeatures: Object.keys(features).length
                    });
                    return false;
                }
                
                ErrorHandler.log('info', '系统功能检查通过', {
                    totalFeatures: Object.keys(features).length
                });
                return true;
            },
            
            generateReport: function() {
                return {
                    timestamp: new Date().toISOString(),
                    version: '2.0.0',
                    features: {
                        总用户数: Object.keys(accounts).length,
                        视频数量: videosData.length,
                        练习数量: exercisesData.length,
                        错误日志: ErrorHandler.errors.length,
                        安全违规: SecurityManager.violations
                    },
                    performance: {
                        内存使用: navigator.deviceMemory || '未知',
                        硬件并发: navigator.hardwareConcurrency || '未知',
                        连接类型: navigator.connection?.effectiveType || '未知'
                    },
                    compatibility: {
                        WebGL: !!window.WebGLRenderingContext,
                        ServiceWorker: 'serviceWorker' in navigator,
                        IntersectionObserver: 'IntersectionObserver' in window,
                        Geolocation: 'geolocation' in navigator
                    }
                };
            }
        };
        
        // 添加系统状态面板
        window.showSystemStatus = function() {
            const report = SystemChecker.generateReport();
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3>系统状态报告</h3>
                        <button onclick="this.closest('.modal-overlay').remove()" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div style="display: grid; gap: var(--space-4);">
                            <div class="card-enhanced">
                                <div class="card-header">
                                    <h4>系统信息</h4>
                                </div>
                                <div class="card-body">
                                    <p><strong>版本:</strong> ${report.version}</p>
                                    <p><strong>时间:</strong> ${new Date(report.timestamp).toLocaleString()}</p>
                                    <p><strong>功能检查:</strong> ${SystemChecker.checkFeatures() ? '✅ 通过' : '❌ 失败'}</p>
                                </div>
                            </div>
                            
                            <div class="card-enhanced">
                                <div class="card-header">
                                    <h4>数据统计</h4>
                                </div>
                                <div class="card-body">
                                    ${Object.entries(report.features).map(([key, value]) => 
                                        `<p><strong>${key}:</strong> ${value}</p>`
                                    ).join('')}
                                </div>
                            </div>
                            
                            <div class="card-enhanced">
                                <div class="card-header">
                                    <h4>性能信息</h4>
                                </div>
                                <div class="card-body">
                                    ${Object.entries(report.performance).map(([key, value]) => 
                                        `<p><strong>${key}:</strong> ${value}</p>`
                                    ).join('')}
                                </div>
                            </div>
                            
                            <div class="card-enhanced">
                                <div class="card-header">
                                    <h4>兼容性检查</h4>
                                </div>
                                <div class="card-body">
                                    ${Object.entries(report.compatibility).map(([key, value]) => 
                                        `<p><strong>${key}:</strong> ${value ? '✅ 支持' : '❌ 不支持'}</p>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button onclick="this.closest('.modal-overlay').remove()" class="btn btn-primary">
                            关闭
                        </button>
                        <button onclick="navigator.clipboard.writeText(JSON.stringify(SystemChecker.generateReport(), null, 2)); showToast('报告已复制到剪贴板', 'success');" class="btn btn-secondary">
                            复制报告
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };
        
        // AI智能助手系统
        window.AIAssistant = {
            isActive: false,
            chatHistory: [],
            apiKey: 'sk-dhseqxecuwwotodiskfdgwdjahnbexcgdotkfsovbgajxnis',
            apiEndpoint: 'https://api.deepseek.com/v1/chat/completions',
            model: 'deepseek-ai/DeepSeek-R1',
            
            // 初始化AI助手
            init: function() {
                this.createChatInterface();
                this.loadKnowledgeBase();
                this.addChatStyles();
                
                // 测试AI连接
                this.testAIConnection();
            },
            
            // 测试AI连接
            testAIConnection: async function() {
                try {
                    console.log('🔍 开始测试AI连接...');
                    console.log('🔑 API密钥:', this.apiKey.substring(0, 10) + '...');
                    console.log('🌐 API端点:', this.apiEndpoint);
                    console.log('🤖 模型:', this.model);
                    
                    // 更新状态为连接中
                    this.updateConnectionStatus('连接中...', '#f39c12');
                    
                    const testResponse = await this.callAIAPI('你好，请简单回复"连接成功"');
                    console.log('✅ AI连接测试成功:', testResponse);
                    
                    // 更新状态为在线
                    this.updateConnectionStatus('在线 · AI连接正常', '#27ae60');
                    
                    // 显示成功消息
                    this.addMessage('亲爱的同学，我已经成功连接到AI服务了！现在可以为您提供实时帮助～ 💕', 'ai');
                    
                } catch (error) {
                    console.error('❌ AI连接测试失败:', error);
                    
                    // 更新状态为离线
                    this.updateConnectionStatus('离线 · 使用本地回复', '#e74c3c');
                    
                    // 显示错误消息
                    this.addMessage('抱歉，AI服务暂时无法连接，但我仍然可以为您提供本地帮助～ 请稍后再试 💪', 'ai');
                }
            },
            
            // 更新连接状态
            updateConnectionStatus: function(status, color) {
                const chatStatus = document.querySelector('.chat-status');
                if (chatStatus) {
                    chatStatus.textContent = status;
                    chatStatus.style.color = color;
                }
                
                // 同时更新聊天窗口标题
                const chatTitle = document.querySelector('.chat-title');
                if (chatTitle) {
                    chatTitle.innerHTML = `
                        <i class="fas fa-robot"></i>
                        AI助手
                        <span class="connection-indicator" style="color: ${color};">●</span>
                    `;
                }
            },
            
            // 界面跳转功能
            navigateToSection: function(section) {
                try {
                    console.log('AI助手跳转到:', section);
                    
                    // 隐藏所有内容区域
                    const sections = ['home', 'videos', 'exercises', 'scores', 'review', 'upload', 'settings'];
                    sections.forEach(s => {
                        const element = document.getElementById(s + 'Section');
                        if (element) element.style.display = 'none';
                    });
                    
                    // 显示目标区域
                    const targetSection = document.getElementById(section + 'Section');
                    if (targetSection) {
                        targetSection.style.display = 'block';
                        
                        // 更新导航栏状态
                        const navLinks = document.querySelectorAll('.nav-link');
                        navLinks.forEach(link => link.classList.remove('active'));
                        
                        const activeLink = document.querySelector(`[onclick="showSection('${section}')"]`);
                        if (activeLink) activeLink.classList.add('active');
                        
                        // 特殊处理
                        if (section === 'videos') {
                            renderVideoGrid();
                        } else if (section === 'exercises') {
                            renderExerciseGrid();
                        } else if (section === 'scores') {
                            updateScoreChart('2024');
                        }
                        
                        console.log('成功跳转到:', section);
                    } else {
                        console.warn('目标区域未找到:', section);
                    }
                } catch (error) {
                    console.error('界面跳转失败:', error);
                }
            },
            
            // 视频控制功能
            controlVideo: function(action) {
                try {
                    console.log('AI助手控制视频:', action);
                    
                    const videoModal = document.querySelector('.video-modal');
                    const videoPlayer = videoModal ? videoModal.querySelector('video, iframe') : null;
                    
                    if (!videoPlayer) {
                        console.warn('未找到视频播放器');
                        return;
                    }
                    
                    switch (action) {
                        case 'fullscreen':
                            if (videoPlayer.requestFullscreen) {
                                videoPlayer.requestFullscreen();
                            } else if (videoPlayer.webkitRequestFullscreen) {
                                videoPlayer.webkitRequestFullscreen();
                            } else if (videoPlayer.msRequestFullscreen) {
                                videoPlayer.msRequestFullscreen();
                            }
                            break;
                            
                        case 'speed':
                            // 显示倍速控制面板
                            this.showSpeedControl();
                            break;
                            
                        case 'pause':
                            if (videoPlayer.pause) {
                                videoPlayer.pause();
                            }
                            break;
                            
                        case 'play':
                            if (videoPlayer.play) {
                                videoPlayer.play();
                            }
                            break;
                            
                        default:
                            console.warn('未知的视频控制动作:', action);
                    }
                } catch (error) {
                    console.error('视频控制失败:', error);
                }
            },
            
            // 显示倍速控制面板
            showSpeedControl: function() {
                const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
                const speedHtml = speeds.map(speed => 
                    `<button class="speed-btn" onclick="AIAssistant.setVideoSpeed(${speed})">${speed}x</button>`
                ).join('');
                
                const speedPanel = document.createElement('div');
                speedPanel.className = 'speed-control-panel';
                speedPanel.innerHTML = `
                    <div class="speed-control-header">
                        <span>选择播放速度</span>
                        <button onclick="this.parentElement.parentElement.remove()">×</button>
                    </div>
                    <div class="speed-buttons">
                        ${speedHtml}
                    </div>
                `;
                
                // 添加样式
                const style = document.createElement('style');
                style.textContent = `
                    .speed-control-panel {
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        border-radius: 12px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                        z-index: 10000;
                        padding: 20px;
                        min-width: 300px;
                    }
                    .speed-control-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 15px;
                        font-weight: bold;
                    }
                    .speed-buttons {
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 10px;
                    }
                    .speed-btn {
                        padding: 10px;
                        border: 2px solid #3498db;
                        background: white;
                        color: #3498db;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s;
                    }
                    .speed-btn:hover {
                        background: #3498db;
                        color: white;
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(speedPanel);
            },
            
            // 设置视频播放速度
            setVideoSpeed: function(speed) {
                try {
                    const videoModal = document.querySelector('.video-modal');
                    const videoPlayer = videoModal ? videoModal.querySelector('video') : null;
                    
                    if (videoPlayer && videoPlayer.playbackRate !== undefined) {
                        videoPlayer.playbackRate = speed;
                        console.log('设置视频播放速度:', speed);
                        
                        // 移除速度控制面板
                        const speedPanel = document.querySelector('.speed-control-panel');
                        if (speedPanel) speedPanel.remove();
                        
                        // 显示确认消息
                        this.addMessage(`亲爱的，我已经为您将视频播放速度设置为 ${speed}x 了～ ⚡`, 'ai');
                    } else {
                        console.warn('无法设置视频播放速度');
                    }
                } catch (error) {
                    console.error('设置视频速度失败:', error);
                }
            },
            
            // 创建聊天界面
            createChatInterface: function() {
                const chatWidget = document.createElement('div');
                chatWidget.id = 'aiChatWidget';
                chatWidget.className = 'ai-chat-widget';
                chatWidget.innerHTML = `
                    <div class="chat-toggle" onclick="AIAssistant.toggleChat()" id="chatToggle">
                        <i class="fas fa-robot"></i>
                        <span class="chat-notification" id="chatNotification">AI助手</span>
                    </div>
                    <div class="chat-container" id="chatContainer" style="display: none;">
                        <div class="chat-header" id="chatHeader">
                            <div class="chat-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="chat-info">
                                <h4 class="chat-title">流体力学AI助手</h4>
                                <p class="chat-status">连接中...</p>
                            </div>
                            <div class="chat-actions">
                                <button onclick="AIAssistant.reconnectAI()" class="reconnect-btn" title="重新连接AI">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button onclick="AIAssistant.toggleChat()" class="chat-close">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <div class="ai-message">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <p>您好！我是流体力学AI助手 🌊</p>
                                    <p>我可以帮助您：</p>
                                    <ul>
                                        <li>📚 解答流体力学问题</li>
                                        <li>🎯 推荐学习内容</li>
                                        <li>📊 分析学习进度</li>
                                        <li>💡 提供学习建议</li>
                                        <li>✍️ 批改作业</li>
                                    </ul>
                                    <p>请随时向我提问！</p>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <div class="quick-replies">
                                <button onclick="AIAssistant.sendQuickReply('流体力学基础概念')" class="quick-reply">基础概念</button>
                                <button onclick="AIAssistant.sendQuickReply('练习题推荐')" class="quick-reply">练习推荐</button>
                                <button onclick="AIAssistant.sendQuickReply('学习计划')" class="quick-reply">学习计划</button>
                            </div>
                            <div class="chat-input-wrapper">
                                <input type="text" id="chatInput" placeholder="输入您的问题..." 
                                       onkeypress="if(event.key==='Enter') AIAssistant.sendMessage()">
                                <button onclick="AIAssistant.sendMessage()" class="send-btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(chatWidget);
                this.addChatStyles();
                this.initDragAndDrop();
            },
            
            // 初始化拖拽功能
            initDragAndDrop: function() {
                const chatWidget = document.getElementById('aiChatWidget');
                const chatHeader = document.getElementById('chatHeader');
                let isDragging = false;
                let startX, startY, startLeft, startTop;
                
                // 鼠标按下事件
                chatHeader.addEventListener('mousedown', (e) => {
                    if (e.target.closest('.chat-close')) return;
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startLeft = parseInt(chatWidget.style.left) || 0;
                    startTop = parseInt(chatWidget.style.top) || 0;
                    chatHeader.style.cursor = 'grabbing';
                    e.preventDefault();
                });
                
                // 鼠标移动事件
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    chatWidget.style.left = (startLeft + deltaX) + 'px';
                    chatWidget.style.top = (startTop + deltaY) + 'px';
                    chatWidget.style.right = 'auto';
                    chatWidget.style.bottom = 'auto';
                });
                
                // 鼠标释放事件
                document.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        chatHeader.style.cursor = 'grab';
                        
                        // 检查是否靠近边缘，如果是则自动隐藏
                        const rect = chatWidget.getBoundingClientRect();
                        const windowWidth = window.innerWidth;
                        const windowHeight = window.innerHeight;
                        
                        if (rect.right < windowWidth * 0.1 || rect.left > windowWidth * 0.9) {
                            setTimeout(() => {
                                if (!this.isActive) {
                                    chatWidget.style.transform = 'translateX(100%)';
                                    setTimeout(() => {
                                        chatWidget.style.display = 'none';
                                    }, 300);
                                }
                            }, 2000);
                        }
                    }
                });
                
                // 添加自动显示功能
                let hideTimeout;
                chatWidget.addEventListener('mouseenter', () => {
                    clearTimeout(hideTimeout);
                    chatWidget.style.transform = 'translateX(0)';
                });
                
                chatWidget.addEventListener('mouseleave', () => {
                    if (!this.isActive) {
                        hideTimeout = setTimeout(() => {
                            chatWidget.style.transform = 'translateX(100%)';
                            setTimeout(() => {
                                chatWidget.style.display = 'none';
                            }, 300);
                        }, 1000);
                    }
                });
            },
            
            // 添加聊天样式
            addChatStyles: function() {
                if (document.getElementById('aiChatStyles')) return;
                
                const style = document.createElement('style');
                style.id = 'aiChatStyles';
                style.textContent = `
                    .ai-chat-widget {
                        position: fixed;
                        bottom: var(--space-6);
                        right: var(--space-6);
                        z-index: var(--z-tooltip);
                        font-family: var(--font-sans);
                        transition: transform 0.3s ease;
                    }
                    
                    .chat-toggle {
                        width: 60px;
                        height: 60px;
                        background: var(--gradient-primary);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        box-shadow: var(--shadow-lg);
                        transition: all var(--transition-normal);
                        position: relative;
                    }
                    
                    .chat-toggle:hover {
                        transform: scale(1.1);
                        box-shadow: var(--shadow-2xl);
                    }
                    
                    .chat-toggle i {
                        color: white;
                        font-size: var(--text-xl);
                    }
                    
                    .chat-notification {
                        position: absolute;
                        top: -40px;
                        right: 0;
                        background: var(--dark);
                        color: white;
                        padding: var(--space-2) var(--space-3);
                        border-radius: var(--radius-lg);
                        font-size: var(--text-sm);
                        white-space: nowrap;
                        opacity: 0;
                        transform: translateY(10px);
                        transition: all var(--transition-normal);
                        pointer-events: none;
                    }
                    
                    .chat-toggle:hover .chat-notification {
                        opacity: 1;
                        transform: translateY(0);
                    }
                    
                    .chat-container {
                        position: absolute;
                        bottom: 80px;
                        right: 0;
                        width: 380px;
                        height: 500px;
                        background: white;
                        border-radius: var(--radius-2xl);
                        box-shadow: var(--shadow-2xl);
                        display: flex;
                        flex-direction: column;
                        overflow: hidden;
                    }
                    
                    .chat-header {
                        background: var(--gradient-primary);
                        color: white;
                        padding: var(--space-4);
                        display: flex;
                        align-items: center;
                        gap: var(--space-3);
                        cursor: grab;
                        user-select: none;
                    }
                    
                    .chat-header:active {
                        cursor: grabbing;
                    }
                    
                    .chat-avatar {
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.2);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    
                    .chat-info h4 {
                        margin: 0;
                        font-size: var(--text-base);
                        font-weight: var(--font-semibold);
                    }
                    
                    .chat-status {
                        margin: 0;
                        font-size: var(--text-xs);
                        opacity: 0.8;
                    }
                    
                    .chat-actions {
                        display: flex;
                        gap: var(--space-2);
                        align-items: center;
                        margin-left: auto;
                    }
                    
                    .reconnect-btn {
                        background: none;
                        border: none;
                        color: white;
                        cursor: pointer;
                        padding: var(--space-2);
                        border-radius: var(--radius-md);
                        transition: all var(--transition-fast);
                        font-size: var(--text-sm);
                    }
                    
                    .reconnect-btn:hover {
                        background: rgba(255, 255, 255, 0.2);
                        transform: rotate(180deg);
                    }
                    
                    .chat-close {
                        background: none;
                        border: none;
                        color: white;
                        cursor: pointer;
                        padding: var(--space-2);
                        border-radius: var(--radius-md);
                        transition: all var(--transition-fast);
                    }
                    
                    .chat-close:hover {
                        background: rgba(255, 255, 255, 0.2);
                    }
                    
                    .chat-messages {
                        flex: 1;
                        overflow-y: auto;
                        padding: var(--space-4);
                        display: flex;
                        flex-direction: column;
                        gap: var(--space-3);
                    }
                    
                    .ai-message, .user-message {
                        display: flex;
                        gap: var(--space-2);
                        align-items: flex-start;
                    }
                    
                    .user-message {
                        flex-direction: row-reverse;
                    }
                    
                    .message-avatar {
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: var(--text-sm);
                        color: white;
                        flex-shrink: 0;
                    }
                    
                    .ai-message .message-avatar {
                        background: var(--accent);
                    }
                    
                    .user-message .message-avatar {
                        background: var(--secondary);
                    }
                    
                    .message-content {
                        background: var(--light);
                        padding: var(--space-3);
                        border-radius: var(--radius-lg);
                        max-width: 80%;
                        font-size: var(--text-sm);
                        line-height: var(--leading-relaxed);
                    }
                    
                    .user-message .message-content {
                        background: var(--primary);
                        color: white;
                    }
                    
                    .message-content ul {
                        margin: var(--space-2) 0;
                        padding-left: var(--space-4);
                    }
                    
                    .chat-input-container {
                        padding: var(--space-4);
                        border-top: 1px solid var(--border);
                    }
                    
                    .quick-replies {
                        display: flex;
                        gap: var(--space-2);
                        margin-bottom: var(--space-3);
                        flex-wrap: wrap;
                    }
                    
                    .quick-reply {
                        background: var(--accent-alpha);
                        color: var(--accent-dark);
                        border: 1px solid var(--accent);
                        padding: var(--space-1) var(--space-2);
                        border-radius: var(--radius-full);
                        font-size: var(--text-xs);
                        cursor: pointer;
                        transition: all var(--transition-fast);
                    }
                    
                    .quick-reply:hover {
                        background: var(--accent);
                        color: white;
                    }
                    
                    .chat-input-wrapper {
                        display: flex;
                        gap: var(--space-2);
                        align-items: center;
                    }
                    
                    #chatInput {
                        flex: 1;
                        padding: var(--space-3);
                        border: 1px solid var(--border);
                        border-radius: var(--radius-lg);
                        font-size: var(--text-sm);
                        outline: none;
                    }
                    
                    #chatInput:focus {
                        border-color: var(--accent);
                        box-shadow: 0 0 0 3px var(--accent-alpha);
                    }
                    
                    .send-btn {
                        background: var(--accent);
                        color: white;
                        border: none;
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all var(--transition-fast);
                    }
                    
                    .send-btn:hover {
                        background: var(--accent-dark);
                        transform: scale(1.1);
                    }
                    
                    /* 流式显示效果 */
                    .message-content.typing::after {
                        content: '|';
                        animation: blink 1s infinite;
                        color: var(--primary);
                        font-weight: bold;
                        margin-left: 2px;
                    }
                    
                    @keyframes blink {
                        0%, 50% { opacity: 1; }
                        51%, 100% { opacity: 0; }
                    }
                    
                    /* 加载状态 */
                    .ai-message.loading .message-content {
                        background: linear-gradient(90deg, #f0f0f0 0%, #e0e0e0 50%, #f0f0f0 100%);
                        animation: loading-shimmer 1.5s infinite;
                        min-height: 20px;
                    }
                    
                    @keyframes loading-shimmer {
                        0% { background-position: -200px 0; }
                        100% { background-position: 200px 0; }
                    }
                    
                    @media (max-width: 768px) {
                        .chat-container {
                            width: calc(100vw - 32px);
                            right: -180px;
                        }
                    }
                `;
                document.head.appendChild(style);
            },
            
            // 切换聊天界面
            toggleChat: function() {
                const container = document.getElementById('chatContainer');
                this.isActive = !this.isActive;
                container.style.display = this.isActive ? 'flex' : 'none';
                
                if (this.isActive) {
                    document.getElementById('chatInput').focus();
                }
            },
            
            // 发送消息
            sendMessage: async function() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (!message) return;
                
                this.addMessage(message, 'user');
                input.value = '';
                
                // 生成AI回复
                await this.generateAIResponse(message);
            },
            
            // 发送快速回复
            sendQuickReply: async function(message) {
                this.addMessage(message, 'user');
                await this.generateAIResponse(message);
            },
            
            // 添加消息到聊天界面
            addMessage: function(content, sender) {
                const messagesContainer = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = sender === 'user' ? 'user-message' : 'ai-message';
                
                const avatar = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-content">${content}</div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                this.chatHistory.push({ content, sender, timestamp: Date.now() });
                
                // 如果是AI回复，添加快速回复按钮
                if (sender === 'ai') {
                    this.addQuickReplies();
                }
            },
            
            // 添加快速回复按钮
            addQuickReplies: function() {
                const messagesContainer = document.getElementById('chatMessages');
                if (!messagesContainer) return;
                
                const quickReplies = [
                    { text: '💙 基础概念', action: '基础概念' },
                    { text: '📝 练习题', action: '练习' },
                    { text: '📊 分数线', action: '分数' },
                    { text: '🎬 视频控制', action: '视频' },
                    { text: '🏠 界面跳转', action: '界面' },
                    { text: '✨ 批改作业', action: '批改' }
                ];
                
                const quickReplyDiv = document.createElement('div');
                quickReplyDiv.className = 'quick-replies';
                quickReplyDiv.innerHTML = `
                    <div class="quick-reply-buttons">
                        ${quickReplies.map(reply => 
                            `<button class="quick-reply-btn" onclick="AIAssistant.handleQuickReply('${reply.action}')">${reply.text}</button>`
                        ).join('')}
                    </div>
                `;
                
                messagesContainer.appendChild(quickReplyDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },
            
            // 处理快速回复
            handleQuickReply: function(action) {
                const response = this.generateFallbackResponse(action);
                this.addMessage(response, 'ai');
                
                // 移除快速回复按钮
                const quickReplies = document.querySelectorAll('.quick-replies');
                quickReplies.forEach(reply => reply.remove());
            },
            
            // 手动重新连接AI
            reconnectAI: async function() {
                console.log('🔄 手动重新连接AI...');
                this.updateConnectionStatus('重新连接中...', '#f39c12');
                
                try {
                    await this.testAIConnection();
                    this.addMessage('亲爱的同学，AI连接已恢复！现在可以为您提供实时帮助了～ 💕', 'ai');
                } catch (error) {
                    this.addMessage('抱歉，重新连接失败。请检查网络连接或稍后再试 💪', 'ai');
                }
            },
            
            // 开始作业批改
            startHomeworkGrading: function() {
                const gradingModal = document.createElement('div');
                gradingModal.className = 'homework-grading-modal';
                gradingModal.innerHTML = `
                    <div class="grading-content">
                        <div class="grading-header">
                            <h3>📝 AI智能作业批改</h3>
                            <button onclick="this.closest('.homework-grading-modal').remove()" class="close-btn">×</button>
                        </div>
                        <div class="grading-body">
                            <div class="grading-instructions">
                                <p>亲爱的同学，请将您的作业内容粘贴到下面的文本框中，我会温柔地为您批改～</p>
                                <p>支持的内容类型：</p>
                                <ul>
                                    <li>📊 计算题和推导题</li>
                                    <li>📝 概念解释题</li>
                                    <li>🎯 选择题答案</li>
                                    <li>📋 简答题和论述题</li>
                                </ul>
                            </div>
                            <div class="grading-input">
                                <textarea id="homeworkContent" placeholder="请粘贴您的作业内容..." rows="10"></textarea>
                            </div>
                            <div class="grading-options">
                                <label>
                                    <input type="checkbox" id="detailedFeedback" checked>
                                    详细反馈和建议
                                </label>
                                <label>
                                    <input type="checkbox" id="scoreEstimation" checked>
                                    预估分数
                                </label>
                                <label>
                                    <input type="checkbox" id="improvementTips" checked>
                                    改进建议
                                </label>
                            </div>
                        </div>
                        <div class="grading-footer">
                            <button onclick="AIAssistant.gradeHomework()" class="grade-btn">
                                <i class="fas fa-check"></i>
                                开始批改
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(gradingModal);
                
                // 添加样式
                this.addGradingStyles();
                
                return '亲爱的同学，我已经为您打开了作业批改界面，请将作业内容粘贴进去，我会温柔地为您批改～ 📝💕';
            },
            
            // 批改作业
            gradeHomework: async function() {
                const content = document.getElementById('homeworkContent').value.trim();
                if (!content) {
                    this.addMessage('亲爱的同学，请先输入您的作业内容哦～ 💕', 'ai');
                    return;
                }
                
                const detailedFeedback = document.getElementById('detailedFeedback').checked;
                const scoreEstimation = document.getElementById('scoreEstimation').checked;
                const improvementTips = document.getElementById('improvementTips').checked;
                
                this.addMessage('亲爱的同学，我正在认真批改您的作业，请稍等片刻～ 📝✨', 'ai');
                
                try {
                    const prompt = `请作为流体力学老师，温柔地批改以下学生作业：

作业内容：
${content}

批改要求：
${detailedFeedback ? '- 详细分析每个答案的正确性' : ''}
${scoreEstimation ? '- 给出预估分数（满分100分）' : ''}
${improvementTips ? '- 提供具体的改进建议' : ''}

请用专业、准确、简明的中文回答问题，直接给出知识点、解题思路、分析和建议。

请用中文回答，多用表情符号让反馈更生动。`;
                 
                  const response = await this.callAIAPI(prompt);
                  this.addMessage(response, 'ai');
                  
                  // 关闭批改界面
                  const modal = document.querySelector('.homework-grading-modal');
                  if (modal) modal.remove();
                  
              } catch (error) {
                  console.error('批改作业失败:', error);
                  this.addMessage('抱歉，批改过程中遇到了一些问题。请稍后再试，或者检查网络连接～ 💪', 'ai');
              }
          },
          
          // 生成AI回复（流式显示）
          generateAIResponse: async function(userMessage) {
                  try {
                      // 显示加载状态
                      this.addMessage('正在思考中...', 'ai', true);
                      const loadingMessage = document.querySelector('.ai-message.loading');
                      
                      // 创建流式显示的消息容器
                      let streamingMessage = null;
                      
                      // 调用AI API，使用流式回调
                      await this.callAIAPI(userMessage, (content, isFinal) => {
                          if (!streamingMessage) {
                              // 移除加载消息，创建新的流式消息
                              if (loadingMessage) {
                                  loadingMessage.remove();
                              }
                              streamingMessage = this.addMessage('', 'ai');
                          }
                          
                          // 更新消息内容
                          const messageContent = streamingMessage.querySelector('.message-content');
                          if (messageContent) {
                              messageContent.textContent = content;
                              
                              // 如果未结束，添加打字光标效果
                              if (!isFinal) {
                                  messageContent.classList.add('typing');
                              } else {
                                  messageContent.classList.remove('typing');
                              }
                          }
                          
                          // 滚动到底部
                          this.scrollToBottom();
                      });
                      
                  } catch (error) {
                      console.error('AI回复生成失败:', error);
                      
                      // 移除加载消息
                      const loadingMessage = document.querySelector('.ai-message.loading');
                      if (loadingMessage) {
                          loadingMessage.remove();
                      }
                      
                      // 使用备用回复
                      const fallbackResponse = this.generateFallbackResponse(userMessage);
                      this.addMessage(fallbackResponse, 'ai');
                  }
              },

              // 调用AI API（流式实现，兼容siliconflow.cn接口，边生成边显示）
              callAIAPI: async function(userMessage, onStream) {
                  // onStream: 可选回调，每收到一段新内容就调用（content, isFinal）
                  const apiUrl = 'https://api.siliconflow.cn/v1/chat/completions';
                  const apiKey = 'sk-dhseqxecuwwotodiskfdgwdjahnbexcgdotkfsovbgajxnis';
                  const model = 'deepseek-ai/DeepSeek-R1';
                  
                  const requestBody = {
                      model: model,
                      messages: [
                          {
                              role: 'system',
                              content: `你是中国海洋大学803流体力学专业的AI学习助手，专注于流体力学知识解答、作业批改、界面导航、视频控制、学习规划等。请用专业、准确、简明的中文回答问题，直接给出知识点、解题思路、分析和建议。`
                          },
                          { 
                              role: 'user', 
                              content: userMessage 
                          }
                      ],
                      stream: true,
                      temperature: 0.7,
                      max_tokens: 2000
                  };
                  
                  // 状态显示
                  this.updateConnectionStatus('思考中...', '#f39c12');
                  
                  let finalContent = '';
                  try {
                      const response = await fetch(apiUrl, {
                          method: 'POST',
                          headers: {
                              'Authorization': `Bearer ${apiKey}`,
                              'Content-Type': 'application/json'
                          },
                          body: JSON.stringify(requestBody)
                      });
                      
                      if (!response.ok) {
                          this.updateConnectionStatus('离线 · 使用本地回复', '#e74c3c');
                          throw new Error(`AI接口请求失败: ${response.status}`);
                      }
                      
                      // 处理流式响应
                      const reader = response.body.getReader();
                      const decoder = new TextDecoder('utf-8');
                      let buffer = '';
                      let done = false;
                      
                      while (!done) {
                          const { value, done: streamDone } = await reader.read();
                          done = streamDone;
                          
                          if (value) {
                              buffer += decoder.decode(value, { stream: true });
                              let eventEndIndex;
                              
                              while ((eventEndIndex = buffer.indexOf('\n\n')) !== -1) {
                                  const eventData = buffer.slice(0, eventEndIndex);
                                  buffer = buffer.slice(eventEndIndex + 2);
                                  
                                  if (eventData.startsWith('data:')) {
                                      const data = eventData.slice(5).trim();
                                      
                                      if (data === '[DONE]') {
                                          if (onStream) onStream(finalContent, true);
                                          this.updateConnectionStatus('在线 · AI连接正常', '#27ae60');
                                          this.processAICommands(finalContent, userMessage);
                                          return finalContent;
                                      }
                                      
                                      try {
                                          const parsed = JSON.parse(data);
                                          const delta = parsed.choices?.[0]?.delta?.content || '';
                                          
                                          if (delta) {
                                              finalContent += delta;
                                              if (onStream) onStream(finalContent, false);
                                          }
                                      } catch (e) {
                                          // 忽略解析错误，继续处理
                                      }
                                  }
                              }
                          }
                      }
                      
                      // 流结束
                      if (onStream) onStream(finalContent, true);
                      this.updateConnectionStatus('在线 · AI连接正常', '#27ae60');
                      this.processAICommands(finalContent, userMessage);
                      return finalContent;
                      
                  } catch (error) {
                      console.error('AI API调用失败:', error);
                      this.updateConnectionStatus('离线 · 使用本地回复', '#e74c3c');
                      
                      // 生成备用回复
                      const fallbackResponse = this.generateFallbackResponse(userMessage);
                      if (onStream) onStream(fallbackResponse, true);
                      return fallbackResponse;
                  }
              },

              // 处理AI指令（根据AI回复内容执行相应操作）
              processAICommands: function(aiResponse, userMessage) {
                  const response = aiResponse.toLowerCase();
                  const message = userMessage.toLowerCase();
                  
                  // 界面跳转指令
                  if (response.includes('跳转到') || response.includes('切换到') || message.includes('跳转') || message.includes('切换')) {
                      if (response.includes('首页') || response.includes('主页')) {
                          this.navigateToSection('home');
                      } else if (response.includes('视频') || response.includes('学习视频')) {
                          this.navigateToSection('videos');
                      } else if (response.includes('练习') || response.includes('题库') || response.includes('练习题')) {
                          this.navigateToSection('exercises');
                      } else if (response.includes('分数') || response.includes('成绩') || response.includes('分数线')) {
                          this.navigateToSection('scores');
                      } else if (response.includes('复习') || response.includes('复习规划')) {
                          this.navigateToSection('review');
                      }
                  }
                  
                  // 视频控制指令
                  if (response.includes('全屏') || response.includes('视频') || message.includes('全屏') || message.includes('倍速')) {
                      if (response.includes('全屏')) {
                          this.controlVideo('fullscreen');
                      } else if (response.includes('暂停')) {
                          this.controlVideo('pause');
                      } else if (response.includes('播放')) {
                          this.controlVideo('play');
                      } else if (response.includes('速度') || response.includes('倍速')) {
                          this.controlVideo('speed');
                      }
                  }
                  
                  // 作业批改指令
                  if (response.includes('批改') || response.includes('检查作业') || message.includes('批改') || message.includes('作业')) {
                      this.startHomeworkGrading();
                  }
              },
              
              // 生成备用回复
              generateFallbackResponse: function(userMessage) {
                  const responses = {
                      '基础概念': '流体的定义和特性、连续介质假设、流体的物理性质、压力、密度、粘度等基本参数。建议从这些基础概念开始学习哦！有什么不懂的随时问我～',
                      '练习': '我为您推荐一些练习：流体静力学计算题、伯努利方程应用题、动量方程推导题、边界层理论分析题。建议每天练习2-3道题目，循序渐进哦！',
                      '计划': '我为您制定了一个学习计划：第1-2周：基础概念和流体静力学、第3-4周：流体动力学和伯努利方程、第5-6周：动量方程和能量方程、第7-8周：边界层理论和湍流。每周学习时间建议：10-15小时，不要太累哦～',
                      '分数': '让我为您介绍分数线信息：2025年国家线：274分、2025年复试线：274分。建议目标分数：290分以上，我相信您一定可以的！',
                      '批改': '我很乐意帮您批改作业！请将您的作业内容发给我，我会检查计算过程、指出错误、提供正确答案、给出改进建议。让我们一起进步吧！',
                      '视频': '我可以帮您调节视频播放哦！点击视频播放器，我可以帮您：调节播放速度（0.5x - 2x）、全屏播放、跳转到指定时间、调节音量。需要我帮您操作吗？',
                      '界面': '我可以帮您跳转到不同的学习界面：主页、视频学习、练习题、分数线、复习计划。告诉我您想去哪里，我帮您导航～',
                      'default': '我是您的流体力学AI助手，可以为您提供学习指导。请告诉我您想了解什么？我会一直陪伴您学习哦～'
                  };
                  
                  for (let key in responses) {
                      if (userMessage.includes(key)) {
                          return responses[key];
                      }
                  }
                  return responses.default;
              }
          };
          
          // 应用程序启动
          if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', initializeApp);
          } else {
              initializeApp();
          }
          
      </script>
  </body>
  </html>