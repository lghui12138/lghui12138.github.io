<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•ç³»ç»Ÿæµ‹è¯• - ä¿®å¤ç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 100%;
        }
        
        .test-title {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #5a6fd8;
        }
        
        .test-button.danger {
            background: #e74c3c;
        }
        
        .test-button.danger:hover {
            background: #c0392b;
        }
        
        .test-button.success {
            background: #27ae60;
        }
        
        .test-button.success:hover {
            background: #229954;
        }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .test-result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">ç™»å½•ç³»ç»Ÿæµ‹è¯• - ä¿®å¤ç‰ˆ</h1>
        
        <div class="test-section">
            <h3>1. åŸºç¡€åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testBasicLogin()">æµ‹è¯•åŸºç¡€ç™»å½•</button>
            <button class="test-button" onclick="testTeacherLogin()">æµ‹è¯•æ•™å¸ˆç™»å½•</button>
            <button class="test-button" onclick="testStudentLogin()">æµ‹è¯•å­¦ç”Ÿç™»å½•</button>
            <button class="test-button danger" onclick="testInvalidLogin()">æµ‹è¯•æ— æ•ˆç™»å½•</button>
            <div id="basicResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
            <button class="test-button" onclick="testSystemStatus()">æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
            <button class="test-button" onclick="testAccountsData()">æ£€æŸ¥è´¦å·æ•°æ®</button>
            <button class="test-button" onclick="testLoginState()">æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
            <div id="statusResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. é«˜çº§åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testLoginPersistence()">æµ‹è¯•ç™»å½•æŒä¹…åŒ–</button>
            <button class="test-button" onclick="testLogout()">æµ‹è¯•ç™»å‡ºåŠŸèƒ½</button>
            <button class="test-button" onclick="testErrorHandling()">æµ‹è¯•é”™è¯¯å¤„ç†</button>
            <div id="advancedResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. è°ƒè¯•å·¥å…·</h3>
            <button class="test-button" onclick="openMainPage()">æ‰“å¼€ä¸»é¡µé¢</button>
            <button class="test-button success" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="test-button danger" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
            <div id="debugResult" class="test-result"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿè´¦å·æ•°æ®
        const testAccounts = {
            'liuguanghui6330156': { 
                name: 'åˆ˜å…‰è¾‰', 
                role: 'teacher', 
                password: 'Ll700306', 
                color: 'teacher',
                progress: 0,
                grades: [],
                videoProgress: 0,
                questionProgress: 0,
                studyTime: 0,
                watchedVideos: [],
                completedExercises: []
            },
            'student1': { 
                name: 'å­¦ç”Ÿè´¦å·', 
                role: 'student', 
                password: '123456', 
                color: 'student', 
                progress: 0, 
                grades: [], 
                videoProgress: 0, 
                questionProgress: 0, 
                studyTime: 0, 
                watchedVideos: [], 
                completedExercises: [] 
            },
            'niwenxuan': { 
                name: 'å€ªæ–‡è½©', 
                role: 'student', 
                password: 'niwenxuan2025', 
                color: 'student', 
                progress: 0, 
                grades: [], 
                videoProgress: 0, 
                questionProgress: 0, 
                studyTime: 0, 
                watchedVideos: [], 
                completedExercises: [] 
            },
            'hanwenxu': { 
                name: 'éŸ©æ–‡æ—­', 
                role: 'student', 
                password: 'hanwenxu2025', 
                color: 'student', 
                progress: 0, 
                grades: [], 
                videoProgress: 0, 
                questionProgress: 0, 
                studyTime: 0, 
                watchedVideos: [], 
                completedExercises: [] 
            }
        };

        // æµ‹è¯•ç»“æœæ˜¾ç¤ºå‡½æ•°
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `test-result ${type}`;
        }

        // 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•
        function testBasicLogin() {
            let result = '=== åŸºç¡€ç™»å½•æµ‹è¯• ===\n';
            
            // æµ‹è¯•æ•™å¸ˆç™»å½•
            const teacherAccount = testAccounts['liuguanghui6330156'];
            if (teacherAccount && teacherAccount.password === 'Ll700306') {
                result += 'âœ… æ•™å¸ˆè´¦å·éªŒè¯é€šè¿‡\n';
            } else {
                result += 'âŒ æ•™å¸ˆè´¦å·éªŒè¯å¤±è´¥\n';
            }
            
            // æµ‹è¯•å­¦ç”Ÿç™»å½•
            const studentAccount = testAccounts['student1'];
            if (studentAccount && studentAccount.password === '123456') {
                result += 'âœ… å­¦ç”Ÿè´¦å·éªŒè¯é€šè¿‡\n';
            } else {
                result += 'âŒ å­¦ç”Ÿè´¦å·éªŒè¯å¤±è´¥\n';
            }
            
            // æµ‹è¯•è´¦å·æ•°é‡
            const accountCount = Object.keys(testAccounts).length;
            result += `ğŸ“Š è´¦å·æ€»æ•°: ${accountCount}\n`;
            
            showResult('basicResult', result, 'success');
        }

        function testTeacherLogin() {
            let result = '=== æ•™å¸ˆç™»å½•æµ‹è¯• ===\n';
            
            const username = 'liuguanghui6330156';
            const password = 'Ll700306';
            const account = testAccounts[username];
            
            if (account && account.password === password && account.role === 'teacher') {
                result += 'âœ… æ•™å¸ˆç™»å½•æˆåŠŸ\n';
                result += `ğŸ‘¤ ç”¨æˆ·å: ${username}\n`;
                result += `ğŸ“ å§“å: ${account.name}\n`;
                result += `ğŸ“ è§’è‰²: ${account.role}\n`;
            } else {
                result += 'âŒ æ•™å¸ˆç™»å½•å¤±è´¥\n';
            }
            
            showResult('basicResult', result, 'success');
        }

        function testStudentLogin() {
            let result = '=== å­¦ç”Ÿç™»å½•æµ‹è¯• ===\n';
            
            const username = 'student1';
            const password = '123456';
            const account = testAccounts[username];
            
            if (account && account.password === password && account.role === 'student') {
                result += 'âœ… å­¦ç”Ÿç™»å½•æˆåŠŸ\n';
                result += `ğŸ‘¤ ç”¨æˆ·å: ${username}\n`;
                result += `ğŸ“ å§“å: ${account.name}\n`;
                result += `ğŸ“ è§’è‰²: ${account.role}\n`;
            } else {
                result += 'âŒ å­¦ç”Ÿç™»å½•å¤±è´¥\n';
            }
            
            showResult('basicResult', result, 'success');
        }

        function testInvalidLogin() {
            let result = '=== æ— æ•ˆç™»å½•æµ‹è¯• ===\n';
            
            // æµ‹è¯•ä¸å­˜åœ¨çš„ç”¨æˆ·å
            const invalidUsername = 'nonexistent';
            const invalidAccount = testAccounts[invalidUsername];
            if (!invalidAccount) {
                result += 'âœ… æ— æ•ˆç”¨æˆ·åæ£€æµ‹æ­£å¸¸\n';
            } else {
                result += 'âŒ æ— æ•ˆç”¨æˆ·åæ£€æµ‹å¤±è´¥\n';
            }
            
            // æµ‹è¯•é”™è¯¯å¯†ç 
            const username = 'student1';
            const wrongPassword = 'wrongpassword';
            const account = testAccounts[username];
            if (account && account.password !== wrongPassword) {
                result += 'âœ… é”™è¯¯å¯†ç æ£€æµ‹æ­£å¸¸\n';
            } else {
                result += 'âŒ é”™è¯¯å¯†ç æ£€æµ‹å¤±è´¥\n';
            }
            
            showResult('basicResult', result, 'success');
        }

        // 2. ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
        function testSystemStatus() {
            let result = '=== ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ ===\n';
            
            result += `ğŸ“Š è´¦å·æ•°æ®å®Œæ•´æ€§: ${Object.keys(testAccounts).length > 0 ? 'âœ…' : 'âŒ'}\n`;
            result += `ğŸ” æ•™å¸ˆè´¦å·å­˜åœ¨: ${testAccounts['liuguanghui6330156'] ? 'âœ…' : 'âŒ'}\n`;
            result += `ğŸ‘¨â€ğŸ“ å­¦ç”Ÿè´¦å·å­˜åœ¨: ${testAccounts['student1'] ? 'âœ…' : 'âŒ'}\n`;
            result += `ğŸ’¾ æœ¬åœ°å­˜å‚¨å¯ç”¨: ${typeof localStorage !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
            
            showResult('statusResult', result, 'info');
        }

        function testAccountsData() {
            let result = '=== è´¦å·æ•°æ®æ£€æŸ¥ ===\n';
            
            Object.keys(testAccounts).forEach(username => {
                const account = testAccounts[username];
                result += `ğŸ‘¤ ${username}:\n`;
                result += `   ğŸ“ å§“å: ${account.name}\n`;
                result += `   ğŸ“ è§’è‰²: ${account.role}\n`;
                result += `   ğŸ”‘ å¯†ç é•¿åº¦: ${account.password.length}\n`;
                result += `   ğŸ“ˆ è¿›åº¦: ${account.progress}%\n`;
                result += `   ğŸ“š å·²å®Œæˆç»ƒä¹ : ${account.completedExercises.length}\n`;
                result += `   ğŸ¥ å·²è§‚çœ‹è§†é¢‘: ${account.watchedVideos.length}\n\n`;
            });
            
            showResult('statusResult', result, 'info');
        }

        function testLoginState() {
            let result = '=== ç™»å½•çŠ¶æ€æ£€æŸ¥ ===\n';
            
            const savedUser = localStorage.getItem('currentUser');
            result += `ğŸ’¾ ä¿å­˜çš„ç™»å½•çŠ¶æ€: ${savedUser || 'æ— '}\n`;
            
            if (savedUser && testAccounts[savedUser]) {
                result += 'âœ… ä¿å­˜çš„ç™»å½•çŠ¶æ€æœ‰æ•ˆ\n';
            } else if (savedUser) {
                result += 'âŒ ä¿å­˜çš„ç™»å½•çŠ¶æ€æ— æ•ˆ\n';
            } else {
                result += 'â„¹ï¸ æ— ä¿å­˜çš„ç™»å½•çŠ¶æ€\n';
            }
            
            showResult('statusResult', result, 'info');
        }

        // 3. é«˜çº§åŠŸèƒ½æµ‹è¯•
        function testLoginPersistence() {
            let result = '=== ç™»å½•æŒä¹…åŒ–æµ‹è¯• ===\n';
            
            // æ¨¡æ‹Ÿç™»å½•
            const testUser = 'student1';
            localStorage.setItem('currentUser', testUser);
            result += `ğŸ’¾ å·²ä¿å­˜ç™»å½•çŠ¶æ€: ${testUser}\n`;
            
            // éªŒè¯ä¿å­˜
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser === testUser) {
                result += 'âœ… ç™»å½•çŠ¶æ€ä¿å­˜æˆåŠŸ\n';
            } else {
                result += 'âŒ ç™»å½•çŠ¶æ€ä¿å­˜å¤±è´¥\n';
            }
            
            // æ¸…é™¤æµ‹è¯•æ•°æ®
            localStorage.removeItem('currentUser');
            result += 'ğŸ§¹ å·²æ¸…é™¤æµ‹è¯•æ•°æ®\n';
            
            showResult('advancedResult', result, 'success');
        }

        function testLogout() {
            let result = '=== ç™»å‡ºåŠŸèƒ½æµ‹è¯• ===\n';
            
            // æ¨¡æ‹Ÿç™»å½•çŠ¶æ€
            localStorage.setItem('currentUser', 'student1');
            result += 'ğŸ’¾ å·²è®¾ç½®æµ‹è¯•ç™»å½•çŠ¶æ€\n';
            
            // æ¨¡æ‹Ÿç™»å‡º
            localStorage.removeItem('currentUser');
            result += 'ğŸšª å·²æ‰§è¡Œç™»å‡ºæ“ä½œ\n';
            
            // éªŒè¯ç™»å‡º
            const savedUser = localStorage.getItem('currentUser');
            if (!savedUser) {
                result += 'âœ… ç™»å‡ºåŠŸèƒ½æ­£å¸¸\n';
            } else {
                result += 'âŒ ç™»å‡ºåŠŸèƒ½å¼‚å¸¸\n';
            }
            
            showResult('advancedResult', result, 'success');
        }

        function testErrorHandling() {
            let result = '=== é”™è¯¯å¤„ç†æµ‹è¯• ===\n';
            
            // æµ‹è¯•ç©ºç”¨æˆ·å
            const emptyUsername = '';
            const emptyAccount = testAccounts[emptyUsername];
            if (!emptyAccount) {
                result += 'âœ… ç©ºç”¨æˆ·åå¤„ç†æ­£å¸¸\n';
            } else {
                result += 'âŒ ç©ºç”¨æˆ·åå¤„ç†å¼‚å¸¸\n';
            }
            
            // æµ‹è¯•ç©ºå¯†ç 
            const username = 'student1';
            const emptyPassword = '';
            const account = testAccounts[username];
            if (account && account.password !== emptyPassword) {
                result += 'âœ… ç©ºå¯†ç å¤„ç†æ­£å¸¸\n';
            } else {
                result += 'âŒ ç©ºå¯†ç å¤„ç†å¼‚å¸¸\n';
            }
            
            // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦
            const specialUsername = 'test@#$%';
            const specialAccount = testAccounts[specialUsername];
            if (!specialAccount) {
                result += 'âœ… ç‰¹æ®Šå­—ç¬¦å¤„ç†æ­£å¸¸\n';
            } else {
                result += 'âŒ ç‰¹æ®Šå­—ç¬¦å¤„ç†å¼‚å¸¸\n';
            }
            
            showResult('advancedResult', result, 'success');
        }

        // 4. è°ƒè¯•å·¥å…·
        function openMainPage() {
            window.open('fluid_dynamic_2.html', '_blank');
        }

        function runAllTests() {
            let result = '=== è¿è¡Œæ‰€æœ‰æµ‹è¯• ===\n';
            
            try {
                testBasicLogin();
                testSystemStatus();
                testLoginPersistence();
                testErrorHandling();
                
                result += 'âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ\n';
                result += 'ğŸ“Š æµ‹è¯•ç»“æœå·²æ˜¾ç¤ºåœ¨å„åŒºåŸŸ\n';
            } catch (error) {
                result += `âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: ${error.message}\n`;
            }
            
            showResult('debugResult', result, 'success');
        }

        function clearAllData() {
            let result = '=== æ¸…é™¤æ‰€æœ‰æ•°æ® ===\n';
            
            try {
                localStorage.clear();
                result += 'ğŸ§¹ å·²æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨æ•°æ®\n';
                result += 'ğŸ”„ é¡µé¢å°†åœ¨3ç§’ååˆ·æ–°\n';
                
                setTimeout(() => {
                    location.reload();
                }, 3000);
            } catch (error) {
                result += `âŒ æ¸…é™¤æ•°æ®æ—¶å‡ºç°é”™è¯¯: ${error.message}\n`;
            }
            
            showResult('debugResult', result, 'error');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        window.addEventListener('load', function() {
            testSystemStatus();
        });
    </script>
</body>
</html>