<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数学公式渲染测试 - 流体力学学习平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .section {
            margin: 40px 0;
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title i {
            color: #3498db;
        }

        .demo-controls {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .control-group {
            margin: 15px 0;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
        }

        .control-group button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .control-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .formula-demo {
            margin: 30px 0;
            padding: 20px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .demo-title {
            color: #27ae60;
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .info-title {
            color: #1976d2;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .info-content {
            color: #1976d2;
            line-height: 1.6;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #3498db;
        }

        .feature-title {
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .feature-description {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-square-root-alt"></i> 数学公式渲染测试</h1>
            <p>测试美观的数学公式显示效果</p>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-cogs"></i> 控制面板
            </h2>
            
            <div class="demo-controls">
                <div class="control-group">
                    <label>选择公式类型：</label>
                    <select id="formulaType">
                        <option value="static">流体静力学</option>
                        <option value="dynamics">流体动力学</option>
                        <option value="viscous">粘性流动</option>
                        <option value="turbulent">湍流</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>选择具体公式：</label>
                    <select id="formulaSelect">
                        <option value="basic">基本方程</option>
                        <option value="bernoulli">伯努利方程</option>
                        <option value="navier-stokes">N-S方程</option>
                        <option value="reynolds">雷诺数</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <button onclick="renderFormula()">渲染公式</button>
                    <button onclick="renderAllFormulas()">渲染所有公式</button>
                    <button onclick="clearFormulas()">清除公式</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-info-circle"></i> 功能特性
            </h2>
            
            <div class="feature-list">
                <div class="feature-item">
                    <div class="feature-title">🎨 美观设计</div>
                    <div class="feature-description">
                        采用现代化的卡片设计，渐变背景和阴影效果，提供优秀的视觉体验
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-title">📐 数学公式</div>
                    <div class="feature-description">
                        集成MathJax，支持LaTeX数学公式渲染，显示效果专业美观
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-title">📱 响应式</div>
                    <div class="feature-description">
                        完全响应式设计，在手机、平板、电脑上都有良好的显示效果
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-title">⚡ 高性能</div>
                    <div class="feature-description">
                        异步加载MathJax，不阻塞页面渲染，提供流畅的用户体验
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-title">🎯 分类显示</div>
                    <div class="feature-description">
                        不同类别的公式使用不同的颜色主题，便于区分和记忆
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-title">📖 详细说明</div>
                    <div class="feature-description">
                        每个公式都包含推导过程和物理意义说明，帮助深入理解
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-flask"></i> 公式演示
            </h2>
            
            <div class="info-box">
                <div class="info-title">使用说明</div>
                <div class="info-content">
                    使用上方的控制面板选择公式类型和具体公式，然后点击"渲染公式"按钮查看效果。
                    所有公式都使用MathJax进行渲染，支持LaTeX语法。
                </div>
            </div>
            
            <div id="formulaDemo" class="formula-demo">
                <div class="demo-title">公式将在这里显示</div>
                <p>请使用控制面板选择并渲染公式</p>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-code"></i> 代码示例
            </h2>
            
            <div class="info-box">
                <div class="info-title">使用方法</div>
                <div class="info-content">
                    <pre><code>// 初始化公式渲染器
const renderer = new FormulaRenderer();
renderer.init();

// 渲染单个公式
const formulaData = {
    title: "流体静力学基本方程",
    formula: "$$\\nabla p = \\rho \\vec{g}$$",
    explanation: "压强梯度等于流体密度与重力加速度的乘积",
    derivation: [
        "考虑流体微元在重力场中的平衡",
        "微元受力：重力 $F_g = \\rho \\vec{g} dV$",
        "表面力：$F_s = -\\nabla p dV$",
        "平衡条件：$F_g + F_s = 0$",
        "$\\therefore \\nabla p = \\rho \\vec{g}$"
    ],
    physics: "压强梯度等于流体密度与重力加速度的乘积，这是流体静力学的基本微分方程。",
    category: "static"
};

renderer.renderSingleFormula(formulaData, "formulaDemo");</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载公式渲染器 -->
    <script src="js/components/formulaRenderer.js"></script>
    <script>
        // 公式数据
        const formulaDatabase = {
            static: {
                basic: {
                    title: "流体静力学基本方程",
                    formula: "$$\\nabla p = \\rho \\vec{g}$$",
                    explanation: "压强梯度等于流体密度与重力加速度的乘积",
                    derivation: [
                        "考虑流体微元在重力场中的平衡",
                        "微元受力：重力 $F_g = \\rho \\vec{g} dV$",
                        "表面力：$F_s = -\\nabla p dV$",
                        "平衡条件：$F_g + F_s = 0$",
                        "即：$\\rho \\vec{g} - \\nabla p = 0$",
                        "$\\therefore \\nabla p = \\rho \\vec{g}$"
                    ],
                    physics: "压强梯度等于流体密度与重力加速度的乘积，这是流体静力学的基本微分方程。",
                    category: "static"
                },
                pressure: {
                    title: "静水压强分布",
                    formula: "$$p = p_0 + \\rho g h$$",
                    explanation: "对于不可压缩流体，压强随深度线性增加",
                    derivation: [
                        "对微分方程 $\\frac{dp}{dz} = -\\rho g$ 积分",
                        "$\\int dp = -\\rho g \\int dz$",
                        "$p - p_0 = -\\rho g(z - z_0)$",
                        "令 $h = z_0 - z$ (深度)",
                        "$\\therefore p = p_0 + \\rho g h$"
                    ],
                    physics: "对于不可压缩流体，压强随深度线性增加，斜率为 $\\rho g$。",
                    category: "static"
                }
            },
            dynamics: {
                bernoulli: {
                    title: "伯努利方程",
                    formula: "$$\\frac{p}{\\rho g} + \\frac{v^2}{2g} + z = H$$",
                    explanation: "沿流线机械能守恒",
                    derivation: [
                        "沿流线积分欧拉方程",
                        "$\\int[\\frac{\\partial \\vec{v}}{\\partial t} + (\\vec{v} \\cdot \\nabla)\\vec{v}] \\cdot ds = \\int[-\\frac{1}{\\rho}\\nabla p + \\vec{g}] \\cdot ds$",
                        "定常流动：$\\frac{\\partial \\vec{v}}{\\partial t} = 0$",
                        "$\\therefore \\int(\\vec{v} \\cdot \\nabla)\\vec{v} \\cdot ds = \\int[-\\frac{1}{\\rho}\\nabla p + \\vec{g}] \\cdot ds$",
                        "积分得到：$\\frac{v^2}{2} + \\frac{p}{\\rho} + gz = 常数$"
                    ],
                    physics: "沿流线机械能守恒，总水头保持不变。",
                    category: "dynamics"
                },
                continuity: {
                    title: "连续性方程",
                    formula: "$$\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\vec{v}) = 0$$",
                    explanation: "基于质量守恒定律",
                    derivation: [
                        "基于质量守恒定律",
                        "控制体内质量变化率 = 质量通量",
                        "$\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\vec{v}) = 0$",
                        "对于不可压缩流体：",
                        "$\\nabla \\cdot \\vec{v} = 0$ (速度散度为零)"
                    ],
                    physics: "流体微团体积在运动过程中保持不变。",
                    category: "dynamics"
                }
            },
            viscous: {
                "navier-stokes": {
                    title: "N-S方程",
                    formula: "$$\\rho(\\frac{\\partial \\vec{v}}{\\partial t} + \\vec{v} \\cdot \\nabla\\vec{v}) = -\\nabla p + \\mu\\nabla^2\\vec{v} + \\rho\\vec{g}$$",
                    explanation: "粘性流体的运动方程",
                    derivation: [
                        "基于动量守恒定律",
                        "考虑粘性应力：",
                        "$\\rho(\\frac{\\partial \\vec{v}}{\\partial t} + \\vec{v} \\cdot \\nabla\\vec{v}) = -\\nabla p + \\mu\\nabla^2\\vec{v} + \\rho\\vec{g}$"
                    ],
                    physics: "粘性流体的运动方程，包含惯性力、压力梯度、粘性力和重力。",
                    category: "viscous"
                },
                reynolds: {
                    title: "雷诺数",
                    formula: "$$Re = \\frac{\\rho v L}{\\mu} = \\frac{v L}{\\nu}$$",
                    explanation: "判断流动状态的重要参数",
                    derivation: [
                        "雷诺数定义：",
                        "$Re = \\frac{惯性力}{粘性力}$",
                        "$= \\frac{\\rho v^2 L^2}{\\mu v L}$",
                        "$= \\frac{\\rho v L}{\\mu} = \\frac{v L}{\\nu}$"
                    ],
                    physics: "判断流动状态的重要参数，$Re < 2300$ 为层流。",
                    category: "viscous"
                }
            },
            turbulent: {
                rans: {
                    title: "RANS方程",
                    formula: "$$\\frac{\\partial \\bar{u}_i}{\\partial t} + \\bar{u}_j\\frac{\\partial \\bar{u}_i}{\\partial x_j} = -\\frac{1}{\\rho}\\frac{\\partial \\bar{p}}{\\partial x_i} + \\nu\\nabla^2\\bar{u}_i + \\frac{1}{\\rho}\\frac{\\partial \\tau_{ij}}{\\partial x_j}$$",
                    explanation: "湍流时均运动方程",
                    derivation: [
                        "对N-S方程进行雷诺平均",
                        "得到RANS方程：",
                        "$\\frac{\\partial \\bar{u}_i}{\\partial t} + \\bar{u}_j\\frac{\\partial \\bar{u}_i}{\\partial x_j} = -\\frac{1}{\\rho}\\frac{\\partial \\bar{p}}{\\partial x_i} + \\nu\\nabla^2\\bar{u}_i + \\frac{1}{\\rho}\\frac{\\partial \\tau_{ij}}{\\partial x_j}$"
                    ],
                    physics: "湍流时均运动方程，包含雷诺应力项。",
                    category: "turbulent"
                }
            }
        };

        // 初始化公式渲染器
        let renderer;

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderer = new FormulaRenderer();
            renderer.init();
            
            // 更新公式选择器
            updateFormulaSelect();
        });

        // 更新公式选择器
        function updateFormulaSelect() {
            const typeSelect = document.getElementById('formulaType');
            const formulaSelect = document.getElementById('formulaSelect');
            const selectedType = typeSelect.value;
            
            // 清空现有选项
            formulaSelect.innerHTML = '';
            
            // 添加新选项
            const formulas = formulaDatabase[selectedType];
            if (formulas) {
                Object.keys(formulas).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = formulas[key].title;
                    formulaSelect.appendChild(option);
                });
            }
        }

        // 渲染单个公式
        function renderFormula() {
            const typeSelect = document.getElementById('formulaType');
            const formulaSelect = document.getElementById('formulaSelect');
            const selectedType = typeSelect.value;
            const selectedFormula = formulaSelect.value;
            
            const formulaData = formulaDatabase[selectedType][selectedFormula];
            if (formulaData && renderer) {
                renderer.renderSingleFormula(formulaData, 'formulaDemo');
            }
        }

        // 渲染所有公式
        function renderAllFormulas() {
            if (!renderer) return;
            
            const demoContainer = document.getElementById('formulaDemo');
            demoContainer.innerHTML = '';
            
            // 渲染所有类型的公式
            Object.keys(formulaDatabase).forEach(type => {
                const typeTitle = document.createElement('h3');
                typeTitle.textContent = getTypeTitle(type);
                typeTitle.style.color = '#2c3e50';
                typeTitle.style.marginTop = '30px';
                typeTitle.style.marginBottom = '20px';
                demoContainer.appendChild(typeTitle);
                
                Object.values(formulaDatabase[type]).forEach(formulaData => {
                    const formulaDiv = document.createElement('div');
                    formulaDiv.innerHTML = renderer.renderFormulaContainer(formulaData);
                    demoContainer.appendChild(formulaDiv);
                });
            });
            
            renderer.typeset();
        }

        // 清除公式
        function clearFormulas() {
            const demoContainer = document.getElementById('formulaDemo');
            demoContainer.innerHTML = '<div class="demo-title">公式已清除</div><p>请使用控制面板选择并渲染公式</p>';
        }

        // 获取类型标题
        function getTypeTitle(type) {
            const titles = {
                'static': '流体静力学',
                'dynamics': '流体动力学',
                'viscous': '粘性流动',
                'turbulent': '湍流'
            };
            return titles[type] || type;
        }

        // 监听类型选择变化
        document.getElementById('formulaType').addEventListener('change', updateFormulaSelect);
    </script>
</body>
</html> 