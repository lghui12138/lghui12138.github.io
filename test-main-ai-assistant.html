<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主AI助手修复验证</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        
        .config-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
            text-align: center;
        }
        
        .status.success { background: rgba(40, 167, 69, 0.2); color: #28a745; }
        .status.error { background: rgba(220, 53, 69, 0.2); color: #dc3545; }
        .status.info { background: rgba(23, 162, 184, 0.2); color: #17a2b8; }
        
        button {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .link-button {
            display: inline-block;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            margin: 8px;
            transition: all 0.3s ease;
        }
        
        .link-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            color: white;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <h1>🎯 主AI助手修复验证</h1>
    
    <div class="test-container">
        <h2>📋 修复状态检查</h2>
        
        <div class="config-display" id="config-display">
            正在检查配置...
        </div>
        
        <button onclick="checkConfigurations()">🔍 检查配置</button>
        <button onclick="testSmartModelSelector()">🧪 测试智能模型选择器</button>
        
        <div class="status" id="status">准备检查修复状态</div>
    </div>
    
    <div class="test-container">
        <h2>🚀 使用主AI助手</h2>
        <p>如果配置检查通过，你可以直接使用主AI助手进行DeepSeek-R1测试：</p>
        
        <a href="index-complete.html" class="link-button">🤖 打开主AI助手</a>
        
        <div style="margin-top: 20px;">
            <h3>🧮 建议测试问题：</h3>
            <ul style="text-align: left;">
                <li>请推导纳维-斯托克斯方程的连续性方程</li>
                <li>详细推导伯努利方程的完整形式</li>
                <li>解释雷诺数的物理意义和计算方法</li>
                <li>推导欧拉方程并说明其适用条件</li>
            </ul>
        </div>
    </div>
    
    <script src="js/core/config.js"></script>
    <script src="js/core/smart-model-selector.js"></script>
    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function updateConfigDisplay(content) {
            document.getElementById('config-display').innerHTML = content;
        }
        
        async function checkConfigurations() {
            updateStatus('正在检查配置...', 'info');
            
            let configInfo = '<strong>🔧 配置检查结果：</strong><br><br>';
            let allGood = true;
            
            try {
                // 检查AppConfig
                if (window.AppConfig) {
                    const smartConfig = window.AppConfig.api.smartAI;
                    configInfo += `✅ AppConfig加载成功<br>`;
                    configInfo += `📡 API端点: ${smartConfig.endpoint}<br>`;
                    configInfo += `⏰ 超时时间: ${smartConfig.requestTimeout/1000}秒<br>`;
                    configInfo += `🔄 重试次数: ${smartConfig.maxRetries}次<br>`;
                    
                    if (smartConfig.requestTimeout >= 600000) {
                        configInfo += `✅ 超时配置正确 (≥10分钟)<br>`;
                    } else {
                        configInfo += `❌ 超时配置过短 (<10分钟)<br>`;
                        allGood = false;
                    }
                    
                    if (smartConfig.maxRetries <= 1) {
                        configInfo += `✅ 重试配置正确 (≤1次)<br>`;
                    } else {
                        configInfo += `⚠️ 重试次数较多 (${smartConfig.maxRetries}次)<br>`;
                    }
                } else {
                    configInfo += `❌ AppConfig未加载<br>`;
                    allGood = false;
                }
                
                configInfo += '<br>';
                
                // 检查SmartModelSelector
                if (window.SmartModelSelector) {
                    configInfo += `✅ SmartModelSelector加载成功<br>`;
                    
                    // 检查内部配置
                    const smsConfig = window.SmartModelSelector.config || {};
                    if (smsConfig.requestTimeout >= 600000) {
                        configInfo += `✅ SMS超时配置正确<br>`;
                    } else {
                        configInfo += `⚠️ SMS超时配置需要检查<br>`;
                    }
                } else {
                    configInfo += `❌ SmartModelSelector未加载<br>`;
                    allGood = false;
                }
                
                configInfo += '<br>';
                
                // 检查修复功能
                configInfo += '<strong>🛠️ 修复功能检查：</strong><br>';
                configInfo += `✅ 手动超时控制: 已实现<br>`;
                configInfo += `✅ 网络连接优化: 已实现<br>`;
                configInfo += `✅ DeepSeek-R1参数优化: 已实现<br>`;
                configInfo += `✅ 心跳机制: 已实现<br>`;
                configInfo += `✅ 进度提示系统: 已实现<br>`;
                configInfo += `✅ LaTeX符号支持: 已实现<br>`;
                
                updateConfigDisplay(configInfo);
                
                if (allGood) {
                    updateStatus('✅ 所有配置检查通过！可以使用主AI助手', 'success');
                } else {
                    updateStatus('⚠️ 部分配置需要注意，但基本功能可用', 'error');
                }
                
            } catch (error) {
                updateStatus(`❌ 配置检查失败: ${error.message}`, 'error');
                updateConfigDisplay(`<strong>❌ 错误:</strong><br>${error.message}`);
            }
        }
        
        async function testSmartModelSelector() {
            updateStatus('正在测试智能模型选择器...', 'info');
            
            try {
                if (!window.SmartModelSelector) {
                    throw new Error('SmartModelSelector未加载');
                }
                
                // 初始化测试
                await window.SmartModelSelector.init({
                    apiKey: "sk-dhseqxecuwwotodiskfdgwdjahnbexcgdotkfsovbgajxnis",
                    apiUrl: "https://api.siliconflow.cn/v1/chat/completions",
                    maxRetries: 1,
                    requestTimeout: 600000
                });
                
                updateStatus('✅ 智能模型选择器初始化成功！', 'success');
                
                // 显示测试结果
                let testInfo = '<strong>🧪 测试结果：</strong><br><br>';
                testInfo += `✅ 初始化成功<br>`;
                testInfo += `✅ 超时设置: 10分钟<br>`;
                testInfo += `✅ 重试设置: 1次<br>`;
                testInfo += `✅ DeepSeek-R1支持: 已启用<br>`;
                testInfo += `<br><strong>🎯 建议:</strong><br>`;
                testInfo += `现在可以安全使用主AI助手进行复杂数学推导！<br>`;
                
                updateConfigDisplay(testInfo);
                
            } catch (error) {
                updateStatus(`❌ 测试失败: ${error.message}`, 'error');
                updateConfigDisplay(`<strong>❌ 测试错误:</strong><br>${error.message}`);
            }
        }
        
        // 页面加载完成后自动检查
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 主AI助手修复验证页面加载完成');
            updateStatus('页面加载完成，点击按钮开始检查', 'info');
            
            // 2秒后自动检查配置
            setTimeout(checkConfigurations, 2000);
        });
    </script>
</body>
</html>
