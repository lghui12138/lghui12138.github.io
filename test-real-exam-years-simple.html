<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 真题年份显示测试</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .year-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .year-item {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid #2196f3;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #2196f3;
            color: white;
        }
        .btn:hover {
            background: #1976d2;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success {
            background: #c8e6c9;
            color: #2e7d32;
        }
        .status.error {
            background: #ffcdd2;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>🧪 真题年份显示测试</h1>
            
            <div class="test-section">
                <h3>📊 数据状态</h3>
                <p><strong>总题目数:</strong> {{ totalQuestions }}</p>
                <p><strong>真题模式:</strong> {{ isRealExamMode ? '是' : '否' }}</p>
                <p><strong>realExamYears长度:</strong> {{ realExamYears.length }}</p>
                <p><strong>availableYears长度:</strong> {{ availableYears.length }}</p>
            </div>

            <div class="test-section">
                <h3>📅 可用年份 (availableYears)</h3>
                <div v-if="availableYears.length > 0" class="year-list">
                    <div v-for="year in availableYears" :key="year" class="year-item">
                        {{ year }}年
                    </div>
                </div>
                <div v-else class="status error">
                    没有找到年份数据
                </div>
            </div>

            <div class="test-section">
                <h3>📅 真题年份 (realExamYears)</h3>
                <div v-if="realExamYears.length > 0" class="year-list">
                    <div v-for="yearInfo in realExamYears" :key="yearInfo.year" class="year-item">
                        {{ yearInfo.year }}年 ({{ yearInfo.count }}题)
                    </div>
                </div>
                <div v-else class="status error">
                    没有找到真题年份数据
                </div>
            </div>

            <div class="test-section">
                <h3>🔧 操作</h3>
                <button @click="loadData" class="btn">加载真题数据</button>
                <button @click="setRealExamMode" class="btn">设置真题模式</button>
                <button @click="showStatus" class="btn">显示状态</button>
            </div>

            <div v-if="status" class="status" :class="statusType">
                {{ status }}
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    allQuestions: [],
                    realExamYears: [],
                    isRealExamMode: false,
                    status: '',
                    statusType: 'success'
                }
            },

            computed: {
                totalQuestions() {
                    return this.allQuestions.length;
                },

                availableYears() {
                    // 如果是真题模式，使用真题年份
                    if (this.isRealExamMode && this.realExamYears.length > 0) {
                        return this.realExamYears.map(y => y.year);
                    }
                    
                    // 如果真题数据已加载但realExamYears还没设置，从allQuestions中提取
                    if (this.isRealExamMode && this.allQuestions.length > 0) {
                        const years = [...new Set(this.allQuestions.map(q => q.year))].sort((a, b) => b - a);
                        return years;
                    }
                    
                    return [];
                }
            },

            methods: {
                async loadData() {
                    try {
                        this.status = '正在加载真题数据...';
                        this.statusType = 'success';
                        
                        const response = await fetch('question-banks/真题_中国海洋大学_2000-2021_cleaned.json');
                        if (!response.ok) {
                            throw new Error('真题文件加载失败');
                        }
                        
                        this.allQuestions = await response.json();
                        this.realExamYears = this.getRealExamYears(this.allQuestions);
                        
                        this.status = `✅ 数据加载成功: ${this.allQuestions.length}题，${this.realExamYears.length}个年份`;
                        this.statusType = 'success';
                        
                    } catch (error) {
                        this.status = `❌ 加载失败: ${error.message}`;
                        this.statusType = 'error';
                        console.error('加载失败:', error);
                    }
                },

                getRealExamYears(questions) {
                    const years = [...new Set(questions.map(q => q.year))].sort((a, b) => b - a);
                    return years.map(year => ({
                        year,
                        count: questions.filter(q => q.year === year).length,
                        label: `${year}年 (${questions.filter(q => q.year === year).length}题)`
                    }));
                },

                setRealExamMode() {
                    this.isRealExamMode = true;
                    this.status = '✅ 已设置真题模式';
                    this.statusType = 'success';
                },

                showStatus() {
                    console.log('当前状态:', {
                        totalQuestions: this.totalQuestions,
                        isRealExamMode: this.isRealExamMode,
                        realExamYears: this.realExamYears,
                        availableYears: this.availableYears
                    });
                    this.status = '📊 状态已输出到控制台';
                    this.statusType = 'success';
                }
            },

            mounted() {
                this.loadData();
            }
        }).mount('#app');
    </script>
</body>
</html> 