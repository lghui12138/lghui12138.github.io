<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢˜åº“ç®¡ç†ç³»ç»Ÿ - æ•™å¸ˆç«¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 800px;
        }

        .sidebar {
            width: 300px;
            background: #f8f9fa;
            border-right: 2px solid #e9ecef;
            padding: 30px;
        }

        .sidebar h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .bank-list {
            list-style: none;
        }

        .bank-item {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            margin-bottom: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .bank-item:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.2);
        }

        .bank-item.active {
            border-color: #4facfe;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
        }

        .bank-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .bank-name {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
            display: flex;
            align-items: center;
        }

        .priority-badge {
            color: #ff9800;
            margin-right: 5px;
            font-size: 1.2em;
        }

        .recommended-badge {
            color: #f44336;
            margin-right: 5px;
            font-size: 1.2em;
        }

        .difficulty-badge {
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .bank-info {
            color: #666;
            font-size: 0.85em;
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }

        .bank-info span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .bank-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .bank-item:hover .bank-actions {
            opacity: 1;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 6px;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }

        .content-area {
            flex: 1;
            padding: 30px;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .toolbar h2 {
            color: white;
            font-size: 1.8em;
            margin: 0;
        }

        .toolbar-left .subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
            display: block;
        }

        .toolbar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .sort-controls, .filter-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .sort-controls label, .filter-controls label {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
        }

        .sort-controls select, .filter-controls select {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            background: white;
            color: #333;
            font-size: 14px;
            cursor: pointer;
        }

        .sort-controls select:focus, .filter-controls select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-large {
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 25px;
        }

        .question-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .question-item {
            border-bottom: 1px solid #e9ecef;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .question-item:hover {
            background: #f8f9fa;
        }

        .question-item:last-child {
            border-bottom: none;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .question-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            flex: 1;
            margin-right: 20px;
            line-height: 1.5;
        }

        .question-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .meta-tag {
            background: #e9ecef;
            color: #495057;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
        }

        .question-actions {
            display: flex;
            gap: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-header h3 {
            color: #333;
            font-size: 1.8em;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f8f9fa;
            color: #666;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.2);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .options-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .option-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .option-label {
            width: 30px;
            height: 30px;
            background: #4facfe;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .option-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stats-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stats-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
            color: #dee2e6;
        }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1em;
        }

        .search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            font-size: 1.2em;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ffd93d 0%, #ff9f43 100%);
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .btn-group {
                flex-wrap: wrap;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š é¢˜åº“ç®¡ç†ç³»ç»Ÿ</h1>
            <p>æµä½“åŠ›å­¦å­¦ä¹ å¹³å° - æ•™å¸ˆç®¡ç†ç«¯</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="search-bar">
                    <input type="text" id="bankSearch" class="search-input" placeholder="æœç´¢é¢˜åº“...">
                    <button class="search-btn" onclick="searchBanks()">ğŸ”</button>
                </div>
                
                <h3>ğŸ“‹ é¢˜åº“åˆ—è¡¨</h3>
                <ul class="bank-list" id="bankList">
                    <li class="loading">åŠ è½½ä¸­...</li>
                </ul>
                
                <button class="btn btn-success btn-large" style="width: 100%; margin-top: 20px;" onclick="createNewBank()">
                    â• åˆ›å»ºæ–°é¢˜åº“
                </button>
            </div>

            <div class="content-area">
                <!-- å·¥å…·æ  -->
                <div class="toolbar">
                    <div class="toolbar-left">
                        <h2>ğŸ“š é¢˜åº“ç®¡ç†ç³»ç»Ÿ</h2>
                        <span class="subtitle">ç®¡ç†æ‰€æœ‰é¢˜åº“å’Œé¢˜ç›®</span>
                    </div>
                    <div class="toolbar-right">
                        <!-- æ’åºæ§åˆ¶ -->
                        <div class="sort-controls">
                            <label for="sortBy">æ’åºæ–¹å¼ï¼š</label>
                            <select id="sortBy" onchange="sortQuestionBanks()">
                                <option value="priority">ä¼˜å…ˆçº§</option>
                                <option value="questionCount">é¢˜ç›®æ•°é‡</option>
                                <option value="lastUpdated">æ›´æ–°æ—¶é—´</option>
                                <option value="difficulty">éš¾åº¦</option>
                                <option value="name">åç§°</option>
                                <option value="category">åˆ†ç±»</option>
                            </select>
                            <select id="sortOrder" onchange="sortQuestionBanks()">
                                <option value="asc">å‡åº</option>
                                <option value="desc">é™åº</option>
                            </select>
                        </div>
                        
                        <!-- ç­›é€‰æ§åˆ¶ -->
                        <div class="filter-controls">
                            <label for="filterCategory">åˆ†ç±»ç­›é€‰ï¼š</label>
                            <select id="filterCategory" onchange="filterQuestionBanks()">
                                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                <option value="æ˜“é”™é¢˜">æ˜“é”™é¢˜</option>
                                <option value="çœŸé¢˜">çœŸé¢˜</option>
                                <option value="åŸºç¡€ç†è®º">åŸºç¡€ç†è®º</option>
                                <option value="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</option>
                                <option value="é«˜çº§ç†è®º">é«˜çº§ç†è®º</option>
                                <option value="ä¸“é¢˜åº”ç”¨">ä¸“é¢˜åº”ç”¨</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary" onclick="createNewBank()">
                            <i class="fas fa-plus"></i> æ–°å»ºé¢˜åº“
                        </button>
                        <button class="btn btn-success" onclick="refreshData()">
                            <i class="fas fa-sync"></i> åˆ·æ–°æ•°æ®
                        </button>
                    </div>
                </div>

                <!-- æ€»ä½“ç»Ÿè®¡ -->
                <div class="stats-cards" id="overallStats" style="display: grid;">
                    <div class="stats-card">
                        <div class="stats-number" id="totalBanks">0</div>
                        <div class="stats-label">é¢˜åº“æ€»æ•°</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="totalQuestionsAll">0</div>
                        <div class="stats-label">é¢˜ç›®æ€»æ•°</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="easyBanks">0</div>
                        <div class="stats-label">ç®€å•é¢˜åº“</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="hardBanks">0</div>
                        <div class="stats-label">å›°éš¾é¢˜åº“</div>
                    </div>
                </div>
                
                <!-- å•ä¸ªé¢˜åº“ç»Ÿè®¡ -->
                <div class="stats-cards" id="bankStats" style="display: none;">
                    <div class="stats-card">
                        <div class="stats-number" id="totalQuestions">0</div>
                        <div class="stats-label">æ€»é¢˜ç›®æ•°</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="easyQuestions">0</div>
                        <div class="stats-label">ç®€å•é¢˜ç›®</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="mediumQuestions">0</div>
                        <div class="stats-label">ä¸­ç­‰é¢˜ç›®</div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-number" id="hardQuestions">0</div>
                        <div class="stats-label">å›°éš¾é¢˜ç›®</div>
                    </div>
                </div>

                <!-- é¢˜åº“æ“ä½œå·¥å…·æ  -->
                <div id="bankToolbar" class="bank-toolbar" style="display: none; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 1px solid #e3e6ea;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="toolbar-left">
                            <h3 id="currentBankName" style="margin: 0; color: #333;">è¯·é€‰æ‹©é¢˜åº“</h3>
                            <span id="currentBankDesc" class="subtitle" style="color: #666; font-size: 14px;"></span>
                        </div>
                        <div class="toolbar-right" style="display: flex; gap: 10px;">
                            <button class="btn btn-success" onclick="addQuestion()" id="addQuestionBtn">
                                â• æ·»åŠ é¢˜ç›®
                            </button>
                            <button class="btn btn-info" onclick="importQuestions()" id="importBtn">
                                ğŸ“¤ å¯¼å…¥é¢˜ç›®
                            </button>
                            <button class="btn btn-warning" onclick="exportBank()" id="exportBtn">
                                ğŸ“¥ å¯¼å‡ºé¢˜åº“
                            </button>
                            <button class="btn btn-danger" onclick="deleteBank()" id="deleteBankBtn">
                                ğŸ—‘ï¸ åˆ é™¤é¢˜åº“
                            </button>
                        </div>
                    </div>
                </div>

                <div class="question-list" id="questionList">
                    <div class="empty-state">
                        <i>ğŸ“</i>
                        <h3>é€‰æ‹©é¢˜åº“å¼€å§‹ç®¡ç†</h3>
                        <p>ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªé¢˜åº“ï¼Œæˆ–åˆ›å»ºæ–°çš„é¢˜åº“æ¥å¼€å§‹ç®¡ç†é¢˜ç›®</p>
                        <div style="background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 8px; padding: 15px; margin-top: 20px; font-size: 0.9em;">
                            <strong>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                            â€¢ é€‰æ‹©å·¦ä¾§é¢˜åº“å¯æŸ¥çœ‹å’Œç¼–è¾‘é¢˜ç›®<br>
                            â€¢ æ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤é¢˜åº“å’Œé¢˜ç›®<br>
                            â€¢ ä¿®æ”¹åè¯·ä¸‹è½½ç”Ÿæˆçš„æ–‡ä»¶å¹¶æ›¿æ¢åˆ°æœåŠ¡å™¨<br>
                            â€¢ æ”¯æŒJSONæ ¼å¼çš„æ‰¹é‡å¯¼å…¥å¯¼å‡º
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¢˜åº“ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="bankModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="bankModalTitle">åˆ›å»ºé¢˜åº“</h3>
                <button class="close-btn" onclick="closeBankModal()">&times;</button>
            </div>
            <form onsubmit="saveBankInfo(event)">
                <div class="form-group">
                    <label class="form-label">é¢˜åº“åç§°</label>
                    <input type="text" id="bankName" class="form-input" required placeholder="è¾“å…¥é¢˜åº“åç§°...">
                </div>
                <div class="form-group">
                    <label class="form-label">é¢˜åº“æè¿°</label>
                    <textarea id="bankDescription" class="form-input form-textarea" placeholder="è¾“å…¥é¢˜åº“æè¿°..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">é¢˜åº“åˆ†ç±»</label>
                    <select id="bankCategory" class="form-input form-select">
                        <option value="æµä½“åŠ›å­¦åŸºç¡€">æµä½“åŠ›å­¦åŸºç¡€</option>
                        <option value="æµä½“æ€§è´¨">æµä½“æ€§è´¨</option>
                        <option value="åŠ¨é‡æ–¹ç¨‹">åŠ¨é‡æ–¹ç¨‹</option>
                        <option value="èƒ½é‡æ–¹ç¨‹">èƒ½é‡æ–¹ç¨‹</option>
                        <option value="å‹åŠ›">å‹åŠ›</option>
                        <option value="åŠ¿æµ">åŠ¿æµ</option>
                        <option value="ç²˜æ€§">ç²˜æ€§</option>
                        <option value="è¾¹ç•Œå±‚">è¾¹ç•Œå±‚</option>
                        <option value="æ¹æµ">æ¹æµ</option>
                        <option value="ç®¡é“æµåŠ¨">ç®¡é“æµåŠ¨</option>
                        <option value="è‡ªç”±é¢">è‡ªç”±é¢</option>
                        <option value="æ¶¡åº¦">æ¶¡åº¦</option>
                        <option value="é›·è¯ºæ•°">é›·è¯ºæ•°</option>
                        <option value="å®éªŒä¸é‡çº²">å®éªŒä¸é‡çº²</option>
                        <option value="æµçº¿è½¨è¿¹">æµçº¿è½¨è¿¹</option>
                        <option value="æ˜“é”™é¢˜">æ˜“é”™é¢˜</option>
                        <option value="çœŸé¢˜">çœŸé¢˜</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="btn" style="background: #6c757d; margin-right: 10px;" onclick="closeBankModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- é¢˜ç›®ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="questionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="questionModalTitle">æ·»åŠ é¢˜ç›®</h3>
                <button class="close-btn" onclick="closeQuestionModal()">&times;</button>
            </div>
            <form onsubmit="saveQuestion(event)">
                <div class="form-group">
                    <label class="form-label">é¢˜ç›®å†…å®¹</label>
                    <textarea id="questionTitle" class="form-input form-textarea" required placeholder="è¾“å…¥é¢˜ç›®å†…å®¹..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">é¢˜ç›®ç±»å‹</label>
                    <select id="questionType" class="form-input form-select" onchange="updateQuestionForm()">
                        <option value="é€‰æ‹©é¢˜">é€‰æ‹©é¢˜</option>
                        <option value="åˆ¤æ–­é¢˜">åˆ¤æ–­é¢˜</option>
                        <option value="å¡«ç©ºé¢˜">å¡«ç©ºé¢˜</option>
                        <option value="è§£ç­”é¢˜">è§£ç­”é¢˜</option>
                        <option value="è®¡ç®—é¢˜">è®¡ç®—é¢˜</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">éš¾åº¦ç­‰çº§</label>
                    <select id="questionDifficulty" class="form-input form-select">
                        <option value="easy">ç®€å•</option>
                        <option value="medium">ä¸­ç­‰</option>
                        <option value="hard">å›°éš¾</option>
                    </select>
                </div>
                
                <!-- é€‰æ‹©é¢˜é€‰é¡¹ -->
                <div id="optionsSection" class="form-group">
                    <label class="form-label">é€‰é¡¹è®¾ç½®</label>
                    <div class="options-container">
                        <div class="option-group">
                            <div class="option-label">A</div>
                            <input type="text" class="option-input" id="optionA" placeholder="é€‰é¡¹Aå†…å®¹">
                        </div>
                        <div class="option-group">
                            <div class="option-label">B</div>
                            <input type="text" class="option-input" id="optionB" placeholder="é€‰é¡¹Bå†…å®¹">
                        </div>
                        <div class="option-group">
                            <div class="option-label">C</div>
                            <input type="text" class="option-input" id="optionC" placeholder="é€‰é¡¹Cå†…å®¹">
                        </div>
                        <div class="option-group">
                            <div class="option-label">D</div>
                            <input type="text" class="option-input" id="optionD" placeholder="é€‰é¡¹Då†…å®¹">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">æ­£ç¡®ç­”æ¡ˆ</label>
                    <input type="text" id="questionAnswer" class="form-input" required placeholder="è¾“å…¥æ­£ç¡®ç­”æ¡ˆ...">
                    <small style="color: #666; margin-top: 5px; display: block;">
                        é€‰æ‹©é¢˜å¡«å†™é€‰é¡¹å­—æ¯(A/B/C/D)ï¼Œåˆ¤æ–­é¢˜å¡«å†™(æ­£ç¡®/é”™è¯¯)ï¼Œå¡«ç©ºé¢˜å’Œå…¶ä»–é¢˜å‹å¡«å†™å…·ä½“ç­”æ¡ˆ
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">é¢˜ç›®è§£é‡Š</label>
                    <textarea id="questionExplanation" class="form-input form-textarea" placeholder="è¾“å…¥é¢˜ç›®è§£é‡Šå’Œè§£é¢˜æ€è·¯..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">çŸ¥è¯†ç‚¹æ ‡ç­¾</label>
                    <input type="text" id="questionTags" class="form-input" placeholder="ç”¨é€—å·åˆ†éš”å¤šä¸ªæ ‡ç­¾ï¼Œå¦‚ï¼šæµä½“é™åŠ›å­¦,å‹åŠ›,å¸•æ–¯å¡å®šå¾‹">
                </div>

                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="btn" style="background: #6c757d; margin-right: 10px;" onclick="closeQuestionModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜é¢˜ç›®</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../js/core/utils.js"></script>
    <script src="../modules/teacher-management.js"></script>
    <script>
        let currentBank = null;
        let currentQuestionId = null;
        let questionBanks = [];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestionBanks();
        });

        // åŠ è½½é¢˜åº“åˆ—è¡¨
        async function loadQuestionBanks() {
            try {
                const response = await fetch('../question-banks/index.json');
                const data = await response.json();
                questionBanks = data.questionBanks || data.banks || [];
                
                // è½¬æ¢æ•°æ®æ ¼å¼ä»¥å…¼å®¹ç®¡ç†ç³»ç»Ÿ
                questionBanks = questionBanks.map(bank => ({
                    id: bank.id,
                    name: bank.name,
                    description: bank.description || 'æ— æè¿°',
                    category: bank.category || 'æœªåˆ†ç±»',
                    filename: bank.filename,
                    questionCount: bank.questionCount || 0,
                    difficulty: bank.difficulty || 'medium',
                    tags: bank.tags || [],
                    color: bank.color || '#4facfe',
                    createTime: bank.lastUpdated || new Date().toISOString(),
                    updateTime: bank.lastUpdated || new Date().toISOString(),
                    priority: bank.priority || 999,
                    recommended: bank.recommended || false
                }));
                
                // åˆå§‹æ’åºï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
                sortQuestionBanks('priority', 'asc');
                updateOverallStats();
            } catch (error) {
                console.error('åŠ è½½é¢˜åº“åˆ—è¡¨å¤±è´¥:', error);
                showNotification('åŠ è½½é¢˜åº“åˆ—è¡¨å¤±è´¥', 'error');
            }
        }

        // æ’åºé¢˜åº“
        function sortQuestionBanks(sortBy = null, order = null) {
            const sortField = sortBy || document.getElementById('sortBy').value;
            const sortOrder = order || document.getElementById('sortOrder').value;
            
            questionBanks.sort((a, b) => {
                let valueA = a[sortField];
                let valueB = b[sortField];
                
                // ç‰¹æ®Šå¤„ç†ä¸åŒç±»å‹çš„æ’åº
                if (sortField === 'difficulty') {
                    const difficultyOrder = { 'easy': 1, 'medium': 2, 'hard': 3 };
                    valueA = difficultyOrder[valueA] || 2;
                    valueB = difficultyOrder[valueB] || 2;
                } else if (sortField === 'questionCount' || sortField === 'priority') {
                    valueA = parseInt(valueA) || 0;
                    valueB = parseInt(valueB) || 0;
                } else if (sortField === 'lastUpdated') {
                    valueA = new Date(valueA);
                    valueB = new Date(valueB);
                } else {
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                }
                
                if (sortOrder === 'desc') {
                    return valueA > valueB ? -1 : valueA < valueB ? 1 : 0;
                } else {
                    return valueA < valueB ? -1 : valueA > valueB ? 1 : 0;
                }
            });
            
            displayBankList();
        }

        // ç­›é€‰é¢˜åº“
        function filterQuestionBanks() {
            const filterCategory = document.getElementById('filterCategory').value;
            displayBankList(filterCategory);
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            showNotification('æ­£åœ¨åˆ·æ–°æ•°æ®...', 'info');
            loadQuestionBanks();
            setTimeout(() => {
                showNotification('æ•°æ®åˆ·æ–°å®Œæˆ', 'success');
            }, 1000);
        }

        // æ˜¾ç¤ºé¢˜åº“åˆ—è¡¨
        function displayBankList(filterCategory = '') {
            const bankList = document.getElementById('bankList');
            
            // ç­›é€‰é¢˜åº“
            let filteredBanks = questionBanks;
            if (filterCategory) {
                filteredBanks = questionBanks.filter(bank => bank.category === filterCategory);
            }
            
            if (filteredBanks.length === 0) {
                bankList.innerHTML = '<li style="text-align: center; color: #666; padding: 20px;">æš‚æ— é¢˜åº“</li>';
                return;
            }

            bankList.innerHTML = filteredBanks.map(bank => {
                const priorityBadge = bank.priority <= 3 ? '<span class="priority-badge">â­</span>' : '';
                const recommendedBadge = bank.recommended ? '<span class="recommended-badge">ğŸ”¥</span>' : '';
                const difficultyColor = {
                    'easy': '#28a745',
                    'medium': '#ffc107', 
                    'hard': '#dc3545'
                }[bank.difficulty] || '#6c757d';
                
                return `
                    <li class="bank-item" onclick="selectBank('${bank.id}')">
                        <div class="bank-header">
                            <div class="bank-name">
                                ${priorityBadge}${recommendedBadge}${bank.name}
                            </div>
                            <div class="bank-meta">
                                <span class="difficulty-badge" style="background: ${difficultyColor}">
                                    ${bank.difficulty === 'easy' ? 'ç®€å•' : bank.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾'}
                                </span>
                            </div>
                        </div>
                        <div class="bank-info">
                            <span class="question-count">ğŸ“Š ${bank.questionCount || 0} é¢˜</span>
                            <span class="category">ğŸ“‚ ${bank.category || 'æœªåˆ†ç±»'}</span>
                            <span class="update-time">ğŸ•’ ${new Date(bank.updateTime).toLocaleDateString()}</span>
                        </div>
                        <div class="bank-actions">
                            <button class="btn btn-sm" onclick="event.stopPropagation(); editBank('${bank.id}')" title="ç¼–è¾‘é¢˜åº“">
                                âœï¸
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteBank('${bank.id}')" title="åˆ é™¤é¢˜åº“">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </li>
                `;
            }).join('');
        }

        // é€‰æ‹©é¢˜åº“
        async function selectBank(bankId) {
            try {
                // ç§»é™¤ä¹‹å‰çš„activeçŠ¶æ€
                document.querySelectorAll('.bank-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // æ·»åŠ activeçŠ¶æ€åˆ°å½“å‰é€‰ä¸­çš„é¢˜åº“
                event.target.closest('.bank-item').classList.add('active');
                
                const bank = questionBanks.find(b => b.id === bankId);
                if (!bank) {
                    showNotification('é¢˜åº“ä¸å­˜åœ¨', 'error');
                    return;
                }

                currentBank = bank;
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('questionList').innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½é¢˜ç›®...</div>';
                
                let questions = [];
                
                // ä¼˜å…ˆä»GitHubå­˜å‚¨åŠ è½½
                if (window.GitHubStorage && window.GitHubStorage.isConnected) {
                    try {
                        console.log(`ğŸŒ å°è¯•ä»GitHubåŠ è½½é¢˜åº“: ${bank.filename}`);
                        const githubData = await window.GitHubStorage.loadData(`question-banks/${bank.filename}`);
                        
                        if (githubData && Array.isArray(githubData)) {
                            questions = githubData;
                            console.log(`âœ… ä»GitHubæˆåŠŸåŠ è½½é¢˜åº“: ${bank.filename}, é¢˜ç›®æ•°é‡: ${questions.length}`);
                        } else if (githubData && githubData.questions && Array.isArray(githubData.questions)) {
                            questions = githubData.questions;
                            console.log(`âœ… ä»GitHubæˆåŠŸåŠ è½½é¢˜åº“: ${bank.filename}, é¢˜ç›®æ•°é‡: ${questions.length}`);
                        }
                    } catch (githubError) {
                        console.warn(`âš ï¸ ä»GitHubåŠ è½½é¢˜åº“å¤±è´¥: ${bank.filename}`, githubError.message);
                    }
                }
                
                // å¦‚æœGitHubåŠ è½½å¤±è´¥ï¼Œä»æœ¬åœ°å­˜å‚¨åŠ è½½
                if (!questions || questions.length === 0) {
                    const storageKey = `bank_${bank.filename}`;
                    const storedData = localStorage.getItem(storageKey);
                    
                    if (storedData) {
                        // å¦‚æœæœ‰æœ¬åœ°å­˜å‚¨çš„æ•°æ®ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®
                        try {
                            questions = JSON.parse(storedData);
                            console.log(`ğŸ“¦ ä»æœ¬åœ°å­˜å‚¨åŠ è½½é¢˜åº“: ${bank.filename}, é¢˜ç›®æ•°é‡: ${questions.length}`);
                        } catch (error) {
                            console.error('è§£ææœ¬åœ°å­˜å‚¨æ•°æ®å¤±è´¥:', error);
                        }
                    }
                }
                
                // å¦‚æœæœ¬åœ°å­˜å‚¨ä¹Ÿæ²¡æœ‰æ•°æ®ï¼Œä»æœåŠ¡å™¨åŠ è½½
                if (!questions || questions.length === 0) {
                    console.log(`ğŸŒ ä»æœåŠ¡å™¨åŠ è½½é¢˜åº“: ${bank.filename}`);
                    const response = await fetch(`../question-banks/${bank.filename}`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const serverData = await response.json();
                    questions = Array.isArray(serverData) ? serverData : [];
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    const storageKey = `bank_${bank.filename}`;
                    localStorage.setItem(storageKey, JSON.stringify(questions));
                    console.log(`ğŸ’¾ é¢˜åº“æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨: ${bank.filename}`);
                }
                
                // ç¡®ä¿questionsæ˜¯æ•°ç»„
                currentBank.questions = questions;
                
                // æ›´æ–°ç•Œé¢
                document.getElementById('currentBankName').textContent = bank.name;
                document.getElementById('currentBankDesc').textContent = bank.description;
                
                // æ˜¾ç¤ºé¢˜åº“å·¥å…·æ 
                document.getElementById('bankToolbar').style.display = 'block';
                
                // éšè—æ€»ä½“ç»Ÿè®¡ï¼Œæ˜¾ç¤ºå•ä¸ªé¢˜åº“ç»Ÿè®¡
                document.getElementById('overallStats').style.display = 'none';
                document.getElementById('bankStats').style.display = 'grid';
                
                displayQuestions(currentBank.questions);
                updateStats(currentBank.questions);
                
            } catch (error) {
                console.error('åŠ è½½é¢˜åº“å¤±è´¥:', error);
                showNotification(`åŠ è½½é¢˜åº“å¤±è´¥: ${error.message}`, 'error');
                
                // æ¢å¤åˆ°åˆå§‹çŠ¶æ€
                document.getElementById('questionList').innerHTML = `
                    <div class="empty-state">
                        <i>âŒ</i>
                        <h3>åŠ è½½å¤±è´¥</h3>
                        <p>æ— æ³•åŠ è½½é¢˜åº“å†…å®¹ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p>
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºé¢˜ç›®åˆ—è¡¨
        function displayQuestions(questions) {
            const questionList = document.getElementById('questionList');
            
            if (!questions || questions.length === 0) {
                questionList.innerHTML = `
                    <div class="empty-state">
                        <i>ğŸ“</i>
                        <h3>æš‚æ— é¢˜ç›®</h3>
                        <p>ç‚¹å‡»"æ·»åŠ é¢˜ç›®"å¼€å§‹åˆ›å»ºç¬¬ä¸€é“é¢˜ç›®</p>
                    </div>
                `;
                return;
            }
            
            questionList.innerHTML = questions.map((question, index) => {
                const questionTitle = question.title || question.question || 'æœªå‘½åé¢˜ç›®';
                const questionType = question.type || 'é€‰æ‹©é¢˜';
                const difficulty = getDifficultyText(question.difficulty);
                const category = question.category || currentBank?.category || 'æœªåˆ†ç±»';
                
                // å¤„ç†æ ‡ç­¾
                let tagsHtml = '';
                if (question.tags && Array.isArray(question.tags)) {
                    tagsHtml = question.tags.map(tag => `<span class="meta-tag">${tag}</span>`).join('');
                }
                
                // æ˜¾ç¤ºé¢˜ç›®é¢„è§ˆï¼ˆå‰100ä¸ªå­—ç¬¦ï¼‰
                const preview = questionTitle.length > 100 ? questionTitle.substring(0, 100) + '...' : questionTitle;
                
                return `
                    <div class="question-item">
                        <div class="question-header">
                            <div class="question-title">${preview}</div>
                            <div class="question-actions">
                                <button class="btn" onclick="viewQuestion(${index})" title="æŸ¥çœ‹å®Œæ•´é¢˜ç›®">æŸ¥çœ‹</button>
                                <button class="btn" onclick="editQuestion(${index})" title="ç¼–è¾‘é¢˜ç›®">ç¼–è¾‘</button>
                                <button class="btn btn-danger" onclick="deleteQuestion(${index})" title="åˆ é™¤é¢˜ç›®">åˆ é™¤</button>
                            </div>
                        </div>
                        <div class="question-meta">
                            <span class="meta-tag">${questionType}</span>
                            <span class="meta-tag">${difficulty}</span>
                            <span class="meta-tag">${category}</span>
                            ${tagsHtml}
                        </div>
                        ${question.options && question.options.length > 0 ? `
                            <div class="question-preview" style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                é€‰é¡¹: ${question.options.slice(0, 2).join(' | ')}${question.options.length > 2 ? ' ...' : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // è·å–éš¾åº¦æ–‡æœ¬
        function getDifficultyText(difficulty) {
            switch(difficulty) {
                case 'easy': return 'ç®€å•';
                case 'medium': return 'ä¸­ç­‰';
                case 'hard': return 'å›°éš¾';
                default: return 'ä¸­ç­‰';
            }
        }

        // æ›´æ–°æ€»ä½“ç»Ÿè®¡ä¿¡æ¯
        function updateOverallStats() {
            const totalBanks = questionBanks.length;
            const totalQuestions = questionBanks.reduce((sum, bank) => sum + (bank.questionCount || 0), 0);
            const easyBanks = questionBanks.filter(bank => bank.difficulty === 'easy').length;
            const hardBanks = questionBanks.filter(bank => bank.difficulty === 'hard').length;
            
            document.getElementById('totalBanks').textContent = totalBanks;
            document.getElementById('totalQuestionsAll').textContent = totalQuestions;
            document.getElementById('easyBanks').textContent = easyBanks;
            document.getElementById('hardBanks').textContent = hardBanks;
        }
        
        // æ›´æ–°å•ä¸ªé¢˜åº“ç»Ÿè®¡ä¿¡æ¯
        function updateStats(questions) {
            const total = questions.length;
            const easy = questions.filter(q => q.difficulty === 'easy').length;
            const medium = questions.filter(q => q.difficulty === 'medium').length;
            const hard = questions.filter(q => q.difficulty === 'hard').length;
            
            document.getElementById('totalQuestions').textContent = total;
            document.getElementById('easyQuestions').textContent = easy;
            document.getElementById('mediumQuestions').textContent = medium;
            document.getElementById('hardQuestions').textContent = hard;
        }

        // åˆ›å»ºæ–°é¢˜åº“
        function createNewBank() {
            currentBank = null;
            document.getElementById('bankModalTitle').textContent = 'åˆ›å»ºæ–°é¢˜åº“';
            document.getElementById('bankName').value = '';
            document.getElementById('bankDescription').value = '';
            document.getElementById('bankCategory').value = 'æµä½“åŠ›å­¦åŸºç¡€';
            document.getElementById('bankModal').style.display = 'block';
        }

        // ç¼–è¾‘é¢˜åº“
        function editBank(bankId) {
            const bank = questionBanks.find(b => b.id === bankId);
            if (!bank) return;
            
            currentBank = bank;
            document.getElementById('bankModalTitle').textContent = 'ç¼–è¾‘é¢˜åº“';
            document.getElementById('bankName').value = bank.name;
            document.getElementById('bankDescription').value = bank.description || '';
            document.getElementById('bankCategory').value = bank.category || 'æµä½“åŠ›å­¦åŸºç¡€';
            document.getElementById('bankModal').style.display = 'block';
        }

        // ä¿å­˜é¢˜åº“ä¿¡æ¯
        function saveBankInfo(event) {
            event.preventDefault();
            
            const name = document.getElementById('bankName').value.trim();
            const description = document.getElementById('bankDescription').value.trim();
            const category = document.getElementById('bankCategory').value;
            
            if (!name) {
                showNotification('è¯·è¾“å…¥é¢˜åº“åç§°', 'warning');
                return;
            }

            const bankData = {
                id: currentBank ? currentBank.id : 'bank_' + Date.now(),
                name: name,
                description: description,
                category: category,
                filename: currentBank ? currentBank.filename : `${name}.json`,
                questionCount: currentBank ? currentBank.questionCount : 0,
                createTime: currentBank ? currentBank.createTime : new Date().toISOString(),
                updateTime: new Date().toISOString()
            };

            if (currentBank) {
                // æ›´æ–°ç°æœ‰é¢˜åº“
                const index = questionBanks.findIndex(b => b.id === currentBank.id);
                if (index !== -1) {
                    questionBanks[index] = bankData;
                }
            } else {
                // åˆ›å»ºæ–°é¢˜åº“
                questionBanks.push(bankData);
                // åˆ›å»ºç©ºçš„é¢˜ç›®æ–‡ä»¶
                saveBankQuestions(bankData, []);
            }

            // æ›´æ–°index.json
            updateBankIndex();
            displayBankList();
            closeBankModal();
            
            showNotification(currentBank ? 'é¢˜åº“æ›´æ–°æˆåŠŸ' : 'é¢˜åº“åˆ›å»ºæˆåŠŸ', 'success');
        }

        // å…³é—­é¢˜åº“æ¨¡æ€æ¡†
        function closeBankModal() {
            document.getElementById('bankModal').style.display = 'none';
        }

        // åˆ é™¤é¢˜åº“
        function deleteBank(bankId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¢˜åº“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }

            const index = questionBanks.findIndex(b => b.id === bankId);
            if (index !== -1) {
                questionBanks.splice(index, 1);
                updateBankIndex();
                displayBankList();
                
                                    // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰é€‰ä¸­çš„é¢˜åº“ï¼Œæ¸…ç©ºæ˜¾ç¤º
                    if (currentBank && currentBank.id === bankId) {
                        currentBank = null;
                        document.getElementById('currentBankName').textContent = 'è¯·é€‰æ‹©é¢˜åº“';
                        document.getElementById('questionList').innerHTML = `
                            <div class="empty-state">
                                <i>ğŸ“</i>
                                <h3>é€‰æ‹©é¢˜åº“å¼€å§‹ç®¡ç†</h3>
                                <p>ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªé¢˜åº“ï¼Œæˆ–åˆ›å»ºæ–°çš„é¢˜åº“æ¥å¼€å§‹ç®¡ç†é¢˜ç›®</p>
                            </div>
                        `;
                        // æ˜¾ç¤ºæ€»ä½“ç»Ÿè®¡ï¼Œéšè—å•ä¸ªé¢˜åº“ç»Ÿè®¡
                        document.getElementById('overallStats').style.display = 'grid';
                        document.getElementById('bankStats').style.display = 'none';
                        document.getElementById('addQuestionBtn').disabled = true;
                        document.getElementById('importBtn').disabled = true;
                        document.getElementById('exportBtn').disabled = true;
                    }
                
                showNotification('é¢˜åº“åˆ é™¤æˆåŠŸ', 'success');
            }
        }

        // æ·»åŠ é¢˜ç›®
        function addQuestion() {
            if (!currentBank) {
                showNotification('è¯·å…ˆé€‰æ‹©é¢˜åº“', 'warning');
                return;
            }
            
            currentQuestionId = null;
            document.getElementById('questionModalTitle').textContent = 'æ·»åŠ é¢˜ç›®';
            clearQuestionForm();
            updateQuestionForm();
            document.getElementById('questionModal').style.display = 'block';
        }

        // æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…
        function viewQuestion(index) {
            if (!currentBank || !currentBank.questions) return;
            
            const question = currentBank.questions[index];
            
            let optionsHtml = '';
            if (question.options && question.options.length > 0) {
                optionsHtml = question.options.map((option, i) => 
                    `<div style="margin-bottom: 8px;"><strong>${String.fromCharCode(65 + i)}.</strong> ${option}</div>`
                ).join('');
            }
            
            const content = `
                <div style="max-height: 400px; overflow-y: auto;">
                    <h4 style="color: #333; margin-bottom: 15px;">é¢˜ç›®å†…å®¹</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; line-height: 1.6;">
                        ${question.title || question.question || 'æ— é¢˜ç›®å†…å®¹'}
                    </div>
                    
                    ${optionsHtml ? `
                        <h4 style="color: #333; margin-bottom: 10px;">é€‰é¡¹</h4>
                        <div style="background: #fff; border: 1px solid #dee2e6; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            ${optionsHtml}
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                        <div><strong>ç±»å‹:</strong> ${question.type || 'é€‰æ‹©é¢˜'}</div>
                        <div><strong>éš¾åº¦:</strong> ${getDifficultyText(question.difficulty)}</div>
                        <div><strong>ç­”æ¡ˆ:</strong> ${question.answer || question.correct || 'æ— '}</div>
                    </div>
                    
                    ${question.explanation ? `
                        <h4 style="color: #333; margin-bottom: 10px;">è§£é‡Š</h4>
                        <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; line-height: 1.6;">
                            ${question.explanation}
                        </div>
                    ` : ''}
                </div>
            `;
            
            showModal('é¢˜ç›®è¯¦æƒ…', content);
        }
        
        // ç¼–è¾‘é¢˜ç›®
        function editQuestion(index) {
            if (!currentBank || !currentBank.questions) {
                showNotification('è¯·å…ˆé€‰æ‹©é¢˜åº“', 'warning');
                return;
            }
            
            const question = currentBank.questions[index];
            if (!question) {
                showNotification('é¢˜ç›®æ•°æ®ä¸å­˜åœ¨', 'error');
                return;
            }
            
            currentQuestionId = index;
            
            try {
                document.getElementById('questionModalTitle').textContent = 'ç¼–è¾‘é¢˜ç›®';
                document.getElementById('questionTitle').value = question.title || question.question || '';
                document.getElementById('questionType').value = question.type || 'é€‰æ‹©é¢˜';
                document.getElementById('questionDifficulty').value = question.difficulty || 'medium';
                document.getElementById('questionAnswer').value = question.answer || question.correct || '';
                document.getElementById('questionExplanation').value = question.explanation || '';
                document.getElementById('questionTags').value = question.tags ? question.tags.join(',') : '';
                
                // å¡«å……é€‰é¡¹
                if (question.options && Array.isArray(question.options)) {
                    document.getElementById('optionA').value = question.options[0] || '';
                    document.getElementById('optionB').value = question.options[1] || '';
                    document.getElementById('optionC').value = question.options[2] || '';
                    document.getElementById('optionD').value = question.options[3] || '';
                } else {
                    // æ¸…ç©ºé€‰é¡¹
                    document.getElementById('optionA').value = '';
                    document.getElementById('optionB').value = '';
                    document.getElementById('optionC').value = '';
                    document.getElementById('optionD').value = '';
                }
                
                updateQuestionForm();
                document.getElementById('questionModal').style.display = 'block';
                
                // æ˜¾ç¤ºç¼–è¾‘æˆåŠŸæç¤º
                showNotification(`æ­£åœ¨ç¼–è¾‘é¢˜ç›®: ${question.title || question.question || 'æ— æ ‡é¢˜'}`, 'info');
                
            } catch (error) {
                console.error('ç¼–è¾‘é¢˜ç›®æ—¶å‡ºé”™:', error);
                showNotification('ç¼–è¾‘é¢˜ç›®æ—¶å‡ºé”™: ' + error.message, 'error');
            }
        }

        // æ›´æ–°é¢˜ç›®è¡¨å•
        function updateQuestionForm() {
            const type = document.getElementById('questionType').value;
            const optionsSection = document.getElementById('optionsSection');
            
            if (type === 'é€‰æ‹©é¢˜') {
                optionsSection.style.display = 'block';
            } else {
                optionsSection.style.display = 'none';
            }
        }

        // æ¸…ç©ºé¢˜ç›®è¡¨å•
        function clearQuestionForm() {
            document.getElementById('questionTitle').value = '';
            document.getElementById('questionType').value = 'é€‰æ‹©é¢˜';
            document.getElementById('questionDifficulty').value = 'medium';
            document.getElementById('questionAnswer').value = '';
            document.getElementById('questionExplanation').value = '';
            document.getElementById('questionTags').value = '';
            document.getElementById('optionA').value = '';
            document.getElementById('optionB').value = '';
            document.getElementById('optionC').value = '';
            document.getElementById('optionD').value = '';
        }

        // ä¿å­˜é¢˜ç›®
        async function saveQuestion(event) {
            event.preventDefault();
            
            try {
                if (!currentBank) {
                    showNotification('è¯·å…ˆé€‰æ‹©é¢˜åº“', 'warning');
                    return;
                }

                const title = document.getElementById('questionTitle').value.trim();
                const type = document.getElementById('questionType').value;
                const difficulty = document.getElementById('questionDifficulty').value;
                const answer = document.getElementById('questionAnswer').value.trim();
                const explanation = document.getElementById('questionExplanation').value.trim();
                const tags = document.getElementById('questionTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);

                if (!title) {
                    showNotification('è¯·å¡«å†™é¢˜ç›®å†…å®¹', 'warning');
                    return;
                }

                if (!answer) {
                    showNotification('è¯·å¡«å†™æ­£ç¡®ç­”æ¡ˆ', 'warning');
                    return;
                }

            const questionData = {
                id: currentQuestionId !== null ? currentBank.questions[currentQuestionId].id : 'q_' + Date.now(),
                title: title,
                question: title, // å…¼å®¹æ€§
                type: type,
                difficulty: difficulty,
                category: currentBank.category,
                answer: answer,
                correct: answer, // å…¼å®¹æ€§
                explanation: explanation,
                tags: tags,
                createTime: currentQuestionId !== null ? currentBank.questions[currentQuestionId].createTime : new Date().toISOString(),
                updateTime: new Date().toISOString()
            };

            // å¦‚æœæ˜¯é€‰æ‹©é¢˜ï¼Œæ·»åŠ é€‰é¡¹
            if (type === 'é€‰æ‹©é¢˜') {
                const options = [
                    document.getElementById('optionA').value.trim(),
                    document.getElementById('optionB').value.trim(),
                    document.getElementById('optionC').value.trim(),
                    document.getElementById('optionD').value.trim()
                ].filter(option => option);
                
                if (options.length < 2) {
                    showNotification('é€‰æ‹©é¢˜è‡³å°‘éœ€è¦2ä¸ªé€‰é¡¹', 'warning');
                    return;
                }
                
                questionData.options = options;
            }

            if (!currentBank.questions) {
                currentBank.questions = [];
            }

            if (currentQuestionId !== null) {
                // æ›´æ–°ç°æœ‰é¢˜ç›®
                currentBank.questions[currentQuestionId] = questionData;
            } else {
                // æ·»åŠ æ–°é¢˜ç›®
                currentBank.questions.push(questionData);
            }

                // æ›´æ–°é¢˜åº“æ–‡ä»¶
                await saveBankQuestions(currentBank, currentBank.questions);
                
                // æ›´æ–°é¢˜åº“çš„é¢˜ç›®æ•°é‡
                const bankIndex = questionBanks.findIndex(b => b.id === currentBank.id);
                if (bankIndex !== -1) {
                    questionBanks[bankIndex].questionCount = currentBank.questions.length;
                    questionBanks[bankIndex].updateTime = new Date().toISOString();
                }
                
                updateBankIndex();
                displayQuestions(currentBank.questions);
                updateStats(currentBank.questions);
                displayBankList();
                closeQuestionModal();
                
                showNotification(currentQuestionId !== null ? 'é¢˜ç›®æ›´æ–°æˆåŠŸ' : 'é¢˜ç›®æ·»åŠ æˆåŠŸ', 'success');
                
            } catch (error) {
                console.error('ä¿å­˜é¢˜ç›®æ—¶å‡ºé”™:', error);
                showNotification('ä¿å­˜é¢˜ç›®æ—¶å‡ºé”™: ' + error.message, 'error');
            }
        }

        // å…³é—­é¢˜ç›®æ¨¡æ€æ¡†
        function closeQuestionModal() {
            document.getElementById('questionModal').style.display = 'none';
        }

        // åˆ é™¤é¢˜ç›®
        function deleteQuestion(index) {
            if (!currentBank || !currentBank.questions) return;
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿ')) {
                return;
            }

            currentBank.questions.splice(index, 1);
            
            // æ›´æ–°é¢˜åº“æ–‡ä»¶
            saveBankQuestions(currentBank, currentBank.questions);
            
            // æ›´æ–°é¢˜åº“çš„é¢˜ç›®æ•°é‡
            const bankIndex = questionBanks.findIndex(b => b.id === currentBank.id);
            if (bankIndex !== -1) {
                questionBanks[bankIndex].questionCount = currentBank.questions.length;
                questionBanks[bankIndex].updateTime = new Date().toISOString();
            }
            
            updateBankIndex();
            displayQuestions(currentBank.questions);
            updateStats(currentBank.questions);
            displayBankList();
            
            showNotification('é¢˜ç›®åˆ é™¤æˆåŠŸ', 'success');
        }

        // æœç´¢é¢˜åº“
        function searchBanks() {
            const searchTerm = document.getElementById('bankSearch').value.toLowerCase().trim();
            const bankItems = document.querySelectorAll('.bank-item');
            
            bankItems.forEach(item => {
                const bankName = item.querySelector('.bank-name').textContent.toLowerCase();
                if (bankName.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // å¯¼å‡ºé¢˜åº“
        function exportBank() {
            if (!currentBank || !currentBank.questions) {
                showNotification('æ²¡æœ‰å¯å¯¼å‡ºçš„é¢˜åº“', 'warning');
                return;
            }

            const data = {
                bank: currentBank,
                questions: currentBank.questions,
                exportTime: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentBank.name}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('é¢˜åº“å¯¼å‡ºæˆåŠŸ', 'success');
        }

        // å¯¼å…¥é¢˜ç›®
        function importQuestions() {
            if (!currentBank) {
                showNotification('è¯·å…ˆé€‰æ‹©é¢˜åº“', 'warning');
                return;
            }

            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        let questions = [];

                        if (data.questions) {
                            questions = data.questions;
                        } else if (Array.isArray(data)) {
                            questions = data;
                        } else {
                            throw new Error('æ— æ•ˆçš„æ–‡ä»¶æ ¼å¼');
                        }

                        if (!Array.isArray(questions) || questions.length === 0) {
                            showNotification('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„é¢˜ç›®æ•°æ®', 'warning');
                            return;
                        }

                        // æ·»åŠ åˆ°å½“å‰é¢˜åº“
                        if (!currentBank.questions) {
                            currentBank.questions = [];
                        }

                        const importedCount = questions.length;
                        currentBank.questions.push(...questions);

                        // æ›´æ–°é¢˜åº“æ–‡ä»¶
                        saveBankQuestions(currentBank, currentBank.questions);
                        
                        // æ›´æ–°é¢˜åº“ä¿¡æ¯
                        const bankIndex = questionBanks.findIndex(b => b.id === currentBank.id);
                        if (bankIndex !== -1) {
                            questionBanks[bankIndex].questionCount = currentBank.questions.length;
                            questionBanks[bankIndex].updateTime = new Date().toISOString();
                        }
                        
                        updateBankIndex();
                        displayQuestions(currentBank.questions);
                        updateStats(currentBank.questions);
                        displayBankList();
                        
                        showNotification(`æˆåŠŸå¯¼å…¥ ${importedCount} é“é¢˜ç›®`, 'success');

                    } catch (error) {
                        console.error('å¯¼å…¥å¤±è´¥:', error);
                        showNotification('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œå¯¼å…¥å¤±è´¥', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // æ›´æ–°é¢˜åº“ç´¢å¼•
        function updateBankIndex() {
            const indexData = {
                version: "1.0",
                lastUpdated: new Date().toISOString().split('T')[0],
                questionBanks: questionBanks,
                categories: [
                    { id: "basics", name: "åŸºç¡€æ¦‚å¿µ", description: "æµä½“åŠ›å­¦åŸºç¡€æ¦‚å¿µå’ŒåŸç†" },
                    { id: "theory", name: "åŸºç¡€ç†è®º", description: "æµä½“åŠ›å­¦åŸºæœ¬ç†è®ºå’Œæ–¹ç¨‹" },
                    { id: "advanced", name: "é«˜çº§ç†è®º", description: "å¤æ‚æµåŠ¨å’Œé«˜çº§ç†è®º" },
                    { id: "application", name: "ä¸“é¢˜åº”ç”¨", description: "ç‰¹å®šé¢†åŸŸçš„åº”ç”¨é¢˜ç›®" },
                    { id: "exam", name: "çœŸé¢˜", description: "å†å¹´è€ƒè¯•çœŸé¢˜" }
                ],
                statistics: {
                    totalBanks: questionBanks.length,
                    totalQuestions: questionBanks.reduce((sum, bank) => sum + (bank.questionCount || 0), 0),
                    lastUpdated: new Date().toISOString().split('T')[0]
                }
            };
            
            // ç”±äºæ˜¯é™æ€ç½‘ç«™ï¼Œæä¾›ä¸‹è½½æ›´æ–°åçš„ç´¢å¼•æ–‡ä»¶
            downloadFile(JSON.stringify(indexData, null, 2), 'index.json', 'application/json');
            showNotification('é¢˜åº“ç´¢å¼•å·²ç”Ÿæˆï¼Œè¯·æ›¿æ¢question-banks/index.jsonæ–‡ä»¶', 'info');
        }

        // ä¿å­˜é¢˜åº“é¢˜ç›®
        async function saveBankQuestions(bank, questions) {
            try {
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                const storageKey = `bank_${bank.filename}`;
                localStorage.setItem(storageKey, JSON.stringify(questions));
                
                // æ›´æ–°å†…å­˜ä¸­çš„æ•°æ®
                const bankIndex = questionBanks.findIndex(b => b.filename === bank.filename);
                if (bankIndex !== -1) {
                    questionBanks[bankIndex].questions = questions;
                    questionBanks[bankIndex].questionCount = questions.length;
                    questionBanks[bankIndex].updateTime = new Date().toISOString();
                }
                
                // ç”±äºæ˜¯é™æ€ç½‘ç«™ï¼Œæä¾›ä¸‹è½½é¢˜åº“æ–‡ä»¶
                downloadFile(JSON.stringify(questions, null, 2), bank.filename, 'application/json');
                showNotification(`é¢˜åº“å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼Œæ–‡ä»¶å·²ä¸‹è½½ï¼š${bank.filename}`, 'success');
                
                console.log(`âœ… é¢˜åº“ä¿å­˜æˆåŠŸ: ${bank.filename}, é¢˜ç›®æ•°é‡: ${questions.length}`);
                
            } catch (error) {
                console.error('ä¿å­˜é¢˜åº“æ—¶å‡ºé”™:', error);
                showNotification('ä¿å­˜é¢˜åº“æ—¶å‡ºé”™: ' + error.message, 'error');
            }
        }

        // ä¸‹è½½æ–‡ä»¶å·¥å…·å‡½æ•°
        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æ˜¾ç¤ºé€šç”¨æ¨¡æ€æ¡†
        function showModal(title, content, actions = null) {
            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${title}</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                        ${content}
                    </div>
                    ${actions ? `<div class="modal-footer" style="text-align: right; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">${actions}</div>` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeModal(modal.querySelector('.close-btn'));
                }
            };
        }
        
        // å…³é—­é€šç”¨æ¨¡æ€æ¡†
        function closeModal(button) {
            const modal = button.closest('.modal');
            if (modal && modal.parentNode) {
                modal.parentNode.removeChild(modal);
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // è‡ªåŠ¨éšè—
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const bankModal = document.getElementById('bankModal');
            const questionModal = document.getElementById('questionModal');
            
            if (event.target === bankModal) {
                closeBankModal();
            } else if (event.target === questionModal) {
                closeQuestionModal();
            }
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 'n':
                        event.preventDefault();
                        if (currentBank) {
                            addQuestion();
                        } else {
                            createNewBank();
                        }
                        break;
                    case 's':
                        event.preventDefault();
                        if (currentBank) {
                            exportBank();
                        }
                        break;
                }
            }
            
            if (event.key === 'Escape') {
                closeBankModal();
                closeQuestionModal();
            }
        });
    </script>
</body>
</html> 