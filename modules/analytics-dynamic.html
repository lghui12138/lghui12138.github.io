<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š å­¦ä¹ åˆ†æ - æµä½“åŠ›å­¦å­¦ä¹ å¹³å°</title>
    
    <!-- å¤–éƒ¨ä¾èµ– -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- å…±äº«ç»„ä»¶åº“ -->
    <script src="../js/shared-components.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
            margin: 0;
            font-family: 'SF Pro Display', sans-serif;
            color: white;
        }

        .analytics-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .analytics-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            color: #333;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .metric-card {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, #8e44ad, #3498db);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .metric-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .metric-change {
            font-size: 0.9em;
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 10px;
            display: inline-block;
        }

        .metric-up {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .metric-down {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .tab-container {
            margin-bottom: 30px;
        }

        .tab-buttons {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: white;
            color: #333;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .progress-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #8e44ad;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-title {
            font-weight: bold;
            color: #2c3e50;
        }

        .progress-score {
            font-weight: bold;
            color: #8e44ad;
        }

        .progress-bar-container {
            background: #e9ecef;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #8e44ad, #3498db);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #666;
        }

        .weakness-item {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .weakness-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
        }

        .weakness-description {
            color: #856404;
            font-size: 0.9em;
        }

        .recommendation-item {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .recommendation-title {
            font-weight: bold;
            color: #155724;
            margin-bottom: 8px;
        }

        .recommendation-description {
            color: #155724;
            font-size: 0.9em;
        }

        .time-range-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .time-btn {
            padding: 8px 16px;
            border: 2px solid rgba(255,255,255,0.3);
            background: transparent;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-btn.active {
            background: white;
            color: #333;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .achievement-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: white;
            transform: scale(1.05);
        }

        .achievement-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .achievement-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .achievement-description {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .study-streak {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .streak-number {
            font-size: 4em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .streak-label {
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .streak-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
        }

        .calendar-day.active {
            background: rgba(255,255,255,0.8);
            color: #333;
        }
    </style>
</head>
<body>
    <div id="analyticsApp">
        <!-- æµ·æ´‹èƒŒæ™¯ -->
        <ocean-background></ocean-background>

        <!-- é€šçŸ¥ç»„ä»¶ -->
        <notification-component :notification="notification" @close="notification = ''"></notification-component>

        <!-- åŠ è½½åŠ¨ç”» -->
        <loading-spinner :show="loading" text="æ­£åœ¨åˆ†æå­¦ä¹ æ•°æ®..."></loading-spinner>

        <div class="analytics-container" v-if="!loading">
            <!-- é¡µé¢å¤´éƒ¨ -->
            <header style="text-align: center; padding: 40px 0; margin-bottom: 30px;">
                <h1><i class="fas fa-chart-line"></i> å­¦ä¹ åˆ†æ</h1>
                <p>æ·±åº¦åˆ†ææ‚¨çš„å­¦ä¹ æ•°æ®ï¼Œæä¾›ä¸ªæ€§åŒ–æ”¹è¿›å»ºè®®</p>
            </header>

            <!-- æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ -->
            <div class="time-range-selector">
                <button 
                    v-for="range in timeRanges" 
                    :key="range.value"
                    class="time-btn"
                    :class="{ active: selectedTimeRange === range.value }"
                    @click="switchTimeRange(range.value)"
                >
                    {{ range.label }}
                </button>
            </div>

            <!-- æ ¸å¿ƒæŒ‡æ ‡ -->
            <div class="dashboard-grid">
                <div class="metric-card">
                    <div class="metric-number">{{ metrics.totalScore }}</div>
                    <div class="metric-label">ç»¼åˆå¾—åˆ†</div>
                    <div class="metric-change metric-up">
                        <i class="fas fa-arrow-up"></i> +{{ metrics.scoreChange }}
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-number">{{ metrics.practiceCount }}</div>
                    <div class="metric-label">ç»ƒä¹ æ¬¡æ•°</div>
                    <div class="metric-change metric-up">
                        <i class="fas fa-arrow-up"></i> +{{ metrics.practiceChange }}
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-number">{{ metrics.studyTime }}h</div>
                    <div class="metric-label">å­¦ä¹ æ—¶é•¿</div>
                    <div class="metric-change metric-up">
                        <i class="fas fa-arrow-up"></i> +{{ metrics.timeChange }}h
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-number">{{ metrics.accuracy }}%</div>
                    <div class="metric-label">æ­£ç¡®ç‡</div>
                    <div class="metric-change" :class="metrics.accuracyChange >= 0 ? 'metric-up' : 'metric-down'">
                        <i :class="metrics.accuracyChange >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>
                        {{ metrics.accuracyChange >= 0 ? '+' : '' }}{{ metrics.accuracyChange }}%
                    </div>
                </div>
            </div>

            <!-- åŠŸèƒ½æ ‡ç­¾é¡µ -->
            <div class="tab-container">
                <div class="tab-buttons">
                    <button 
                        v-for="tab in tabs" 
                        :key="tab.id"
                        class="tab-btn"
                        :class="{ active: activeTab === tab.id }"
                        @click="switchTab(tab.id)"
                    >
                        <i :class="tab.icon"></i> {{ tab.name }}
                    </button>
                </div>

                <!-- å­¦ä¹ è¿›åº¦ -->
                <div class="tab-content" :class="{ active: activeTab === 'progress' }">
                    <div class="analytics-card">
                        <h3><i class="fas fa-tasks"></i> å­¦ä¹ è¿›åº¦åˆ†æ</h3>
                        
                        <div v-for="subject in progressData" :key="subject.id" class="progress-item">
                            <div class="progress-header">
                                <div class="progress-title">{{ subject.name }}</div>
                                <div class="progress-score">{{ subject.score }}åˆ†</div>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" :style="{ width: subject.progress + '%' }"></div>
                            </div>
                            <div class="progress-details">
                                <span>å®Œæˆåº¦: {{ subject.progress }}%</span>
                                <span>ç»ƒä¹ : {{ subject.practiced }}/{{ subject.total }}é¢˜</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æˆç»©è¶‹åŠ¿ -->
                <div class="tab-content" :class="{ active: activeTab === 'trends' }">
                    <div class="analytics-card">
                        <h3><i class="fas fa-chart-line"></i> æˆç»©è¶‹åŠ¿å›¾</h3>
                        <div class="chart-container">
                            <canvas ref="trendsChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3><i class="fas fa-pie-chart"></i> çŸ¥è¯†ç‚¹æŒæ¡åº¦</h3>
                        <div class="chart-container">
                            <canvas ref="masteryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- è–„å¼±ç¯èŠ‚ -->
                <div class="tab-content" :class="{ active: activeTab === 'weaknesses' }">
                    <div class="analytics-card">
                        <h3><i class="fas fa-exclamation-triangle"></i> è–„å¼±çŸ¥è¯†ç‚¹</h3>
                        
                        <div v-for="weakness in weaknesses" :key="weakness.id" class="weakness-item">
                            <div class="weakness-title">
                                <i class="fas fa-exclamation-circle"></i> {{ weakness.topic }}
                            </div>
                            <div class="weakness-description">
                                æ­£ç¡®ç‡: {{ weakness.accuracy }}% | 
                                é”™è¯¯æ¬¡æ•°: {{ weakness.errorCount }} | 
                                å»ºè®®: {{ weakness.suggestion }}
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3><i class="fas fa-lightbulb"></i> å­¦ä¹ å»ºè®®</h3>
                        
                        <div v-for="recommendation in recommendations" :key="recommendation.id" class="recommendation-item">
                            <div class="recommendation-title">
                                <i class="fas fa-star"></i> {{ recommendation.title }}
                            </div>
                            <div class="recommendation-description">
                                {{ recommendation.description }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å­¦ä¹ æˆå°± -->
                <div class="tab-content" :class="{ active: activeTab === 'achievements' }">
                    <div class="analytics-card">
                        <h3><i class="fas fa-trophy"></i> å­¦ä¹ æˆå°±</h3>
                        
                        <div class="study-streak">
                            <div class="streak-number">{{ studyStreak }}</div>
                            <div class="streak-label">è¿ç»­å­¦ä¹ å¤©æ•°</div>
                            <div>ä¿æŒå­¦ä¹ ä¹ æƒ¯ï¼Œç»§ç»­åŠ æ²¹ï¼</div>
                            
                            <div class="streak-calendar">
                                <div 
                                    v-for="day in recentDays" 
                                    :key="day.date"
                                    class="calendar-day"
                                    :class="{ active: day.studied }"
                                >
                                    {{ day.day }}
                                </div>
                            </div>
                        </div>
                        
                        <div class="achievement-grid">
                            <div 
                                v-for="achievement in achievements" 
                                :key="achievement.id"
                                class="achievement-item"
                                :class="{ unlocked: achievement.unlocked }"
                            >
                                <div class="achievement-icon">{{ achievement.icon }}</div>
                                <div class="achievement-title">{{ achievement.title }}</div>
                                <div class="achievement-description">{{ achievement.description }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            mixins: [SharedMixin],
            components: {
                'ocean-background': OceanBackground,
                'notification-component': NotificationComponent,
                'loading-spinner': LoadingSpinner
            },
            data() {
                return {
                    activeTab: 'progress',
                    selectedTimeRange: '7d',
                    timeRanges: [
                        { value: '7d', label: 'è¿‘7å¤©' },
                        { value: '30d', label: 'è¿‘30å¤©' },
                        { value: '90d', label: 'è¿‘3ä¸ªæœˆ' },
                        { value: 'all', label: 'å…¨éƒ¨' }
                    ],
                    tabs: [
                        { id: 'progress', name: 'å­¦ä¹ è¿›åº¦', icon: 'fas fa-tasks' },
                        { id: 'trends', name: 'æˆç»©è¶‹åŠ¿', icon: 'fas fa-chart-line' },
                        { id: 'weaknesses', name: 'è–„å¼±ç¯èŠ‚', icon: 'fas fa-exclamation-triangle' },
                        { id: 'achievements', name: 'å­¦ä¹ æˆå°±', icon: 'fas fa-trophy' }
                    ],
                    metrics: {
                        totalScore: 85,
                        scoreChange: 5,
                        practiceCount: 126,
                        practiceChange: 15,
                        studyTime: 24,
                        timeChange: 3,
                        accuracy: 78,
                        accuracyChange: 2
                    },
                    progressData: [
                        {
                            id: 1,
                            name: 'æµä½“é™åŠ›å­¦',
                            progress: 85,
                            score: 88,
                            practiced: 34,
                            total: 40
                        },
                        {
                            id: 2,
                            name: 'æµä½“è¿åŠ¨å­¦',
                            progress: 72,
                            score: 76,
                            practiced: 29,
                            total: 40
                        },
                        {
                            id: 3,
                            name: 'æµä½“åŠ¨åŠ›å­¦',
                            progress: 65,
                            score: 71,
                            practiced: 26,
                            total: 40
                        },
                        {
                            id: 4,
                            name: 'ç²˜æ€§æµåŠ¨',
                            progress: 58,
                            score: 64,
                            practiced: 23,
                            total: 40
                        }
                    ],
                    weaknesses: [
                        {
                            id: 1,
                            topic: 'ä¼¯åŠªåˆ©æ–¹ç¨‹åº”ç”¨',
                            accuracy: 45,
                            errorCount: 8,
                            suggestion: 'é‡ç‚¹å¤ä¹ èƒ½é‡å®ˆæ’åŸç†å’Œåº”ç”¨æ¡ä»¶'
                        },
                        {
                            id: 2,
                            topic: 'é›·è¯ºæ•°è®¡ç®—',
                            accuracy: 52,
                            errorCount: 6,
                            suggestion: 'åŠ å¼ºé‡çº²åˆ†æå’Œæ•°å€¼è®¡ç®—ç»ƒä¹ '
                        },
                        {
                            id: 3,
                            topic: 'å‹å¼ºåˆ†å¸ƒè§„å¾‹',
                            accuracy: 61,
                            errorCount: 5,
                            suggestion: 'ç†è§£é™åŠ›å­¦åŸºæœ¬æ–¹ç¨‹çš„ç‰©ç†æ„ä¹‰'
                        }
                    ],
                    recommendations: [
                        {
                            id: 1,
                            title: 'é‡ç‚¹æ”»å…‹èƒ½é‡æ–¹ç¨‹',
                            description: 'å»ºè®®æ¯å¤©ç»ƒä¹ 2-3é“ä¼¯åŠªåˆ©æ–¹ç¨‹ç›¸å…³é¢˜ç›®ï¼Œå¹¶è§‚çœ‹ç›¸å…³è§†é¢‘è¯¾ç¨‹'
                        },
                        {
                            id: 2,
                            title: 'åŠ å¼ºæ¦‚å¿µç†è§£',
                            description: 'å»ºè®®ä½¿ç”¨AIåŠ©æ‰‹å¤šé—®ä¸€äº›æ¦‚å¿µæ€§é—®é¢˜ï¼Œæ·±åŒ–ç†è®ºç†è§£'
                        },
                        {
                            id: 3,
                            title: 'ä¿æŒç»ƒä¹ é¢‘ç‡',
                            description: 'å½“å‰å­¦ä¹ è¿›åº¦è‰¯å¥½ï¼Œå»ºè®®ä¿æŒæ¯å¤©30åˆ†é’Ÿçš„ç»ƒä¹ æ—¶é—´'
                        }
                    ],
                    studyStreak: 12,
                    recentDays: [
                        { date: '2024-01-09', day: '9', studied: true },
                        { date: '2024-01-10', day: '10', studied: true },
                        { date: '2024-01-11', day: '11', studied: false },
                        { date: '2024-01-12', day: '12', studied: true },
                        { date: '2024-01-13', day: '13', studied: true },
                        { date: '2024-01-14', day: '14', studied: true },
                        { date: '2024-01-15', day: '15', studied: true }
                    ],
                    achievements: [
                        {
                            id: 1,
                            title: 'åˆå‡ºèŒ…åº',
                            description: 'å®Œæˆé¦–æ¬¡ç»ƒä¹ ',
                            icon: 'ğŸ¯',
                            unlocked: true
                        },
                        {
                            id: 2,
                            title: 'å‹¤å¥‹å­¦è€…',
                            description: 'è¿ç»­å­¦ä¹ 7å¤©',
                            icon: 'ğŸ“š',
                            unlocked: true
                        },
                        {
                            id: 3,
                            title: 'ç™¾é¢˜æ–©',
                            description: 'å®Œæˆ100é“é¢˜ç›®',
                            icon: 'ğŸ’¯',
                            unlocked: true
                        },
                        {
                            id: 4,
                            title: 'ç²¾ç›Šæ±‚ç²¾',
                            description: 'å•æ¬¡ç»ƒä¹ 90åˆ†ä»¥ä¸Š',
                            icon: 'â­',
                            unlocked: false
                        },
                        {
                            id: 5,
                            title: 'å­¦éœ¸æ¨¡å¼',
                            description: 'è¿ç»­å­¦ä¹ 30å¤©',
                            icon: 'ğŸ†',
                            unlocked: false
                        },
                        {
                            id: 6,
                            title: 'æµä½“å¤§å¸ˆ',
                            description: 'æ‰€æœ‰æ¨¡å—85åˆ†ä»¥ä¸Š',
                            icon: 'ğŸ‘‘',
                            unlocked: false
                        }
                    ]
                }
            },
            methods: {
                switchTab(tabId) {
                    this.activeTab = tabId;
                    if (tabId === 'trends') {
                        this.$nextTick(() => {
                            this.initCharts();
                        });
                    }
                },
                
                switchTimeRange(range) {
                    this.selectedTimeRange = range;
                    this.loadAnalyticsData(range);
                },
                
                loadAnalyticsData(range) {
                    // æ ¹æ®æ—¶é—´èŒƒå›´åŠ è½½ä¸åŒçš„æ•°æ®
                    this.showNotification(`å·²åˆ‡æ¢åˆ°${range}çš„æ•°æ®è§†å›¾`, 'info');
                },
                
                initCharts() {
                    this.initTrendsChart();
                    this.initMasteryChart();
                },
                
                initTrendsChart() {
                    const ctx = this.$refs.trendsChart?.getContext('2d');
                    if (!ctx) return;
                    
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['ç¬¬1å‘¨', 'ç¬¬2å‘¨', 'ç¬¬3å‘¨', 'ç¬¬4å‘¨', 'ç¬¬5å‘¨', 'ç¬¬6å‘¨', 'ç¬¬7å‘¨', 'ç¬¬8å‘¨'],
                            datasets: [{
                                label: 'ç»ƒä¹ æˆç»©',
                                data: [65, 68, 72, 75, 78, 76, 82, 85],
                                borderColor: '#8e44ad',
                                backgroundColor: 'rgba(142, 68, 173, 0.1)',
                                tension: 0.4,
                                fill: true
                            }, {
                                label: 'æ­£ç¡®ç‡',
                                data: [60, 65, 70, 72, 75, 73, 78, 78],
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'å­¦ä¹ æˆç»©å˜åŒ–è¶‹åŠ¿'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                },
                
                initMasteryChart() {
                    const ctx = this.$refs.masteryChart?.getContext('2d');
                    if (!ctx) return;
                    
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['æµä½“é™åŠ›å­¦', 'æµä½“è¿åŠ¨å­¦', 'æµä½“åŠ¨åŠ›å­¦', 'ç²˜æ€§æµåŠ¨'],
                            datasets: [{
                                data: [85, 72, 65, 58],
                                backgroundColor: [
                                    '#27ae60',
                                    '#3498db',
                                    '#f39c12',
                                    '#e74c3c'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'å„çŸ¥è¯†ç‚¹æŒæ¡åº¦åˆ†å¸ƒ'
                                },
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
            },
            
            mounted() {
                console.log('ğŸ“Š å­¦ä¹ åˆ†ææ¨¡å—å¯åŠ¨ï¼');
                this.setLoading(true);
                
                setTimeout(() => {
                    this.setLoading(false);
                    this.showNotification('å­¦ä¹ æ•°æ®åˆ†æå®Œæˆï¼', 'success');
                }, 1800);
            }
        }).mount('#analyticsApp');
    </script>
</body>
</html> 