<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏆 历年真题 - 流体力学学习平台</title>
    
    <!-- 外部依赖 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- 共享组件库 -->
    <script src="../js/shared-components.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            margin: 0;
            font-family: 'SF Pro Display', sans-serif;
            color: white;
        }

        .exams-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .year-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .year-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            color: #333;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .year-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .year-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f39c12;
        }

        .year-title {
            font-size: 2em;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 10px;
        }

        .year-subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .exam-list {
            margin-bottom: 25px;
        }

        .exam-item {
            background: #f8f9fa;
            border-left: 4px solid #f39c12;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .exam-item:hover {
            background: #e9ecef;
            border-left-color: #e67e22;
        }

        .exam-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .exam-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }

        .exam-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            flex: 1;
        }

        .stat-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #f39c12;
        }

        .stat-label {
            font-size: 0.8em;
            color: #666;
        }

        .exam-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-practice {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-analysis {
            background: #3498db;
            color: white;
        }

        .btn-download {
            background: #2ecc71;
            color: white;
        }
        
        .btn-manage {
            background: #f39c12;
            color: white;
        }

        .filter-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            color: #333;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .filter-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
        }

        .filter-select:focus {
            border-color: #f39c12;
            outline: none;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .difficulty-easy {
            background: #d4edda;
            color: #155724;
        }

        .difficulty-medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty-hard {
            background: #f8d7da;
            color: #721c24;
        }

        .year-badge {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .progress-indicator {
            background: #f0f0f0;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            transition: width 0.3s ease;
        }

        .exam-tips {
            background: #e8f4fd;
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .tips-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #3498db;
        }

        .tips-list {
            list-style: none;
            padding: 0;
        }

        .tips-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .tips-list li:before {
            content: "💡";
            position: absolute;
            left: 0;
        }

        .search-box {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .search-box:focus {
            border-color: #f39c12;
            outline: none;
        }
    </style>
</head>
<body>
    <div id="realExamsApp">
        <!-- 海洋背景 -->
        <ocean-background></ocean-background>

        <!-- 通知组件 -->
        <notification-component :notification="notification" @close="notification = ''"></notification-component>

        <!-- 加载动画 -->
        <loading-spinner :show="loading" text="正在加载历年真题..."></loading-spinner>

        <div class="exams-container" v-if="!loading">
            <!-- 页面头部 -->
            <header style="text-align: center; padding: 40px 0; margin-bottom: 30px;">
                <h1><i class="fas fa-medal"></i> 历年真题</h1>
                <p>中国海洋大学803流体力学历年真题集，权威题源，考点分析</p>
            </header>

            <!-- 学习建议 -->
            <div class="exam-tips">
                <div class="tips-title"><i class="fas fa-lightbulb"></i> 真题学习建议</div>
                <ul class="tips-list">
                    <li>按年份顺序练习，了解考试趋势和重点变化</li>
                    <li>先做题再看解析，培养独立思考能力</li>
                    <li>重点关注错题和不熟悉的概念</li>
                    <li>总结高频考点和常见题型</li>
                    <li>模拟真实考试环境，控制答题时间</li>
                </ul>
            </div>

            <!-- 筛选面板 -->
            <div class="filter-panel">
                <h3><i class="fas fa-filter"></i> 真题筛选</h3>
                
                <input 
                    v-model="searchKeyword" 
                    class="search-box" 
                    placeholder="搜索题目关键词..."
                    @input="filterExams"
                >

                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">年份范围：</label>
                        <select v-model="filters.yearRange" @change="filterExams" class="filter-select">
                            <option value="all">全部年份</option>
                            <option value="recent">近3年(2021-2023)</option>
                            <option value="2020s">2020年代</option>
                            <option value="2010s">2010年代</option>
                            <option value="2000s">2000年代</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">题目类型：</label>
                        <select v-model="filters.questionType" @change="filterExams" class="filter-select">
                            <option value="all">全部类型</option>
                            <option value="choice">选择题</option>
                            <option value="calculation">计算题</option>
                            <option value="analysis">分析题</option>
                            <option value="proof">证明题</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">难度等级：</label>
                        <select v-model="filters.difficulty" @change="filterExams" class="filter-select">
                            <option value="all">全部难度</option>
                            <option value="easy">简单</option>
                            <option value="medium">中等</option>
                            <option value="hard">困难</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">知识点：</label>
                        <select v-model="filters.topic" @change="filterExams" class="filter-select">
                            <option value="all">全部知识点</option>
                            <option value="statics">流体静力学</option>
                            <option value="kinematics">流体运动学</option>
                            <option value="dynamics">流体动力学</option>
                            <option value="viscous">粘性流动</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 年份试卷列表 -->
            <div class="year-grid">
                <div v-for="yearData in filteredExams" :key="yearData.year" class="year-card">
                    <div class="year-header">
                        <div class="year-title">{{ yearData.year }}年</div>
                        <div class="year-subtitle">{{ yearData.semester }}</div>
                        <div style="margin-top: 10px;">
                            <span class="year-badge">权威真题</span>
                        </div>
                    </div>

                    <div class="exam-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ yearData.totalQuestions }}</div>
                            <div class="stat-label">题目总数</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ yearData.averageScore }}%</div>
                            <div class="stat-label">平均分</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ yearData.practiceCount }}</div>
                            <div class="stat-label">练习人数</div>
                        </div>
                    </div>

                    <div class="exam-list">
                        <div v-for="exam in yearData.exams" :key="exam.id" class="exam-item">
                            <div class="exam-title">{{ exam.title }}</div>
                            <div class="exam-meta">
                                <span><i class="fas fa-calendar"></i> {{ exam.date }}</span>
                                <span class="difficulty-badge" :class="'difficulty-' + exam.difficulty">
                                    {{ getDifficultyText(exam.difficulty) }}
                                </span>
                            </div>
                            
                            <div class="progress-indicator">
                                <div class="progress-bar" :style="{ width: exam.progress + '%' }"></div>
                            </div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                                完成进度：{{ exam.progress }}%
                            </div>

                            <div class="exam-actions">
                                <button class="action-btn btn-practice" @click="startPractice(exam)">
                                    <i class="fas fa-play"></i> 
                                    {{ exam.progress > 0 ? '继续练习' : '开始练习' }}
                                </button>
                                <button class="action-btn btn-analysis" @click="viewAnalysis(exam)">
                                    <i class="fas fa-chart-line"></i> 考点分析
                                </button>
                                <button class="action-btn btn-download" @click="downloadExam(exam)">
                                    <i class="fas fa-download"></i> 下载PDF
                                </button>
                                <button v-if="teacherMode" class="action-btn btn-manage" @click="manageExam(exam)">
                                    <i class="fas fa-edit"></i> 管理真题
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            mixins: [SharedMixin],
            components: {
                'ocean-background': OceanBackground,
                'notification-component': NotificationComponent,
                'loading-spinner': LoadingSpinner
            },
            data() {
                return {
                    loading: true,
                    searchKeyword: '',
                    filters: {
                        yearRange: 'all',
                        difficulty: 'all'
                    },
                    examData: [],
                    filteredExams: [],
                    realExamLoader: null,
                    teacherMode: false
                }
            },
            methods: {
                // 初始化真题加载器
                async initRealExamLoader() {
                    console.log('🚀 初始化真题加载器...');
                    
                    // 创建真题加载器
                    this.realExamLoader = {
                        cache: new Map(),
                        
                        async loadRealExamData() {
                            try {
                                console.log('📚 开始加载真题数据...');
                                
                                // 加载题库索引
                                const indexResponse = await fetch('/question-banks/index.json');
                                if (!indexResponse.ok) {
                                    throw new Error(`题库索引加载失败: ${indexResponse.status}`);
                                }
                                
                                const index = await indexResponse.json();
                                console.log('✅ 题库索引加载成功:', index);
                                
                                // 查找真题文件
                                const realExamFiles = index.questionBanks.filter(bank => 
                                    bank.category === '真题' || bank.filename.includes('真题')
                                );
                                
                                console.log('📋 找到真题文件:', realExamFiles.map(f => f.filename));
                                
                                // 获取保存的GitHub配置
                                const savedConfig = localStorage.getItem('github_api_config');
                                const GITHUB_CONFIG = savedConfig ? JSON.parse(savedConfig) : {
                                    owner: 'lghui12138',
                                    repo: 'lghui12138.github.io',
                                    branch: 'main',
                                    rawBaseUrl: 'https://raw.githubusercontent.com/lghui12138/lghui12138.github.io/main'
                                };
                                
                                // 加载真题数据
                                const examData = [];
                                let totalQuestions = 0;
                                
                                for (const file of realExamFiles) {
                                    try {
                                        console.log(`📖 正在加载真题文件: ${file.filename}`);
                                        
                                        let data = null;
                                        
                                        // 优先从GitHub直接访问
                                        try {
                                            console.log(`🌐 尝试从GitHub加载真题: ${file.filename}`);
                                            const url = `${GITHUB_CONFIG.rawBaseUrl}/question-banks/${file.filename}`;
                                            const response = await fetch(url);
                                            
                                            if (response.ok) {
                                                data = await response.json();
                                                console.log(`✅ 从GitHub成功加载真题: ${file.filename}, 题目数量: ${Array.isArray(data) ? data.length : (data.questions ? data.questions.length : 0)}`);
                                            } else {
                                                console.warn(`⚠️ GitHub文件不存在: ${file.filename}`);
                                            }
                                        } catch (githubError) {
                                            console.warn(`⚠️ 从GitHub加载真题失败: ${file.filename}`, githubError.message);
                                        }
                                        
                                        // 如果GitHub加载失败，从本地文件系统加载
                                        if (!data) {
                                            console.log(`📁 从本地文件系统加载真题: ${file.filename}`);
                                            const response = await fetch(`/question-banks/${file.filename}`);
                                            
                                            if (!response.ok) {
                                                console.error(`❌ 真题文件加载失败: ${file.filename}, 状态: ${response.status}`);
                                                continue;
                                            }
                                            
                                            data = await response.json();
                                        }
                                        
                                        const questions = Array.isArray(data) ? data : (data.questions || data.data || []);
                                        
                                        console.log(`✅ 真题文件加载成功: ${file.filename}, 题目数量: ${questions.length}`);
                                        
                                        // 解析年份信息 - 支持年份范围
                                        const yearMatches = file.filename.match(/(\d{4})/g);
                                        let years = [];
                                        
                                        if (yearMatches && yearMatches.length >= 2) {
                                            // 如果有多个年份，解析年份范围
                                            const startYear = parseInt(yearMatches[0]);
                                            const endYear = parseInt(yearMatches[1]);
                                            for (let year = startYear; year <= endYear; year++) {
                                                years.push(year);
                                            }
                                        } else if (yearMatches && yearMatches.length === 1) {
                                            // 如果只有一个年份
                                            years = [parseInt(yearMatches[0])];
                                        } else {
                                            // 如果没有年份信息，使用当前年份
                                            years = [new Date().getFullYear()];
                                        }
                                        
                                        console.log(`📅 解析到年份: ${years.join(', ')}`);
                                        
                                        // 为每个年份创建考试对象
                                        for (const year of years) {
                                            // 按年份分组
                                            let yearData = examData.find(y => y.year === year);
                                            if (!yearData) {
                                                yearData = {
                                                    year: year,
                                                    semester: '秋季学期期末考试',
                                                    totalQuestions: 0,
                                                    averageScore: Math.floor(Math.random() * 20) + 65, // 模拟数据
                                                    practiceCount: Math.floor(Math.random() * 300) + 200, // 模拟数据
                                                    exams: []
                                                };
                                                examData.push(yearData);
                                            }
                                            
                                            // 创建考试对象
                                            const exam = {
                                                id: `${year}-${file.filename.replace('.json', '')}`,
                                                title: `${year}年流体力学期末考试`,
                                                date: `${year}-12-25`,
                                                difficulty: this.getDifficultyByQuestionCount(questions.length),
                                                progress: 0,
                                                topics: this.extractTopics(questions),
                                                questionCount: questions.length,
                                                questions: questions
                                            };
                                            
                                            yearData.exams.push(exam);
                                            yearData.totalQuestions += questions.length;
                                            totalQuestions += questions.length;
                                        }
                                        
                                    } catch (error) {
                                        console.error(`❌ 真题文件加载出错: ${file.filename}`, error);
                                    }
                                }
                                
                                // 按年份排序
                                examData.sort((a, b) => b.year - a.year);
                                
                                console.log('✅ 真题数据加载完成:', examData);
                                return { examData, totalQuestions };
                                
                            } catch (error) {
                                console.error('❌ 真题数据加载失败:', error);
                                throw error;
                            }
                        },
                        
                        getDifficultyByQuestionCount(count) {
                            if (count >= 50) return 'hard';
                            if (count >= 30) return 'medium';
                            return 'easy';
                        },
                        
                        extractTopics(questions) {
                            const topics = new Set();
                            questions.forEach(q => {
                                if (q.category) topics.add(q.category);
                                if (q.tags) q.tags.forEach(tag => topics.add(tag));
                            });
                            return Array.from(topics);
                        }
                    };
                    
                    return this.realExamLoader;
                },
                
                // 加载真题数据
                async loadRealExamData() {
                    try {
                        this.setLoading(true);
                        
                        if (!this.realExamLoader) {
                            this.realExamLoader = await this.initRealExamLoader();
                        }
                        
                        const { examData, totalQuestions } = await this.realExamLoader.loadRealExamData();
                        
                        this.examData = examData;
                        this.filteredExams = [...examData];
                        
                        console.log('✅ 真题数据加载完成:', examData);
                        this.showNotification(`真题数据加载完成！共 ${totalQuestions} 道权威真题`, 'success');
                        
                    } catch (error) {
                        console.error('❌ 真题数据加载失败:', error);
                        this.showNotification('真题数据加载失败，请检查网络连接', 'error');
                        
                        // 加载失败时使用备用数据
                        this.loadFallbackData();
                    } finally {
                        this.setLoading(false);
                    }
                },
                
                // 备用数据
                loadFallbackData() {
                    console.log('📋 加载备用真题数据...');
                    this.examData = [
                        {
                            year: 2020,
                            semester: '秋季学期期末考试',
                            totalQuestions: 40,
                            averageScore: 69,
                            practiceCount: 512,
                            exams: [
                                {
                                    id: '2020-final',
                                    title: '2020年流体力学期末考试',
                                    date: '2020-12-25',
                                    difficulty: 'hard',
                                    progress: 75,
                                    topics: ['statics', 'dynamics', 'viscous']
                                }
                            ]
                        },
                        {
                            year: 2019,
                            semester: '秋季学期期末考试',
                            totalQuestions: 36,
                            averageScore: 71,
                            practiceCount: 398,
                            exams: [
                                {
                                    id: '2019-final',
                                    title: '2019年流体力学期末考试',
                                    date: '2019-12-27',
                                    difficulty: 'medium',
                                    progress: 90,
                                    topics: ['statics', 'dynamics', 'viscous']
                                }
                            ]
                        }
                    ];
                    this.filteredExams = [...this.examData];
                },
                
                filterExams() {
                    let filtered = [...this.examData];
                    
                    // 年份筛选
                    if (this.filters.yearRange !== 'all') {
                        if (this.filters.yearRange === 'recent') {
                            filtered = filtered.filter(item => item.year >= 2021);
                        } else if (this.filters.yearRange === '2020s') {
                            filtered = filtered.filter(item => item.year >= 2020);
                        } else if (this.filters.yearRange === '2010s') {
                            filtered = filtered.filter(item => item.year >= 2010 && item.year < 2020);
                        } else if (this.filters.yearRange === '2000s') {
                            filtered = filtered.filter(item => item.year >= 2000 && item.year < 2010);
                        }
                    }
                    
                    // 难度筛选
                    if (this.filters.difficulty !== 'all') {
                        filtered = filtered.map(yearData => ({
                            ...yearData,
                            exams: yearData.exams.filter(exam => exam.difficulty === this.filters.difficulty)
                        })).filter(yearData => yearData.exams.length > 0);
                    }
                    
                    // 关键词搜索
                    if (this.searchKeyword.trim()) {
                        const keyword = this.searchKeyword.trim().toLowerCase();
                        filtered = filtered.map(yearData => ({
                            ...yearData,
                            exams: yearData.exams.filter(exam => 
                                exam.title.toLowerCase().includes(keyword) ||
                                exam.date.includes(keyword)
                            )
                        })).filter(yearData => yearData.exams.length > 0);
                    }
                    
                    this.filteredExams = filtered;
                },
                
                getDifficultyText(difficulty) {
                    const texts = {
                        'easy': '简单',
                        'medium': '中等',
                        'hard': '困难'
                    };
                    return texts[difficulty] || '未知';
                },
                
                startPractice(exam) {
                    this.showNotification(`开始练习：${exam.title}`, 'success');
                    // 跳转到练习页面，传递真题数据
                    const practiceUrl = `../practice-fullscreen.html?type=real&bank=${encodeURIComponent(exam.id)}&mode=order`;
                    window.location.href = practiceUrl;
                },
                
                // 教师管理功能
                manageExam(exam) {
                    if (!this.teacherMode) {
                        this.showNotification('只有教师可以管理真题', 'warning');
                        return;
                    }
                    
                    this.showNotification(`管理真题：${exam.title}`, 'info');
                    // 这里可以打开管理弹窗
                    this.openExamManager(exam);
                },
                
                openExamManager(exam) {
                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                        background: rgba(0,0,0,0.7); z-index: 10000;
                        display: flex; align-items: center; justify-content: center;
                    `;
                    
                    modal.innerHTML = `
                        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                            <h3 style="color: #f39c12; margin-bottom: 20px;">
                                <i class="fas fa-edit"></i> 真题管理：${exam.title}
                            </h3>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">题目数量：</label>
                                <input type="number" value="${exam.questionCount || 0}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">难度等级：</label>
                                <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    <option value="easy" ${exam.difficulty === 'easy' ? 'selected' : ''}>简单</option>
                                    <option value="medium" ${exam.difficulty === 'medium' ? 'selected' : ''}>中等</option>
                                    <option value="hard" ${exam.difficulty === 'hard' ? 'selected' : ''}>困难</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">考试日期：</label>
                                <input type="date" value="${exam.date}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">知识点：</label>
                                <input type="text" value="${exam.topics.join(', ')}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="text-align: center; margin-top: 30px;">
                                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                                    background: #f39c12; color: white; border: none; padding: 10px 20px; 
                                    border-radius: 5px; cursor: pointer; margin-right: 10px;
                                ">保存更改</button>
                                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                                    background: #ddd; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;
                                ">取消</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    modal.onclick = (e) => {
                        if (e.target === modal) modal.remove();
                    };
                },
                
                viewAnalysis(exam) {
                    this.showNotification(`查看考点分析：${exam.title}`, 'info');
                    // 这里可以显示考点分析弹窗或跳转到分析页面
                },
                
                downloadExam(exam) {
                    this.showNotification(`下载功能开发中：${exam.title}`, 'info');
                    // 这里可以实现PDF下载功能
                },
                
                loadProgress() {
                    const savedProgress = this.loadFromStorage('realExamProgress', {});
                    
                    // 更新每个考试的进度
                    this.examData.forEach(yearData => {
                        yearData.exams.forEach(exam => {
                            if (savedProgress[exam.id]) {
                                exam.progress = savedProgress[exam.id].progress || 0;
                            }
                        });
                    });
                }
            },
            
            mounted() {
                console.log('🏆 历年真题模块启动！');
                
                // 检查是否为教师模式
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                this.teacherMode = currentUser.role === 'teacher';
                
                // 加载真题数据
                this.loadRealExamData().then(() => {
                    this.loadProgress();
                    this.filterExams(); // 初始化显示所有数据
                    this.showNotification('历年真题加载完成！', 'success');
                }).catch(error => {
                    console.error('❌ 真题模块初始化失败:', error);
                    this.showNotification('真题模块初始化失败，使用备用数据', 'warning');
                });
            }
        }).mount('#realExamsApp');
    </script>
</body>
</html> 