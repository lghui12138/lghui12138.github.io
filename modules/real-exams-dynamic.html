<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† å†å¹´çœŸé¢˜ - æµä½“åŠ›å­¦å­¦ä¹ å¹³å°</title>
    
    <!-- å¤–éƒ¨ä¾èµ– -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- å…±äº«ç»„ä»¶åº“ -->
    <script src="../js/shared-components.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            margin: 0;
            font-family: 'SF Pro Display', sans-serif;
            color: white;
        }

        .exams-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .year-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .year-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            color: #333;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .year-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .year-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f39c12;
        }

        .year-title {
            font-size: 2em;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 10px;
        }

        .year-subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .exam-list {
            margin-bottom: 25px;
        }

        .exam-item {
            background: #f8f9fa;
            border-left: 4px solid #f39c12;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .exam-item:hover {
            background: #e9ecef;
            border-left-color: #e67e22;
        }

        .exam-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .exam-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }

        .exam-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            flex: 1;
        }

        .stat-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #f39c12;
        }

        .stat-label {
            font-size: 0.8em;
            color: #666;
        }

        .exam-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-practice {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-analysis {
            background: #3498db;
            color: white;
        }

        .btn-download {
            background: #2ecc71;
            color: white;
        }
        
        .btn-manage {
            background: #f39c12;
            color: white;
        }

        .filter-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            color: #333;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .filter-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
        }

        .filter-select:focus {
            border-color: #f39c12;
            outline: none;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .difficulty-easy {
            background: #d4edda;
            color: #155724;
        }

        .difficulty-medium {
            background: #fff3cd;
            color: #856404;
        }

        .difficulty-hard {
            background: #f8d7da;
            color: #721c24;
        }

        .year-badge {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .progress-indicator {
            background: #f0f0f0;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            transition: width 0.3s ease;
        }

        .exam-tips {
            background: #e8f4fd;
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .tips-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #3498db;
        }

        .tips-list {
            list-style: none;
            padding: 0;
        }

        .tips-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .tips-list li:before {
            content: "ğŸ’¡";
            position: absolute;
            left: 0;
        }

        .search-box {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .search-box:focus {
            border-color: #f39c12;
            outline: none;
        }
    </style>
</head>
<body>
    <div id="realExamsApp">
        <!-- æµ·æ´‹èƒŒæ™¯ -->
        <ocean-background></ocean-background>

        <!-- é€šçŸ¥ç»„ä»¶ -->
        <notification-component :notification="notification" @close="notification = ''"></notification-component>

        <!-- åŠ è½½åŠ¨ç”» -->
        <loading-spinner :show="loading" text="æ­£åœ¨åŠ è½½å†å¹´çœŸé¢˜..."></loading-spinner>

        <div class="exams-container" v-if="!loading">
            <!-- é¡µé¢å¤´éƒ¨ -->
            <header style="text-align: center; padding: 40px 0; margin-bottom: 30px;">
                <h1><i class="fas fa-medal"></i> å†å¹´çœŸé¢˜</h1>
                <p>ä¸­å›½æµ·æ´‹å¤§å­¦803æµä½“åŠ›å­¦å†å¹´çœŸé¢˜é›†ï¼Œæƒå¨é¢˜æºï¼Œè€ƒç‚¹åˆ†æ</p>
            </header>

            <!-- å­¦ä¹ å»ºè®® -->
            <div class="exam-tips">
                <div class="tips-title"><i class="fas fa-lightbulb"></i> çœŸé¢˜å­¦ä¹ å»ºè®®</div>
                <ul class="tips-list">
                    <li>æŒ‰å¹´ä»½é¡ºåºç»ƒä¹ ï¼Œäº†è§£è€ƒè¯•è¶‹åŠ¿å’Œé‡ç‚¹å˜åŒ–</li>
                    <li>å…ˆåšé¢˜å†çœ‹è§£æï¼ŒåŸ¹å…»ç‹¬ç«‹æ€è€ƒèƒ½åŠ›</li>
                    <li>é‡ç‚¹å…³æ³¨é”™é¢˜å’Œä¸ç†Ÿæ‚‰çš„æ¦‚å¿µ</li>
                    <li>æ€»ç»“é«˜é¢‘è€ƒç‚¹å’Œå¸¸è§é¢˜å‹</li>
                    <li>æ¨¡æ‹ŸçœŸå®è€ƒè¯•ç¯å¢ƒï¼Œæ§åˆ¶ç­”é¢˜æ—¶é—´</li>
                </ul>
            </div>

            <!-- ç­›é€‰é¢æ¿ -->
            <div class="filter-panel">
                <h3><i class="fas fa-filter"></i> çœŸé¢˜ç­›é€‰</h3>
                
                <input 
                    v-model="searchKeyword" 
                    class="search-box" 
                    placeholder="æœç´¢é¢˜ç›®å…³é”®è¯..."
                    @input="filterExams"
                >

                <div class="filter-grid">
                    <div class="filter-group">
                        <label class="filter-label">å¹´ä»½èŒƒå›´ï¼š</label>
                        <select v-model="filters.yearRange" @change="filterExams" class="filter-select">
                            <option value="all">å…¨éƒ¨å¹´ä»½</option>
                            <option value="recent">è¿‘3å¹´(2021-2023)</option>
                            <option value="2020s">2020å¹´ä»£</option>
                            <option value="2010s">2010å¹´ä»£</option>
                            <option value="2000s">2000å¹´ä»£</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">é¢˜ç›®ç±»å‹ï¼š</label>
                        <select v-model="filters.questionType" @change="filterExams" class="filter-select">
                            <option value="all">å…¨éƒ¨ç±»å‹</option>
                            <option value="choice">é€‰æ‹©é¢˜</option>
                            <option value="calculation">è®¡ç®—é¢˜</option>
                            <option value="analysis">åˆ†æé¢˜</option>
                            <option value="proof">è¯æ˜é¢˜</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">éš¾åº¦ç­‰çº§ï¼š</label>
                        <select v-model="filters.difficulty" @change="filterExams" class="filter-select">
                            <option value="all">å…¨éƒ¨éš¾åº¦</option>
                            <option value="easy">ç®€å•</option>
                            <option value="medium">ä¸­ç­‰</option>
                            <option value="hard">å›°éš¾</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">çŸ¥è¯†ç‚¹ï¼š</label>
                        <select v-model="filters.topic" @change="filterExams" class="filter-select">
                            <option value="all">å…¨éƒ¨çŸ¥è¯†ç‚¹</option>
                            <option value="statics">æµä½“é™åŠ›å­¦</option>
                            <option value="kinematics">æµä½“è¿åŠ¨å­¦</option>
                            <option value="dynamics">æµä½“åŠ¨åŠ›å­¦</option>
                            <option value="viscous">ç²˜æ€§æµåŠ¨</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- å¹´ä»½è¯•å·åˆ—è¡¨ -->
            <div class="year-grid">
                <div v-for="yearData in filteredExams" :key="yearData.year" class="year-card">
                    <div class="year-header">
                        <div class="year-title">{{ yearData.year }}å¹´</div>
                        <div class="year-subtitle">{{ yearData.semester }}</div>
                        <div style="margin-top: 10px;">
                            <span class="year-badge">æƒå¨çœŸé¢˜</span>
                        </div>
                    </div>

                    <div class="exam-stats">
                        <div class="stat-item">
                            <div class="stat-number">{{ yearData.totalQuestions }}</div>
                            <div class="stat-label">é¢˜ç›®æ€»æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ yearData.averageScore }}%</div>
                            <div class="stat-label">å¹³å‡åˆ†</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ yearData.practiceCount }}</div>
                            <div class="stat-label">ç»ƒä¹ äººæ•°</div>
                        </div>
                    </div>

                    <div class="exam-list">
                        <div v-for="exam in yearData.exams" :key="exam.id" class="exam-item">
                            <div class="exam-title">{{ exam.title }}</div>
                            <div class="exam-meta">
                                <span><i class="fas fa-calendar"></i> {{ exam.date }}</span>
                                <span class="difficulty-badge" :class="'difficulty-' + exam.difficulty">
                                    {{ getDifficultyText(exam.difficulty) }}
                                </span>
                            </div>
                            
                            <div class="progress-indicator">
                                <div class="progress-bar" :style="{ width: exam.progress + '%' }"></div>
                            </div>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                                å®Œæˆè¿›åº¦ï¼š{{ exam.progress }}%
                            </div>

                            <div class="exam-actions">
                                <button class="action-btn btn-practice" @click="startPractice(exam)">
                                    <i class="fas fa-play"></i> 
                                    {{ exam.progress > 0 ? 'ç»§ç»­ç»ƒä¹ ' : 'å¼€å§‹ç»ƒä¹ ' }}
                                </button>
                                <button class="action-btn btn-analysis" @click="viewAnalysis(exam)">
                                    <i class="fas fa-chart-line"></i> è€ƒç‚¹åˆ†æ
                                </button>
                                <button class="action-btn btn-download" @click="downloadExam(exam)">
                                    <i class="fas fa-download"></i> ä¸‹è½½PDF
                                </button>
                                <button v-if="teacherMode" class="action-btn btn-manage" @click="manageExam(exam)">
                                    <i class="fas fa-edit"></i> ç®¡ç†çœŸé¢˜
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            mixins: [SharedMixin],
            components: {
                'ocean-background': OceanBackground,
                'notification-component': NotificationComponent,
                'loading-spinner': LoadingSpinner
            },
            data() {
                return {
                    loading: true,
                    searchKeyword: '',
                    filters: {
                        yearRange: 'all',
                        difficulty: 'all'
                    },
                    examData: [],
                    filteredExams: [],
                    realExamLoader: null,
                    teacherMode: false
                }
            },
            methods: {
                // åˆå§‹åŒ–çœŸé¢˜åŠ è½½å™¨
                async initRealExamLoader() {
                    console.log('ğŸš€ åˆå§‹åŒ–çœŸé¢˜åŠ è½½å™¨...');
                    
                    // åˆ›å»ºçœŸé¢˜åŠ è½½å™¨
                    this.realExamLoader = {
                        cache: new Map(),
                        
                        async loadRealExamData() {
                            try {
                                console.log('ğŸ“š å¼€å§‹åŠ è½½çœŸé¢˜æ•°æ®...');
                                
                                // åŠ è½½é¢˜åº“ç´¢å¼•
                                const indexResponse = await fetch('/question-banks/index.json');
                                if (!indexResponse.ok) {
                                    throw new Error(`é¢˜åº“ç´¢å¼•åŠ è½½å¤±è´¥: ${indexResponse.status}`);
                                }
                                
                                const index = await indexResponse.json();
                                console.log('âœ… é¢˜åº“ç´¢å¼•åŠ è½½æˆåŠŸ:', index);
                                
                                // æŸ¥æ‰¾çœŸé¢˜æ–‡ä»¶
                                const realExamFiles = index.questionBanks.filter(bank => 
                                    bank.category === 'çœŸé¢˜' || bank.filename.includes('çœŸé¢˜')
                                );
                                
                                console.log('ğŸ“‹ æ‰¾åˆ°çœŸé¢˜æ–‡ä»¶:', realExamFiles.map(f => f.filename));
                                
                                // è·å–ä¿å­˜çš„GitHubé…ç½®
                                const savedConfig = localStorage.getItem('github_api_config');
                                const GITHUB_CONFIG = savedConfig ? JSON.parse(savedConfig) : {
                                    owner: 'lghui12138',
                                    repo: 'lghui12138.github.io',
                                    branch: 'main',
                                    rawBaseUrl: 'https://raw.githubusercontent.com/lghui12138/lghui12138.github.io/main'
                                };
                                
                                // åŠ è½½çœŸé¢˜æ•°æ®
                                const examData = [];
                                let totalQuestions = 0;
                                
                                for (const file of realExamFiles) {
                                    try {
                                        console.log(`ğŸ“– æ­£åœ¨åŠ è½½çœŸé¢˜æ–‡ä»¶: ${file.filename}`);
                                        
                                        let data = null;
                                        
                                        // ä¼˜å…ˆä»GitHubç›´æ¥è®¿é—®
                                        try {
                                            console.log(`ğŸŒ å°è¯•ä»GitHubåŠ è½½çœŸé¢˜: ${file.filename}`);
                                            const url = `${GITHUB_CONFIG.rawBaseUrl}/question-banks/${file.filename}`;
                                            const response = await fetch(url);
                                            
                                            if (response.ok) {
                                                data = await response.json();
                                                console.log(`âœ… ä»GitHubæˆåŠŸåŠ è½½çœŸé¢˜: ${file.filename}, é¢˜ç›®æ•°é‡: ${Array.isArray(data) ? data.length : (data.questions ? data.questions.length : 0)}`);
                                            } else {
                                                console.warn(`âš ï¸ GitHubæ–‡ä»¶ä¸å­˜åœ¨: ${file.filename}`);
                                            }
                                        } catch (githubError) {
                                            console.warn(`âš ï¸ ä»GitHubåŠ è½½çœŸé¢˜å¤±è´¥: ${file.filename}`, githubError.message);
                                        }
                                        
                                        // å¦‚æœGitHubåŠ è½½å¤±è´¥ï¼Œä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½
                                        if (!data) {
                                            console.log(`ğŸ“ ä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½çœŸé¢˜: ${file.filename}`);
                                            const response = await fetch(`/question-banks/${file.filename}`);
                                            
                                            if (!response.ok) {
                                                console.error(`âŒ çœŸé¢˜æ–‡ä»¶åŠ è½½å¤±è´¥: ${file.filename}, çŠ¶æ€: ${response.status}`);
                                                continue;
                                            }
                                            
                                            data = await response.json();
                                        }
                                        
                                        const questions = Array.isArray(data) ? data : (data.questions || data.data || []);
                                        
                                        console.log(`âœ… çœŸé¢˜æ–‡ä»¶åŠ è½½æˆåŠŸ: ${file.filename}, é¢˜ç›®æ•°é‡: ${questions.length}`);
                                        
                                        // è§£æå¹´ä»½ä¿¡æ¯ - æ”¯æŒå¹´ä»½èŒƒå›´
                                        const yearMatches = file.filename.match(/(\d{4})/g);
                                        let years = [];
                                        
                                        if (yearMatches && yearMatches.length >= 2) {
                                            // å¦‚æœæœ‰å¤šä¸ªå¹´ä»½ï¼Œè§£æå¹´ä»½èŒƒå›´
                                            const startYear = parseInt(yearMatches[0]);
                                            const endYear = parseInt(yearMatches[1]);
                                            for (let year = startYear; year <= endYear; year++) {
                                                years.push(year);
                                            }
                                        } else if (yearMatches && yearMatches.length === 1) {
                                            // å¦‚æœåªæœ‰ä¸€ä¸ªå¹´ä»½
                                            years = [parseInt(yearMatches[0])];
                                        } else {
                                            // å¦‚æœæ²¡æœ‰å¹´ä»½ä¿¡æ¯ï¼Œä½¿ç”¨å½“å‰å¹´ä»½
                                            years = [new Date().getFullYear()];
                                        }
                                        
                                        console.log(`ğŸ“… è§£æåˆ°å¹´ä»½: ${years.join(', ')}`);
                                        
                                        // ä¸ºæ¯ä¸ªå¹´ä»½åˆ›å»ºè€ƒè¯•å¯¹è±¡
                                        for (const year of years) {
                                            // æŒ‰å¹´ä»½åˆ†ç»„
                                            let yearData = examData.find(y => y.year === year);
                                            if (!yearData) {
                                                yearData = {
                                                    year: year,
                                                    semester: 'ç§‹å­£å­¦æœŸæœŸæœ«è€ƒè¯•',
                                                    totalQuestions: 0,
                                                    averageScore: Math.floor(Math.random() * 20) + 65, // æ¨¡æ‹Ÿæ•°æ®
                                                    practiceCount: Math.floor(Math.random() * 300) + 200, // æ¨¡æ‹Ÿæ•°æ®
                                                    exams: []
                                                };
                                                examData.push(yearData);
                                            }
                                            
                                            // åˆ›å»ºè€ƒè¯•å¯¹è±¡
                                            const exam = {
                                                id: `${year}-${file.filename.replace('.json', '')}`,
                                                title: `${year}å¹´æµä½“åŠ›å­¦æœŸæœ«è€ƒè¯•`,
                                                date: `${year}-12-25`,
                                                difficulty: this.getDifficultyByQuestionCount(questions.length),
                                                progress: 0,
                                                topics: this.extractTopics(questions),
                                                questionCount: questions.length,
                                                questions: questions
                                            };
                                            
                                            yearData.exams.push(exam);
                                            yearData.totalQuestions += questions.length;
                                            totalQuestions += questions.length;
                                        }
                                        
                                    } catch (error) {
                                        console.error(`âŒ çœŸé¢˜æ–‡ä»¶åŠ è½½å‡ºé”™: ${file.filename}`, error);
                                    }
                                }
                                
                                // æŒ‰å¹´ä»½æ’åº
                                examData.sort((a, b) => b.year - a.year);
                                
                                console.log('âœ… çœŸé¢˜æ•°æ®åŠ è½½å®Œæˆ:', examData);
                                return { examData, totalQuestions };
                                
                            } catch (error) {
                                console.error('âŒ çœŸé¢˜æ•°æ®åŠ è½½å¤±è´¥:', error);
                                throw error;
                            }
                        },
                        
                        getDifficultyByQuestionCount(count) {
                            if (count >= 50) return 'hard';
                            if (count >= 30) return 'medium';
                            return 'easy';
                        },
                        
                        extractTopics(questions) {
                            const topics = new Set();
                            questions.forEach(q => {
                                if (q.category) topics.add(q.category);
                                if (q.tags) q.tags.forEach(tag => topics.add(tag));
                            });
                            return Array.from(topics);
                        }
                    };
                    
                    return this.realExamLoader;
                },
                
                // åŠ è½½çœŸé¢˜æ•°æ®
                async loadRealExamData() {
                    try {
                        this.setLoading(true);
                        
                        if (!this.realExamLoader) {
                            this.realExamLoader = await this.initRealExamLoader();
                        }
                        
                        const { examData, totalQuestions } = await this.realExamLoader.loadRealExamData();
                        
                        this.examData = examData;
                        this.filteredExams = [...examData];
                        
                        console.log('âœ… çœŸé¢˜æ•°æ®åŠ è½½å®Œæˆ:', examData);
                        this.showNotification(`çœŸé¢˜æ•°æ®åŠ è½½å®Œæˆï¼å…± ${totalQuestions} é“æƒå¨çœŸé¢˜`, 'success');
                        
                    } catch (error) {
                        console.error('âŒ çœŸé¢˜æ•°æ®åŠ è½½å¤±è´¥:', error);
                        this.showNotification('çœŸé¢˜æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                        
                        // åŠ è½½å¤±è´¥æ—¶ä½¿ç”¨å¤‡ç”¨æ•°æ®
                        this.loadFallbackData();
                    } finally {
                        this.setLoading(false);
                    }
                },
                
                // å¤‡ç”¨æ•°æ®
                loadFallbackData() {
                    console.log('ğŸ“‹ åŠ è½½å¤‡ç”¨çœŸé¢˜æ•°æ®...');
                    this.examData = [
                        {
                            year: 2020,
                            semester: 'ç§‹å­£å­¦æœŸæœŸæœ«è€ƒè¯•',
                            totalQuestions: 40,
                            averageScore: 69,
                            practiceCount: 512,
                            exams: [
                                {
                                    id: '2020-final',
                                    title: '2020å¹´æµä½“åŠ›å­¦æœŸæœ«è€ƒè¯•',
                                    date: '2020-12-25',
                                    difficulty: 'hard',
                                    progress: 75,
                                    topics: ['statics', 'dynamics', 'viscous']
                                }
                            ]
                        },
                        {
                            year: 2019,
                            semester: 'ç§‹å­£å­¦æœŸæœŸæœ«è€ƒè¯•',
                            totalQuestions: 36,
                            averageScore: 71,
                            practiceCount: 398,
                            exams: [
                                {
                                    id: '2019-final',
                                    title: '2019å¹´æµä½“åŠ›å­¦æœŸæœ«è€ƒè¯•',
                                    date: '2019-12-27',
                                    difficulty: 'medium',
                                    progress: 90,
                                    topics: ['statics', 'dynamics', 'viscous']
                                }
                            ]
                        }
                    ];
                    this.filteredExams = [...this.examData];
                },
                
                filterExams() {
                    let filtered = [...this.examData];
                    
                    // å¹´ä»½ç­›é€‰
                    if (this.filters.yearRange !== 'all') {
                        if (this.filters.yearRange === 'recent') {
                            filtered = filtered.filter(item => item.year >= 2021);
                        } else if (this.filters.yearRange === '2020s') {
                            filtered = filtered.filter(item => item.year >= 2020);
                        } else if (this.filters.yearRange === '2010s') {
                            filtered = filtered.filter(item => item.year >= 2010 && item.year < 2020);
                        } else if (this.filters.yearRange === '2000s') {
                            filtered = filtered.filter(item => item.year >= 2000 && item.year < 2010);
                        }
                    }
                    
                    // éš¾åº¦ç­›é€‰
                    if (this.filters.difficulty !== 'all') {
                        filtered = filtered.map(yearData => ({
                            ...yearData,
                            exams: yearData.exams.filter(exam => exam.difficulty === this.filters.difficulty)
                        })).filter(yearData => yearData.exams.length > 0);
                    }
                    
                    // å…³é”®è¯æœç´¢
                    if (this.searchKeyword.trim()) {
                        const keyword = this.searchKeyword.trim().toLowerCase();
                        filtered = filtered.map(yearData => ({
                            ...yearData,
                            exams: yearData.exams.filter(exam => 
                                exam.title.toLowerCase().includes(keyword) ||
                                exam.date.includes(keyword)
                            )
                        })).filter(yearData => yearData.exams.length > 0);
                    }
                    
                    this.filteredExams = filtered;
                },
                
                getDifficultyText(difficulty) {
                    const texts = {
                        'easy': 'ç®€å•',
                        'medium': 'ä¸­ç­‰',
                        'hard': 'å›°éš¾'
                    };
                    return texts[difficulty] || 'æœªçŸ¥';
                },
                
                startPractice(exam) {
                    this.showNotification(`å¼€å§‹ç»ƒä¹ ï¼š${exam.title}`, 'success');
                    // è·³è½¬åˆ°ç»ƒä¹ é¡µé¢ï¼Œä¼ é€’çœŸé¢˜æ•°æ®
                    const practiceUrl = `../practice-fullscreen.html?type=real&bank=${encodeURIComponent(exam.id)}&mode=order`;
                    window.location.href = practiceUrl;
                },
                
                // æ•™å¸ˆç®¡ç†åŠŸèƒ½
                manageExam(exam) {
                    if (!this.teacherMode) {
                        this.showNotification('åªæœ‰æ•™å¸ˆå¯ä»¥ç®¡ç†çœŸé¢˜', 'warning');
                        return;
                    }
                    
                    this.showNotification(`ç®¡ç†çœŸé¢˜ï¼š${exam.title}`, 'info');
                    // è¿™é‡Œå¯ä»¥æ‰“å¼€ç®¡ç†å¼¹çª—
                    this.openExamManager(exam);
                },
                
                openExamManager(exam) {
                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                        background: rgba(0,0,0,0.7); z-index: 10000;
                        display: flex; align-items: center; justify-content: center;
                    `;
                    
                    modal.innerHTML = `
                        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                            <h3 style="color: #f39c12; margin-bottom: 20px;">
                                <i class="fas fa-edit"></i> çœŸé¢˜ç®¡ç†ï¼š${exam.title}
                            </h3>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">é¢˜ç›®æ•°é‡ï¼š</label>
                                <input type="number" value="${exam.questionCount || 0}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">éš¾åº¦ç­‰çº§ï¼š</label>
                                <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    <option value="easy" ${exam.difficulty === 'easy' ? 'selected' : ''}>ç®€å•</option>
                                    <option value="medium" ${exam.difficulty === 'medium' ? 'selected' : ''}>ä¸­ç­‰</option>
                                    <option value="hard" ${exam.difficulty === 'hard' ? 'selected' : ''}>å›°éš¾</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">è€ƒè¯•æ—¥æœŸï¼š</label>
                                <input type="date" value="${exam.date}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">çŸ¥è¯†ç‚¹ï¼š</label>
                                <input type="text" value="${exam.topics.join(', ')}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="text-align: center; margin-top: 30px;">
                                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                                    background: #f39c12; color: white; border: none; padding: 10px 20px; 
                                    border-radius: 5px; cursor: pointer; margin-right: 10px;
                                ">ä¿å­˜æ›´æ”¹</button>
                                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                                    background: #ddd; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;
                                ">å–æ¶ˆ</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    modal.onclick = (e) => {
                        if (e.target === modal) modal.remove();
                    };
                },
                
                viewAnalysis(exam) {
                    this.showNotification(`æŸ¥çœ‹è€ƒç‚¹åˆ†æï¼š${exam.title}`, 'info');
                    // è¿™é‡Œå¯ä»¥æ˜¾ç¤ºè€ƒç‚¹åˆ†æå¼¹çª—æˆ–è·³è½¬åˆ°åˆ†æé¡µé¢
                },
                
                downloadExam(exam) {
                    this.showNotification(`ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­ï¼š${exam.title}`, 'info');
                    // è¿™é‡Œå¯ä»¥å®ç°PDFä¸‹è½½åŠŸèƒ½
                },
                
                loadProgress() {
                    const savedProgress = this.loadFromStorage('realExamProgress', {});
                    
                    // æ›´æ–°æ¯ä¸ªè€ƒè¯•çš„è¿›åº¦
                    this.examData.forEach(yearData => {
                        yearData.exams.forEach(exam => {
                            if (savedProgress[exam.id]) {
                                exam.progress = savedProgress[exam.id].progress || 0;
                            }
                        });
                    });
                }
            },
            
            mounted() {
                console.log('ğŸ† å†å¹´çœŸé¢˜æ¨¡å—å¯åŠ¨ï¼');
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ•™å¸ˆæ¨¡å¼
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                this.teacherMode = currentUser.role === 'teacher';
                
                // åŠ è½½çœŸé¢˜æ•°æ®
                this.loadRealExamData().then(() => {
                    this.loadProgress();
                    this.filterExams(); // åˆå§‹åŒ–æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
                    this.showNotification('å†å¹´çœŸé¢˜åŠ è½½å®Œæˆï¼', 'success');
                }).catch(error => {
                    console.error('âŒ çœŸé¢˜æ¨¡å—åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showNotification('çœŸé¢˜æ¨¡å—åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ•°æ®', 'warning');
                });
            }
        }).mount('#realExamsApp');
    </script>
</body>
</html> 