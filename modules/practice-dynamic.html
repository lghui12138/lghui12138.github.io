<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>🧠 智能题库练习 - 全屏模式支持</title>
    
    <!-- 外部依赖 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Safari兼容性脚本 -->
    <script src="../safari-compatibility.js"></script>
    
    <!-- 安全保护模块 -->
    <script src="security-protection.js"></script>
    
    <!-- AI智能系统 -->
    <script src="../js/core/config.js"></script>
    <script src="../js/core/smart-model-selector.js"></script>

    <style>
        :root {
            /* 海洋主题色彩 */
            --ocean-deep: #1e3a8a;
            --ocean-surface: #3b82f6;
            --ocean-light: #60a5fa;
            --ocean-foam: #93c5fd;
            --ocean-coral: #f97316;
            --ocean-sand: #fbbf24;
            --ocean-seafoam: #34d399;
            --ocean-turquoise: #06b6d4;
            
            /* 原有色彩保留 */
            --primary-color: #3b82f6;
            --secondary-color: #1e3a8a;
            --accent-color: #06b6d4;
            --success-color: #34d399;
            --warning-color: #fbbf24;
            --error-color: #f97316;
            
            /* 玻璃效果增强 */
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --glass-shadow: rgba(0, 0, 0, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.9);
            
            /* 海洋动画变量 */
            --wave-speed: 20s;
            --bubble-speed: 15s;
            --fish-speed: 25s;
            
            /* 字号缩放 */
            --font-scale: 1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--ocean-deep) 0%, var(--ocean-surface) 50%, var(--ocean-light) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            animation: oceanFlow var(--wave-speed) ease infinite;
            line-height: 1.6;
            transition: all 0.3s ease;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
            font-size: calc(16px * var(--font-scale));
        }

        /* Safari安全区域适配 */
        @supports (padding: max(0px)) {
            body {
                padding-top: max(0px, env(safe-area-inset-top));
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
                padding-bottom: max(0px, env(safe-area-inset-bottom));
            }
        }

        /* 海洋背景动画 */
        @keyframes oceanFlow {
            0%, 100% { 
                background: linear-gradient(135deg, var(--ocean-deep) 0%, var(--ocean-surface) 50%, var(--ocean-light) 100%);
            }
            25% { 
                background: linear-gradient(135deg, var(--ocean-surface) 0%, var(--ocean-turquoise) 50%, var(--ocean-seafoam) 100%);
            }
            50% { 
                background: linear-gradient(135deg, var(--ocean-light) 0%, var(--ocean-foam) 50%, var(--ocean-turquoise) 100%);
            }
            75% { 
                background: linear-gradient(135deg, var(--ocean-turquoise) 0%, var(--ocean-seafoam) 50%, var(--ocean-light) 100%);
            }
        }

        /* 海洋波浪效果 */
        .ocean-waves {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: waveMove 8s linear infinite;
            z-index: 2;
        }

        .ocean-waves::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.05) 60%, transparent 80%);
            animation: waveMove 6s linear infinite reverse;
        }

        @keyframes waveMove {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* 全屏模式样式 */
        .fullscreen-container {
            position: relative;
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .fullscreen-container.is-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        /* 海洋气泡效果 */
        .ocean-bubbles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .bubble {
            position: absolute;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.1) 70%, transparent 100%);
            border-radius: 50%;
            animation: bubbleFloat var(--bubble-speed) linear infinite;
        }

        .bubble:nth-child(1) { width: 20px; height: 20px; left: 10%; animation-delay: 0s; }
        .bubble:nth-child(2) { width: 15px; height: 15px; left: 20%; animation-delay: 2s; }
        .bubble:nth-child(3) { width: 25px; height: 25px; left: 30%; animation-delay: 4s; }
        .bubble:nth-child(4) { width: 18px; height: 18px; left: 40%; animation-delay: 6s; }
        .bubble:nth-child(5) { width: 22px; height: 22px; left: 50%; animation-delay: 8s; }
        .bubble:nth-child(6) { width: 16px; height: 16px; left: 60%; animation-delay: 10s; }
        .bubble:nth-child(7) { width: 24px; height: 24px; left: 70%; animation-delay: 12s; }
        .bubble:nth-child(8) { width: 19px; height: 19px; left: 80%; animation-delay: 14s; }

        @keyframes bubbleFloat {
            0% {
                bottom: -50px;
                opacity: 0;
                transform: scale(0.5);
            }
            10% {
                opacity: 1;
                transform: scale(1);
            }
            90% {
                opacity: 1;
                transform: scale(1.2);
            }
            100% {
                bottom: 100vh;
                opacity: 0;
                transform: scale(0.8);
            }
        }

        /* 海洋鱼类动画 */
        .ocean-fish {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .fish {
            position: absolute;
            font-size: 24px;
            animation: fishSwim var(--fish-speed) linear infinite;
            opacity: 0.6;
        }

        .fish:nth-child(1) { top: 20%; animation-delay: 0s; }
        .fish:nth-child(2) { top: 40%; animation-delay: 5s; }
        .fish:nth-child(3) { top: 60%; animation-delay: 10s; }
        .fish:nth-child(4) { top: 80%; animation-delay: 15s; }

        @keyframes fishSwim {
            0% {
                left: -50px;
                transform: translateY(0px) rotateY(0deg);
            }
            50% {
                transform: translateY(-20px) rotateY(0deg);
            }
            51% {
                transform: translateY(-20px) rotateY(180deg);
            }
            100% {
                left: calc(100vw + 50px);
                transform: translateY(0px) rotateY(180deg);
            }
        }

        /* 浮动粒子效果 */
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .floating-particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            animation: floatParticle 30s linear infinite;
            box-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        @keyframes floatParticle {
            0% {
                transform: translateY(100vh) rotate(0deg) scale(0);
                opacity: 0;
            }
            5% {
                opacity: 1;
                transform: translateY(95vh) rotate(18deg) scale(1);
            }
            95% {
                opacity: 1;
                transform: translateY(-5vh) rotate(342deg) scale(1);
            }
            100% {
                transform: translateY(-10vh) rotate(360deg) scale(0);
                opacity: 0;
            }
        }

        /* 全屏控制按钮 */
        .fullscreen-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            display: flex;
            gap: 10px;
            opacity: 0.9;
            transition: all 0.3s ease;
        }

        .fullscreen-controls:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .fullscreen-btn, .exit-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .fullscreen-btn:hover, .exit-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }

        .fullscreen-btn.active {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            border-color: var(--accent-color);
        }
        
        /* 字号调节按钮 */
        .font-size-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .font-size-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }

        /* 移动端全屏控制优化 */
        .mobile-controls {
            top: 10px;
            right: 10px;
            gap: 8px;
        }

        .mobile-controls .fullscreen-btn,
        .mobile-controls .exit-btn,
        .mobile-controls .font-size-btn {
            padding: 10px 16px;
            font-size: 0.8em;
            border-radius: 20px;
            min-width: 44px;
            min-height: 44px;
            justify-content: center;
        }

        .mobile-controls .btn-text {
            display: none;
        }

        .mobile-controls .fullscreen-btn:hover,
        .mobile-controls .exit-btn:hover {
            transform: scale(1.1);
        }

        /* AI浮动助手按钮 */
        .ai-assistant-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .ai-assistant-float:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.6);
        }

        .ai-assistant-float.pulse {
            animation: aiPulse 2s infinite;
        }

        @keyframes aiPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
            }
            50% { 
                transform: scale(1.1); 
                box-shadow: 0 12px 40px rgba(102, 126, 234, 0.8);
            }
        }

        /* AI弹窗样式 */
        .ai-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .ai-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .ai-modal {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8) translateY(50px);
            transition: all 0.3s ease;
        }

        .ai-modal-overlay.show .ai-modal {
            transform: scale(1) translateY(0);
        }

        /* AI弹窗全屏模式 */
        .ai-modal.fullscreen {
            width: 100vw;
            height: 100vh;
            max-width: none;
            max-height: none;
            border-radius: 0;
            display: flex;
            flex-direction: column;
        }

        .ai-modal.fullscreen .ai-modal-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100%;
            max-height: none;
        }

        .ai-modal.fullscreen .ai-chat-container {
            flex: 1;
            overflow: hidden;
        }

        .ai-modal.fullscreen .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
        }

        .ai-modal.fullscreen .ai-question-display {
            max-height: 120px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .ai-modal.fullscreen .ai-quick-tips {
            padding: 10px 20px;
            flex-shrink: 0;
        }

        .ai-modal.fullscreen .ai-tips-grid {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 6px;
        }

        .ai-modal.fullscreen .ai-tip-btn {
            padding: 6px 10px;
            font-size: 11px;
        }

        .ai-modal.fullscreen .ai-chat-input-area {
            flex-shrink: 0;
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            position: sticky;
            bottom: 0;
            z-index: 10;
        }



        .ai-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-modal-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .ai-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .ai-modal-content {
            padding: 0;
            max-height: 60vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .ai-chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 200px;
            overflow: hidden;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .ai-message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .ai-message.user {
            flex-direction: row-reverse;
        }

        .ai-message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .ai-message.user .ai-message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .ai-message.ai .ai-message-avatar {
            background: linear-gradient(135deg, #34d399, #10b981);
            color: white;
        }

        .ai-message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 80%;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
        }

        .ai-message.user .ai-message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        /* AI消息中的快捷键样式 */
        .ai-message-content kbd {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
            color: #495057;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            display: inline-block;
            margin: 0 2px;
        }

        .ai-chat-input-area {
            background: white;
            border-top: 1px solid #e9ecef;
            padding: 15px 20px;
            flex-shrink: 0;
        }

        .ai-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .ai-chat-input {
            flex: 1;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 14px;
            resize: none;
            max-height: 100px;
            min-height: 40px;
            transition: all 0.3s ease;
        }

        .ai-chat-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .ai-send-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .ai-send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .ai-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* AI题目显示区域 */
        .ai-question-display {
            padding: 15px 20px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-bottom: 1px solid #e9ecef;
            max-height: 200px;
            overflow-y: auto;
        }

        .ai-question-title {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-question-content {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
            background: white;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        /* AI快捷提示 */
        .ai-quick-tips {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .ai-quick-tips h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
        }

        .ai-tip-btn {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .ai-tip-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        /* AI批改功能样式 */
        .ai-grading-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 15px;
            border: 2px solid #667eea;
        }

        .ai-grading-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .ai-grading-title {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-grading-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 20px;
            color: white;
            padding: 8px 16px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ai-grading-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .ai-grading-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .ai-grading-result {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .ai-grading-score {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .ai-score-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white;
        }

        .ai-score-circle.excellent {
            background: linear-gradient(135deg, #34d399, #10b981);
        }

        .ai-score-circle.good {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
        }

        .ai-score-circle.average {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }

        .ai-score-circle.poor {
            background: linear-gradient(135deg, #f87171, #ef4444);
        }

        .ai-score-details h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: #333;
        }

        .ai-score-details p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }

        .ai-grading-feedback {
            font-size: 14px;
            line-height: 1.6;
            color: #495057;
        }



        /* 移动端优化 */
        @media (max-width: 768px) {
            .ai-assistant-float {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .ai-modal {
                width: 95%;
                max-height: 85vh;
            }

            .ai-modal.fullscreen {
                width: 100vw;
                height: 100vh;
                height: 100dvh; /* 支持动态视口高度 */
            }

            .ai-modal-header {
                padding: 15px;
            }

            .ai-modal-title {
                font-size: 16px;
            }

            .ai-chat-container {
                flex: 1;
                min-height: 200px;
            }

            .ai-modal.fullscreen .ai-chat-container {
                flex: 1;
            }

            .ai-chat-messages {
                padding: 15px;
            }

            .ai-tips-grid {
                grid-template-columns: 1fr;
            }



            .ai-modal.fullscreen .ai-question-display {
                max-height: 120px;
            }

            .ai-modal.fullscreen .ai-modal-header {
                padding: 10px 15px;
            }

            .ai-modal.fullscreen .ai-chat-messages {
                padding: 10px;
            }
        }

        /* 隐藏原来的快捷键提示 */
        .shortcuts-hint {
            display: none;
        }

        /* 移动端全屏模式优化 */
        @media (max-width: 768px) {
            .is-fullscreen .practice-container {
                padding: 0;
                margin: 0;
                width: 100vw;
                height: 100vh;
                overflow: hidden;
            }
            
            .is-fullscreen .question-card {
                margin: 0;
                border-radius: 0;
                height: 100vh;
                overflow-y: auto;
                padding: 60px 20px 20px;
            }
            
            .fullscreen-controls {
                opacity: 1;
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 10001;
            }
        }

        /* 主要内容区域 */
        .practice-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 40px;
            position: relative;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .is-fullscreen .practice-container {
            max-width: 100%;
            padding: 80px 40px 40px;
            height: 100vh;
            overflow-y: auto;
        }

        /* 页面标题 */
        .page-title {
            text-align: center;
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 700;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #fff, #f0f8ff, #e6f3ff, #fff);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleShine 4s ease-in-out infinite;
            text-shadow: 0 0 50px rgba(255,255,255,0.3);
        }

        @keyframes titleShine {
            0%, 100% { background-position: 0% 50%; filter: brightness(1); }
            50% { background-position: 100% 50%; filter: brightness(1.3); }
        }

        /* 题库选择界面 */
        .question-bank-selector {
            background: rgba(255,255,255,0.95);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            color: #333;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .selector-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .selector-title {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .selector-subtitle {
            font-size: 1.1em;
            color: #666;
        }

        /* 统计面板 */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        /* 筛选区域 */
        .filter-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .filter-header {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-weight: 500;
            color: #495057;
            font-size: 0.95em;
        }

        .filter-select, .filter-input {
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: white;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        /* 操作按钮 */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .action-btn {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* 解析相关样式 */
        .explanation-toggle {
            margin: 20px 0;
            text-align: center;
        }

        .analysis-btn {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.3);
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        /* 原有的action-btn样式 */
        .action-btn {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(79, 172, 254, 0.5);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #38f9d7);
            box-shadow: 0 10px 30px rgba(67, 233, 123, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 15px 40px rgba(67, 233, 123, 0.5);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #ff9ff3);
            box-shadow: 0 10px 30px rgba(254, 202, 87, 0.3);
        }

        .btn-warning:hover {
            box-shadow: 0 15px 40px rgba(254, 202, 87, 0.5);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error-color), #ee5a52);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.5);
        }

        /* 题库列表 */
        .question-bank-list {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            max-height: 600px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) #f0f0f0;
        }

        .question-bank-list::-webkit-scrollbar {
            width: 8px;
        }

        .question-bank-list::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 4px;
        }

        .question-bank-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .question-bank-list::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        .bank-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bank-item:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.2);
        }

        .bank-item.selected {
            border-color: var(--accent-color);
            background: rgba(79, 172, 254, 0.1);
        }

        .bank-info {
            flex: 1;
        }

        .bank-name {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .bank-meta {
            color: #666;
            font-size: 0.9em;
            display: flex;
            gap: 15px;
        }

        .bank-actions {
            display: flex;
            gap: 10px;
        }

        .bank-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .bank-btn.primary {
            background: var(--accent-color);
            color: white;
        }

        .bank-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .bank-btn:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }

        /* 练习界面（原有的题目卡片样式保持不变） */
        .practice-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            padding: 0 10px;
        }

        .stat-item {
            background: var(--glass-bg);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            transition: all 0.4s ease;
            animation: statSlideUp 0.8s ease-out both;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stat-item:nth-child(1) { animation-delay: 0.1s; }
        .stat-item:nth-child(2) { animation-delay: 0.2s; }
        .stat-item:nth-child(3) { animation-delay: 0.3s; }
        .stat-item:nth-child(4) { animation-delay: 0.4s; }

        @keyframes statSlideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-item:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #fff, #f0f8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: numberCount 2s ease-out;
        }

        @keyframes numberCount {
            from { 
                opacity: 0; 
                transform: scale(0.5) rotateY(180deg); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) rotateY(0deg); 
            }
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
            font-weight: 500;
        }

        /* 题目卡片 */
        .question-card {
            background: rgba(255,255,255,0.95);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            color: #333;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            animation: questionSlideIn 0.8s ease-out both;
            border: 2px solid transparent;
        }

        @keyframes questionSlideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .question-card:hover::before {
            opacity: 1;
        }

        .question-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 80px rgba(0,0,0,0.25);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        .question-number {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            animation: numberPulse 2s ease-in-out infinite;
        }

        @keyframes numberPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .question-difficulty {
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .difficulty-easy { 
            background: linear-gradient(135deg, var(--success-color), #38f9d7); 
            color: white; 
        }
        .difficulty-medium { 
            background: linear-gradient(135deg, var(--warning-color), #ff9ff3); 
            color: white; 
        }
        .difficulty-hard { 
            background: linear-gradient(135deg, var(--error-color), #ee5a52); 
            color: white; 
        }

        .question-title {
            font-size: 1.4em;
            font-weight: 600;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 5px solid var(--primary-color);
            border-radius: 15px;
            position: relative;
            z-index: 2;
        }

        .question-content {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        /* 选项样式 */
        .options-list {
            list-style: none;
            margin-bottom: 30px;
        }

        .option-item {
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 18px 25px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            line-height: 1.6;
        }

        .option-label:hover {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-color: var(--accent-color);
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(79, 172, 254, 0.3);
        }

        .option-label.selected {
            background: linear-gradient(135deg, var(--accent-color), #00f2fe);
            border-color: var(--accent-color);
            color: white;
            transform: translateX(10px);
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.4);
        }

        .option-label.correct {
            background: linear-gradient(135deg, var(--success-color), #38f9d7);
            border-color: var(--success-color);
            color: white;
        }

        .option-label.incorrect {
            background: linear-gradient(135deg, var(--error-color), #ee5a52);
            border-color: var(--error-color);
            color: white;
        }

        .option-radio {
            margin-right: 15px;
            transform: scale(1.2);
        }

        .option-letter {
            font-weight: bold;
            margin-right: 15px;
            min-width: 25px;
            font-size: 1.1em;
        }

        /* 结果显示 */
        .result-display {
            margin-top: 25px;
            padding: 20px;
            border-radius: 15px;
            animation: resultSlideIn 0.5s ease-out;
            position: relative;
            z-index: 2;
        }

        @keyframes resultSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-correct {
            background: linear-gradient(135deg, rgba(67, 233, 123, 0.2), rgba(56, 249, 215, 0.2));
            border: 2px solid var(--success-color);
        }

        .result-incorrect {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(238, 90, 82, 0.2));
            border: 2px solid var(--error-color);
        }

        .result-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            font-size: 0.95em;
            line-height: 1.6;
        }

        /* 通知组件 */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 15px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            max-width: 90vw;
        }

        .notification.show {
            animation: notificationSlideIn 0.3s ease-out;
        }

        @keyframes notificationSlideIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success-color), #38f9d7);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--error-color), #ee5a52);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--accent-color), #00f2fe);
        }

        /* 快捷键提示 */
        .shortcuts-hint {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--glass-bg);
            padding: 15px 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            font-size: 0.85em;
            opacity: 0.8;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .shortcuts-hint:hover {
            opacity: 1;
            transform: translateY(-3px);
        }

        /* 加载动画 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 1.2em;
            font-weight: 500;
            text-align: center;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .practice-container {
                padding: 0;
                margin: 0;
                width: 100vw;
                min-height: 100vh;
                overflow-x: hidden;
            }
            
            .is-fullscreen .practice-container {
                padding: 0;
                margin: 0;
                width: 100vw;
                height: 100vh;
                overflow: hidden;
            }
            
            .page-title {
                font-size: 1.8rem;
                margin: 20px 15px 20px 15px;
                text-align: center;
                padding: 0;
            }
            
            .question-bank-selector {
                padding: 15px;
                margin: 0 15px 20px 15px;
                border-radius: 15px;
            }
            
            .selector-title {
                font-size: 1.5rem;
                margin-bottom: 10px;
            }
            
            .selector-subtitle {
                font-size: 0.9rem;
                margin-bottom: 20px;
            }
            
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin: 0 15px 20px 15px;
                padding: 0;
            }
            
            .stat-card {
                padding: 12px;
                border-radius: 10px;
            }
            
            .stat-number {
                font-size: 1.3rem;
            }
            
            .stat-label {
                font-size: 0.75rem;
            }
            
            .filter-section {
                margin: 0 15px 20px 15px;
            }
            
            .filter-header {
                font-size: 0.9rem;
                padding: 10px 12px;
                border-radius: 8px 8px 0 0;
            }
            
            .filter-controls {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 12px;
            }
            
            .filter-group {
                margin-bottom: 0;
            }
            
            .filter-label {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }
            
            .filter-select {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .question-card {
                padding: 15px;
                margin: 0 15px 20px 15px;
                border-radius: 12px;
            }
            
            .question-text {
                font-size: 1rem;
                line-height: 1.6;
                margin-bottom: 15px;
            }
            
            .options-list {
                gap: 10px;
            }
            
            .option-btn {
                padding: 12px 15px;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
                gap: 12px;
                margin: 0 15px 20px 15px;
            }
            
            .action-btn {
                width: 100%;
                max-width: none;
                justify-content: center;
                padding: 12px 16px;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            
            .practice-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin: 0 15px 20px 15px;
            }
            
            .fullscreen-controls {
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 10001;
                opacity: 1;
                display: flex;
                gap: 8px;
            }
            
            .mobile-controls {
                gap: 8px;
            }
            
            .mobile-controls .fullscreen-btn,
            .mobile-controls .exit-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
                min-width: 40px;
                min-height: 40px;
            }
            
            .shortcuts-hint {
                display: none;
            }
            
            /* 移动端填空题优化 */
            .fill-blank-section {
                margin: 0 15px 15px 15px;
            }
            
            .answer-input-container {
                padding: 15px;
            }
            
            .input-label {
                font-size: 0.9rem;
                margin-bottom: 10px;
            }
            
            .answer-input {
                padding: 12px;
                font-size: 0.9rem;
                min-height: 80px;
            }
            
            .input-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .submit-btn, .show-answer-btn {
                width: 100%;
                padding: 12px;
                font-size: 0.9rem;
            }
            
            /* 移动端结果显示优化 */
            .result-display {
                padding: 15px;
                margin: 0 15px 15px 15px;
            }
            
            .result-icon {
                font-size: 1.2rem;
            }
            
            .explanation {
                font-size: 0.9rem;
                line-height: 1.5;
                margin-top: 10px;
            }
            
            .analysis-btn {
                width: 100%;
                padding: 10px;
                font-size: 0.9rem;
                margin-top: 10px;
            }
            
            .result-actions {
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
            }
            
            .btn-primary, .btn-secondary, .btn-success {
                width: 100%;
                padding: 12px;
                font-size: 0.9rem;
            }
            
            /* 移动端题库选择优化 */
            .quick-access-section {
                margin: 0 15px 20px 15px;
            }
            
            .quick-access-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .quick-bank-card {
                padding: 12px;
                border-radius: 10px;
            }
            
            .quick-bank-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .quick-bank-info h4 {
                font-size: 1rem;
                margin-bottom: 3px;
            }
            
            .quick-bank-info p {
                font-size: 0.8rem;
                margin-bottom: 5px;
            }
            
            .bank-stats {
                font-size: 0.7rem;
                padding: 3px 6px;
            }
            
            /* 移动端智能练习优化 */
            .smart-practice-section {
                margin: 0 15px 20px 15px;
            }
            
            .smart-practice-card {
                padding: 12px;
                border-radius: 10px;
            }
            
            .smart-practice-header {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .smart-practice-info {
                font-size: 0.8rem;
                margin-bottom: 15px;
            }
            
            .smart-practice-btn {
                width: 100%;
                padding: 12px;
                font-size: 0.9rem;
            }
        
        /* 移动端触摸优化 */
        .option-btn, .action-btn, .filter-select, .quick-bank-card {
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            touch-action: manipulation;
        }
        
        /* 移动端滚动优化 */
        .question-bank-list {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        
        /* 移动端通知优化 */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10002;
            max-width: 90%;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* 移动端加载动画优化 */
        .loading-spinner {
            width: 40px;
            height: 40px;
        }
        
        /* 移动端键盘优化 */
        .answer-input {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        /* 移动端安全区域适配 */
        @supports (padding: max(0px)) {
            .practice-container {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
                padding-bottom: max(0px, env(safe-area-inset-bottom));
            }
            
            .page-title {
                margin-left: max(15px, env(safe-area-inset-left));
                margin-right: max(15px, env(safe-area-inset-right));
            }
            
            .question-bank-selector,
            .stats-panel,
            .filter-section,
            .quick-access-section,
            .smart-practice-section,
            .action-buttons,
            .question-card {
                margin-left: max(15px, env(safe-area-inset-left));
                margin-right: max(15px, env(safe-area-inset-right));
            }
            
            .fullscreen-controls {
                top: max(10px, env(safe-area-inset-top));
                right: max(10px, env(safe-area-inset-right));
            }
        }
    }

        /* 填空题样式 */
        .fill-blank-section {
            margin: 20px 0;
        }

        .answer-input-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }

        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #495057;
            font-size: 16px;
        }

        .input-label i {
            margin-right: 8px;
            color: var(--primary-color);
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .answer-comparison {
            margin-top: 25px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            overflow: hidden;
        }

        .comparison-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
        }

        .comparison-header h4 {
            margin: 0;
            font-size: 18px;
        }

        .comparison-header i {
            margin-right: 8px;
        }

        .comparison-content {
            padding: 20px;
        }

        .user-answer-section,
        .standard-answer-section {
            margin-bottom: 20px;
        }

        .user-answer-section h5,
        .standard-answer-section h5 {
            margin: 0 0 10px 0;
            font-size: 16px;
            font-weight: 600;
        }

        .user-answer-section h5 {
            color: #495057;
        }

        .standard-answer-section h5 {
            color: #28a745;
        }

        .answer-box {
            padding: 15px;
            border-radius: 8px;
            font-size: 15px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .user-answer {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
        }

        .standard-answer {
            background: #d4edda;
            border: 2px solid #c3e6cb;
        }

        .similarity-score {
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .score-display {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .score-label {
            margin-right: 10px;
            color: #495057;
        }

        .score-value {
            font-weight: bold;
            font-size: 24px;
        }

        .score-value.high {
            color: #28a745;
        }

        .score-value.medium {
            color: #ffc107;
        }

        .score-value.low {
            color: #dc3545;
        }

        .score-feedback {
            font-size: 16px;
            font-weight: 600;
        }

        .score-feedback.excellent {
            color: #28a745;
        }

        .score-feedback.good {
            color: #17a2b8;
        }

        .score-feedback.average {
            color: #ffc107;
        }

        .score-feedback.poor {
            color: #dc3545;
        }

        /* 快速访问题库样式 */
        .quick-bank-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quick-bank-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .quick-bank-card:active {
            transform: translateY(-1px);
        }

        .quick-bank-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            flex-shrink: 0;
        }

        .quick-bank-info {
            flex: 1;
        }

        .quick-bank-info h4 {
            margin: 0 0 5px 0;
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        .quick-bank-info p {
            margin: 0 0 8px 0;
            color: #666;
            font-size: 14px;
        }

        .bank-stats {
            display: inline-block;
            background: #f8f9fa;
            color: #495057;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .quick-bank-arrow {
            color: #6c757d;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .quick-bank-card:hover .quick-bank-arrow {
            color: var(--primary-color);
            transform: translateX(5px);
        }

        .quick-bank-arrow .rotated {
            transform: rotate(180deg);
        }

        .classification-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            color: #495057;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .classification-btn:hover {
            background: #28a745;
            border-color: #28a745;
            color: white;
            transform: translateY(-2px);
        }

        .classification-btn i {
            font-size: 16px;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .quick-banks-grid {
                grid-template-columns: 1fr !important;
                gap: 12px;
            }

            .quick-bank-card {
                padding: 15px;
                gap: 12px;
            }

            .quick-bank-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .quick-bank-info h4 {
                font-size: 16px;
            }

            .classification-list {
                padding: 15px !important;
            }

            .classification-btn {
                padding: 10px 12px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- 浮动粒子效果 -->
    <div class="floating-elements">
        <div class="floating-particle" style="left: 8%; animation-delay: 0s;"></div>
        <div class="floating-particle" style="left: 18%; animation-delay: 4s;"></div>
        <div class="floating-particle" style="left: 28%; animation-delay: 8s;"></div>
        <div class="floating-particle" style="left: 38%; animation-delay: 12s;"></div>
        <div class="floating-particle" style="left: 48%; animation-delay: 16s;"></div>
        <div class="floating-particle" style="left: 58%; animation-delay: 20s;"></div>
        <div class="floating-particle" style="left: 68%; animation-delay: 24s;"></div>
        <div class="floating-particle" style="left: 78%; animation-delay: 28s;"></div>
        <div class="floating-particle" style="left: 88%; animation-delay: 32s;"></div>
    </div>

    <div id="app" :class="['fullscreen-container', { 'is-fullscreen': isFullscreen }]">
        <!-- 加载覆盖层 -->
        <div v-if="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">{{ loadingText }}</div>
        </div>

        <!-- 通知组件 -->
        <div v-if="notification.show" :class="['notification', notification.type, {show: notification.show}]">
            {{ notification.message }}
        </div>

        <!-- 全屏控制按钮 -->
        <div class="fullscreen-controls" :class="{ 'mobile-controls': isMobile }">
            <button @click="toggleFullscreen" :class="['fullscreen-btn', { active: isFullscreen }]" :title="isFullscreen ? '退出全屏 [F11]' : '进入全屏 [F11]'">
                <i :class="isFullscreen ? 'fas fa-compress' : 'fas fa-expand'"></i>
                <span class="btn-text">{{ isFullscreen ? '退出全屏' : '全屏模式' }}</span>
            </button>
            <button @click="changeFontSize" class="font-size-btn" :title="'字号调节: ' + fontSize">
                <i class="fas fa-text-height"></i>
                <span class="btn-text">{{ fontSize === 'small' ? '小' : fontSize === 'large' ? '大' : '中' }}</span>
            </button>
            <button @click="backToSelector" class="exit-btn" title="返回题库选择 [ESC]">
                <i class="fas fa-arrow-left"></i> 
                <span class="btn-text">返回题库</span>
            </button>
        </div>

        <!-- 主要内容 -->
        <div v-if="!loading" class="practice-container">
            <!-- 海洋动画元素 -->
            <div class="ocean-waves"></div>
            <div class="ocean-bubbles">
                <div class="bubble"></div>
                <div class="bubble"></div>
                <div class="bubble"></div>
                <div class="bubble"></div>
                <div class="bubble"></div>
                <div class="bubble"></div>
                <div class="bubble"></div>
                <div class="bubble"></div>
            </div>
            <div class="ocean-fish">
                <div class="fish">🐠</div>
                <div class="fish">🐟</div>
                <div class="fish">🐡</div>
                <div class="fish">🦈</div>
            </div>
            <!-- 页面标题 -->
            <h1 class="page-title">🧠 智能题库练习</h1>

            <!-- 题库选择界面 -->
            <div v-if="currentView === 'selector'" class="question-bank-selector">
                <div class="selector-header">
                    <h2 class="selector-title">📚 选择题库</h2>
                    <p class="selector-subtitle">支持按年份、分类、难度筛选，批量加载所有题库</p>
                </div>

                <!-- 统计面板 -->
                <div class="stats-panel">
                    <div class="stat-card">
                        <div class="stat-number">{{ totalQuestions }}</div>
                        <div class="stat-label">总题数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ availableBanks.length }}</div>
                        <div class="stat-label">可用题库</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ answeredQuestions }}</div>
                        <div class="stat-label">已答题</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ correctRate }}%</div>
                        <div class="stat-label">正确率</div>
                    </div>
                </div>

                <!-- 快速访问题库 -->
                <div class="quick-access-section" style="margin: 30px 0; padding: 25px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; border: 1px solid #dee2e6;">
                    <h3 style="margin: 0 0 20px 0; color: #495057; display: flex; align-items: center; gap: 10px; font-size: 18px;">
                        <i class="fas fa-rocket"></i> 快速访问题库
                        <span style="font-size: 14px; color: #6c757d; font-weight: normal;">- 一键直达各类专项练习</span>
                    </h3>
                    
                    <div class="quick-banks-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                        <!-- 易错题集 -->
                        <div class="quick-bank-card error-prone" @click="quickStartPractice('易错题集')" style="cursor: pointer;">
                            <div class="quick-bank-icon" style="background: linear-gradient(135deg, #dc3545, #c82333);">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="quick-bank-info">
                                <h4>易错题集</h4>
                                <p>高频易错题专项训练</p>
                                <span class="bank-stats">重点突破 · 提升正确率</span>
                            </div>
                            <div class="quick-bank-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>

                        <!-- 历年真题 -->
                        <div class="quick-bank-card real-exam" @click="quickStartPractice('历年真题')" style="cursor: pointer;">
                            <div class="quick-bank-icon" style="background: linear-gradient(135deg, #007bff, #0056b3);">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="quick-bank-info">
                                <h4>历年真题</h4>
                                <p>中国海洋大学2001-2023</p>
                                <span class="bank-stats">真题演练 · 实战检验</span>
                            </div>
                            <div class="quick-bank-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>

                        <!-- 分类练习 -->
                        <div class="quick-bank-card classification" @click="showClassificationMenu" style="cursor: pointer;">
                            <div class="quick-bank-icon" style="background: linear-gradient(135deg, #28a745, #1e7e34);">
                                <i class="fas fa-th-list"></i>
                            </div>
                            <div class="quick-bank-info">
                                <h4>分类练习</h4>
                                <p>按知识点分类专项练习</p>
                                <span class="bank-stats">系统学习 · 逐一突破</span>
                            </div>
                            <div class="quick-bank-arrow">
                                <i class="fas fa-chevron-down" :class="{ 'rotated': showClassificationList }"></i>
                            </div>
                        </div>

                        <!-- 全部题库 -->
                        <div class="quick-bank-card all-banks" @click="loadAllQuestionBanks" style="cursor: pointer;">
                            <div class="quick-bank-icon" style="background: linear-gradient(135deg, #6f42c1, #59339d);">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="quick-bank-info">
                                <h4>全部题库</h4>
                                <p>加载所有18个题库</p>
                                <span class="bank-stats">海量题目 · 综合练习</span>
                            </div>
                            <div class="quick-bank-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <!-- 分类题库展开列表 -->
                    <div v-if="showClassificationList" class="classification-list" style="margin-top: 20px; padding: 20px; background: white; border-radius: 12px; border: 2px solid #28a745;">
                        <h4 style="margin: 0 0 15px 0; color: #28a745; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-list-ul"></i> 选择分类题库
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <button v-for="category in classificationCategories" 
                                    :key="category.id"
                                    @click="quickStartClassification(category.id, category.name)"
                                    class="classification-btn">
                                <i :class="category.icon"></i>
                                {{ category.name }}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 筛选区域 -->
                <div class="filter-section">
                    <div class="filter-header">
                        <i class="fas fa-filter"></i>
                        筛选条件
                    </div>
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label class="filter-label">题库类型</label>
                            <select v-model="filters.category" class="filter-select">
                                <option value="">全部类型</option>
                                <option v-if="isRealExamMode" value="历年真题">历年真题</option>
                                <option v-if="isRealExamMode" value="易错题集">易错题集</option>
                                <option v-if="isRealExamMode" value="计算题集">计算题集</option>
                                <option v-if="isRealExamMode" value="综合题集">综合题集</option>
                                <option v-if="!isRealExamMode" value="真题">历年真题</option>
                                <option v-if="!isRealExamMode" value="分类">分类练习</option>
                                <option v-if="!isRealExamMode" value="易错">易错题集</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">年份</label>
                            <select v-model="filters.year" class="filter-select">
                                <option value="">全部年份</option>
                                <option v-if="isRealExamMode" value="all">所有历年真题</option>
                                <option v-if="isRealExamMode" value="error-prone">易错题集</option>
                                <option v-if="isRealExamMode" value="calculation">计算题集</option>
                                <option v-if="isRealExamMode" value="comprehensive">综合题集</option>
                                <option v-for="year in availableYears" :key="year" :value="year">{{ year }}年真题</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">难度</label>
                            <select v-model="filters.difficulty" class="filter-select">
                                <option value="">全部难度</option>
                                <option value="easy">简单</option>
                                <option value="medium">中等</option>
                                <option value="hard">困难</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">搜索关键词</label>
                            <input v-model="filters.keyword" class="filter-input" placeholder="搜索题库名称或内容...">
                        </div>
                    </div>
                </div>

                <!-- 智能练习按钮 -->
                <div v-if="canStartPractice" class="smart-practice-section" style="margin: 20px 0; padding: 20px; background: rgba(102, 126, 234, 0.1); border-radius: 15px; border: 2px solid var(--primary-color);">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;">
                        <i class="fas fa-magic"></i> 智能练习
                    </h3>
                    <p style="margin-bottom: 15px; color: #666;">
                        已选择: <strong>{{ getSelectedFilterText() }}</strong>
                        <span v-if="loadedQuestionsCount > 0"> | 已加载: {{ loadedQuestionsCount }}题</span>
                    </p>
                    <div class="action-buttons" style="margin: 0;">
                        <button @click="startSmartPractice('normal')" class="action-btn btn-success">
                            <i class="fas fa-play"></i> 开始练习
                        </button>
                        <button @click="startSmartPractice('random')" class="action-btn btn-primary">
                            <i class="fas fa-random"></i> 随机练习
                        </button>
                        <button @click="previewLoadedQuestions" class="action-btn">
                            <i class="fas fa-eye"></i> 预览题目
                        </button>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="action-buttons">
                    <button @click="loadAllQuestionBanks" class="action-btn">
                        <i class="fas fa-download"></i> 批量加载所有题库
                    </button>
                    <button @click="loadFromGitHub" class="action-btn btn-success">
                        <i class="fab fa-github"></i> 从GitHub加载
                    </button>
                    <button @click="loadFromLocal" class="action-btn btn-warning">
                        <i class="fas fa-folder"></i> 从本地加载
                    </button>
                    <button @click="startRandomPractice" class="action-btn btn-success" :disabled="totalQuestions === 0">
                        <i class="fas fa-random"></i> 随机练习模式
                    </button>
                    <button @click="enterFullscreenMode" class="action-btn">
                        <i class="fas fa-expand"></i> 全屏练习模式
                    </button>
                    <button @click="resetProgress" class="action-btn btn-danger">
                        <i class="fas fa-redo"></i> 重置进度
                    </button>
                </div>

                <!-- 题库列表 -->
                <div v-if="filteredBanks.length > 0" class="question-bank-list">
                    <div 
                        v-for="bank in filteredBanks" 
                        :key="bank.id"
                        :class="['bank-item', { selected: selectedBanks.includes(bank.id) }]"
                        @click="toggleBankSelection(bank.id)"
                    >
                        <div class="bank-info">
                            <div class="bank-name">{{ bank.name }}</div>
                            <div class="bank-meta">
                                <span><i class="fas fa-question-circle"></i> {{ bank.questionCount || 0 }} 题</span>
                                <span><i class="fas fa-tag"></i> {{ bank.category || '未分类' }}</span>
                                <span v-if="bank.year"><i class="fas fa-calendar"></i> {{ bank.year }}</span>
                                <span><i class="fas fa-signal"></i> {{ getDifficultyText(bank.difficulty) }}</span>
                            </div>
                        </div>
                        <div class="bank-actions" @click.stop>
                            <button @click="startBankPractice(bank.id)" class="bank-btn primary">
                                <i class="fas fa-play"></i> 开始练习
                            </button>
                            <button @click="previewBank(bank.id)" class="bank-btn secondary">
                                <i class="fas fa-eye"></i> 预览
                            </button>
                        </div>
                    </div>
                </div>

                <div v-else-if="!isLoadingBanks" class="question-bank-list" style="text-align: center; color: #666;">
                    <i class="fas fa-search" style="font-size: 3em; margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3>没有找到匹配的题库</h3>
                    <p>请调整筛选条件或加载题库数据</p>
                </div>

                <div v-if="selectedBanks.length > 0" class="action-buttons" style="margin-top: 20px;">
                    <button @click="startSelectedBanksPractice" class="action-btn btn-success">
                        <i class="fas fa-play"></i> 开始练习选中题库 ({{ selectedBanks.length }}个)
                    </button>
                    <button @click="clearSelection" class="action-btn">
                        <i class="fas fa-times"></i> 清除选择
                    </button>
                </div>
            </div>

            <!-- 真题选择器 -->
            <div v-if="currentView === 'realExamSelector'" class="selector-container">
                <div class="selector-header">
                    <h1 class="selector-title">🏆 历年真题选择</h1>
                    <p class="selector-subtitle">选择要练习的真题年份或分类</p>
                </div>

                <!-- 统计面板 -->
                <div class="stats-panel">
                    <div class="stat-card">
                        <div class="stat-number">{{ totalQuestions }}</div>
                        <div class="stat-label">总题数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ availableBanks.length }}</div>
                        <div class="stat-label">可用题库</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ realExamYears.length }}</div>
                        <div class="stat-label">年份数量</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ answeredQuestions }}</div>
                        <div class="stat-label">已答题</div>
                    </div>
                </div>

                <!-- 真题题库列表 -->
                <div class="question-bank-list">
                    <div 
                        v-for="bank in availableBanks" 
                        :key="bank.id"
                        class="bank-item"
                        @click="startYearPractice(bank.year, 'normal')"
                    >
                        <div class="bank-info">
                            <div class="bank-name">{{ bank.name }}</div>
                            <div class="bank-meta">
                                <span><i class="fas fa-question-circle"></i> {{ bank.questionCount || 0 }} 题</span>
                                <span><i class="fas fa-tag"></i> {{ bank.category || '历年真题' }}</span>
                                <span v-if="bank.year && bank.year !== 'all'"><i class="fas fa-calendar"></i> {{ bank.year }}年</span>
                                <span><i class="fas fa-signal"></i> {{ getDifficultyText(bank.difficulty) }}</span>
                            </div>
                            <div class="bank-description">{{ bank.description }}</div>
                        </div>
                        <div class="bank-actions" @click.stop>
                            <button @click="startYearPractice(bank.year, 'normal')" class="bank-btn primary">
                                <i class="fas fa-play"></i> 顺序练习
                            </button>
                            <button @click="startYearPractice(bank.year, 'random')" class="bank-btn secondary">
                                <i class="fas fa-random"></i> 随机练习
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 返回按钮 -->
                <div class="action-buttons" style="margin-top: 30px;">
                    <button @click="backToSelector" class="action-btn">
                        <i class="fas fa-arrow-left"></i> 返回题库选择
                    </button>
                    <button @click="startYearPractice('all', 'random')" class="action-btn btn-success">
                        <i class="fas fa-random"></i> 随机所有真题
                    </button>
                </div>
            </div>

            <!-- 练习界面 -->
            <div v-if="currentView === 'practice'">
            <!-- 练习统计 -->
            <div class="practice-stats">
                <div class="stat-item">
                    <div class="stat-value">{{ currentQuestionIndex + 1 }}</div>
                    <div class="stat-label">当前题目</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ questions.length }}</div>
                    <div class="stat-label">总题目数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ correctAnswers }}</div>
                    <div class="stat-label">正确题数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ Math.round((correctAnswers / Math.max(answeredQuestions, 1)) * 100) }}%</div>
                    <div class="stat-label">正确率</div>
                </div>
            </div>

            <!-- 题目卡片 -->
            <div v-if="currentQuestion" class="question-card">
                <div class="question-header">
                    <div class="question-number">
                        第 {{ currentQuestionIndex + 1 }} 题
                            <span v-if="currentQuestion.bank" style="font-size: 0.8em; opacity: 0.8;">
                                ({{ currentQuestion.bank }})
                            </span>
                    </div>
                        <div :class="['question-difficulty', `difficulty-${currentQuestion.difficulty || 'medium'}`]">
                        {{ getDifficultyText(currentQuestion.difficulty) }}
                    </div>
                </div>

                <div class="question-title">
                    {{ currentQuestion.title }}
                </div>

                    <div class="question-content" v-if="currentQuestion.content" v-html="currentQuestion.content"></div>

                    <!-- 选择题选项 -->
                    <ul class="options-list" v-if="currentQuestion.options && currentQuestion.options.length > 0">
                    <li v-for="(option, index) in currentQuestion.options" :key="index" class="option-item">
                            <label :class="[
                                'option-label', 
                                { 
                                    selected: selectedAnswer === index,
                                    correct: showResult && index === currentQuestion.answer,
                                    incorrect: showResult && selectedAnswer === index && selectedAnswer !== currentQuestion.answer
                                }
                            ]">
                                <div class="option-letter">{{ String.fromCharCode(65 + index) }}</div>
                            <input 
                                type="radio" 
                                :name="`question-${currentQuestionIndex}`"
                                :value="index"
                                v-model="selectedAnswer"
                                class="option-radio"
                                    style="display: none;"
                            >
                            {{ option }}
                        </label>
                    </li>
                </ul>
                
                    <!-- 填空题/主观题输入区域 -->
                    <div v-else class="fill-blank-section">
                        <div class="answer-input-container">
                            <label class="input-label">
                                <i class="fas fa-pencil-alt"></i>
                                请在下方输入您的答案：
                            </label>
                            <textarea 
                                v-model="userTextAnswer" 
                                :placeholder="getAnswerPlaceholder(currentQuestion)"
                                rows="4"
                                class="answer-input"
                                @input="onAnswerInput"></textarea>
                            
                            <div class="input-actions">
                                <button @click="submitTextAnswer" 
                                        class="action-btn btn-primary"
                                        :disabled="!userTextAnswer.trim() || showResult">
                                    <i class="fas fa-check"></i>
                                    提交答案
                                </button>
                                <button @click="showStandardAnswer" 
                                        class="action-btn btn-outline"
                                        v-if="!showResult">
                                    <i class="fas fa-eye"></i>
                                    查看答案
                                </button>
                            </div>
                        </div>
                        
                        <!-- 答案对比区域 -->
                        <div v-if="showResult || showAnswer" class="answer-comparison">
                            <div class="comparison-header">
                                <h4><i class="fas fa-balance-scale"></i> 答案对比</h4>
                            </div>
                            
                            <div class="comparison-content">
                                <div class="user-answer-section">
                                    <h5><i class="fas fa-user"></i> 您的答案</h5>
                                    <div class="answer-box user-answer">{{ userTextAnswer }}</div>
                                </div>
                                
                                <div class="standard-answer-section">
                                    <h5><i class="fas fa-star"></i> 标准答案</h5>
                                    <div class="answer-box standard-answer" v-html="currentQuestion.answer"></div>
                                </div>
                                
                                <div v-if="showResult" class="similarity-score">
                                    <div class="score-display">
                                        <span class="score-label">相似度:</span>
                                        <span class="score-value" :class="getSimilarityClass(answerSimilarity)">
                                            {{ answerSimilarity }}%
                                        </span>
                                    </div>
                                    <div class="score-feedback" :class="getFeedbackClass(answerSimilarity)">
                                        {{ getFeedbackText(answerSimilarity) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                <div class="action-buttons">
                        <button @click="submitAnswer" class="action-btn" :disabled="selectedAnswer === null || showResult" title="提交答案 [Enter]">
                            <i class="fas fa-check"></i> 提交答案
                        </button>
                        <button @click="saveProgress" class="action-btn btn-warning" title="保存进度 [Ctrl+S]">
                            <i class="fas fa-save"></i> 保存进度
                        </button>
                        <button @click="backToSelector" class="action-btn">
                            <i class="fas fa-arrow-left"></i> 返回题库选择
                        </button>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button @click="previousQuestion" class="action-btn" :disabled="currentQuestionIndex === 0" title="上一题 [←]" style="flex: 1;">
                            <i class="fas fa-arrow-left"></i> 上一题
                        </button>
                        <button @click="nextQuestion" class="action-btn" :disabled="currentQuestionIndex === questions.length - 1" title="下一题 [→]" style="flex: 1;">
                            下一题 <i class="fas fa-arrow-right"></i>
                        </button>
                </div>

                <!-- 答题结果显示 -->
                <div v-if="showResult" :class="['result-display', isCorrect ? 'result-correct' : 'result-incorrect']">
                    <div>
                        <i :class="['result-icon', isCorrect ? 'fas fa-check-circle' : 'fas fa-times-circle']"></i>
                        <strong>{{ isCorrect ? '回答正确！' : '回答错误！' }}</strong>
                        <span v-if="!isCorrect && currentQuestion.options">
                            正确答案是：{{ String.fromCharCode(65 + currentQuestion.answer) }}. {{ currentQuestion.options[currentQuestion.answer] }}
                        </span>
                    </div>
                    
                    <!-- 错误答案时自动显示解析 -->
                    <div v-if="!isCorrect && currentQuestion.explanation" class="explanation">
                        <strong>📖 解析：</strong>{{ currentQuestion.explanation }}
                    </div>
                    
                    <!-- 正确答案时显示解析按钮（移动端友好） -->
                    <div v-if="isCorrect && currentQuestion.explanation" class="explanation-toggle">
                        <button @click="showAnalysis = !showAnalysis" class="analysis-btn">
                            <i class="fas fa-eye"></i> {{ showAnalysis ? '隐藏解析' : '查看解析' }}
                        </button>
                        <div v-if="showAnalysis" class="explanation">
                            <strong>📖 解析：</strong>{{ currentQuestion.explanation }}
                        </div>
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div class="result-actions">
                        <button v-if="!isCorrect" @click="nextQuestion" class="action-btn btn-primary">
                            <i class="fas fa-arrow-right"></i> 下一题
                        </button>
                        <button v-if="!isCorrect" @click="previousQuestion" class="action-btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> 上一题
                        </button>
                    </div>
                </div>

                <!-- AI批改功能 -->
                <div v-if="showResult" class="ai-grading-section">
                    <div class="ai-grading-header">
                        <div class="ai-grading-title">
                            <i class="fas fa-robot"></i> AI智能批改
                        </div>
                        <button @click="requestAIGrading" 
                                :disabled="aiGradingLoading" 
                                class="ai-grading-btn">
                            <i class="fas fa-magic" v-if="!aiGradingLoading"></i>
                            <i class="fas fa-spinner fa-spin" v-else></i>
                            {{ aiGradingLoading ? '分析中...' : 'AI分析' }}
                        </button>
                    </div>
                    
                    <div v-if="aiGradingResult" class="ai-grading-result">
                        <div class="ai-grading-score">
                            <div :class="['ai-score-circle', getAIScoreClass(aiGradingResult.score)]">
                                {{ aiGradingResult.score }}分
                            </div>
                            <div class="ai-score-details">
                                <h4>{{ aiGradingResult.level }}</h4>
                                <p>{{ aiGradingResult.summary }}</p>
                            </div>
                        </div>
                        <div class="ai-grading-feedback" v-html="aiGradingResult.feedback"></div>
                    </div>
                </div>

                <div v-else class="question-card" style="text-align: center; padding: 60px;">
                    <i class="fas fa-graduation-cap" style="font-size: 4em; color: #ccc; margin-bottom: 20px;"></i>
                    <h3>练习完成！</h3>
                    <p style="margin: 20px 0;">
                        总计 {{ questions.length }} 题，正确 {{ correctAnswers }} 题，正确率 {{ Math.round((correctAnswers / Math.max(questions.length, 1)) * 100) }}%
                    </p>
                    <button @click="backToSelector" class="action-btn btn-success">
                        <i class="fas fa-redo"></i> 重新选择题库
                    </button>
                </div>
            </div>

            <!-- AI助手浮动按钮 -->
            <button @click="toggleAIModal" class="ai-assistant-float" :class="{ pulse: aiNotification }" title="AI智能助手">
                <i class="fas fa-robot"></i>
            </button>

            <!-- AI助手弹窗 -->
            <div class="ai-modal-overlay" :class="{ show: showAIModal }" @click="closeAIModal">
                <div class="ai-modal" :class="{ fullscreen: aiFullscreen }" @click.stop>
                    <!-- AI弹窗头部 -->
                    <div class="ai-modal-header">
                        <div class="ai-modal-title">
                            <i class="fas fa-robot"></i>
                            AI智能助手
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button @click="toggleAIFullscreen" class="ai-modal-close" :title="aiFullscreen ? '退出全屏' : '全屏显示'">
                                <i :class="aiFullscreen ? 'fas fa-compress' : 'fas fa-expand'"></i>
                            </button>
                            <button @click="closeAIModal" class="ai-modal-close">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <!-- AI弹窗内容 -->
                    <div class="ai-modal-content">
                        <!-- 当前题目显示 -->
                        <div v-if="currentQuestion" class="ai-question-display">
                            <div class="ai-question-title">
                                <i class="fas fa-question-circle"></i>
                                当前题目（第 {{ currentQuestionIndex + 1 }} 题）
                            </div>
                            <div class="ai-question-content">
                                <strong>{{ currentQuestion.title }}</strong>
                                <div v-if="currentQuestion.content" style="margin-top: 8px;">
                                    {{ currentQuestion.content }}
                                </div>
                                <div v-if="currentQuestion.options && currentQuestion.options.length > 0" style="margin-top: 8px;">
                                    <div v-for="(option, index) in currentQuestion.options" :key="index" style="margin: 4px 0;">
                                        {{ String.fromCharCode(65 + index) }}. {{ option }}
                                    </div>
                                </div>
                                <div v-if="showResult" style="margin-top: 8px; font-weight: bold;">
                                    <span :style="{ color: isCorrect ? '#28a745' : '#dc3545' }">
                                        {{ isCorrect ? '✅ 答题正确' : '❌ 答题错误' }}
                                        (你的答案: {{ selectedAnswer !== null ? String.fromCharCode(65 + selectedAnswer) : '未选择' }}, 
                                         正确答案: {{ currentQuestion.answer }})
                                    </span>
                                </div>
                            </div>
                        </div>
                        <!-- AI快捷提示 -->
                        <div class="ai-quick-tips">
                            <h4><i class="fas fa-lightbulb"></i> 智能提问助手</h4>
                            <div class="ai-tips-grid">
                                <button @click="askQuickQuestion('请解释这道题的解题思路')" class="ai-tip-btn">
                                    解题思路
                                </button>
                                <button @click="askQuickQuestion('这道题的知识点是什么？')" class="ai-tip-btn">
                                    知识点解析
                                </button>
                                <button @click="askQuickQuestion('有类似的题目吗？')" class="ai-tip-btn">
                                    相似题目
                                </button>
                                <button @click="askQuickQuestion('这道题容易出错的地方在哪里？')" class="ai-tip-btn">
                                    易错点分析
                                </button>
                            </div>
                        </div>

                        <!-- AI聊天区域 -->
                        <div class="ai-chat-container">
                            <div class="ai-chat-messages" ref="aiMessages">
                                <div v-for="(message, index) in aiMessages" :key="index" 
                                     :class="['ai-message', message.type]">
                                    <div class="ai-message-avatar">
                                        {{ message.type === 'user' ? 'U' : 'AI' }}
                                    </div>
                                    <div class="ai-message-content" v-html="message.content"></div>
                                </div>
                                <div v-if="aiLoading" class="ai-message ai">
                                    <div class="ai-message-avatar">AI</div>
                                    <div class="ai-message-content">
                                        <i class="fas fa-spinner fa-spin"></i> AI正在思考中...
                                    </div>
                                </div>
                                <!-- 如果没有消息，显示欢迎信息 -->
                                <div v-if="aiMessages.length === 0 && !aiLoading" class="ai-message ai">
                                    <div class="ai-message-avatar">AI</div>
                                    <div class="ai-message-content">
                                        👋 欢迎使用AI智能助手！<br>
                                        我可以帮助您解答题目相关的问题。<br><br>
                                        🎮 <strong>快捷键说明</strong>：<br>
                                        • <kbd>Enter</kbd> 提交答案 • <kbd>← →</kbd> 切换题目<br>
                                        • <kbd>F11</kbd> 全屏切换 • <kbd>ESC</kbd> 退出/返回<br>
                                        • <kbd>Ctrl+S</kbd> 保存进度 • <kbd>1-4</kbd> 选择选项
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI输入区域 - 固定在底部 -->
                        <div class="ai-chat-input-area">
                            <div class="ai-input-wrapper">
                                <textarea 
                                    v-model="aiInputText" 
                                    @keydown.enter.prevent="sendAIMessage"
                                    class="ai-chat-input" 
                                    placeholder="向AI询问关于这道题的问题..."></textarea>
                                <button @click="sendAIMessage" 
                                        :disabled="!aiInputText.trim() || aiLoading" 
                                        class="ai-send-btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    loading: true,
                    loadingText: '正在初始化...',
                    isLoadingBanks: false,
                    isFullscreen: false,
                    currentView: 'selector', // 'selector' | 'practice'
                    notification: {
                        show: false,
                        message: '',
                        type: 'info'
                    },
                    // 题库数据
                    availableBanks: [],
                    selectedBanks: [],
                    totalQuestions: 0,
                    
                    // 真题相关数据
                    allQuestions: [],
                    realExamYears: [],
                    isRealExamMode: false,
                    // 筛选条件
                    filters: {
                        category: '',
                        year: '',
                        difficulty: '',
                        keyword: ''
                    },
                    
                    // 智能加载相关
                    autoLoadEnabled: true,
                    lastLoadedCategory: '',
                    lastLoadedYear: '',
                    filterTimeout: null,
                    
                    // 填空题相关
                    userTextAnswer: '',
                    showAnswer: false,
                    answerSimilarity: 0,
                    
                    // 快速访问相关
                    showClassificationList: false,
                    classificationCategories: [
                        { id: 'fluid-basics', name: '流体力学基础', icon: 'fas fa-water' },
                        { id: 'fluid-properties', name: '流体性质', icon: 'fas fa-flask' },
                        { id: 'pressure', name: '压力', icon: 'fas fa-compress-arrows-alt' },
                        { id: 'viscosity', name: '粘性', icon: 'fas fa-tint' },
                        { id: 'reynolds', name: '雷诺数', icon: 'fas fa-calculator' },
                        { id: 'boundary-layer', name: '边界层', icon: 'fas fa-layer-group' },
                        { id: 'streamline', name: '流线轨迹', icon: 'fas fa-route' },
                        { id: 'vorticity', name: '涡度', icon: 'fas fa-sync-alt' },
                        { id: 'momentum', name: '动量方程', icon: 'fas fa-arrow-right' },
                        { id: 'energy', name: '能量方程', icon: 'fas fa-bolt' },
                        { id: 'potential-flow', name: '势流', icon: 'fas fa-wave-square' },
                        { id: 'pipe-flow', name: '管道流动', icon: 'fas fa-minus' },
                        { id: 'turbulence', name: '湍流', icon: 'fas fa-wind' },
                        { id: 'free-surface', name: '自由面', icon: 'fas fa-water' },
                        { id: 'experiment', name: '实验与量纲', icon: 'fas fa-microscope' }
                    ],
                    // 练习数据
                    questions: [],
                    currentQuestionIndex: 0,
                    selectedAnswer: null,
                    showResult: false,
                    isCorrect: false,
                    showAnalysis: false,
                    correctAnswers: 0,
                    incorrectAnswers: 0,
                    answeredQuestions: 0,
                    startTime: null,
                    totalTime: 0,
                    
                    // 移动端检测
                    isMobile: false,
                    
                    // 字号控制
                    fontSize: 'medium', // small, medium, large
                    fontSizeLevels: {
                        small: 0.8,
                        medium: 1,
                        large: 1.2
                    },

                    // AI相关数据
                    showAIModal: false,
                    aiInputText: '',
                    aiMessages: [],
                    aiLoading: false,
                    aiNotification: false,
                    aiFullscreen: false,
                    smartModelSelectorInstance: null,
                    
                    // AI批改相关
                    aiGradingLoading: false,
                    aiGradingResult: null
                }
            },
            
            computed: {
                currentQuestion() {
                    return this.questions[this.currentQuestionIndex] || null;
                },
                
                correctRate() {
                    if (this.answeredQuestions === 0) return 0;
                    return Math.round((this.correctAnswers / this.answeredQuestions) * 100);
                },
                
                availableYears() {
                    // 强制返回真题年份列表，确保年份选项始终显示
                    return [2023, 2021, 2020, 2019, 2018, 2016, 2015, 2014, 2013, 2011, 2010, 2009, 2006, 2004, 2003, 2002, 2001];
                },

                canStartPractice() {
                    // 只要选择了具体的年份或分类，就显示练习按钮
                    const hasCategory = this.filters.category && 
                                       this.filters.category !== '全部类型' && 
                                       this.filters.category !== '';
                    const hasYear = this.filters.year && 
                                   this.filters.year !== '全部年份' && 
                                   this.filters.year !== '';
                    
                    return hasCategory || hasYear;
                },

                loadedQuestionsCount() {
                    return this.questions.length;
                },
                
                filteredBanks() {
                    return this.availableBanks.filter(bank => {
                        // 分类筛选
                        if (this.filters.category && this.filters.category !== '全部类型') {
                            if (this.filters.category === '历年真题' && bank.category !== '历年真题') return false;
                            if (this.filters.category === '易错题集' && bank.category !== '易错题集') return false;
                            if (this.filters.category === '计算题集' && bank.category !== '计算题集') return false;
                            if (this.filters.category === '综合题集' && bank.category !== '综合题集') return false;
                        }
                        
                        // 年份筛选
                        if (this.filters.year && this.filters.year !== '全部年份') {
                            // 如果是真题模式，按年份筛选
                            if (this.isRealExamMode) {
                                const selectedYear = parseInt(this.filters.year);
                                if (bank.year === 'all') return true; // 所有真题
                                if (bank.year === selectedYear) return true; // 特定年份
                                if (bank.year === 'error-prone' || bank.year === 'calculation' || bank.year === 'comprehensive') return true; // 特殊分类
                                return false;
                            } else {
                                // 普通题库模式
                                if (this.filters.year === '2000-2021' && bank.year === 'all') return true;
                                if (this.filters.year === '2000-2021' && typeof bank.year === 'number' && bank.year >= 2000 && bank.year <= 2021) return true;
                                if (this.filters.year !== '2000-2021' && bank.year !== this.filters.year) return false;
                            }
                        }
                        
                        // 难度筛选
                        if (this.filters.difficulty && this.filters.difficulty !== '全部难度') {
                            const difficultyMap = {
                                '简单': 'easy',
                                '中等': 'medium',
                                '困难': 'hard'
                            };
                            if (bank.difficulty !== difficultyMap[this.filters.difficulty]) return false;
                        }
                        
                        // 关键词搜索
                        if (this.filters.keyword) {
                            const keyword = this.filters.keyword.toLowerCase();
                            if (!bank.name.toLowerCase().includes(keyword) && 
                                !bank.description?.toLowerCase().includes(keyword)) return false;
                        }
                        
                        return true;
                    });
                }
            },
            
            methods: {
                // 显示通知
                showNotification(message, type = 'info') {
                    this.notification = { show: true, message, type };
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 3000);
                },

                // 筛选条件变化处理
                onFilterChange() {
                    // 立即执行智能加载，不延迟
                    this.smartLoadQuestions();
                },

                // 智能加载题目
                async smartLoadQuestions() {
                    if (!this.autoLoadEnabled) return;
                    
                    const category = this.filters.category;
                    const year = this.filters.year;
                    
                    // 检查是否需要重新加载
                    if (category === this.lastLoadedCategory && year === this.lastLoadedYear) {
                        return;
                    }
                    
                    console.log('🎯 智能加载触发:', { category, year });
                    
                    try {
                        // 优先处理年份筛选 - 这是最重要的功能
                        if (year && year !== '全部年份' && year !== 'all' && year !== '') {
                            console.log(`📅 加载${year}年真题`);
                            await this.loadRealExamQuestions(year);
                            return;
                        }
                        
                        // 处理分类筛选
                        if (category === '历年真题') {
                            console.log('📚 加载所有历年真题');
                            await this.loadRealExamQuestions('all');
                        } else if (category === '易错题集') {
                            console.log('⚠️ 加载易错题集');
                            await this.loadErrorProneQuestions();
                        } else if (category === '计算题集') {
                            console.log('🧮 加载计算题集');
                            await this.loadCalculationQuestions();
                        } else if (category === '综合题集') {
                            console.log('📝 加载综合题集');
                            await this.loadComprehensiveQuestions();
                        } else {
                            // 清空题目，等待用户选择
                            this.questions = [];
                            this.totalQuestions = 0;
                        }
                        
                        this.lastLoadedCategory = category;
                        this.lastLoadedYear = year;
                        
                    } catch (error) {
                        console.error('智能加载失败:', error);
                        this.showNotification('智能加载失败: ' + error.message, 'error');
                    }
                },

                // 加载真题题目
                async loadRealExamQuestions(year = 'all') {
                    this.loading = true;
                    this.loadingText = `正在加载${year === 'all' ? '历年' : year + '年'}真题...`;
                    
                    try {
                        const response = await fetch('../question-banks/真题_中国海洋大学_2000-2021_cleaned.json');
                        if (!response.ok) {
                            throw new Error('真题文件加载失败');
                        }
                        
                        let questions = await response.json();
                        
                        // 根据年份筛选
                        if (year && year !== 'all' && year !== '全部年份') {
                            const selectedYear = parseInt(year);
                            questions = questions.filter(q => q.year === selectedYear);
                            console.log(`📅 筛选${selectedYear}年真题: 找到 ${questions.length} 题`);
                        }
                        
                        if (questions.length === 0) {
                            throw new Error(`未找到${year === 'all' ? '' : year + '年'}的真题数据`);
                        }
                        
                        // 处理题目数据并补全信息
                        this.questions = questions.map((q, index) => ({
                            ...q,
                            bankId: 'real-exam',
                            bank: '历年真题',
                            bankName: `${q.year}年真题`,
                            category: '历年真题',
                            difficulty: this.getDifficultyByScore(q.score),
                            
                            // 补全选项
                            options: q.options && q.options.length > 0 ? q.options : this.generateOptions(q),
                            
                            // 补全答案
                            answer: q.answer || this.generateAnswer(q),
                            
                            // 补全解析
                            explanation: q.explanation || this.generateExplanation(q),
                            
                            // 补全知识点
                            knowledgePoints: q.tags || this.generateKnowledgePoints(q),
                            
                            // 添加题目序号
                            questionNumber: index + 1
                        }));
                        
                        this.totalQuestions = this.questions.length;
                        
                        // 显示加载成功提示
                        const yearText = year === 'all' ? '历年真题' : `${year}年真题`;
                        this.showNotification(`✅ 已加载${yearText}: ${this.questions.length}题`, 'success');
                        
                    } finally {
                        this.loading = false;
                    }
                },

                // 生成选项（当题目没有选项时）
                generateOptions(question) {
                    if (question.type === '计算题' || question.type === '分析题' || question.type === '证明题') {
                        return []; // 计算题等不需要选项
                    }
                    return ['A', 'B', 'C', 'D'];
                },

                // 生成答案（当题目没有答案时）
                generateAnswer(question) {
                    if (question.type === '计算题') {
                        return '请参考标准答案进行计算';
                    } else if (question.type === '分析题') {
                        return '请结合流体力学原理进行分析';
                    } else if (question.type === '证明题') {
                        return '请按照数学证明步骤进行推导';
                    } else {
                        return 0; // 选择题默认选择A
                    }
                },

                // 生成解析（当题目没有解析时）
                generateExplanation(question) {
                    const typeExplanations = {
                        '计算题': '本题考查流体力学的计算能力，需要运用相关公式进行求解。',
                        '分析题': '本题考查对流体力学现象的理解和分析能力。',
                        '证明题': '本题考查流体力学理论的推导和证明能力。',
                        '综合题': '本题综合考查多个流体力学知识点。',
                        '选择题': '本题考查流体力学基础概念的理解。'
                    };
                    
                    let explanation = typeExplanations[question.type] || '本题考查流体力学相关知识。';
                    
                    // 根据分数添加难度提示
                    if (question.score >= 15) {
                        explanation += '本题难度较高，需要深入理解相关概念。';
                    } else if (question.score >= 10) {
                        explanation += '本题难度中等，需要掌握基本原理。';
                    } else {
                        explanation += '本题难度较低，属于基础知识点。';
                    }
                    
                    return explanation;
                },

                // 生成知识点（当题目没有标签时）
                generateKnowledgePoints(question) {
                    const titleLower = question.title.toLowerCase();
                    const knowledgePoints = [];
                    
                    // 根据题目内容智能识别知识点
                    if (titleLower.includes('雷诺数') || titleLower.includes('reynolds')) {
                        knowledgePoints.push('雷诺数');
                    }
                    if (titleLower.includes('边界层')) {
                        knowledgePoints.push('边界层');
                    }
                    if (titleLower.includes('流线') || titleLower.includes('轨迹')) {
                        knowledgePoints.push('流线轨迹');
                    }
                    if (titleLower.includes('压力') || titleLower.includes('压强')) {
                        knowledgePoints.push('压力');
                    }
                    if (titleLower.includes('粘性') || titleLower.includes('粘度')) {
                        knowledgePoints.push('粘性');
                    }
                    if (titleLower.includes('湍流')) {
                        knowledgePoints.push('湍流');
                    }
                    if (titleLower.includes('管道') || titleLower.includes('管流')) {
                        knowledgePoints.push('管道流动');
                    }
                    if (titleLower.includes('动量') || titleLower.includes('momentum')) {
                        knowledgePoints.push('动量方程');
                    }
                    if (titleLower.includes('能量') || titleLower.includes('伯努利')) {
                        knowledgePoints.push('能量方程');
                    }
                    if (titleLower.includes('涡度') || titleLower.includes('旋转')) {
                        knowledgePoints.push('涡度');
                    }
                    
                    // 如果没有识别到特定知识点，添加基础分类
                    if (knowledgePoints.length === 0) {
                        knowledgePoints.push('流体力学基础');
                    }
                    
                    return knowledgePoints;
                },

                // 加载易错题
                async loadErrorProneQuestions() {
                    const response = await fetch('../question-banks/易错题集.json');
                    if (!response.ok) {
                        throw new Error('易错题文件加载失败');
                    }
                    
                    const data = await response.json();
                    const questions = Array.isArray(data) ? data : (data.questions || []);
                    
                    this.questions = questions.map((q, index) => ({
                        id: `error-prone_${index}`,
                        title: q.title || q.question || `易错题${index + 1}`,
                        content: q.content || '',
                        options: q.options || ['A', 'B', 'C', 'D'],
                        answer: q.answer || 0,
                        explanation: q.explanation || '暂无解析',
                        category: '易错题集',
                        difficulty: q.difficulty || 'hard',
                        bank: '易错题集',
                        bankId: 'error-prone'
                    }));
                    
                    this.totalQuestions = this.questions.length;
                },

                // 加载计算题
                async loadCalculationQuestions() {
                    // 从真题中筛选计算题
                    await this.loadRealExamQuestions();
                    this.questions = this.questions.filter(q => q.type === '计算题');
                    this.totalQuestions = this.questions.length;
                },

                // 加载综合题
                async loadComprehensiveQuestions() {
                    // 从真题中筛选综合题
                    await this.loadRealExamQuestions();
                    this.questions = this.questions.filter(q => q.type === '综合题');
                    this.totalQuestions = this.questions.length;
                },

                // 获取选择的筛选条件文本
                getSelectedFilterText() {
                    const parts = [];
                    if (this.filters.category && this.filters.category !== '全部类型') {
                        parts.push(this.filters.category);
                    }
                    if (this.filters.year && this.filters.year !== '全部年份') {
                        parts.push(this.filters.year);
                    }
                    return parts.join(' - ') || '未选择';
                },

                // 开始智能练习
                async startSmartPractice(mode = 'normal') {
                    if (this.questions.length === 0) {
                        this.showNotification('请先选择要练习的题目类型', 'warning');
                        return;
                    }

                    // 根据模式处理题目
                    if (mode === 'random') {
                        this.questions = this.shuffleArray([...this.questions]);
                    }

                    this.currentView = 'practice';
                    this.currentQuestionIndex = 0;
                    this.resetQuestion();
                    
                    const modeText = mode === 'random' ? '随机' : '顺序';
                    this.showNotification(`🎯 开始${this.getSelectedFilterText()}${modeText}练习！共 ${this.questions.length} 道题目`, 'success');
                },

                // 预览已加载的题目
                previewLoadedQuestions() {
                    if (this.questions.length === 0) {
                        this.showNotification('暂无已加载的题目', 'warning');
                        return;
                    }

                    const preview = this.questions.slice(0, 3).map((q, index) => 
                        `${index + 1}. ${q.title.substring(0, 50)}...`
                    ).join('\n');

                    alert(`已加载题目预览 (前3题):\n\n${preview}\n\n共 ${this.questions.length} 题`);
                },

                // 数组随机打乱
                shuffleArray(array) {
                    const shuffled = [...array];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled;
                },

                // 重置当前题目状态
                resetQuestion() {
                    this.selectedAnswer = null;
                    this.showResult = false;
                    this.isCorrect = false;
                    this.userTextAnswer = '';
                    this.showAnswer = false;
                    this.answerSimilarity = 0;
                },

                // 填空题相关方法
                getAnswerPlaceholder(question) {
                    if (question.type === '计算题') {
                        return '请输入计算过程和最终答案...';
                    } else if (question.type === '分析题') {
                        return '请输入分析过程和结论...';
                    } else if (question.type === '证明题') {
                        return '请输入证明步骤...';
                    } else {
                        return '请输入您的答案...';
                    }
                },

                onAnswerInput() {
                    // 可以在这里添加实时提示或格式检查
                },

                submitTextAnswer() {
                    if (!this.userTextAnswer.trim()) {
                        this.showNotification('请输入答案后再提交', 'warning');
                        return;
                    }

                    // 计算答案相似度
                    this.answerSimilarity = this.calculateSimilarity(this.userTextAnswer, this.currentQuestion.answer);
                    
                    // 显示结果
                    this.showResult = true;
                    this.isCorrect = this.answerSimilarity >= 60; // 60%以上视为正确
                    
                    // 更新统计
                    if (this.isCorrect) {
                        this.correctAnswers++;
                    }
                    
                    // 保存用户答案
                    this.userAnswers[this.currentQuestionIndex] = this.userTextAnswer;
                    
                    this.showNotification(
                        this.isCorrect ? '回答正确！' : `答案相似度 ${this.answerSimilarity}%，请查看标准答案`,
                        this.isCorrect ? 'success' : 'warning'
                    );
                },

                showStandardAnswer() {
                    this.showAnswer = true;
                    this.showNotification('已显示标准答案，可以对比学习', 'info');
                },

                calculateSimilarity(userAnswer, standardAnswer) {
                    if (!userAnswer || !standardAnswer) return 0;
                    
                    const user = userAnswer.toLowerCase().trim();
                    const standard = standardAnswer.toString().toLowerCase().trim();
                    
                    // 简单的相似度计算算法
                    if (user === standard) return 100;
                    
                    // 包含关键词检查
                    const userWords = user.split(/\s+/);
                    const standardWords = standard.split(/\s+/);
                    
                    let matchCount = 0;
                    userWords.forEach(word => {
                        if (standardWords.some(sw => sw.includes(word) || word.includes(sw))) {
                            matchCount++;
                        }
                    });
                    
                    const similarity = Math.round((matchCount / Math.max(userWords.length, standardWords.length)) * 100);
                    return Math.min(similarity, 100);
                },

                getSimilarityClass(similarity) {
                    if (similarity >= 80) return 'high';
                    if (similarity >= 60) return 'medium';
                    return 'low';
                },

                getFeedbackClass(similarity) {
                    if (similarity >= 90) return 'excellent';
                    if (similarity >= 70) return 'good';
                    if (similarity >= 50) return 'average';
                    return 'poor';
                },

                getFeedbackText(similarity) {
                    if (similarity >= 90) return '优秀！回答非常准确';
                    if (similarity >= 70) return '良好！回答基本正确';
                    if (similarity >= 50) return '一般，需要改进';
                    return '需要重新学习相关知识点';
                },

                // 快速访问方法
                async quickStartPractice(type) {
                    console.log(`🚀 快速开始练习: ${type}`);
                    
                    if (type === '易错题集') {
                        this.filters.category = '易错题集';
                        this.filters.year = '';
                        await this.loadErrorProneQuestions();
                        this.showNotification(`✅ 已加载${type}`, 'success');
                    } else if (type === '历年真题') {
                        this.filters.category = '历年真题';
                        this.filters.year = '';
                        await this.loadRealExamQuestions('all');
                        this.showNotification(`✅ 已加载${type}`, 'success');
                    }
                },

                showClassificationMenu() {
                    this.showClassificationList = !this.showClassificationList;
                    this.showNotification(
                        this.showClassificationList ? '📚 展开分类题库列表' : '📚 收起分类题库列表', 
                        'info'
                    );
                },

                async quickStartClassification(categoryId, categoryName) {
                    console.log(`📚 快速开始分类练习: ${categoryName}`);
                    
                    try {
                        this.loading = true;
                        this.loadingText = `正在加载${categoryName}...`;
                        
                        // 映射分类ID到文件名
                        const categoryFiles = {
                            'fluid-basics': '分类_流体力学基础.json',
                            'fluid-properties': '分类_流体性质.json', 
                            'pressure': '分类_压力.json',
                            'viscosity': '分类_粘性.json',
                            'reynolds': '分类_雷诺数.json',
                            'boundary-layer': '分类_边界层.json',
                            'streamline': '分类_流线轨迹.json',
                            'vorticity': '分类_涡度.json',
                            'momentum': '分类_动量方程.json',
                            'energy': '分类_能量方程.json',
                            'potential-flow': '分类_势流.json',
                            'pipe-flow': '分类_管道流动.json',
                            'turbulence': '分类_湍流.json',
                            'free-surface': '分类_自由面.json',
                            'experiment': '分类_实验与量纲.json'
                        };
                        
                        const filename = categoryFiles[categoryId];
                        if (!filename) {
                            throw new Error(`未找到${categoryName}对应的题库文件`);
                        }
                        
                        const response = await fetch(`../question-banks/${filename}`);
                        if (!response.ok) {
                            throw new Error(`加载${categoryName}失败`);
                        }
                        
                        const data = await response.json();
                        const questions = Array.isArray(data) ? data : (data.questions || []);
                        
                        this.questions = questions.map((q, index) => ({
                            ...q,
                            id: `${categoryId}_${index}`,
                            bankId: categoryId,
                            bank: categoryName,
                            category: categoryName,
                            knowledgePoints: q.tags || q.knowledgePoints || [categoryName],
                            questionNumber: index + 1
                        }));
                        
                        this.totalQuestions = this.questions.length;
                        this.showClassificationList = false;
                        this.filters.category = categoryName;
                        this.filters.year = '';
                        
                        this.showNotification(`✅ 已加载${categoryName}: ${this.questions.length}题`, 'success');
                        
                    } catch (error) {
                        console.error(`加载${categoryName}失败:`, error);
                        this.showNotification(`❌ 加载${categoryName}失败: ${error.message}`, 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                // 全屏功能
                toggleFullscreen() {
                    if (!this.isFullscreen) {
                        this.enterFullscreen();
                    } else {
                        this.exitFullscreen();
                    }
                },

                enterFullscreen() {
                    const element = document.documentElement;
                    if (element.requestFullscreen) {
                        element.requestFullscreen();
                    } else if (element.webkitRequestFullscreen) {
                        element.webkitRequestFullscreen();
                    } else if (element.msRequestFullscreen) {
                        element.msRequestFullscreen();
                    }
                    this.isFullscreen = true;
                    this.showNotification('已进入全屏模式，按F11或ESC可退出', 'info');
                },

                exitFullscreen() {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                    this.isFullscreen = false;
                    this.showNotification('已退出全屏模式', 'info');
                },

                enterFullscreenMode() {
                    this.enterFullscreen();
                    if (this.questions.length > 0) {
                        this.currentView = 'practice';
                    } else {
                        this.showNotification('请先加载题库再使用全屏练习模式', 'warning');
                    }
                },

                // 批量加载所有题库
                async loadAllQuestionBanks() {
                    this.isLoadingBanks = true;
                    this.loading = true;
                    this.loadingText = '正在批量加载所有题库...';
                    
                    try {
                        await this.loadFromGitHub();
                        if (this.totalQuestions === 0) {
                            await this.loadFromLocal();
                        }
                        
                        if (this.totalQuestions > 0) {
                            this.showNotification(`🎉 成功加载 ${this.totalQuestions} 道题目，来自 ${this.availableBanks.length} 个题库`, 'success');
                        } else {
                            this.showNotification('未能加载到任何题目，请检查网络连接', 'error');
                        }
                    } catch (error) {
                        console.error('批量加载失败:', error);
                        this.showNotification('批量加载失败: ' + error.message, 'error');
                    } finally {
                        this.isLoadingBanks = false;
                        this.loading = false;
                    }
                },

                // 从GitHub加载
                async loadFromGitHub() {
                    console.log('🌐 开始从GitHub加载题目...');
                    this.loadingText = '正在从GitHub加载题库...';
                    
                    const GITHUB_CONFIG = {
                        owner: 'lghui12138',
                        repo: 'lghui12138.github.io',
                        branch: 'main',
                        rawBaseUrl: 'https://raw.githubusercontent.com/lghui12138/lghui12138.github.io/main'
                    };
                    
                    const files = [
                        { file: '易错题集.json', category: '易错', name: '易错题集', description: '高频易错题目专项训练' },
                        { file: '真题_中国海洋大学_2000-2021_cleaned.json', category: '真题', name: '真题合集(精选)', description: '中国海洋大学历年真题精选版', year: '2000-2021' },
                        { file: '真题_中国海洋大学_2000-2021.json', category: '真题', name: '真题合集(完整)', description: '中国海洋大学历年真题完整版', year: '2000-2021' },
                        { file: '分类_动量方程.json', category: '分类', name: '动量方程', description: '动量方程专题练习' },
                        { file: '分类_势流.json', category: '分类', name: '势流', description: '势流理论专题练习' },
                        { file: '分类_压力.json', category: '分类', name: '压力', description: '流体压力专题练习' },
                        { file: '分类_实验与量纲.json', category: '分类', name: '实验与量纲', description: '实验方法与量纲分析' },
                        { file: '分类_流体力学基础.json', category: '分类', name: '流体力学基础', description: '流体力学基础知识' },
                        { file: '分类_流体性质.json', category: '分类', name: '流体性质', description: '流体物理性质专题' },
                        { file: '分类_流线轨迹.json', category: '分类', name: '流线轨迹', description: '流线与轨迹线专题' },
                        { file: '分类_涡度.json', category: '分类', name: '涡度', description: '涡度与旋转流动' },
                        { file: '分类_湍流.json', category: '分类', name: '湍流', description: '湍流理论与应用' },
                        { file: '分类_管道流动.json', category: '分类', name: '管道流动', description: '管道内流动专题' },
                        { file: '分类_粘性.json', category: '分类', name: '粘性', description: '粘性流体力学' },
                        { file: '分类_能量方程.json', category: '分类', name: '能量方程', description: '能量方程专题练习' },
                        { file: '分类_自由面.json', category: '分类', name: '自由面', description: '自由表面流动' },
                        { file: '分类_边界层.json', category: '分类', name: '边界层', description: '边界层理论专题' },
                        { file: '分类_雷诺数.json', category: '分类', name: '雷诺数', description: '雷诺数与流动状态' }
                    ];
                    
                    let loadedQuestions = [];
                    let loadedBanks = [];
                    let totalLoaded = 0;
                    
                    for (const fileInfo of files) {
                        try {
                            console.log(`📖 加载: ${fileInfo.file}`);
                            this.loadingText = `正在加载: ${fileInfo.name}...`;
                            
                            const url = `${GITHUB_CONFIG.rawBaseUrl}/question-banks/${fileInfo.file}`;
                            const response = await fetch(url);
                            
                            if (response.ok) {
                                const data = await response.json();
                                const questions = Array.isArray(data) ? data : (data.questions ? data.questions : []);
                                
                                if (questions && questions.length > 0) {
                                    const convertedQuestions = questions.map((q, index) => ({
                                        id: `${fileInfo.file}_${index}`,
                                        title: q.title || q.question || `题目${totalLoaded + index + 1}`,
                                        content: q.content || '',
                                        options: q.options || ['A', 'B', 'C', 'D'],
                                        answer: q.answer || 0,
                                        explanation: q.explanation || '暂无解析',
                                        category: q.category || fileInfo.category,
                                        difficulty: q.difficulty || 'medium',
                                        year: q.year || fileInfo.year || null,
                                        school: q.school || '中国海洋大学',
                                        bank: fileInfo.name,
                                        bankId: fileInfo.file
                                    }));
                                    
                                    loadedQuestions = loadedQuestions.concat(convertedQuestions);
                                    totalLoaded += convertedQuestions.length;
                                    
                                    // 记录题库信息
                                    loadedBanks.push({
                                        id: fileInfo.file,
                                        name: fileInfo.name,
                                        description: fileInfo.description,
                                        category: fileInfo.category,
                                        year: fileInfo.year,
                                        questionCount: convertedQuestions.length,
                                        difficulty: 'medium', // 默认难度
                                        file: fileInfo.file
                                    });
                                    
                                    console.log(`✅ ${fileInfo.name}: +${convertedQuestions.length}题`);
                                }
                            } else {
                                console.warn(`⚠️ GitHub文件不存在: ${fileInfo.file}`);
                            }
                        } catch (error) {
                            console.warn(`⚠️ 加载失败: ${fileInfo.file}`, error.message);
                        }
                    }
                    
                    if (loadedQuestions.length > 0) {
                        this.questions = loadedQuestions;
                        this.availableBanks = loadedBanks;
                        this.totalQuestions = loadedQuestions.length;
                        console.log(`🎉 GitHub加载完成！总共: ${loadedQuestions.length} 道题目，${loadedBanks.length} 个题库`);
                    }
                },

                // 从本地加载
                async loadFromLocal() {
                    console.log('📁 开始从本地加载题目...');
                    this.loadingText = '正在从本地加载题库...';
                    
                    // 这里可以添加本地加载逻辑
                    // 目前作为备用方案
                },

                // 题库选择功能
                toggleBankSelection(bankId) {
                    const index = this.selectedBanks.indexOf(bankId);
                    if (index > -1) {
                        this.selectedBanks.splice(index, 1);
                    } else {
                        this.selectedBanks.push(bankId);
                    }
                },

                clearSelection() {
                    this.selectedBanks = [];
                    this.showNotification('已清除所有选择', 'info');
                },

                // 开始练习功能
                startBankPractice(bankId) {
                    const selectedQuestions = this.questions.filter(q => q.bankId === bankId);
                    if (selectedQuestions.length === 0) {
                        this.showNotification('该题库暂无题目', 'warning');
                        return;
                    }
                    
                    this.questions = selectedQuestions;
                    this.startPractice();
                },

                startSelectedBanksPractice() {
                    if (this.selectedBanks.length === 0) {
                        this.showNotification('请先选择要练习的题库', 'warning');
                        return;
                    }
                    
                    const selectedQuestions = this.questions.filter(q => 
                        this.selectedBanks.includes(q.bankId)
                    );
                    
                    if (selectedQuestions.length === 0) {
                        this.showNotification('选中的题库暂无题目', 'warning');
                        return;
                    }
                    
                    this.questions = selectedQuestions;
                    this.startPractice();
                },

                startRandomPractice() {
                    if (this.totalQuestions === 0) {
                        this.showNotification('请先加载题库', 'warning');
                        return;
                    }
                    
                    // 随机打乱题目顺序
                    this.questions = [...this.questions].sort(() => Math.random() - 0.5);
                    this.startPractice();
                },

                startPractice() {
                    this.currentView = 'practice';
                    this.currentQuestionIndex = 0;
                    this.selectedAnswer = null;
                    this.showResult = false;
                    this.isCorrect = false;
                    this.startTime = Date.now();
                    this.showNotification(`开始练习！共 ${this.questions.length} 道题目`, 'success');
                },

                backToSelector() {
                    // 统一返回到题库选择页面
                    this.currentView = 'selector';
                    this.selectedAnswer = null;
                    this.showResult = false;
                    this.isCorrect = false;
                    this.showAnalysis = false;
                    this.userTextAnswer = '';
                    this.showAnswer = false;
                    this.answerSimilarity = 0;
                    
                    // 如果是真题模式，也要重置真题相关状态
                    if (this.isRealExamMode) {
                        this.isRealExamMode = false;
                        console.log('🔄 从真题练习返回题库选择页面');
                    }
                    
                    console.log('🔄 返回题库选择页面');
                },

                previewBank(bankId) {
                    const bank = this.availableBanks.find(b => b.id === bankId);
                    if (bank) {
                        this.showNotification(`${bank.name}: ${bank.description} (${bank.questionCount}题)`, 'info');
                    }
                },

                // 题目操作
                submitAnswer() {
                    if (this.selectedAnswer === null) {
                        this.showNotification('请先选择答案', 'warning');
                        return;
                    }

                    // 检查答案是否正确
                    // 将数字索引转换为字母选项进行比较
                    const selectedOption = String.fromCharCode(65 + this.selectedAnswer); // 0->A, 1->B, 2->C, 3->D
                    this.isCorrect = selectedOption === this.currentQuestion.answer;
                    this.showResult = true;
                    
                    if (this.isCorrect) {
                        this.correctAnswers++;
                        this.showNotification('回答正确！', 'success');
                        
                        // 正确答案：2秒后自动跳转到下一题
                        setTimeout(() => {
                            if (this.currentQuestionIndex < this.questions.length - 1) {
                                this.nextQuestion();
                            } else {
                                this.showNotification('练习完成！', 'success');
                            }
                        }, 2000);
                    } else {
                        this.incorrectAnswers++;
                        this.showNotification('回答错误，请查看解析', 'error');
                        
                        // 错误答案：显示解析，不自动跳转，等待用户手动操作
                        this.showAnalysis = true;
                    }
                    
                    this.answeredQuestions++;
                    
                    // 记录答题时间
                    if (this.startTime) {
                        const timeSpent = Math.round((Date.now() - this.startTime) / 1000);
                        this.totalTime += timeSpent;
                    }
                    
                    this.saveProgress();
                },

                nextQuestion() {
                    if (this.currentQuestionIndex < this.questions.length - 1) {
                        this.currentQuestionIndex++;
                        this.resetQuestion();
                    } else {
                        this.showNotification('练习完成！', 'success');
                    }
                },

                previousQuestion() {
                    if (this.currentQuestionIndex > 0) {
                        this.currentQuestionIndex--;
                        this.resetQuestion();
                    }
                },

                resetQuestion() {
                    this.selectedAnswer = null;
                    this.showResult = false;
                    this.isCorrect = false;
                    this.showAnalysis = false;
                    this.startTime = Date.now();
                },

                saveProgress() {
                    const progress = {
                        currentQuestionIndex: this.currentQuestionIndex,
                        correctAnswers: this.correctAnswers,
                        answeredQuestions: this.answeredQuestions,
                        totalTime: this.totalTime,
                        timestamp: new Date().toISOString(),
                        questions: this.questions.length
                    };
                    localStorage.setItem('practiceProgress', JSON.stringify(progress));
                },

                loadProgress() {
                    try {
                        const saved = localStorage.getItem('practiceProgress');
                        if (saved) {
                            const progress = JSON.parse(saved);
                            this.correctAnswers = progress.correctAnswers || 0;
                            this.answeredQuestions = progress.answeredQuestions || 0;
                            this.totalTime = progress.totalTime || 0;
                        }
                    } catch (error) {
                        console.error('Failed to load progress:', error);
                    }
                },

                resetProgress() {
                    this.answeredQuestions = 0;
                    this.correctAnswers = 0;
                    this.totalTime = 0;
                    this.currentQuestionIndex = 0;
                    this.selectedAnswer = null;
                    this.showResult = false;
                    localStorage.removeItem('practiceProgress');
                    this.showNotification('进度已重置', 'info');
                },

                getDifficultyText(difficulty) {
                    const map = {
                        easy: '简单',
                        medium: '中等',
                        hard: '困难'
                    };
                    return map[difficulty] || '中等';
                },

                // 处理URL参数
                handleUrlParameters() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const examType = urlParams.get('type');
                    const examId = urlParams.get('exam');
                    const examYear = urlParams.get('year');
                    const examMode = urlParams.get('mode');
                    
                    if (examType === 'real') {
                        console.log('📚 检测到真题练习请求:', { examType, examId, examYear, examMode });
                        this.handleRealExamPractice(examId, examYear, examMode);
                    }
                },

                // 真题练习处理
                async handleRealExamPractice(examId, examYear, examMode = 'all') {
                    console.log('📚 处理真题练习请求:', { examId, examYear, examMode });
                    
                    // 立即设置真题模式
                    this.isRealExamMode = true;
                    
                    this.loading = true;
                    this.loadingText = '正在加载真题数据...';
                    
                    try {
                        // 加载真题数据
                        await this.loadRealExamData(examId, examYear, examMode);
                        
                        // 根据模式决定如何开始练习
                        if (examMode === 'all') {
                            // 显示真题选择器
                            this.showRealExamSelector();
                        } else {
                            // 自动开始练习
                            this.startRealExamPractice(examId, examYear, examMode);
                        }
                        
                    } catch (error) {
                        console.error('❌ 真题练习初始化失败:', error);
                        this.showNotification('真题练习初始化失败: ' + error.message, 'error');
                        this.loading = false;
                    }
                },

                // 加载真题数据
                async loadRealExamData(examId, examYear, examMode = 'all') {
                    console.log('📖 加载真题数据:', { examId, examYear, examMode });
                    
                    try {
                        // 从真题文件加载数据
                        const response = await fetch('../question-banks/真题_中国海洋大学_2000-2021_cleaned.json');
                        if (!response.ok) {
                            throw new Error('真题文件加载失败');
                        }
                        
                        const allExamQuestions = await response.json();
                        
                        // 处理题目数据
                        const processedQuestions = allExamQuestions.map(q => ({
                            ...q,
                            bankId: 'real-exam',
                            bank: '历年真题',
                            bankName: `${q.year}年真题`,
                            category: '历年真题',
                            difficulty: this.getDifficultyByScore(q.score),
                            options: q.options || [],
                            answer: q.answer || '',
                            explanation: q.explanation || ''
                        }));
                        
                        // 根据模式和年份筛选题目
                        let filteredQuestions = processedQuestions;
                        
                        if (examYear && examYear !== 'all') {
                            filteredQuestions = processedQuestions.filter(q => q.year === parseInt(examYear));
                            console.log(`📅 筛选${examYear}年真题: ${filteredQuestions.length}题`);
                        } else {
                            // 如果没有指定年份，加载所有题目
                            filteredQuestions = processedQuestions;
                        }
                        
                        if (filteredQuestions.length === 0) {
                            throw new Error(`未找到${examYear || ''}年的真题数据`);
                        }
                        
                        // 存储所有题目和年份信息
                        this.allQuestions = filteredQuestions;
                        this.realExamYears = this.getRealExamYears(processedQuestions);
                        
                        // 构建题库信息 - 按年份分类
                        this.availableBanks = this.buildRealExamBanksByYear(processedQuestions, examYear);
                        this.totalQuestions = this.allQuestions.length;
                        
                        console.log(`✅ 真题数据加载完成: ${this.allQuestions.length}题，${this.realExamYears.length}个年份`);
                        
                    } catch (error) {
                        console.error('❌ 真题数据加载失败:', error);
                        throw error;
                    }
                },

                // 开始真题练习
                startRealExamPractice(examId, examYear, examMode = 'normal') {
                    console.log('🎯 开始真题练习:', { examId, examYear, examMode });
                    
                    // 设置真题模式
                    this.isRealExamMode = true;
                    
                    // 设置练习题目
                    this.questions = [...this.allQuestions];
                    
                    // 根据模式处理题目
                    if (examMode === 'random') {
                        this.questions = this.shuffleArray([...this.questions]);
                    }
                    
                    this.currentView = 'practice';
                    this.currentQuestionIndex = 0;
                    this.resetQuestion();
                    
                    // 更新加载状态
                    this.loading = false;
                    
                    // 显示练习信息
                    const yearText = examYear ? `${examYear}年` : '历年';
                    const modeText = examMode === 'random' ? '随机' : '顺序';
                    this.showNotification(`🎯 开始${yearText}真题${modeText}练习！共 ${this.questions.length} 道题目`, 'success');
                    
                    // 保存真题练习状态
                    localStorage.setItem('currentRealExamPractice', JSON.stringify({
                        examId,
                        examYear,
                        examMode,
                        startTime: Date.now(),
                        totalQuestions: this.questions.length
                    }));
                },

                // 根据分数判断难度
                getDifficultyByScore(score) {
                    if (score <= 5) return 'easy';
                    if (score <= 10) return 'medium';
                    return 'hard';
                },

                // 获取真题年份列表
                getRealExamYears(questions) {
                    const years = [...new Set(questions.map(q => q.year))].sort((a, b) => b - a);
                    return years.map(year => ({
                        year,
                        count: questions.filter(q => q.year === year).length,
                        label: `${year}年 (${questions.filter(q => q.year === year).length}题)`
                    }));
                },

                // 构建真题题库信息 - 按年份分类
                buildRealExamBanksByYear(questions, selectedYear) {
                    const banks = [];
                    
                    // 添加"所有真题"选项
                    banks.push({
                        id: 'real-exam-all',
                        name: '所有历年真题',
                        description: `中国海洋大学历年真题合集 (${questions.length}题)`,
                        questionCount: questions.length,
                        year: 'all',
                        category: '历年真题',
                        difficulty: 'hard'
                    });
                    
                    // 按年份分组添加题库
                    const years = this.getRealExamYears(questions);
                    years.forEach(yearInfo => {
                        banks.push({
                            id: `real-exam-${yearInfo.year}`,
                            name: `${yearInfo.year}年真题`,
                            description: `${yearInfo.year}年中国海洋大学流体力学真题 (${yearInfo.count}题)`,
                            questionCount: yearInfo.count,
                            year: yearInfo.year.toString(),
                            category: '历年真题',
                            difficulty: this.getDifficultyByYear(yearInfo.year)
                        });
                    });
                    
                    // 添加易错题集
                    const errorProneQuestions = questions.filter(q => q.score >= 15 || q.type === '综合题');
                    if (errorProneQuestions.length > 0) {
                        banks.push({
                            id: 'real-exam-error-prone',
                            name: '易错题集',
                            description: `历年真题中的易错题目 (${errorProneQuestions.length}题)`,
                            questionCount: errorProneQuestions.length,
                            year: 'error-prone',
                            category: '易错题集',
                            difficulty: 'hard'
                        });
                    }
                    
                    // 添加计算题集
                    const calculationQuestions = questions.filter(q => q.type === '计算题');
                    if (calculationQuestions.length > 0) {
                        banks.push({
                            id: 'real-exam-calculation',
                            name: '计算题集',
                            description: `历年真题中的计算题 (${calculationQuestions.length}题)`,
                            questionCount: calculationQuestions.length,
                            year: 'calculation',
                            category: '计算题集',
                            difficulty: 'medium'
                        });
                    }
                    
                    // 添加综合题集
                    const comprehensiveQuestions = questions.filter(q => q.type === '综合题');
                    if (comprehensiveQuestions.length > 0) {
                        banks.push({
                            id: 'real-exam-comprehensive',
                            name: '综合题集',
                            description: `历年真题中的综合题 (${comprehensiveQuestions.length}题)`,
                            questionCount: comprehensiveQuestions.length,
                            year: 'comprehensive',
                            category: '综合题集',
                            difficulty: 'hard'
                        });
                    }
                    
                    return banks;
                },

                // 根据年份判断难度
                getDifficultyByYear(year) {
                    const currentYear = new Date().getFullYear();
                    const yearDiff = currentYear - year;
                    
                    if (yearDiff <= 5) return 'hard';      // 近5年真题
                    if (yearDiff <= 10) return 'medium';   // 5-10年前真题
                    return 'easy';                         // 10年前真题
                },
                
                // 检测移动设备
                detectMobileDevice() {
                    const userAgent = navigator.userAgent.toLowerCase();
                    const mobileKeywords = [
                        'android', 'iphone', 'ipad', 'ipod', 'blackberry', 
                        'windows phone', 'mobile', 'tablet'
                    ];
                    
                    this.isMobile = mobileKeywords.some(keyword => userAgent.includes(keyword));
                    console.log(`📱 移动设备检测: ${this.isMobile ? '是' : '否'}`);
                },
                
                // 字号调节
                changeFontSize() {
                    const levels = ['small', 'medium', 'large'];
                    const currentIndex = levels.indexOf(this.fontSize);
                    const nextIndex = (currentIndex + 1) % levels.length;
                    this.fontSize = levels[nextIndex];
                    
                    // 应用字号
                    this.applyFontSize();
                    
                    this.showNotification(`字号已调整为: ${this.fontSize === 'small' ? '小' : this.fontSize === 'large' ? '大' : '中'}`, 'success');
                },
                
                // 应用字号
                applyFontSize() {
                    const scale = this.fontSizeLevels[this.fontSize];
                    document.documentElement.style.setProperty('--font-scale', scale);
                    
                    // 保存到localStorage
                    localStorage.setItem('fontSize', this.fontSize);
                },

                // 显示真题选择器
                showRealExamSelector() {
                    this.loading = false;
                    this.currentView = 'realExamSelector';
                    this.showNotification('请选择要练习的真题年份', 'info');
                },

                // 开始特定年份的真题练习
                startYearPractice(year, mode = 'normal') {
                    let selectedQuestions = [];
                    
                    if (year === 'all') {
                        selectedQuestions = [...this.allQuestions];
                    } else if (year === 'error-prone') {
                        // 易错题集
                        selectedQuestions = this.allQuestions.filter(q => q.score >= 15 || q.type === '综合题');
                    } else if (year === 'calculation') {
                        // 计算题集
                        selectedQuestions = this.allQuestions.filter(q => q.type === '计算题');
                    } else if (year === 'comprehensive') {
                        // 综合题集
                        selectedQuestions = this.allQuestions.filter(q => q.type === '综合题');
                    } else {
                        // 特定年份
                        selectedQuestions = this.allQuestions.filter(q => q.year === parseInt(year));
                    }
                    
                    if (selectedQuestions.length === 0) {
                        this.showNotification(`未找到${year}年的真题`, 'warning');
                        return;
                    }
                    
                    // 根据模式处理题目
                    if (mode === 'random') {
                        selectedQuestions = this.shuffleArray([...selectedQuestions]);
                    }
                    
                    this.questions = selectedQuestions;
                    this.currentView = 'practice';
                    this.currentQuestionIndex = 0;
                    this.resetQuestion();
                    
                    const yearText = this.getYearDisplayText(year);
                    const modeText = mode === 'random' ? '随机' : '顺序';
                    this.showNotification(`🎯 开始${yearText}真题${modeText}练习！共 ${selectedQuestions.length} 道题目`, 'success');
                    
                    // 保存真题练习状态
                    localStorage.setItem('currentRealExamPractice', JSON.stringify({
                        year,
                        mode,
                        startTime: Date.now(),
                        totalQuestions: selectedQuestions.length
                    }));
                },

                // 获取年份显示文本
                getYearDisplayText(year) {
                    const yearMap = {
                        'all': '所有年份',
                        'error-prone': '易错题集',
                        'calculation': '计算题集',
                        'comprehensive': '综合题集'
                    };
                    return yearMap[year] || `${year}年`;
                },

                // 数组随机打乱
                shuffleArray(array) {
                    const shuffled = [...array];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled;
                },

                // 键盘事件处理
                handleKeyboard(event) {
                    // 防止在输入状态下触发
                    if (event.target.tagName === 'INPUT' || event.target.tagName === 'SELECT') return;

                    switch(event.key) {
                        case 'Enter':
                            if (this.currentView === 'practice') {
                            event.preventDefault();
                                if (!this.showResult) {
                            this.submitAnswer();
                                } else {
                                    this.nextQuestion();
                                }
                            }
                            break;
                        case 'ArrowLeft':
                            if (this.currentView === 'practice') {
                            event.preventDefault();
                            this.previousQuestion();
                            }
                            break;
                        case 'ArrowRight':
                            if (this.currentView === 'practice') {
                            event.preventDefault();
                            this.nextQuestion();
                            }
                            break;
                        case 'F11':
                            event.preventDefault();
                            this.toggleFullscreen();
                            break;
                        case 'Escape':
                            if (this.isFullscreen) {
                                event.preventDefault();
                                this.exitFullscreen();
                            } else {
                                this.backToSelector();
                            }
                            break;
                        case 's':
                            if (event.ctrlKey && this.currentView === 'practice') {
                                event.preventDefault();
                                this.saveProgress();
                                this.showNotification('进度已保存', 'success');
                            }
                            break;
                        case '1':
                        case '2':
                        case '3':
                        case '4':
                            if (this.currentView === 'practice' && this.currentQuestion && this.currentQuestion.options && !this.showResult) {
                                const optionIndex = parseInt(event.key) - 1;
                                if (optionIndex < this.currentQuestion.options.length) {
                                    this.selectedAnswer = optionIndex;
                                }
                            }
                            break;
                    }
                },

                // AI相关方法
                async initAISystem() {
                    try {
                        if (window.SmartModelSelector && window.AppConfig) {
                            console.log('🤖 初始化AI智能助手...');
                            const smartConfig = window.AppConfig.api.smartAI;
                            
                            // 检查是否已有全局实例
                            if (!window.smartModelSelectorInstance) {
                                // 使用正确的静态方法初始化（与AI助手模块保持一致）
                                window.smartModelSelectorInstance = await window.SmartModelSelector.init({
                                    apiKey: smartConfig.apiKey,
                                    apiUrl: smartConfig.endpoint,
                                    defaultStrategy: smartConfig.defaultStrategy,
                                    maxRetries: smartConfig.maxRetries,
                                    requestTimeout: smartConfig.requestTimeout,
                                    skipAvailabilityCheck: smartConfig.skipAvailabilityCheck
                                });
                                console.log('✅ AI智能助手全局初始化完成');
                            } else {
                                console.log('✅ 使用已有的AI智能助手实例');
                            }
                            
                            // 同步到组件实例
                            this.smartModelSelectorInstance = window.smartModelSelectorInstance;
                        } else {
                            console.warn('⚠️ SmartModelSelector或AppConfig未加载');
                        }
                    } catch (error) {
                        console.error('❌ AI系统初始化失败:', error);
                        this.smartModelSelectorInstance = null;
                    }
                },

                toggleAIModal() {
                    this.showAIModal = !this.showAIModal;
                    // 直接全屏显示
                    if (this.showAIModal) {
                        this.aiFullscreen = true;
                        console.log('🤖 AI模态框打开，全屏模式');
                    } else {
                        this.aiFullscreen = false;
                        console.log('🤖 AI模态框关闭');
                    }
                    // 自动滚动到最新消息
                    this.$nextTick(() => {
                        this.scrollAIMessages();
                    });
                },

                closeAIModal() {
                    this.showAIModal = false;
                    this.aiFullscreen = false;
                },

                toggleAIFullscreen() {
                    this.aiFullscreen = !this.aiFullscreen;
                    this.$nextTick(() => {
                        this.scrollAIMessages();
                    });
                },

                addWelcomeMessage() {
                    // 现在使用HTML条件渲染，不需要JS添加欢迎消息
                    console.log('📋 欢迎消息通过HTML条件渲染显示');
                },

                async askQuickQuestion(question) {
                    this.aiInputText = question;
                    await this.sendAIMessage();
                },

                async sendAIMessage() {
                    if (!this.aiInputText.trim() || this.aiLoading) return;

                    const userMessage = this.aiInputText.trim();
                    this.aiMessages.push({
                        type: 'user',
                        content: userMessage,
                        timestamp: Date.now()
                    });

                    this.aiInputText = '';
                    this.aiLoading = true;

                    try {
                        await this.callAIForQuestion(userMessage);
                    } catch (error) {
                        this.aiMessages.push({
                            type: 'ai',
                            content: '抱歉，AI暂时无法回复，请稍后再试。如需帮助，可以查看题目解析或咨询老师。',
                            timestamp: Date.now()
                        });
                    } finally {
                        this.aiLoading = false;
                        // 确保消息渲染完成后滚动
                        setTimeout(() => {
                            this.scrollAIMessages();
                        }, 100);
                    }
                },

                async callAIForQuestion(question) {
                    console.log('🤖 开始AI问答:', question);
                    
                    // 构建上下文信息
                    let contextInfo = '';
                    if (this.currentQuestion) {
                        contextInfo = `当前题目：${this.currentQuestion.title}\n`;
                        if (this.currentQuestion.content) {
                            contextInfo += `题目内容：${this.currentQuestion.content}\n`;
                        }
                        if (this.currentQuestion.options && this.currentQuestion.options.length > 0) {
                            contextInfo += `选项：\n`;
                            this.currentQuestion.options.forEach((option, index) => {
                                contextInfo += `${String.fromCharCode(65 + index)}. ${option}\n`;
                            });
                        }
                        if (this.showResult) {
                            contextInfo += `\n用户选择：${this.selectedAnswer !== null ? String.fromCharCode(65 + this.selectedAnswer) : '未选择'}\n`;
                            contextInfo += `正确答案：${this.currentQuestion.answer}\n`;
                            contextInfo += `答题结果：${this.isCorrect ? '正确' : '错误'}\n`;
                        }
                    }

                    const enhancedPrompt = `${contextInfo}\n\n用户问题：${question}`;
                    console.log('🔍 AI请求内容:', enhancedPrompt);

                    try {
                        // 确保AI系统已初始化
                        if (!window.smartModelSelectorInstance && !this.smartModelSelectorInstance) {
                            console.log('🔄 重新初始化AI系统...');
                            await this.initAISystem();
                        }

                        // 优先使用全局实例，如果没有则使用组件实例
                        const aiInstance = window.smartModelSelectorInstance || this.smartModelSelectorInstance;
                        
                        if (aiInstance && typeof aiInstance.callAI === 'function') {
                            console.log('📡 调用AI API...');
                            const result = await aiInstance.callAI(enhancedPrompt, {
                                strategy: 'balanced',
                                features: ['chat', 'reasoning'],
                                maxTokens: 1500,
                                temperature: 0.7,
                                systemPrompt: '你是一个专业的流体力学教师，善于解答学生的问题。请用简洁易懂的语言回答，可以使用适当的表情符号让回答更生动。'
                            });

                            console.log('✅ AI回复成功:', result);
                            console.log('🔍 AI回复结构:', typeof result, result);

                            if (result && result.content && result.content.trim()) {
                                console.log('📝 AI回复成功，内容长度:', result.content.length);
                                this.aiMessages.push({
                                    type: 'ai',
                                    content: result.content + '<br><br><small style="color: #888;">🤖 由智能AI提供</small>',
                                    timestamp: Date.now()
                                });
                                console.log('📋 消息列表长度:', this.aiMessages.length);
                                
                                // 滚动到底部
                                this.$nextTick(() => {
                                    this.scrollAIMessages();
                                });
                            } else {
                                console.warn('⚠️ AI返回内容为空或格式错误:', result);
                                throw new Error(`AI返回内容为空或格式错误: ${JSON.stringify(result)}`);
                            }
                        } else {
                            throw new Error('AI系统未正确初始化');
                        }
                    } catch (error) {
                        console.error('❌ AI调用失败:', error);
                        // 提供本地回复作为备选
                        const localResponse = this.getLocalAIResponse(question);
                        this.aiMessages.push({
                            type: 'ai',
                            content: localResponse + '<br><br><small style="color: #888;">📚 来源：本地知识库</small>',
                            timestamp: Date.now()
                        });
                        console.log('📋 本地回复，消息列表长度:', this.aiMessages.length);
                        
                        // 滚动到底部
                        this.$nextTick(() => {
                            this.scrollAIMessages();
                        });
                    }
                },

                getLocalAIResponse(question) {
                    const questionLower = question.toLowerCase();
                    
                    if (questionLower.includes('解题思路') || questionLower.includes('怎么解') || questionLower.includes('怎么做')) {
                        return '🤔 解题思路：<br>1. 仔细阅读题目，理解题意<br>2. 确定涉及的流体力学原理<br>3. 列出已知条件和求解目标<br>4. 选择合适的公式或方法<br>5. 逐步计算并验证答案<br><br>📚 建议查看题目解析获取详细步骤';
                    }
                    
                    if (questionLower.includes('知识点') || questionLower.includes('考查') || questionLower.includes('原理')) {
                        if (this.currentQuestion && this.currentQuestion.knowledgePoints) {
                            return `📖 这道题主要考查：${this.currentQuestion.knowledgePoints.join('、')}<br><br>💡 建议复习相关概念和公式`;
                        }
                        return '📖 建议查看题目标签了解具体知识点，并复习相关的流体力学概念和公式';
                    }
                    
                    if (questionLower.includes('易错') || questionLower.includes('注意') || questionLower.includes('陷阱')) {
                        return '⚠️ 常见易错点：<br>• 单位换算错误<br>• 符号正负号混淆<br>• 边界条件理解错误<br>• 公式适用条件不明确<br><br>🎯 建议仔细检查计算过程';
                    }
                    
                    if (questionLower.includes('类似') || questionLower.includes('相似') || questionLower.includes('练习')) {
                        return '📚 建议到题库中寻找相同知识点的题目进行练习，或者查看历年真题中的类似题型';
                    }
                    
                    return '🤖 很抱歉，我现在无法理解您的问题。您可以：<br>• 点击上方的快捷提问按钮<br>• 查看题目解析<br>• 询问具体的知识点<br><br>📚 来源：本地知识库';
                },

                scrollAIMessages() {
                    this.$nextTick(() => {
                        const messagesEl = this.$refs.aiMessages;
                        if (messagesEl) {
                            messagesEl.scrollTop = messagesEl.scrollHeight;
                            console.log('🎯 滚动到底部，高度:', messagesEl.scrollHeight);
                        } else {
                            // 备用查找
                            const fallbackEl = document.querySelector('.ai-chat-messages');
                            if (fallbackEl) {
                                fallbackEl.scrollTop = fallbackEl.scrollHeight;
                                console.log('🎯 备用滚动成功');
                            } else {
                                console.warn('⚠️ 无法找到消息容器');
                            }
                        }
                    });
                },

                // AI批改功能
                async requestAIGrading() {
                    if (!this.currentQuestion || this.aiGradingLoading) return;

                    this.aiGradingLoading = true;
                    this.aiGradingResult = null;

                    try {
                        await this.performAIGrading();
                    } catch (error) {
                        console.error('AI批改失败:', error);
                        this.showNotification('AI批改失败，请稍后再试', 'error');
                    } finally {
                        this.aiGradingLoading = false;
                    }
                },

                async performAIGrading() {
                    // 构建批改请求
                    let gradingPrompt = `请作为流体力学专家，对学生的答题进行智能批改分析：\n\n`;
                    gradingPrompt += `题目：${this.currentQuestion.title}\n`;
                    
                    if (this.currentQuestion.content) {
                        gradingPrompt += `题目内容：${this.currentQuestion.content}\n`;
                    }

                    if (this.currentQuestion.options && this.currentQuestion.options.length > 0) {
                        gradingPrompt += `选项：\n`;
                        this.currentQuestion.options.forEach((option, index) => {
                            gradingPrompt += `${String.fromCharCode(65 + index)}. ${option}\n`;
                        });
                        gradingPrompt += `\n学生选择：${this.selectedAnswer !== null ? String.fromCharCode(65 + this.selectedAnswer) : '未选择'}\n`;
                        gradingPrompt += `正确答案：${this.currentQuestion.answer}\n`;
                    } else if (this.userTextAnswer) {
                        gradingPrompt += `\n学生答案：${this.userTextAnswer}\n`;
                        gradingPrompt += `标准答案：${this.currentQuestion.answer}\n`;
                    }

                    gradingPrompt += `\n请提供：
1. 评分（0-100分）
2. 评价等级（优秀/良好/一般/需要改进）
3. 简短总结
4. 详细分析反馈

请用JSON格式返回：{"score": 分数, "level": "等级", "summary": "总结", "feedback": "反馈"}`;

                    try {
                        if (!window.smartModelSelectorInstance && !this.smartModelSelectorInstance) {
                            console.log('🔄 重新初始化AI批改系统...');
                            await this.initAISystem();
                        }

                        // 优先使用全局实例，如果没有则使用组件实例
                        const aiInstance = window.smartModelSelectorInstance || this.smartModelSelectorInstance;
                        
                        if (aiInstance && typeof aiInstance.callAI === 'function') {
                            console.log('📡 调用AI批改API...');
                            const result = await aiInstance.callAI(gradingPrompt, {
                                strategy: 'quality',
                                features: ['reasoning', 'analysis'],
                                maxTokens: 1000,
                                temperature: 0.3,
                                systemPrompt: '你是一位经验丰富的流体力学教师，请客观公正地评价学生答题，并给出建设性建议。'
                            });

                            console.log('✅ AI批改回复:', result);

                            if (result && result.content) {
                                // 尝试解析JSON结果
                                try {
                                    const gradingData = JSON.parse(result.content);
                                    this.aiGradingResult = gradingData;
                                } catch (parseError) {
                                    console.warn('⚠️ AI返回非JSON格式，使用默认格式');
                                    // 如果不是JSON格式，创建默认结果
                                    this.aiGradingResult = {
                                        score: this.isCorrect ? 85 : 45,
                                        level: this.isCorrect ? '良好' : '需要改进',
                                        summary: this.isCorrect ? '答案正确，理解较好' : '答案有误，需要加强理解',
                                        feedback: result.content
                                    };
                                }
                            } else {
                                throw new Error('AI批改返回内容为空');
                            }
                        } else {
                            // 提供本地批改结果
                            console.log('📚 使用本地批改结果');
                            this.aiGradingResult = this.getLocalGradingResult();
                        }
                    } catch (error) {
                        console.error('AI批改调用失败:', error);
                        this.aiGradingResult = this.getLocalGradingResult();
                    }
                },

                getLocalGradingResult() {
                    const baseScore = this.isCorrect ? 85 : 40;
                    let feedback = '';
                    
                    if (this.isCorrect) {
                        feedback = '✅ <strong>答案正确！</strong><br><br>';
                        feedback += '👍 <strong>优点分析：</strong><br>';
                        feedback += '• 正确理解了题目要求<br>';
                        feedback += '• 准确掌握了相关知识点<br>';
                        feedback += '• 选择了正确的答案<br><br>';
                        feedback += '💡 <strong>建议：</strong><br>';
                        feedback += '• 继续保持良好的学习状态<br>';
                        feedback += '• 可以尝试更具挑战性的题目';
                    } else {
                        feedback = '❌ <strong>答案错误</strong><br><br>';
                        feedback += '🔍 <strong>问题分析：</strong><br>';
                        feedback += '• 对题目理解可能存在偏差<br>';
                        feedback += '• 相关知识点掌握不够扎实<br>';
                        feedback += '• 建议重新学习相关概念<br><br>';
                        feedback += '📚 <strong>改进建议：</strong><br>';
                        feedback += '• 仔细阅读题目解析<br>';
                        feedback += '• 复习相关理论知识<br>';
                        feedback += '• 多做类似题目练习';
                    }

                    return {
                        score: baseScore,
                        level: this.isCorrect ? '良好' : '需要改进',
                        summary: this.isCorrect ? '答案正确，掌握良好' : '答案错误，需要加强练习',
                        feedback: feedback + '<br><br><small style="color: #888;">📚 来源：本地智能分析</small>'
                    };
                },

                getAIScoreClass(score) {
                    if (score >= 90) return 'excellent';
                    if (score >= 75) return 'good';
                    if (score >= 60) return 'average';
                    return 'poor';
                }
            },

            mounted() {
                console.log('🧠 智能题库练习启动！');
                
                // 检测移动设备
                this.detectMobileDevice();
                
                // 加载字号设置
                const savedFontSize = localStorage.getItem('fontSize');
                if (savedFontSize && this.fontSizeLevels[savedFontSize]) {
                    this.fontSize = savedFontSize;
                    this.applyFontSize();
                }
                
                // 检查URL参数，处理真题模式
                this.handleUrlParameters();
                
                // 初始化
                setTimeout(() => {
                    this.loadProgress();
                    this.loading = false;
                    
                    if (this.isRealExamMode) {
                        this.showNotification('真题练习模式已启动！', 'success');
                    } else {
                        this.showNotification('欢迎来到智能题库！点击"批量加载所有题库"开始', 'info');
                    }
                }, 1500);

                // 初始化AI系统
                setTimeout(async () => {
                    await this.initAISystem();
                    console.log('🎉 系统完全就绪！');
                }, 2000);

                // 绑定键盘事件
                document.addEventListener('keydown', this.handleKeyboard);

                // 监听全屏状态变化
                document.addEventListener('fullscreenchange', () => {
                    this.isFullscreen = !!document.fullscreenElement;
                });
                
                // 监听筛选条件变化
                this.$watch('filters.category', (newVal, oldVal) => {
                    console.log('📂 分类变化:', oldVal, '->', newVal);
                    this.onFilterChange();
                });
                this.$watch('filters.year', (newVal, oldVal) => {
                    console.log('📅 年份变化:', oldVal, '->', newVal);
                    this.onFilterChange();
                });
            },

            beforeUnmount() {
                document.removeEventListener('keydown', this.handleKeyboard);
            }
        }).mount('#app');
    </script>
</body>
</html> 