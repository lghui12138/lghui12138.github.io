<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥ è§†é¢‘è¯¾ç¨‹å­¦ä¹  - æµä½“åŠ›å­¦å­¦ä¹ å¹³å°</title>
    
    <!-- å¤–éƒ¨ä¾èµ– -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- å…±äº«ç»„ä»¶åº“ -->
    <script src="../js/shared-components.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            font-family: 'SF Pro Display', sans-serif;
            color: white;
        }

        .video-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .video-header {
            text-align: center;
            padding: 40px 0;
            margin-bottom: 30px;
        }

        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .course-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            color: #333;
        }

        .course-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .course-thumbnail {
            position: relative;
            height: 200px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: white;
        }

        .play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-overlay:hover {
            background: rgba(0,0,0,0.9);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .course-info {
            padding: 25px;
        }

        .course-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .course-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .course-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #888;
            margin-bottom: 20px;
        }

        .course-progress {
            background: #f0f0f0;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .course-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #dee2e6;
        }

        .video-player {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            color: #333;
        }

        .player-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .video-placeholder {
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2em;
        }

        .video-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }

        .player-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-button {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .notes-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            color: #333;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .note-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .note-time {
            color: #667eea;
            font-weight: bold;
            font-size: 0.9em;
        }

        .note-content {
            margin-top: 8px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div id="videoApp">
        <!-- æµ·æ´‹èƒŒæ™¯ -->
        <ocean-background></ocean-background>

        <!-- é€šçŸ¥ç»„ä»¶ -->
        <notification-component :notification="notification" @close="notification = ''"></notification-component>

        <!-- åŠ è½½åŠ¨ç”» -->
        <loading-spinner :show="loading" text="æ­£åœ¨åŠ è½½è¯¾ç¨‹..."></loading-spinner>

        <div class="video-container" v-if="!loading">
            <!-- é¡µé¢å¤´éƒ¨ -->
            <header class="video-header">
                <h1><i class="fas fa-video"></i> è§†é¢‘è¯¾ç¨‹å­¦ä¹ </h1>
                <p>ç²¾é€‰æµä½“åŠ›å­¦è§†é¢‘è¯¾ç¨‹ï¼Œç³»ç»ŸåŒ–å­¦ä¹ çŸ¥è¯†ç‚¹</p>
            </header>

            <!-- è§†é¢‘æ’­æ”¾å™¨ -->
            <div v-if="currentVideo" class="video-player">
                <h2 style="margin-bottom: 20px;">{{ currentVideo.title }}</h2>
                
                <div class="player-container">
                    <div v-if="currentVideo.sourceType === 'bilibili'" class="video-frame">
                        <iframe 
                            :src="getBilibiliEmbedUrl(currentVideo.videoId)"
                            frameborder="0" 
                            allowfullscreen
                            style="width: 100%; height: 100%; border-radius: 10px;">
                        </iframe>
                    </div>
                    <div v-else class="video-placeholder">
                        <div style="text-align: center;">
                            <i class="fas fa-play-circle" style="font-size: 3em; margin-bottom: 20px;"></i>
                            <div>{{ currentVideo.title }}</div>
                            <div style="font-size: 0.6em; margin-top: 10px; opacity: 0.8;">
                                ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹å­¦ä¹ 
                            </div>
                        </div>
                    </div>
                </div>

                <div class="player-controls">
                    <div class="control-group">
                        <button class="control-button" @click="togglePlay">
                            <i :class="isPlaying ? 'fas fa-pause' : 'fas fa-play'"></i>
                            {{ isPlaying ? 'æš‚åœ' : 'æ’­æ”¾' }}
                        </button>
                        <button class="control-button" @click="changeSpeed">
                            <i class="fas fa-tachometer-alt"></i>
                            {{ playSpeed }}x
                        </button>
                        <button class="control-button" @click="toggleFullscreen">
                            <i class="fas fa-expand"></i>
                            å…¨å±
                        </button>
                    </div>
                    
                    <div class="control-group">
                        <button class="control-button" @click="addNote">
                            <i class="fas fa-sticky-note"></i>
                            æ·»åŠ ç¬”è®°
                        </button>
                        <button class="control-button" @click="markCompleted">
                            <i class="fas fa-check"></i>
                            æ ‡è®°å®Œæˆ
                        </button>
                    </div>
                </div>

                <div style="margin-top: 20px; color: #666;">
                    <strong>è¯¾ç¨‹æè¿°ï¼š</strong>{{ currentVideo.description }}
                </div>
            </div>

            <!-- è¯¾ç¨‹åˆ—è¡¨ -->
            <div class="course-grid">
                <div 
                    v-for="course in courses" 
                    :key="course.id"
                    class="course-card"
                    @click="selectCourse(course)"
                >
                    <div class="course-thumbnail">
                        {{ course.icon }}
                        <div class="play-overlay" @click.stop="playCourse(course)">
                            <i class="fas fa-play" style="color: white; font-size: 24px;"></i>
                        </div>
                    </div>
                    
                    <div class="course-info">
                        <h3 class="course-title">{{ course.title }}</h3>
                        <p class="course-description">{{ course.description }}</p>
                        
                        <div class="course-meta">
                            <span><i class="far fa-clock"></i> {{ course.duration }}</span>
                            <span><i class="fas fa-signal"></i> {{ course.difficulty }}</span>
                            <span><i class="far fa-eye"></i> {{ course.views }} è§‚çœ‹</span>
                        </div>
                        
                        <div class="course-progress">
                            <div class="progress-bar" :style="{ width: course.progress + '%' }"></div>
                        </div>
                        
                        <div class="course-actions">
                            <button class="action-btn btn-primary" @click.stop="playCourse(course)">
                                <i class="fas fa-play"></i> 
                                {{ course.progress > 0 ? 'ç»§ç»­å­¦ä¹ ' : 'å¼€å§‹å­¦ä¹ ' }}
                            </button>
                            <button class="action-btn btn-secondary" @click.stop="toggleFavorite(course)">
                                <i :class="course.isFavorite ? 'fas fa-heart' : 'far fa-heart'"></i>
                                {{ course.isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å­¦ä¹ ç¬”è®° -->
            <div class="notes-panel" v-if="notes.length > 0">
                <div class="notes-header">
                    <h3><i class="fas fa-sticky-note"></i> å­¦ä¹ ç¬”è®°</h3>
                    <button class="control-button" @click="exportNotes">
                        <i class="fas fa-download"></i> å¯¼å‡ºç¬”è®°
                    </button>
                </div>
                
                <div class="note-item" v-for="note in notes" :key="note.id">
                    <div class="note-time">{{ note.time }} - {{ note.course }}</div>
                    <div class="note-content">{{ note.content }}</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            mixins: [SharedMixin],
            components: {
                'ocean-background': OceanBackground,
                'notification-component': NotificationComponent,
                'loading-spinner': LoadingSpinner
            },
            data() {
                return {
                    currentVideo: null,
                    isPlaying: false,
                    playSpeed: 1.0,
                    notes: [],
                    courses: [
                        {
                            id: 1,
                            title: 'æµä½“åŠ›å­¦ä¹‹ç¾ï¼Œå¤ªç¾äº†',
                            description: 'æµä½“åŠ›å­¦çš„åŸºæœ¬æ¦‚å¿µå’Œåº”ç”¨ï¼Œå±•ç°æµä½“è¿åŠ¨çš„ç¾å¦™è§„å¾‹',
                            duration: '45åˆ†é’Ÿ',
                            difficulty: 'ç®€å•',
                            views: 15280,
                            progress: 0,
                            icon: 'ğŸ“š',
                            isFavorite: false,
                            videoId: 'BV16T421D7k4',
                            sourceType: 'bilibili'
                        },
                        {
                            id: 2,
                            title: 'æµä½“åŠ›å­¦åŸºç¡€åŸç†',
                            description: 'æ·±å…¥è®²è§£æµä½“åŠ›å­¦çš„åŸºç¡€ç†è®ºå’Œæ ¸å¿ƒåŸç†',
                            duration: '62åˆ†é’Ÿ',
                            difficulty: 'ä¸­ç­‰',
                            views: 8960,
                            progress: 0,
                            icon: 'âš–ï¸',
                            isFavorite: false,
                            videoId: 'BV1GJ411x7h7',
                            sourceType: 'bilibili'
                        },
                        {
                            id: 3,
                            title: 'ä¼¯åŠªåˆ©æ–¹ç¨‹è¯¦è§£',
                            description: 'è¯¦ç»†è§£æä¼¯åŠªåˆ©æ–¹ç¨‹çš„æ¨å¯¼è¿‡ç¨‹å’Œå·¥ç¨‹åº”ç”¨',
                            duration: '55åˆ†é’Ÿ',
                            difficulty: 'ä¸­ç­‰',
                            views: 12450,
                            progress: 0,
                            icon: 'ğŸŒŠ',
                            isFavorite: false,
                            videoId: 'BV1Yb4y1Y7Jp',
                            sourceType: 'bilibili'
                        },
                        {
                            id: 4,
                            title: 'æµä½“åŠ¨åŠ›å­¦ä¸æ¶¡æ—‹',
                            description: 'æµä½“åŠ¨åŠ›å­¦åŸºç¡€ï¼Œæ¶¡æ—‹è¿åŠ¨çš„å½¢æˆæœºç†å’Œç‰¹æ€§',
                            duration: '48åˆ†é’Ÿ',
                            difficulty: 'å›°éš¾',
                            views: 6780,
                            progress: 0,
                            icon: 'ğŸ”„',
                            isFavorite: false,
                            videoId: 'BV1XJ411L7Bd',
                            sourceType: 'bilibili'
                        },
                        {
                            id: 5,
                            title: 'NSæ–¹ç¨‹è§£æ',
                            description: 'Navier-Stokesæ–¹ç¨‹çš„æ•°å­¦æ¨å¯¼å’Œç‰©ç†æ„ä¹‰',
                            duration: '72åˆ†é’Ÿ',
                            difficulty: 'å›°éš¾',
                            views: 4320,
                            progress: 0,
                            icon: 'âš¡',
                            isFavorite: false,
                            videoId: 'BV1QJ411Y7N8',
                            sourceType: 'bilibili'
                        },
                        {
                            id: 6,
                            title: 'æµä½“åŠ›å­¦å·¥ç¨‹åº”ç”¨',
                            description: 'æµä½“åŠ›å­¦åœ¨å·¥ç¨‹å®è·µä¸­çš„å…·ä½“åº”ç”¨æ¡ˆä¾‹',
                            duration: '58åˆ†é’Ÿ',
                            difficulty: 'ä¸­ç­‰',
                            views: 9850,
                            progress: 0,
                            icon: 'ğŸŒ€',
                            isFavorite: false,
                            videoId: 'BV1NJ411L7Bd',
                            sourceType: 'bilibili'
                        },
                        {
                            id: 7,
                            title: 'è¾¹ç•Œå±‚ç†è®ºç²¾è®²',
                            description: 'æµä½“è¾¹ç•Œå±‚çš„å½¢æˆã€å‘å±•å’Œå·¥ç¨‹è®¡ç®—æ–¹æ³•',
                            duration: '65åˆ†é’Ÿ',
                            difficulty: 'å›°éš¾',
                            views: 3650,
                            progress: 0,
                            icon: 'ğŸ“',
                            isFavorite: false,
                            videoId: 'BV1PJ411L7Bd',
                            sourceType: 'bilibili'
                        },
                        {
                            id: 8,
                            title: 'ç‰©ç†æµ·æ´‹å­¦åŸºç¡€',
                            description: 'æµ·æ´‹æµä½“åŠ›å­¦åŸºç¡€ï¼Œæ½®æ±ã€æ³¢æµªå’Œæµ·æµç°è±¡',
                            duration: '78åˆ†é’Ÿ',
                            difficulty: 'å›°éš¾',
                            views: 5240,
                            progress: 0,
                            icon: 'ğŸŒŠ',
                            isFavorite: false,
                            videoId: 'BV1RJ411L7Bd',
                            sourceType: 'bilibili'
                        }
                    ]
                }
            },
            methods: {
                getBilibiliEmbedUrl(videoId) {
                    // ç”ŸæˆBç«™åµŒå…¥å¼æ’­æ”¾å™¨URL
                    return `https://player.bilibili.com/player.html?bvid=${videoId}&page=1&high_quality=1&danmaku=0&autoplay=1&t=0&as_wide=1`;
                },
                
                selectCourse(course) {
                    this.currentVideo = course;
                    this.showNotification(`é€‰æ‹©è¯¾ç¨‹ï¼š${course.title}`, 'info');
                    
                    // è®°å½•å­¦ä¹ è¿›åº¦
                    this.updateProgress(course.id, 'started');
                },
                
                playCourse(course) {
                    this.currentVideo = course;
                    this.isPlaying = true;
                    this.showNotification(`å¼€å§‹æ’­æ”¾ï¼š${course.title}`, 'success');
                    
                    // è®°å½•è§‚çœ‹å¼€å§‹
                    this.updateProgress(course.id, 'playing');
                },
                
                togglePlay() {
                    this.isPlaying = !this.isPlaying;
                    this.showNotification(this.isPlaying ? 'å¼€å§‹æ’­æ”¾' : 'æš‚åœæ’­æ”¾', 'info');
                },
                
                changeSpeed() {
                    const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0];
                    const currentIndex = speeds.indexOf(this.playSpeed);
                    this.playSpeed = speeds[(currentIndex + 1) % speeds.length];
                    this.showNotification(`æ’­æ”¾é€Ÿåº¦ï¼š${this.playSpeed}x`, 'info');
                },
                
                toggleFullscreen() {
                    this.showNotification('å…¨å±åŠŸèƒ½å¼€å‘ä¸­...', 'info');
                },
                
                addNote() {
                    const content = prompt('è¯·è¾“å…¥ç¬”è®°å†…å®¹ï¼š');
                    if (content) {
                        const note = {
                            id: Date.now(),
                            time: new Date().toLocaleTimeString(),
                            course: this.currentVideo.title,
                            content: content
                        };
                        this.notes.unshift(note);
                        this.saveToStorage('videoNotes', this.notes);
                        this.showNotification('ç¬”è®°å·²æ·»åŠ ï¼', 'success');
                    }
                },
                
                markCompleted() {
                    if (this.currentVideo) {
                        this.currentVideo.progress = 100;
                        this.saveToStorage('courseProgress', this.courses);
                        this.showNotification('è¯¾ç¨‹å·²æ ‡è®°ä¸ºå®Œæˆï¼', 'success');
                    }
                },
                
                toggleFavorite(course) {
                    course.isFavorite = !course.isFavorite;
                    this.saveToStorage('favorites', this.courses.filter(c => c.isFavorite));
                    this.showNotification(
                        course.isFavorite ? 'å·²æ·»åŠ åˆ°æ”¶è—' : 'å·²å–æ¶ˆæ”¶è—', 
                        course.isFavorite ? 'success' : 'info'
                    );
                },
                
                exportNotes() {
                    const notesText = this.notes.map(note => 
                        `${note.time} - ${note.course}\n${note.content}\n\n`
                    ).join('');
                    
                    const blob = new Blob([notesText], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'æµä½“åŠ›å­¦å­¦ä¹ ç¬”è®°.txt';
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('ç¬”è®°å·²å¯¼å‡ºï¼', 'success');
                },
                
                loadProgress() {
                    const savedProgress = this.loadFromStorage('courseProgress', []);
                    if (savedProgress.length > 0) {
                        savedProgress.forEach(saved => {
                            const course = this.courses.find(c => c.id === saved.id);
                            if (course) {
                                course.progress = saved.progress;
                            }
                        });
                    }
                    
                    const savedNotes = this.loadFromStorage('videoNotes', []);
                    this.notes = savedNotes;
                    
                    const savedFavorites = this.loadFromStorage('favorites', []);
                    savedFavorites.forEach(fav => {
                        const course = this.courses.find(c => c.id === fav.id);
                        if (course) {
                            course.isFavorite = true;
                        }
                    });
                },

                // The original getBilibiliEmbedUrl was removed as per the new_code,
                // but the new_code provided a replacement.
            },
            
            mounted() {
                console.log('ğŸ¥ è§†é¢‘å­¦ä¹ æ¨¡å—å¯åŠ¨ï¼');
                this.setLoading(true);
                
                setTimeout(() => {
                    this.loadProgress();
                    this.setLoading(false);
                    this.showNotification('è§†é¢‘è¯¾ç¨‹åŠ è½½å®Œæˆï¼', 'success');
                }, 1200);
            }
        }).mount('#videoApp');
    </script>
</body>
</html> 