<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š æ•™å¸ˆé¢˜ç›®ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #f093fb;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 28px;
        }

        .stats-bar {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .stat-item {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .toolbar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .search-box {
            flex: 1;
            min-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .filter-select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            min-width: 150px;
        }

        .questions-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        }

        .question-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .question-card:hover {
            transform: translateY(-5px);
        }

        .question-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-id {
            background: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .question-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .question-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            line-height: 1.4;
        }

        .question-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #666;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .question-options {
            margin-bottom: 15px;
        }

        .option-item {
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .correct-answer {
            background: #d4edda;
            border-left: 4px solid var(--success-color);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .options-editor {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }

        .option-editor {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .option-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .correct-radio {
            margin-right: 10px;
        }

        .add-option-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            animation: slideIn 0.3s;
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.error {
            background: var(--error-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 16px;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #999;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #ddd;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .questions-grid {
                grid-template-columns: 1fr;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .stats-bar {
                flex-direction: column;
                gap: 10px;
            }

            .modal {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- å¤´éƒ¨ -->
            <div class="header">
                <h1><i class="fas fa-chalkboard-teacher"></i> æ•™å¸ˆé¢˜ç›®ç®¡ç†ç³»ç»Ÿ</h1>
                <p>ç®¡ç†æµä½“åŠ›å­¦é¢˜åº“ - æ”¯æŒå¢åŠ ã€ç¼–è¾‘ã€åˆ é™¤é¢˜ç›®</p>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-number">{{ totalQuestions }}</span>
                        <span class="stat-label">æ€»é¢˜ç›®æ•°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">{{ filteredQuestions.length }}</span>
                        <span class="stat-label">å½“å‰æ˜¾ç¤º</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">{{ questionBanks.length }}</span>
                        <span class="stat-label">é¢˜åº“æ•°é‡</span>
                    </div>
                </div>
            </div>

            <!-- å·¥å…·æ  -->
            <div class="toolbar">
                <button @click="showAddModal" class="btn btn-success">
                    <i class="fas fa-plus"></i> æ·»åŠ é¢˜ç›®
                </button>
                
                <button @click="exportQuestions" class="btn btn-primary">
                    <i class="fas fa-download"></i> å¯¼å‡ºé¢˜åº“
                </button>
                
                <button @click="importQuestions" class="btn btn-warning">
                    <i class="fas fa-upload"></i> å¯¼å…¥é¢˜åº“
                </button>
                
                <button @click="saveToGitHub" class="btn btn-primary" :disabled="!hasChanges">
                    <i class="fas fa-save"></i> ä¿å­˜åˆ°GitHub
                </button>

                <div class="search-box">
                    <input v-model="searchKeyword" 
                           class="search-input" 
                           placeholder="æœç´¢é¢˜ç›®å†…å®¹ã€çŸ¥è¯†ç‚¹..." 
                           @input="onSearch">
                </div>

                <select v-model="selectedBank" class="filter-select" @change="onFilterChange">
                    <option value="">æ‰€æœ‰é¢˜åº“</option>
                    <option v-for="bank in questionBanks" :key="bank.id" :value="bank.id">
                        {{ bank.name }}
                    </option>
                </select>

                <select v-model="selectedType" class="filter-select" @change="onFilterChange">
                    <option value="">æ‰€æœ‰ç±»å‹</option>
                    <option value="é€‰æ‹©é¢˜">é€‰æ‹©é¢˜</option>
                    <option value="è®¡ç®—é¢˜">è®¡ç®—é¢˜</option>
                    <option value="åˆ†æé¢˜">åˆ†æé¢˜</option>
                    <option value="è¯æ˜é¢˜">è¯æ˜é¢˜</option>
                </select>
            </div>

            <!-- é¢˜ç›®åˆ—è¡¨ -->
            <div v-if="loading" class="loading">
                <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½é¢˜ç›®...
            </div>

            <div v-else-if="filteredQuestions.length === 0" class="empty-state">
                <i class="fas fa-inbox"></i>
                <h3>æš‚æ— é¢˜ç›®</h3>
                <p>{{ searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¢˜ç›®' : 'ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ é¢˜ç›®"å¼€å§‹åˆ›å»º' }}</p>
            </div>

            <div v-else class="questions-grid">
                <div v-for="question in paginatedQuestions" :key="question.id" class="question-card">
                    <div class="question-header">
                        <span class="question-id">ID: {{ question.id }}</span>
                        <div class="question-actions">
                            <button @click="editQuestion(question)" class="btn btn-primary btn-small">
                                <i class="fas fa-edit"></i> ç¼–è¾‘
                            </button>
                            <button @click="duplicateQuestion(question)" class="btn btn-warning btn-small">
                                <i class="fas fa-copy"></i> å¤åˆ¶
                            </button>
                            <button @click="deleteQuestion(question)" class="btn btn-danger btn-small">
                                <i class="fas fa-trash"></i> åˆ é™¤
                            </button>
                        </div>
                    </div>

                    <div class="question-title">{{ question.title }}</div>

                    <div class="question-meta">
                        <div class="meta-item">
                            <i class="fas fa-tag"></i>
                            {{ question.type || 'æœªåˆ†ç±»' }}
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-calendar"></i>
                            {{ question.year || 'æœªçŸ¥å¹´ä»½' }}
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-star"></i>
                            {{ question.score || 0 }}åˆ†
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-book"></i>
                            {{ getQuestionBankName(question.bankId) }}
                        </div>
                    </div>

                    <div v-if="question.options && question.options.length > 0" class="question-options">
                        <div v-for="(option, index) in question.options.slice(0, 2)" 
                             :key="index" 
                             class="option-item"
                             :class="{ 'correct-answer': index === question.answer }">
                            {{ String.fromCharCode(65 + index) }}. {{ option.substring(0, 50) }}...
                        </div>
                        <div v-if="question.options.length > 2" class="option-item" style="color: #999;">
                            è¿˜æœ‰ {{ question.options.length - 2 }} ä¸ªé€‰é¡¹...
                        </div>
                    </div>

                    <div v-if="question.knowledgePoints && question.knowledgePoints.length > 0" class="question-meta">
                        <div class="meta-item">
                            <i class="fas fa-lightbulb"></i>
                            {{ question.knowledgePoints.slice(0, 3).join(', ') }}
                            <span v-if="question.knowledgePoints.length > 3">...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åˆ†é¡µ -->
            <div v-if="totalPages > 1" class="pagination" style="text-align: center; margin-top: 30px;">
                <button @click="currentPage = Math.max(1, currentPage - 1)" 
                        :disabled="currentPage === 1" 
                        class="btn btn-primary">
                    ä¸Šä¸€é¡µ
                </button>
                <span style="margin: 0 20px; font-weight: 600;">
                    ç¬¬ {{ currentPage }} é¡µï¼Œå…± {{ totalPages }} é¡µ
                </span>
                <button @click="currentPage = Math.min(totalPages, currentPage + 1)" 
                        :disabled="currentPage === totalPages" 
                        class="btn btn-primary">
                    ä¸‹ä¸€é¡µ
                </button>
            </div>
        </div>

        <!-- æ·»åŠ /ç¼–è¾‘é¢˜ç›®æ¨¡æ€æ¡† -->
        <div v-if="showModal" class="modal-overlay" @click.self="closeModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">
                        <i :class="isEditing ? 'fas fa-edit' : 'fas fa-plus'"></i>
                        {{ isEditing ? 'ç¼–è¾‘é¢˜ç›®' : 'æ·»åŠ é¢˜ç›®' }}
                    </h3>
                    <button @click="closeModal" class="close-btn">&times;</button>
                </div>

                <form @submit.prevent="saveQuestion">
                    <div class="form-group">
                        <label class="form-label">é¢˜ç›®å†…å®¹ *</label>
                        <textarea v-model="currentQuestion.title" 
                                  class="form-textarea" 
                                  placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹..." 
                                  required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">é¢˜ç›®ç±»å‹ *</label>
                        <select v-model="currentQuestion.type" class="form-select" required>
                            <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                            <option value="é€‰æ‹©é¢˜">é€‰æ‹©é¢˜</option>
                            <option value="è®¡ç®—é¢˜">è®¡ç®—é¢˜</option>
                            <option value="åˆ†æé¢˜">åˆ†æé¢˜</option>
                            <option value="è¯æ˜é¢˜">è¯æ˜é¢˜</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ‰€å±é¢˜åº“ *</label>
                        <select v-model="currentQuestion.bankId" class="form-select" required>
                            <option value="">è¯·é€‰æ‹©é¢˜åº“</option>
                            <option v-for="bank in questionBanks" :key="bank.id" :value="bank.id">
                                {{ bank.name }}
                            </option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">å¹´ä»½</label>
                            <input v-model.number="currentQuestion.year" 
                                   type="number" 
                                   class="form-input" 
                                   placeholder="å¦‚: 2023" 
                                   min="2000" 
                                   max="2030">
                        </div>

                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">åˆ†æ•°</label>
                            <input v-model.number="currentQuestion.score" 
                                   type="number" 
                                   class="form-input" 
                                   placeholder="å¦‚: 5" 
                                   min="1" 
                                   max="50">
                        </div>
                    </div>

                    <!-- é€‰æ‹©é¢˜é€‰é¡¹ç¼–è¾‘ -->
                    <div v-if="currentQuestion.type === 'é€‰æ‹©é¢˜'" class="form-group">
                        <label class="form-label">é€‰é¡¹è®¾ç½®</label>
                        <div class="options-editor">
                            <div v-for="(option, index) in currentQuestion.options" :key="index" class="option-editor">
                                <input type="radio" 
                                       :name="'correct-answer'" 
                                       :value="index" 
                                       v-model="currentQuestion.answer" 
                                       class="correct-radio">
                                <input v-model="currentQuestion.options[index]" 
                                       class="option-input" 
                                       :placeholder="`é€‰é¡¹ ${String.fromCharCode(65 + index)}`"
                                       required>
                                <button type="button" 
                                        @click="removeOption(index)" 
                                        class="btn btn-danger btn-small"
                                        v-if="currentQuestion.options.length > 2">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <button type="button" 
                                    @click="addOption" 
                                    class="add-option-btn"
                                    v-if="currentQuestion.options.length < 6">
                                <i class="fas fa-plus"></i> æ·»åŠ é€‰é¡¹
                            </button>
                        </div>
                    </div>

                    <!-- ä¸»è§‚é¢˜ç­”æ¡ˆ -->
                    <div v-else class="form-group">
                        <label class="form-label">æ ‡å‡†ç­”æ¡ˆ</label>
                        <textarea v-model="currentQuestion.answer" 
                                  class="form-textarea" 
                                  placeholder="è¯·è¾“å…¥æ ‡å‡†ç­”æ¡ˆæˆ–è§£é¢˜æ­¥éª¤..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">è§£æè¯´æ˜</label>
                        <textarea v-model="currentQuestion.explanation" 
                                  class="form-textarea" 
                                  placeholder="è¯·è¾“å…¥é¢˜ç›®è§£æ..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">çŸ¥è¯†ç‚¹æ ‡ç­¾</label>
                        <input v-model="knowledgePointsText" 
                               class="form-input" 
                               placeholder="è¯·è¾“å…¥çŸ¥è¯†ç‚¹ï¼Œç”¨é€—å·åˆ†éš”ï¼Œå¦‚: æµä½“åŠ›å­¦åŸºç¡€,é›·è¯ºæ•°,è¾¹ç•Œå±‚">
                    </div>

                    <div class="form-group" style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button type="button" @click="closeModal" class="btn btn-secondary">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i>
                            {{ isEditing ? 'ä¿å­˜ä¿®æ”¹' : 'æ·»åŠ é¢˜ç›®' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- é€šçŸ¥æ¶ˆæ¯ -->
        <div v-if="notification.show" 
             :class="['notification', notification.type]">
            {{ notification.message }}
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // é¢˜ç›®æ•°æ®
                    questions: [],
                    questionBanks: [
                        { id: 'real-exam', name: 'å†å¹´çœŸé¢˜', file: 'çœŸé¢˜_ä¸­å›½æµ·æ´‹å¤§å­¦_2000-2021_cleaned.json' },
                        { id: 'error-prone', name: 'æ˜“é”™é¢˜é›†', file: 'æ˜“é”™é¢˜é›†.json' },
                        { id: 'fluid-basics', name: 'æµä½“åŠ›å­¦åŸºç¡€', file: 'åˆ†ç±»_æµä½“åŠ›å­¦åŸºç¡€.json' },
                        { id: 'fluid-properties', name: 'æµä½“æ€§è´¨', file: 'åˆ†ç±»_æµä½“æ€§è´¨.json' },
                        { id: 'pressure', name: 'å‹åŠ›', file: 'åˆ†ç±»_å‹åŠ›.json' },
                        { id: 'viscosity', name: 'ç²˜æ€§', file: 'åˆ†ç±»_ç²˜æ€§.json' },
                        { id: 'reynolds', name: 'é›·è¯ºæ•°', file: 'åˆ†ç±»_é›·è¯ºæ•°.json' },
                        { id: 'boundary-layer', name: 'è¾¹ç•Œå±‚', file: 'åˆ†ç±»_è¾¹ç•Œå±‚.json' },
                        { id: 'streamline', name: 'æµçº¿è½¨è¿¹', file: 'åˆ†ç±»_æµçº¿è½¨è¿¹.json' },
                        { id: 'vorticity', name: 'æ¶¡åº¦', file: 'åˆ†ç±»_æ¶¡åº¦.json' },
                        { id: 'momentum', name: 'åŠ¨é‡æ–¹ç¨‹', file: 'åˆ†ç±»_åŠ¨é‡æ–¹ç¨‹.json' },
                        { id: 'energy', name: 'èƒ½é‡æ–¹ç¨‹', file: 'åˆ†ç±»_èƒ½é‡æ–¹ç¨‹.json' },
                        { id: 'potential-flow', name: 'åŠ¿æµ', file: 'åˆ†ç±»_åŠ¿æµ.json' },
                        { id: 'pipe-flow', name: 'ç®¡é“æµåŠ¨', file: 'åˆ†ç±»_ç®¡é“æµåŠ¨.json' },
                        { id: 'turbulence', name: 'æ¹æµ', file: 'åˆ†ç±»_æ¹æµ.json' },
                        { id: 'free-surface', name: 'è‡ªç”±é¢', file: 'åˆ†ç±»_è‡ªç”±é¢.json' },
                        { id: 'experiment', name: 'å®éªŒä¸é‡çº²', file: 'åˆ†ç±»_å®éªŒä¸é‡çº².json' }
                    ],
                    
                    // ç•Œé¢çŠ¶æ€
                    loading: false,
                    showModal: false,
                    isEditing: false,
                    hasChanges: false,
                    
                    // ç­›é€‰å’Œæœç´¢
                    searchKeyword: '',
                    selectedBank: '',
                    selectedType: '',
                    
                    // åˆ†é¡µ
                    currentPage: 1,
                    pageSize: 12,
                    
                    // å½“å‰ç¼–è¾‘çš„é¢˜ç›®
                    currentQuestion: this.getEmptyQuestion(),
                    knowledgePointsText: '',
                    
                    // é€šçŸ¥
                    notification: {
                        show: false,
                        message: '',
                        type: 'success'
                    }
                }
            },

            computed: {
                totalQuestions() {
                    return this.questions.length;
                },

                filteredQuestions() {
                    let filtered = this.questions;

                    // æœç´¢è¿‡æ»¤
                    if (this.searchKeyword) {
                        const keyword = this.searchKeyword.toLowerCase();
                        filtered = filtered.filter(q => 
                            q.title.toLowerCase().includes(keyword) ||
                            (q.knowledgePoints && q.knowledgePoints.some(kp => kp.toLowerCase().includes(keyword))) ||
                            (q.explanation && q.explanation.toLowerCase().includes(keyword))
                        );
                    }

                    // é¢˜åº“è¿‡æ»¤
                    if (this.selectedBank) {
                        filtered = filtered.filter(q => q.bankId === this.selectedBank);
                    }

                    // ç±»å‹è¿‡æ»¤
                    if (this.selectedType) {
                        filtered = filtered.filter(q => q.type === this.selectedType);
                    }

                    return filtered;
                },

                totalPages() {
                    return Math.ceil(this.filteredQuestions.length / this.pageSize);
                },

                paginatedQuestions() {
                    const start = (this.currentPage - 1) * this.pageSize;
                    const end = start + this.pageSize;
                    return this.filteredQuestions.slice(start, end);
                }
            },

            async mounted() {
                await this.loadQuestions();
            },

            methods: {
                async loadQuestions() {
                    this.loading = true;
                    try {
                        // åŠ è½½æ‰€æœ‰é¢˜åº“
                        const allQuestions = [];
                        
                        for (const bank of this.questionBanks) {
                            try {
                                const response = await fetch(`../question-banks/${bank.file}`);
                                if (response.ok) {
                                    const data = await response.json();
                                    const questions = Array.isArray(data) ? data : (data.questions || []);
                                    
                                    questions.forEach((q, index) => {
                                        allQuestions.push({
                                            ...q,
                                            id: q.id || `${bank.id}_${index}`,
                                            bankId: bank.id,
                                            bankName: bank.name
                                        });
                                    });
                                }
                            } catch (error) {
                                console.warn(`æ— æ³•åŠ è½½é¢˜åº“ ${bank.name}:`, error);
                            }
                        }
                        
                        this.questions = allQuestions;
                        this.showNotification(`æˆåŠŸåŠ è½½ ${allQuestions.length} é“é¢˜ç›®`, 'success');
                        
                    } catch (error) {
                        console.error('åŠ è½½é¢˜ç›®å¤±è´¥:', error);
                        this.showNotification('åŠ è½½é¢˜ç›®å¤±è´¥', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                getEmptyQuestion() {
                    return {
                        id: '',
                        title: '',
                        type: '',
                        bankId: '',
                        year: new Date().getFullYear(),
                        score: 5,
                        options: ['', '', '', ''],
                        answer: 0,
                        explanation: '',
                        knowledgePoints: []
                    };
                },

                showAddModal() {
                    this.currentQuestion = this.getEmptyQuestion();
                    this.knowledgePointsText = '';
                    this.isEditing = false;
                    this.showModal = true;
                },

                editQuestion(question) {
                    this.currentQuestion = { ...question };
                    // ç¡®ä¿é€‰æ‹©é¢˜æœ‰æ­£ç¡®çš„é€‰é¡¹æ ¼å¼
                    if (question.type === 'é€‰æ‹©é¢˜' && (!question.options || question.options.length === 0)) {
                        this.currentQuestion.options = ['', '', '', ''];
                        this.currentQuestion.answer = 0;
                    }
                    this.knowledgePointsText = question.knowledgePoints ? question.knowledgePoints.join(', ') : '';
                    this.isEditing = true;
                    this.showModal = true;
                },

                duplicateQuestion(question) {
                    this.currentQuestion = { 
                        ...question, 
                        id: `${question.id}_copy_${Date.now()}`,
                        title: `${question.title} (å‰¯æœ¬)`
                    };
                    this.knowledgePointsText = question.knowledgePoints ? question.knowledgePoints.join(', ') : '';
                    this.isEditing = false;
                    this.showModal = true;
                },

                async deleteQuestion(question) {
                    if (!confirm(`ç¡®å®šè¦åˆ é™¤é¢˜ç›® "${question.title.substring(0, 50)}..." å—ï¼Ÿ`)) {
                        return;
                    }

                    try {
                        // ä»æœ¬åœ°æ•°ç»„ä¸­åˆ é™¤
                        const index = this.questions.findIndex(q => q.id === question.id);
                        if (index !== -1) {
                            this.questions.splice(index, 1);
                            this.hasChanges = true;
                            this.showNotification('é¢˜ç›®å·²åˆ é™¤', 'success');
                        }
                    } catch (error) {
                        console.error('åˆ é™¤é¢˜ç›®å¤±è´¥:', error);
                        this.showNotification('åˆ é™¤é¢˜ç›®å¤±è´¥', 'error');
                    }
                },

                saveQuestion() {
                    // éªŒè¯è¡¨å•
                    if (!this.currentQuestion.title.trim()) {
                        this.showNotification('è¯·å¡«å†™é¢˜ç›®å†…å®¹', 'warning');
                        return;
                    }

                    if (!this.currentQuestion.type) {
                        this.showNotification('è¯·é€‰æ‹©é¢˜ç›®ç±»å‹', 'warning');
                        return;
                    }

                    if (!this.currentQuestion.bankId) {
                        this.showNotification('è¯·é€‰æ‹©æ‰€å±é¢˜åº“', 'warning');
                        return;
                    }

                    // å¤„ç†çŸ¥è¯†ç‚¹
                    this.currentQuestion.knowledgePoints = this.knowledgePointsText
                        .split(',')
                        .map(point => point.trim())
                        .filter(point => point);

                    // ç”ŸæˆIDï¼ˆå¦‚æœæ˜¯æ–°å¢ï¼‰
                    if (!this.isEditing || !this.currentQuestion.id) {
                        this.currentQuestion.id = `${this.currentQuestion.bankId}_${Date.now()}`;
                    }

                    // ä¿å­˜åˆ°æœ¬åœ°æ•°ç»„
                    if (this.isEditing) {
                        const index = this.questions.findIndex(q => q.id === this.currentQuestion.id);
                        if (index !== -1) {
                            this.questions.splice(index, 1, { ...this.currentQuestion });
                        }
                    } else {
                        this.questions.push({ ...this.currentQuestion });
                    }

                    this.hasChanges = true;
                    this.closeModal();
                    this.showNotification(
                        this.isEditing ? 'é¢˜ç›®å·²æ›´æ–°' : 'é¢˜ç›®å·²æ·»åŠ ', 
                        'success'
                    );
                },

                addOption() {
                    if (this.currentQuestion.options.length < 6) {
                        this.currentQuestion.options.push('');
                    }
                },

                removeOption(index) {
                    if (this.currentQuestion.options.length > 2) {
                        this.currentQuestion.options.splice(index, 1);
                        // è°ƒæ•´æ­£ç¡®ç­”æ¡ˆç´¢å¼•
                        if (this.currentQuestion.answer >= index) {
                            this.currentQuestion.answer = Math.max(0, this.currentQuestion.answer - 1);
                        }
                    }
                },

                closeModal() {
                    this.showModal = false;
                    this.currentQuestion = this.getEmptyQuestion();
                    this.knowledgePointsText = '';
                },

                onSearch() {
                    this.currentPage = 1;
                },

                onFilterChange() {
                    this.currentPage = 1;
                },

                getQuestionBankName(bankId) {
                    const bank = this.questionBanks.find(b => b.id === bankId);
                    return bank ? bank.name : 'æœªçŸ¥é¢˜åº“';
                },

                async exportQuestions() {
                    try {
                        const dataStr = JSON.stringify(this.questions, null, 2);
                        const dataBlob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(dataBlob);
                        
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `questions_export_${new Date().toISOString().split('T')[0]}.json`;
                        link.click();
                        
                        URL.revokeObjectURL(url);
                        this.showNotification('é¢˜ç›®å·²å¯¼å‡º', 'success');
                    } catch (error) {
                        console.error('å¯¼å‡ºå¤±è´¥:', error);
                        this.showNotification('å¯¼å‡ºå¤±è´¥', 'error');
                    }
                },

                importQuestions() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    
                    input.onchange = (event) => {
                        const file = event.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                try {
                                    const importedQuestions = JSON.parse(e.target.result);
                                    if (Array.isArray(importedQuestions)) {
                                        // ä¸ºå¯¼å…¥çš„é¢˜ç›®ç”Ÿæˆæ–°IDï¼Œé¿å…å†²çª
                                        importedQuestions.forEach(q => {
                                            q.id = `imported_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                                        });
                                        
                                        this.questions.push(...importedQuestions);
                                        this.hasChanges = true;
                                        this.showNotification(`æˆåŠŸå¯¼å…¥ ${importedQuestions.length} é“é¢˜ç›®`, 'success');
                                    } else {
                                        throw new Error('æ— æ•ˆçš„JSONæ ¼å¼');
                                    }
                                } catch (error) {
                                    console.error('å¯¼å…¥å¤±è´¥:', error);
                                    this.showNotification('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    
                    input.click();
                },

                async saveToGitHub() {
                    if (!this.hasChanges) {
                        this.showNotification('æ²¡æœ‰éœ€è¦ä¿å­˜çš„æ›´æ”¹', 'warning');
                        return;
                    }

                    try {
                        this.showNotification('æ­£åœ¨ä¿å­˜åˆ°GitHub...', 'info');
                        
                        // è¿™é‡Œåº”è¯¥è°ƒç”¨GitHub APIä¿å­˜æ–‡ä»¶
                        // ç°åœ¨å…ˆæ¨¡æ‹Ÿä¿å­˜æˆåŠŸ
                        
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        this.hasChanges = false;
                        this.showNotification('å·²æˆåŠŸä¿å­˜åˆ°GitHubä»“åº“', 'success');
                        
                    } catch (error) {
                        console.error('ä¿å­˜åˆ°GitHubå¤±è´¥:', error);
                        this.showNotification('ä¿å­˜åˆ°GitHubå¤±è´¥', 'error');
                    }
                },

                showNotification(message, type = 'success') {
                    this.notification = {
                        show: true,
                        message,
                        type
                    };

                    setTimeout(() => {
                        this.notification.show = false;
                    }, 3000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html> 