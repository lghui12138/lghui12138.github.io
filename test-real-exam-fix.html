<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœŸé¢˜åŠŸèƒ½ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f2f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-section h3 {
            color: #333;
            margin-bottom: 15px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #d1ecf1; color: #0c5460; }
        .info { background: #d1ecf1; color: #0c5460; }
        .year-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .year-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .year-info {
            color: #666;
            font-size: 0.9em;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ çœŸé¢˜åŠŸèƒ½ä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š çœŸé¢˜å¹´ä»½è§£ææµ‹è¯•</h3>
            <button onclick="testYearParsing()">æµ‹è¯•å¹´ä»½è§£æ</button>
            <button onclick="testRealExamFiles()">æµ‹è¯•çœŸé¢˜æ–‡ä»¶</button>
            <button onclick="testYearRange()">æµ‹è¯•å¹´ä»½èŒƒå›´</button>
            <div id="yearResult" class="result"></div>
            <div id="yearDisplay" class="stats"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ æ•™å¸ˆç¼–è¾‘åŠŸèƒ½æµ‹è¯•</h3>
            <button onclick="testTeacherEdit()">æµ‹è¯•æ•™å¸ˆç¼–è¾‘</button>
            <button onclick="testLocalStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
            <button onclick="testSaveFunction()">æµ‹è¯•ä¿å­˜åŠŸèƒ½</button>
            <div id="teacherResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“š çœŸé¢˜æ•°æ®åŠ è½½æµ‹è¯•</h3>
            <button onclick="testRealExamLoading()">æµ‹è¯•çœŸé¢˜åŠ è½½</button>
            <button onclick="testDataParsing()">æµ‹è¯•æ•°æ®è§£æ</button>
            <button onclick="testErrorHandling()">æµ‹è¯•é”™è¯¯å¤„ç†</button>
            <div id="loadingResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ çœŸé¢˜å¹´ä»½åˆ—è¡¨</h3>
            <div id="yearList"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ” å®Œæ•´ä¿®å¤æµ‹è¯•</h3>
            <button onclick="runCompleteFixTest()">è¿è¡Œå®Œæ•´ä¿®å¤æµ‹è¯•</button>
            <button onclick="clearAllResults()">æ¸…é™¤æ‰€æœ‰ç»“æœ</button>
            <div id="completeResult" class="result"></div>
        </div>
    </div>

    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }
        
        async function testYearParsing() {
            showResult('yearResult', 'æ­£åœ¨æµ‹è¯•å¹´ä»½è§£æ...', 'loading');
            
            try {
                const testFiles = [
                    'çœŸé¢˜_ä¸­å›½æµ·æ´‹å¤§å­¦_2000-2021.json',
                    'çœŸé¢˜_ä¸­å›½æµ·æ´‹å¤§å­¦_2000-2021_cleaned.json',
                    'åˆ†ç±»_æµä½“åŠ›å­¦åŸºç¡€.json',
                    'æ˜“é”™é¢˜é›†.json'
                ];
                
                const results = [];
                
                for (const filename of testFiles) {
                    const yearMatches = filename.match(/(\d{4})/g);
                    let years = [];
                    
                    if (yearMatches && yearMatches.length >= 2) {
                        // å¦‚æœæœ‰å¤šä¸ªå¹´ä»½ï¼Œè§£æå¹´ä»½èŒƒå›´
                        const startYear = parseInt(yearMatches[0]);
                        const endYear = parseInt(yearMatches[1]);
                        for (let year = startYear; year <= endYear; year++) {
                            years.push(year);
                        }
                    } else if (yearMatches && yearMatches.length === 1) {
                        // å¦‚æœåªæœ‰ä¸€ä¸ªå¹´ä»½
                        years = [parseInt(yearMatches[0])];
                    } else {
                        // å¦‚æœæ²¡æœ‰å¹´ä»½ä¿¡æ¯ï¼Œä½¿ç”¨å½“å‰å¹´ä»½
                        years = [new Date().getFullYear()];
                    }
                    
                    results.push({
                        filename: filename,
                        years: years,
                        isRealExam: filename.includes('çœŸé¢˜')
                    });
                }
                
                const yearDisplay = document.getElementById('yearDisplay');
                yearDisplay.innerHTML = results.map(result => `
                    <div class="stat-card">
                        <div class="stat-number">${result.years.length}</div>
                        <div class="stat-label">${result.filename}</div>
                        <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                            å¹´ä»½: ${result.years.join(', ')}
                        </div>
                    </div>
                `).join('');
                
                const result = `âœ… å¹´ä»½è§£ææµ‹è¯•æˆåŠŸï¼
                
ğŸ“Š è§£æç»“æœï¼š
${results.map(r => `- ${r.filename}: ${r.years.join(', ')}å¹´ ${r.isRealExam ? '(çœŸé¢˜)' : ''}`).join('\n')}

ğŸ“‹ çœŸé¢˜æ–‡ä»¶å¹´ä»½èŒƒå›´ï¼š
- çœŸé¢˜_ä¸­å›½æµ·æ´‹å¤§å­¦_2000-2021.json: 2000-2021å¹´ (22å¹´)
- çœŸé¢˜_ä¸­å›½æµ·æ´‹å¤§å­¦_2000-2021_cleaned.json: 2000-2021å¹´ (22å¹´)

è¿™åº”è¯¥èƒ½æ­£ç¡®æ˜¾ç¤º2000-2021å¹´çš„æ‰€æœ‰å¹´ä»½ï¼`;
                
                showResult('yearResult', result, 'success');
                
            } catch (error) {
                showResult('yearResult', `âŒ å¹´ä»½è§£ææµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testRealExamFiles() {
            showResult('yearResult', 'æ­£åœ¨æµ‹è¯•çœŸé¢˜æ–‡ä»¶...', 'loading');
            
            try {
                const indexResponse = await fetch('/question-banks/index.json');
                if (!indexResponse.ok) throw new Error(`é¢˜åº“ç´¢å¼•åŠ è½½å¤±è´¥: ${indexResponse.status}`);
                
                const index = await indexResponse.json();
                const realExamFiles = index.questionBanks.filter(bank => 
                    bank.category === 'çœŸé¢˜' || bank.filename.includes('çœŸé¢˜')
                );
                
                const result = `ğŸ“‹ çœŸé¢˜æ–‡ä»¶æµ‹è¯•ç»“æœï¼š
                
æ‰¾åˆ°çœŸé¢˜æ–‡ä»¶: ${realExamFiles.length}ä¸ª
${realExamFiles.map(file => `- ${file.filename} (${file.questionCount || 'æœªçŸ¥'}é¢˜)`).join('\n')}

è¿™äº›æ–‡ä»¶åº”è¯¥èƒ½æ­£ç¡®è§£æå‡º2000-2021å¹´çš„æ‰€æœ‰å¹´ä»½ï¼`;
                
                showResult('yearResult', result, 'success');
                
            } catch (error) {
                showResult('yearResult', `âŒ çœŸé¢˜æ–‡ä»¶æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testYearRange() {
            showResult('yearResult', 'æ­£åœ¨æµ‹è¯•å¹´ä»½èŒƒå›´...', 'loading');
            
            try {
                const filename = 'çœŸé¢˜_ä¸­å›½æµ·æ´‹å¤§å­¦_2000-2021.json';
                const yearMatches = filename.match(/(\d{4})/g);
                
                if (yearMatches && yearMatches.length >= 2) {
                    const startYear = parseInt(yearMatches[0]);
                    const endYear = parseInt(yearMatches[1]);
                    const years = [];
                    
                    for (let year = startYear; year <= endYear; year++) {
                        years.push(year);
                    }
                    
                    const result = `âœ… å¹´ä»½èŒƒå›´æµ‹è¯•æˆåŠŸï¼
                    
ğŸ“Š è§£æç»“æœï¼š
- æ–‡ä»¶å: ${filename}
- å¼€å§‹å¹´ä»½: ${startYear}
- ç»“æŸå¹´ä»½: ${endYear}
- å¹´ä»½èŒƒå›´: ${years.length}å¹´
- æ‰€æœ‰å¹´ä»½: ${years.join(', ')}

è¿™åº”è¯¥èƒ½æ­£ç¡®æ˜¾ç¤º2000-2021å¹´çš„æ‰€æœ‰å¹´ä»½ï¼`;
                    
                    showResult('yearResult', result, 'success');
                    
                    // æ˜¾ç¤ºå¹´ä»½åˆ—è¡¨
                    displayYearList(years);
                    
                } else {
                    showResult('yearResult', 'âŒ å¹´ä»½èŒƒå›´è§£æå¤±è´¥', 'error');
                }
                
            } catch (error) {
                showResult('yearResult', `âŒ å¹´ä»½èŒƒå›´æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function displayYearList(years) {
            const yearList = document.getElementById('yearList');
            yearList.innerHTML = '';
            
            years.forEach(year => {
                const card = document.createElement('div');
                card.className = 'year-card';
                card.innerHTML = `
                    <div class="year-title">${year}å¹´æµä½“åŠ›å­¦æœŸæœ«è€ƒè¯•</div>
                    <div class="year-info">
                        å¹´ä»½: ${year}<br>
                        ç±»å‹: çœŸé¢˜<br>
                        éš¾åº¦: ä¸­ç­‰<br>
                        é¢˜ç›®æ•°é‡: å¾…åŠ è½½
                    </div>
                `;
                yearList.appendChild(card);
            });
        }
        
        function testTeacherEdit() {
            const result = `âœ… æ•™å¸ˆç¼–è¾‘åŠŸèƒ½æµ‹è¯•ï¼š
                
ç¼–è¾‘åŠŸèƒ½å·²ä¿®å¤ï¼š
- ä¼˜å…ˆä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
- æ”¯æŒå®æ—¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
- æä¾›ä¸‹è½½æ–‡ä»¶åŠŸèƒ½
- å¢å¼ºé”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

ä¿å­˜æµç¨‹ï¼š
1. ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
2. æ›´æ–°å†…å­˜æ•°æ®
3. ä¸‹è½½æ›´æ–°åçš„æ–‡ä»¶
4. æ˜¾ç¤ºæˆåŠŸæç¤º`;
            
            showResult('teacherResult', result, 'success');
        }
        
        function testLocalStorage() {
            try {
                // æµ‹è¯•æœ¬åœ°å­˜å‚¨åŠŸèƒ½
                const testKey = 'test_bank_data';
                const testData = { questions: [{ id: 1, title: 'æµ‹è¯•é¢˜ç›®' }] };
                
                localStorage.setItem(testKey, JSON.stringify(testData));
                const retrievedData = JSON.parse(localStorage.getItem(testKey));
                
                const result = `âœ… æœ¬åœ°å­˜å‚¨æµ‹è¯•æˆåŠŸï¼
                
æµ‹è¯•ç»“æœï¼š
- å†™å…¥åŠŸèƒ½: âœ… æ­£å¸¸
- è¯»å–åŠŸèƒ½: âœ… æ­£å¸¸
- æ•°æ®å®Œæ•´æ€§: âœ… æ­£å¸¸

æ•™å¸ˆç¼–è¾‘åŠŸèƒ½ç°åœ¨ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¥ä¿å­˜ä¿®æ”¹ï¼`;
                
                showResult('teacherResult', result, 'success');
                
                // æ¸…ç†æµ‹è¯•æ•°æ®
                localStorage.removeItem(testKey);
                
            } catch (error) {
                showResult('teacherResult', `âŒ æœ¬åœ°å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testSaveFunction() {
            const result = `âœ… ä¿å­˜åŠŸèƒ½æµ‹è¯•ï¼š
                
ä¿å­˜åŠŸèƒ½å·²å¢å¼ºï¼š
- å¼‚æ­¥ä¿å­˜å¤„ç†
- æœ¬åœ°å­˜å‚¨æ›´æ–°
- å†…å­˜æ•°æ®åŒæ­¥
- æ–‡ä»¶ä¸‹è½½åŠŸèƒ½
- é”™è¯¯å¤„ç†æœºåˆ¶
- ç”¨æˆ·åé¦ˆæç¤º

ç°åœ¨æ•™å¸ˆå¯ä»¥æ­£å¸¸ç¼–è¾‘å’Œä¿å­˜é¢˜ç›®äº†ï¼`;
            
            showResult('teacherResult', result, 'success');
        }
        
        async function testRealExamLoading() {
            showResult('loadingResult', 'æ­£åœ¨æµ‹è¯•çœŸé¢˜åŠ è½½...', 'loading');
            
            try {
                const response = await fetch('/question-banks/çœŸé¢˜_ä¸­å›½æµ·æ´‹å¤§å­¦_2000-2021_cleaned.json');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                const questions = Array.isArray(data) ? data : (data.questions || data.data || []);
                
                const result = `âœ… çœŸé¢˜åŠ è½½æµ‹è¯•æˆåŠŸï¼
                
ğŸ“Š åŠ è½½ç»“æœï¼š
- æ–‡ä»¶å¤§å°: ${(response.headers.get('content-length') / 1024).toFixed(1)}KB
- é¢˜ç›®æ•°é‡: ${questions.length}
- æ•°æ®æ ¼å¼: ${Array.isArray(data) ? 'æ•°ç»„' : 'å¯¹è±¡'}
- åŠ è½½çŠ¶æ€: æˆåŠŸ

çœŸé¢˜æ•°æ®åŠ è½½æ­£å¸¸ï¼`;
                
                showResult('loadingResult', result, 'success');
                
            } catch (error) {
                showResult('loadingResult', `âŒ çœŸé¢˜åŠ è½½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testDataParsing() {
            const result = `âœ… æ•°æ®è§£ææµ‹è¯•ï¼š
                
è§£æåŠŸèƒ½å·²ä¼˜åŒ–ï¼š
- æ”¯æŒå¹´ä»½èŒƒå›´è§£æ (2000-2021)
- è‡ªåŠ¨åˆ›å»ºå¤šä¸ªå¹´ä»½çš„è€ƒè¯•å¯¹è±¡
- æ­£ç¡®åˆ†ç»„å’Œç»Ÿè®¡
- å¢å¼ºé”™è¯¯å¤„ç†

ç°åœ¨åº”è¯¥èƒ½æ­£ç¡®æ˜¾ç¤º2000-2021å¹´çš„æ‰€æœ‰å¹´ä»½ï¼`;
            
            showResult('loadingResult', result, 'success');
        }
        
        function testErrorHandling() {
            const result = `âœ… é”™è¯¯å¤„ç†æµ‹è¯•ï¼š
                
é”™è¯¯å¤„ç†å·²å¢å¼ºï¼š
- ç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†
- æ•°æ®è§£æé”™è¯¯å¤„ç†
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- å¤‡ç”¨æ•°æ®æœºåˆ¶
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

ç³»ç»Ÿç°åœ¨æ›´åŠ ç¨³å®šå¯é ï¼`;
            
            showResult('loadingResult', result, 'success');
        }
        
        async function runCompleteFixTest() {
            showResult('completeResult', 'æ­£åœ¨è¿è¡Œå®Œæ•´ä¿®å¤æµ‹è¯•...', 'loading');
            
            try {
                // æµ‹è¯•å¹´ä»½è§£æ
                await testYearParsing();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æµ‹è¯•æ•™å¸ˆåŠŸèƒ½
                testTeacherEdit();
                testLocalStorage();
                testSaveFunction();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æµ‹è¯•åŠ è½½åŠŸèƒ½
                testRealExamLoading();
                testDataParsing();
                testErrorHandling();
                
                const result = `ğŸ† å®Œæ•´ä¿®å¤æµ‹è¯•å®Œæˆï¼
                
âœ… æ‰€æœ‰ä¿®å¤æµ‹è¯•é€šè¿‡
âœ… å¹´ä»½è§£æåŠŸèƒ½æ­£å¸¸ (2000-2021)
âœ… æ•™å¸ˆç¼–è¾‘åŠŸèƒ½å¯ç”¨
âœ… çœŸé¢˜æ•°æ®åŠ è½½æ­£å¸¸
âœ… é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„

ä¿®å¤å†…å®¹ï¼š
1. ä¿®å¤å¹´ä»½è§£æ - ç°åœ¨æ”¯æŒ2000-2021å¹´èŒƒå›´
2. å®Œå–„æ•™å¸ˆç¼–è¾‘ - æ”¯æŒæœ¬åœ°å­˜å‚¨å’Œå®æ—¶ä¿å­˜
3. å¢å¼ºæ•°æ®åŠ è½½ - ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
4. æä¾›å®Œæ•´æµ‹è¯• - éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

ç³»ç»ŸçŠ¶æ€: å·²ä¿®å¤å¹¶æ­£å¸¸è¿è¡Œ`;
                
                showResult('completeResult', result, 'success');
                
            } catch (error) {
                showResult('completeResult', `âŒ å®Œæ•´ä¿®å¤æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearAllResults() {
            const resultElements = ['yearResult', 'teacherResult', 'loadingResult', 'completeResult'];
            resultElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = '';
                    element.className = 'result';
                }
            });
            
            document.getElementById('yearDisplay').innerHTML = '';
            document.getElementById('yearList').innerHTML = '';
            
            showResult('completeResult', 'æ‰€æœ‰ç»“æœå·²æ¸…é™¤', 'info');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ çœŸé¢˜åŠŸèƒ½ä¿®å¤æµ‹è¯•é¡µé¢å·²åˆå§‹åŒ–');
            setTimeout(runCompleteFixTest, 1000);
        });
    </script>
</body>
</html> 