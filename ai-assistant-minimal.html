<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ‰‹ - æœ€å°åŒ–ç‰ˆæœ¬</title>
    <style>
        .vector-perfect {
            position: relative;
            font-weight: bold;
            display: inline-block;
            margin: 0 2px;
        }
        .vector-perfect::after {
            content: 'â†’';
            position: absolute;
            top: -0.4em;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7em;
            font-weight: normal;
            line-height: 1;
            color: currentColor;
            z-index: 1;
        }
        .math-display {
            text-align: center;
            margin: 15px 0;
            font-size: 1.2em;
            font-family: 'Times New Roman', serif;
        }
        .math-inline {
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>AIåŠ©æ‰‹ - deepseek-r1æµ‹è¯•</h1>
        <div>
            <input v-model="question" placeholder="è¾“å…¥é—®é¢˜..." style="width: 300px; padding: 10px;">
            <button @click="askQuestion" style="padding: 10px 20px;">æé—®</button>
        </div>
        <div v-if="response" style="margin-top: 20px; padding: 20px; border: 1px solid #ccc;">
            <h3>AIå›å¤ï¼š</h3>
            <div v-html="response"></div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    question: '',
                    response: ''
                }
            },
            methods: {
                // æ™ºèƒ½æ¨¡å‹é€‰æ‹©å™¨
                selectOptimalModel(question) {
                    const lowerQuestion = question.toLowerCase();
                    console.log('ğŸ§  æ™ºèƒ½æ¨¡å‹é€‰æ‹© - åˆ†æé—®é¢˜:', question);

                    const derivationKeywords = [
                        'æ¨å¯¼', 'è¯æ˜', 'æ±‚è§£', 'è®¡ç®—', 'è§£æ', 'åˆ†æ',
                        'å¦‚ä½•å¾—åˆ°', 'æ€ä¹ˆæ¨å‡º', 'ä¸ºä»€ä¹ˆç­‰äº', 'æ­¥éª¤',
                        'å…¬å¼æ¨å¯¼', 'æ•°å­¦æ¨å¯¼', 'ç†è®ºæ¨å¯¼'
                    ];

                    const hasDerivation = derivationKeywords.some(keyword =>
                        lowerQuestion.includes(keyword)
                    );

                    if (hasDerivation) {
                        console.log('ğŸ¯ é€‰æ‹©deepseek-r1æ¨¡å‹è¿›è¡Œæ•°å­¦æ¨å¯¼');
                        return {
                            preferredModel: 'deepseek-r1',
                            systemPrompt: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„æµä½“åŠ›å­¦æ•™æˆï¼Œè¯·è¯¦ç»†å›ç­”å­¦ç”Ÿçš„é—®é¢˜ã€‚
ä½¿ç”¨LaTeXè¯­æ³•è¡¨ç¤ºæ•°å­¦å…¬å¼ï¼Œç”¨$$åŒ…å›´æ˜¾ç¤ºå…¬å¼ï¼Œç”¨$åŒ…å›´å†…è”å…¬å¼ã€‚
å‘é‡ä½¿ç”¨\\vec{v}æ ¼å¼ï¼Œä¼šè‡ªåŠ¨æ¸²æŸ“ä¸ºvâ†’`
                        };
                    } else {
                        console.log('ğŸ¯ é€‰æ‹©é€šç”¨æ¨¡å‹è¿›è¡Œæ¦‚å¿µè§£é‡Š');
                        return {
                            preferredModel: 'auto'
                        };
                    }
                },

                // LaTeXç¬¦å·å¤„ç†
                processLatexSymbols(formula) {
                    return formula
                        .replace(/\\rho/g, 'Ï')
                        .replace(/\\mu/g, 'Î¼')
                        .replace(/\\nabla/g, 'âˆ‡')
                        .replace(/\\partial/g, 'âˆ‚')
                        .replace(/\\vec\{([^}]+)\}/g, '<span class="vector-perfect">$1</span>');
                },

                // å¤„ç†å…¬å¼
                processFormulas(content) {
                    // å¤„ç†$$åŒ…å›´çš„æ˜¾ç¤ºå…¬å¼
                    content = content.replace(/\$\$([\s\S]*?)\$\$/g, (match, formula) => {
                        const processedFormula = this.processLatexSymbols(formula);
                        return `<div class="math-display">${processedFormula}</div>`;
                    });

                    // å¤„ç†$åŒ…å›´çš„å†…è”å…¬å¼
                    content = content.replace(/\$([^$\n]+)\$/g, (match, formula) => {
                        const processedFormula = this.processLatexSymbols(formula);
                        return `<span class="math-inline">${processedFormula}</span>`;
                    });

                    return content;
                },

                async askQuestion() {
                    if (!this.question.trim()) return;

                    console.log('ğŸ¤– å¼€å§‹å¤„ç†é—®é¢˜:', this.question);
                    this.response = 'æ­£åœ¨æ€è€ƒä¸­...';

                    // æ™ºèƒ½æ¨¡å‹é€‰æ‹©
                    const modelConfig = this.selectOptimalModel(this.question);
                    console.log('ğŸ“‹ æ¨¡å‹é…ç½®:', modelConfig);

                    try {
                        // çœŸæ­£è°ƒç”¨AI API
                        if (modelConfig.preferredModel === 'deepseek-r1') {
                            console.log('ğŸš€ è°ƒç”¨deepseek-r1æ¨¡å‹');

                            const response = await fetch('https://api.siliconflow.cn/v1/chat/completions', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer sk-dhseqxecuwwotodiskfdgwdjahnbexcgdotkfsovbgajxnis'
                                },
                                body: JSON.stringify({
                                    model: 'deepseek-ai/DeepSeek-R1',
                                    messages: [
                                        {
                                            role: 'system',
                                            content: modelConfig.systemPrompt
                                        },
                                        {
                                            role: 'user',
                                            content: this.question
                                        }
                                    ],
                                    max_tokens: 2000,
                                    temperature: 0.3
                                })
                            });

                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                            }

                            const result = await response.json();
                            console.log('âœ… deepseek-r1å›å¤æˆåŠŸ');

                            let aiResponse = result.choices[0].message.content;
                            aiResponse += '<br><br><small style="color: #888;">ğŸ¤– ç”±deepseek-r1æ¨¡å‹æä¾›</small>';

                            // å¤„ç†LaTeXå…¬å¼
                            this.response = this.processFormulas(aiResponse);
                        } else {
                            // ä½¿ç”¨æ¨¡æ‹Ÿå›å¤ä½œä¸ºå¤‡ç”¨
                            let aiResponse = `
                            <strong>æ¦‚å¿µè§£é‡Šå›å¤ï¼ˆé€šç”¨æ¨¡å‹ï¼‰ï¼š</strong><br><br>
                            è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æµä½“åŠ›å­¦é—®é¢˜ï¼è®©æˆ‘ä¸ºæ‚¨è¯¦ç»†è§£ç­”...<br>
                            æµä½“åŠ›å­¦æ˜¯ç ”ç©¶æµä½“è¿åŠ¨è§„å¾‹çš„ç§‘å­¦ã€‚
                            `;
                            this.response = this.processFormulas(aiResponse);
                        }
                    } catch (error) {
                        console.error('âŒ AIè°ƒç”¨å¤±è´¥:', error);
                        this.response = `è°ƒç”¨AIå¤±è´¥: ${error.message}<br><br>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–APIé…ç½®ã€‚`;
                    }

                    console.log('âœ… é—®é¢˜å¤„ç†å®Œæˆ');
                }
            },
            mounted() {
                console.log('ğŸš€ AIåŠ©æ‰‹æœ€å°åŒ–ç‰ˆæœ¬å·²å¯åŠ¨');
            }
        }).mount('#app');
    </script>
</body>
</html>
