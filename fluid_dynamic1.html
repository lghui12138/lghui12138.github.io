<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https:; frame-ancestors 'none'; base-uri 'self';">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, notranslate">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e6fa8" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0d4f73" media="(prefers-color-scheme: dark)">
    <meta name="color-scheme" content="light">
    <title>流体力学学习平台 - 中国海洋大学</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="流体力学">
    
    <!-- External Resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous" defer></script>
    <script src="https://vjs.zencdn.net/8.7.0/video.min.js" crossorigin="anonymous" defer></script>
    <link href="https://vjs.zencdn.net/8.7.0/video-js.css" rel="stylesheet">
    
    <!-- Advanced Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" crossorigin="anonymous" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js" crossorigin="anonymous" defer></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/umd/ffmpeg.js" crossorigin="anonymous" defer></script>
    
    <!-- Video.js Plugins -->
    <script src="https://vjs.zencdn.net/7.21.1/lang/zh-CN.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-quality-levels@2.1.0/dist/videojs-contrib-quality-levels.min.js" defer></script>
    
    <!-- OCR and Image Processing Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/opencv.js@1.7.0/opencv.js" defer></script>
    
    <!-- AI and ML Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.1.0/dist/pose-detection.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469408/pose.js" defer></script>
    
    <!-- Math Libraries -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
    
    <!-- Additional Security Headers -->
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), interest-cohort=()">
    <meta name="pinterest" content="nopin">
    <meta property="og:type" content="website">
    <meta property="og:title" content="流体力学学习平台">
    <meta property="og:description" content="中国海洋大学803流体力学专业学习平台">
    <meta property="og:image" content="/public/logo.png">
    <meta name="twitter:card" content="summary">
    
    <style>
        /* 安全防护：反调试和反自动化 */
        @media print {
            * {
                display: none !important;
            }
            
            body::before {
                content: "此内容受版权保护，禁止打印和截图" !important;
                display: block !important;
                position: fixed !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                text-align: center !important;
                font-size: 48px !important;
                color: red !important;
                z-index: 999999 !important;
                background: white !important;
                padding: 50px !important;
                border: 5px solid red !important;
            }
        }

        /* 完善的CSS变量系统 */
        :root {
            /* 主色调 - 海洋主题 */
            --primary: #1e6fa8;
            --primary-light: #3a86c7;
            --primary-dark: #155a89;
            --primary-alpha: rgba(30, 111, 168, 0.1);
            
            --secondary: #2c9ab7;
            --secondary-light: #4db8d6;
            --secondary-dark: #1e7a94;
            --secondary-alpha: rgba(44, 154, 183, 0.1);
            
            --accent: #4db8d6;
            --accent-light: #6fc7e0;
            --accent-dark: #3a9bbf;
            --accent-alpha: rgba(77, 184, 214, 0.1);
            
            /* 中性色 */
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --gray: #6c757d;
            --dark-gray: #343a40;
            --black: #000000;
            
            /* 功能色 */
            --success: #28a745;
            --success-light: #40c057;
            --success-dark: #1e7e34;
            --success-alpha: rgba(40, 167, 69, 0.1);
            
            --warning: #ffc107;
            --warning-light: #ffca2c;
            --warning-dark: #e0a800;
            --warning-alpha: rgba(255, 193, 7, 0.1);
            
            --danger: #dc3545;
            --danger-light: #e74c3c;
            --danger-dark: #c82333;
            --danger-alpha: rgba(220, 53, 69, 0.1);
            
            --info: #17a2b8;
            --info-light: #20c997;
            --info-dark: #138496;
            --info-alpha: rgba(23, 162, 184, 0.1);
            
            /* 阴影系统 */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 12px 24px rgba(0, 0, 0, 0.25);
            --shadow-2xl: 0 20px 40px rgba(0, 0, 0, 0.3);
            
            /* 圆角系统 */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
            --radius-full: 9999px;
            
            /* 间距系统 */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            --spacing-3xl: 64px;
            
            /* 字体系统 */
            --font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            --font-family-mono: 'Consolas', 'Monaco', 'Courier New', monospace;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-2xl: 24px;
            --font-size-3xl: 32px;
            --font-size-4xl: 48px;
            
            /* 行高系统 */
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;
            
            /* 动画系统 */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --transition-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            /* 布局系统 */
            --header-height: 60px;
            --sidebar-width: 280px;
            --content-max-width: 1200px;
            --container-padding: var(--spacing-lg);
            
            /* Z-index系统 */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
        }

        /* 深色模式支持 */
        @media (prefers-color-scheme: dark) {
            :root {
                --white: #1a1a1a;
                --light-gray: #2d2d2d;
                --gray: #a0a0a0;
                --dark-gray: #e0e0e0;
                --black: #ffffff;
            }
        }

        /* 全局重置和基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-md);
            line-height: var(--line-height-normal);
            color: var(--dark-gray);
            background: linear-gradient(135deg, var(--primary-alpha) 0%, var(--secondary-alpha) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: var(--radius-sm);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: var(--radius-sm);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Firefox滚动条 */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--light-gray);
        }

        /* 选择文本样式 */
        ::selection {
            background: var(--primary-alpha);
            color: var(--primary-dark);
        }

        ::-moz-selection {
            background: var(--primary-alpha);
            color: var(--primary-dark);
        }

        /* 焦点样式 */
        :focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        :focus:not(:focus-visible) {
            outline: none;
        }

        /* 按钮基础样式 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            white-space: nowrap;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left var(--transition-slow);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn:disabled::before {
            display: none;
        }

        /* 按钮变体 */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: var(--white);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), var(--success-dark));
            color: var(--white);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), var(--warning-dark));
            color: var(--dark-gray);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), var(--danger-dark));
            color: var(--white);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), var(--info-dark));
            color: var(--white);
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
            transform: translateY(-2px);
        }

        .btn-ghost {
            background: transparent;
            color: var(--primary);
        }

        .btn-ghost:hover {
            background: var(--primary-alpha);
        }

        /* 按钮尺寸 */
        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-xs);
        }

        .btn-lg {
            padding: var(--spacing-md) var(--spacing-lg);
            font-size: var(--font-size-lg);
        }

        .btn-xl {
            padding: var(--spacing-lg) var(--spacing-xl);
            font-size: var(--font-size-xl);
        }

        /* 卡片样式 */
        .card {
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            transition: all var(--transition-normal);
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--light-gray);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--primary-dark);
            margin: 0;
        }

        .card-subtitle {
            font-size: var(--font-size-sm);
            color: var(--gray);
            margin-top: var(--spacing-xs);
        }

        .card-body {
            color: var(--gray);
            line-height: var(--line-height-relaxed);
        }

        .card-footer {
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* 卡片变体 */
        .card-primary {
            border-left: 4px solid var(--primary);
        }

        .card-success {
            border-left: 4px solid var(--success);
        }

        .card-warning {
            border-left: 4px solid var(--warning);
        }

        .card-danger {
            border-left: 4px solid var(--danger);
        }

        .card-info {
            border-left: 4px solid var(--info);
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
            color: var(--dark-gray);
            font-size: var(--font-size-sm);
        }

        .form-label.required::after {
            content: ' *';
            color: var(--danger);
        }

        .form-control {
            width: 100%;
            padding: var(--spacing-sm);
            border: 2px solid var(--light-gray);
            border-radius: var(--radius-md);
            font-size: var(--font-size-md);
            transition: all var(--transition-normal);
            background: var(--white);
            color: var(--dark-gray);
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-alpha);
            outline: none;
        }

        .form-control:disabled {
            background: var(--light-gray);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .form-control.error {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px var(--danger-alpha);
        }

        .form-control.success {
            border-color: var(--success);
            box-shadow: 0 0 0 3px var(--success-alpha);
        }

        .form-text {
            font-size: var(--font-size-sm);
            color: var(--gray);
            margin-top: var(--spacing-xs);
        }

        .form-text.error {
            color: var(--danger);
        }

        .form-text.success {
            color: var(--success);
        }

        /* 表单控件变体 */
        .form-control-lg {
            padding: var(--spacing-md);
            font-size: var(--font-size-lg);
        }

        .form-control-sm {
            padding: var(--spacing-xs);
            font-size: var(--font-size-sm);
        }

        /* 文本域 */
        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        /* 选择框 */
        select.form-control {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* 复选框和单选框 */
        .form-check {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-sm);
        }

        .form-check-input {
            width: 16px;
            height: 16px;
            margin: 0;
            cursor: pointer;
        }

        .form-check-label {
            cursor: pointer;
            user-select: none;
        }

        /* 消息样式 */
        .message {
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform var(--transition-slow);
        }

        .message:hover::before {
            transform: translateX(100%);
        }

        .message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .message.info {
            background: var(--info);
            color: var(--white);
            border-left: 4px solid var(--info-dark);
        }

        .message.success {
            background: var(--success);
            color: var(--white);
            border-left: 4px solid var(--success-dark);
        }

        .message.warning {
            background: var(--warning);
            color: var(--dark-gray);
            border-left: 4px solid var(--warning-dark);
        }

        .message.error {
            background: var(--danger);
            color: var(--white);
            border-left: 4px solid var(--danger-dark);
        }

        .message-icon {
            font-size: var(--font-size-lg);
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
        }

        .message-title {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .message-text {
            font-size: var(--font-size-sm);
            opacity: 0.9;
        }

        .message-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: background var(--transition-fast);
        }

        .message-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* 加载动画 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
        }

        .loading-primary {
            border-top-color: var(--primary);
        }

        .loading-secondary {
            border-top-color: var(--secondary);
        }

        .loading-success {
            border-top-color: var(--success);
        }

        .loading-warning {
            border-top-color: var(--warning);
        }

        .loading-danger {
            border-top-color: var(--danger);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 脉冲动画 */
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* 淡入动画 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 响应式网格系统 */
        .grid {
            display: grid;
            gap: var(--spacing-lg);
        }

        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        .grid-5 { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
        .grid-6 { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }

        /* 工具类 */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .text-justify { text-align: justify; }
        
        .d-none { display: none !important; }
        .d-block { display: block !important; }
        .d-inline { display: inline !important; }
        .d-inline-block { display: inline-block !important; }
        .d-flex { display: flex !important; }
        .d-inline-flex { display: inline-flex !important; }
        .d-grid { display: grid !important; }
        .d-table { display: table !important; }
        .d-table-cell { display: table-cell !important; }
        
        .justify-start { justify-content: flex-start; }
        .justify-end { justify-content: flex-end; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-around { justify-content: space-around; }
        .justify-evenly { justify-content: space-evenly; }
        
        .align-start { align-items: flex-start; }
        .align-end { align-items: flex-end; }
        .align-center { align-items: center; }
        .align-baseline { align-items: baseline; }
        .align-stretch { align-items: stretch; }
        
        .flex-column { flex-direction: column; }
        .flex-row { flex-direction: row; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-nowrap { flex-wrap: nowrap; }
        
        .w-100 { width: 100%; }
        .w-auto { width: auto; }
        .h-100 { height: 100%; }
        .h-auto { height: auto; }
        
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: var(--spacing-xs); }
        .mb-2 { margin-bottom: var(--spacing-sm); }
        .mb-3 { margin-bottom: var(--spacing-md); }
        .mb-4 { margin-bottom: var(--spacing-lg); }
        .mb-5 { margin-bottom: var(--spacing-xl); }
        
        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: var(--spacing-xs); }
        .mt-2 { margin-top: var(--spacing-sm); }
        .mt-3 { margin-top: var(--spacing-md); }
        .mt-4 { margin-top: var(--spacing-lg); }
        .mt-5 { margin-top: var(--spacing-xl); }
        
        .ml-0 { margin-left: 0; }
        .ml-1 { margin-left: var(--spacing-xs); }
        .ml-2 { margin-left: var(--spacing-sm); }
        .ml-3 { margin-left: var(--spacing-md); }
        .ml-4 { margin-left: var(--spacing-lg); }
        .ml-5 { margin-left: var(--spacing-xl); }
        
        .mr-0 { margin-right: 0; }
        .mr-1 { margin-right: var(--spacing-xs); }
        .mr-2 { margin-right: var(--spacing-sm); }
        .mr-3 { margin-right: var(--spacing-md); }
        .mr-4 { margin-right: var(--spacing-lg); }
        .mr-5 { margin-right: var(--spacing-xl); }
        
        .p-0 { padding: 0; }
        .p-1 { padding: var(--spacing-xs); }
        .p-2 { padding: var(--spacing-sm); }
        .p-3 { padding: var(--spacing-md); }
        .p-4 { padding: var(--spacing-lg); }
        .p-5 { padding: var(--spacing-xl); }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            :root {
                --container-padding: var(--spacing-md);
            }
        }

        @media (max-width: 768px) {
            :root {
                --container-padding: var(--spacing-md);
                --sidebar-width: 100%;
                --font-size-md: 14px;
                --spacing-lg: 16px;
            }
            
            .grid-2, .grid-3, .grid-4, .grid-5, .grid-6 {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: var(--spacing-md);
            }
            
            .btn {
                padding: var(--spacing-xs) var(--spacing-sm);
                font-size: var(--font-size-sm);
            }
        }

        @media (max-width: 480px) {
            :root {
                --font-size-md: 14px;
                --spacing-lg: 16px;
            }
            
            .btn {
                padding: var(--spacing-xs) var(--spacing-sm);
                font-size: var(--font-size-sm);
            }
            
            .card {
                padding: var(--spacing-sm);
            }
        }

        /* 打印样式 */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            .btn {
                display: none;
            }
        }

        /* 高对比度模式 */
        @media (prefers-contrast: high) {
            :root {
                --primary: #000080;
                --secondary: #0000ff;
                --success: #008000;
                --warning: #ff8000;
                --danger: #ff0000;
            }
        }

                 /* 减少动画模式 */
         @media (prefers-reduced-motion: reduce) {
             * {
                 animation-duration: 0.01ms !important;
                 animation-iteration-count: 1 !important;
                 transition-duration: 0.01ms !important;
             }
         }

         /* 布局组件样式 */
         .app-container {
             min-height: 100vh;
             display: flex;
             flex-direction: column;
         }

         .header {
             background: var(--white);
             box-shadow: var(--shadow-md);
             padding: 0;
             position: sticky;
             top: 0;
             z-index: var(--z-sticky);
             border-bottom: 1px solid var(--light-gray);
         }

         .header-content {
             max-width: var(--content-max-width);
             margin: 0 auto;
             padding: 0 var(--container-padding);
             display: flex;
             align-items: center;
             justify-content: space-between;
             height: var(--header-height);
         }

         .header-left {
             display: flex;
             align-items: center;
             gap: var(--spacing-md);
         }

         .sidebar-toggle {
             display: none;
             background: none;
             border: none;
             font-size: var(--font-size-lg);
             color: var(--primary);
             cursor: pointer;
             padding: var(--spacing-xs);
             border-radius: var(--radius-sm);
             transition: all var(--transition-fast);
         }

         .sidebar-toggle:hover {
             background: var(--primary-alpha);
         }

         .logo {
             display: flex;
             align-items: center;
             gap: var(--spacing-sm);
             font-size: var(--font-size-xl);
             font-weight: 600;
             color: var(--primary);
             text-decoration: none;
         }

         .logo i {
             font-size: var(--font-size-2xl);
         }

         .header-center {
             flex: 1;
             display: flex;
             justify-content: center;
         }

         .main-nav {
             display: flex;
             gap: var(--spacing-lg);
         }

         .nav-link {
             display: flex;
             align-items: center;
             gap: var(--spacing-xs);
             color: var(--gray);
             text-decoration: none;
             padding: var(--spacing-sm) var(--spacing-md);
             border-radius: var(--radius-md);
             transition: all var(--transition-normal);
             font-weight: 500;
             position: relative;
         }

         .nav-link::before {
             content: '';
             position: absolute;
             bottom: 0;
             left: 50%;
             width: 0;
             height: 3px;
             background: var(--primary);
             transition: all var(--transition-normal);
             transform: translateX(-50%);
         }

         .nav-link:hover,
         .nav-link.active {
             color: var(--primary);
             background: var(--primary-alpha);
         }

         .nav-link.active::before {
             width: 80%;
         }

         .header-right {
             display: flex;
             align-items: center;
             gap: var(--spacing-md);
         }

         .user-info {
             display: flex;
             align-items: center;
             gap: var(--spacing-sm);
         }

         .user-name {
             font-weight: 500;
             color: var(--dark-gray);
         }

         /* 侧边栏样式 */
         .sidebar {
             position: fixed;
             top: 0;
             left: -100%;
             width: var(--sidebar-width);
             height: 100vh;
             background: var(--white);
             box-shadow: var(--shadow-xl);
             z-index: var(--z-modal);
             transition: left var(--transition-normal);
             overflow-y: auto;
         }

         .sidebar.open {
             left: 0;
         }

         .sidebar-content {
             padding: var(--spacing-lg);
         }

         .sidebar-header {
             display: flex;
             align-items: center;
             justify-content: space-between;
             margin-bottom: var(--spacing-xl);
             padding-bottom: var(--spacing-md);
             border-bottom: 1px solid var(--light-gray);
         }

         .sidebar-header h3 {
             font-size: var(--font-size-lg);
             color: var(--primary-dark);
             margin: 0;
         }

         .sidebar-close {
             background: none;
             border: none;
             font-size: var(--font-size-lg);
             color: var(--gray);
             cursor: pointer;
             padding: var(--spacing-xs);
             border-radius: var(--radius-sm);
             transition: all var(--transition-fast);
         }

         .sidebar-close:hover {
             color: var(--danger);
             background: var(--danger-alpha);
         }

         .sidebar-nav {
             display: flex;
             flex-direction: column;
             gap: var(--spacing-xl);
         }

         .nav-section h4 {
             font-size: var(--font-size-sm);
             color: var(--gray);
             margin-bottom: var(--spacing-md);
             text-transform: uppercase;
             letter-spacing: 0.5px;
         }

         .sidebar-link {
             display: flex;
             align-items: center;
             gap: var(--spacing-sm);
             color: var(--dark-gray);
             text-decoration: none;
             padding: var(--spacing-sm) var(--spacing-md);
             border-radius: var(--radius-md);
             transition: all var(--transition-normal);
             margin-bottom: var(--spacing-xs);
         }

         .sidebar-link:hover {
             background: var(--primary-alpha);
             color: var(--primary);
             transform: translateX(4px);
         }

         .sidebar-link i {
             width: 20px;
             text-align: center;
         }

         /* 主内容区域 */
         .main-content {
             flex: 1;
             padding-top: var(--spacing-lg);
             padding-bottom: var(--spacing-xl);
         }

         .container {
             max-width: var(--content-max-width);
             margin: 0 auto;
             padding: 0 var(--container-padding);
         }

         .section {
             display: none;
             animation: fadeIn 0.5s ease-in-out;
         }

         .section.active {
             display: block;
         }

         /* 登录界面样式 */
         .login-container {
             display: flex;
             align-items: center;
             justify-content: center;
             min-height: calc(100vh - var(--header-height));
             padding: var(--spacing-xl);
         }

         .login-card {
             background: var(--white);
             border-radius: var(--radius-xl);
             box-shadow: var(--shadow-2xl);
             padding: var(--spacing-3xl);
             width: 100%;
             max-width: 450px;
             position: relative;
             overflow: hidden;
         }

         .login-card::before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             height: 6px;
             background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
         }

         .login-header {
             text-align: center;
             margin-bottom: var(--spacing-2xl);
         }

         .login-logo {
             font-size: var(--font-size-4xl);
             color: var(--primary);
             margin-bottom: var(--spacing-lg);
         }

         .login-header h1 {
             font-size: var(--font-size-2xl);
             margin-bottom: var(--spacing-sm);
             color: var(--dark-gray);
         }

         .login-header p {
             color: var(--gray);
             font-size: var(--font-size-md);
         }

         .login-form {
             margin-bottom: var(--spacing-lg);
         }

         .login-footer {
             text-align: center;
             margin-top: var(--spacing-xl);
             color: var(--gray);
             font-size: var(--font-size-sm);
         }

         .login-footer p {
             margin-bottom: var(--spacing-xs);
         }

         .version-info {
             opacity: 0.7;
             font-size: var(--font-size-xs);
         }

         /* 首页样式 */
         .welcome-banner {
             text-align: center;
             margin-bottom: var(--spacing-3xl);
             padding: var(--spacing-2xl) 0;
         }

         .welcome-banner h1 {
             font-size: var(--font-size-3xl);
             margin-bottom: var(--spacing-md);
             color: var(--primary-dark);
             background: linear-gradient(135deg, var(--primary), var(--secondary));
             -webkit-background-clip: text;
             -webkit-text-fill-color: transparent;
             background-clip: text;
         }

         .welcome-banner p {
             font-size: var(--font-size-lg);
             color: var(--gray);
             max-width: 600px;
             margin: 0 auto;
         }

         .quick-stats {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
             gap: var(--spacing-lg);
             margin-bottom: var(--spacing-3xl);
         }

         .stat-card {
             background: var(--white);
             border-radius: var(--radius-lg);
             box-shadow: var(--shadow-md);
             padding: var(--spacing-xl);
             display: flex;
             align-items: center;
             gap: var(--spacing-lg);
             transition: all var(--transition-normal);
             border: 1px solid rgba(0, 0, 0, 0.05);
             position: relative;
             overflow: hidden;
         }

         .stat-card::before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             height: 4px;
             background: linear-gradient(90deg, var(--primary), var(--secondary));
         }

         .stat-card:hover {
             transform: translateY(-8px);
             box-shadow: var(--shadow-xl);
         }

         .stat-card i {
             font-size: var(--font-size-3xl);
             color: var(--primary);
             flex-shrink: 0;
         }

         .stat-content h3 {
             font-size: var(--font-size-2xl);
             margin-bottom: var(--spacing-xs);
             color: var(--dark-gray);
         }

         .stat-content p {
             color: var(--gray);
             font-size: var(--font-size-sm);
         }

         .recent-activities {
             background: var(--white);
             border-radius: var(--radius-lg);
             box-shadow: var(--shadow-md);
             padding: var(--spacing-xl);
         }

         .recent-activities h2 {
             font-size: var(--font-size-xl);
             margin-bottom: var(--spacing-lg);
             color: var(--primary-dark);
         }

         .activities-list {
             display: flex;
             flex-direction: column;
             gap: var(--spacing-md);
         }

         .activity-item {
             display: flex;
             align-items: center;
             gap: var(--spacing-md);
             padding: var(--spacing-md);
             border-radius: var(--radius-md);
             background: var(--light-gray);
             transition: all var(--transition-normal);
         }

         .activity-item:hover {
             background: var(--primary-alpha);
             transform: translateX(4px);
         }

         .activity-icon {
             width: 40px;
             height: 40px;
             border-radius: var(--radius-full);
             background: var(--primary);
             color: var(--white);
             display: flex;
             align-items: center;
             justify-content: center;
             flex-shrink: 0;
         }

         .activity-content {
             flex: 1;
         }

         .activity-title {
             font-weight: 500;
             margin-bottom: var(--spacing-xs);
             color: var(--dark-gray);
         }

         .activity-time {
             font-size: var(--font-size-sm);
             color: var(--gray);
         }

         /* 加载屏幕样式 */
         .loading-screen {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: linear-gradient(135deg, var(--primary), var(--secondary));
             display: flex;
             align-items: center;
             justify-content: center;
             z-index: 9999;
             transition: opacity var(--transition-slow);
         }

         .loading-screen.hidden {
             opacity: 0;
             pointer-events: none;
         }

         .loading-content {
             text-align: center;
             color: var(--white);
         }

         .loading-logo {
             font-size: var(--font-size-4xl);
             margin-bottom: var(--spacing-lg);
             animation: pulse 2s infinite;
         }

         .loading-text {
             font-size: var(--font-size-xl);
             margin-bottom: var(--spacing-lg);
             font-weight: 500;
         }

         .loading-spinner {
             width: 40px;
             height: 40px;
             border: 4px solid rgba(255, 255, 255, 0.3);
             border-top: 4px solid var(--white);
             border-radius: 50%;
             animation: spin 1s linear infinite;
             margin: 0 auto;
         }

         /* 模态框样式 */
         .modal-container {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0, 0, 0, 0.5);
             display: flex;
             align-items: center;
             justify-content: center;
             z-index: var(--z-modal);
             opacity: 0;
             visibility: hidden;
             transition: all var(--transition-normal);
         }

         .modal-container.show {
             opacity: 1;
             visibility: visible;
         }

         .modal {
             background: var(--white);
             border-radius: var(--radius-lg);
             box-shadow: var(--shadow-2xl);
             max-width: 90%;
             max-height: 90%;
             overflow: auto;
             transform: scale(0.8);
             transition: transform var(--transition-normal);
         }

         .modal-container.show .modal {
             transform: scale(1);
         }

         .modal-header {
             padding: var(--spacing-lg);
             border-bottom: 1px solid var(--light-gray);
             display: flex;
             align-items: center;
             justify-content: space-between;
         }

         .modal-title {
             font-size: var(--font-size-lg);
             font-weight: 600;
             color: var(--primary-dark);
             margin: 0;
         }

         .modal-close {
             background: none;
             border: none;
             font-size: var(--font-size-lg);
             color: var(--gray);
             cursor: pointer;
             padding: var(--spacing-xs);
             border-radius: var(--radius-sm);
             transition: all var(--transition-fast);
         }

         .modal-close:hover {
             color: var(--danger);
             background: var(--danger-alpha);
         }

         .modal-body {
             padding: var(--spacing-lg);
         }

         .modal-footer {
             padding: var(--spacing-lg);
             border-top: 1px solid var(--light-gray);
             display: flex;
             align-items: center;
             justify-content: flex-end;
             gap: var(--spacing-sm);
         }

         /* 通知样式 */
         .notification-container {
             position: fixed;
             top: var(--spacing-lg);
             right: var(--spacing-lg);
             z-index: var(--z-toast);
             display: flex;
             flex-direction: column;
             gap: var(--spacing-sm);
             max-width: 400px;
         }

         .notification {
             background: var(--white);
             border-radius: var(--radius-md);
             box-shadow: var(--shadow-lg);
             padding: var(--spacing-md);
             display: flex;
             align-items: center;
             gap: var(--spacing-sm);
             transform: translateX(100%);
             transition: all var(--transition-normal);
             border-left: 4px solid var(--primary);
         }

         .notification.show {
             transform: translateX(0);
         }

         .notification.success {
             border-left-color: var(--success);
         }

         .notification.warning {
             border-left-color: var(--warning);
         }

         .notification.error {
             border-left-color: var(--danger);
         }

         .notification.info {
             border-left-color: var(--info);
         }

         .notification-icon {
             font-size: var(--font-size-lg);
             flex-shrink: 0;
         }

         .notification.success .notification-icon {
             color: var(--success);
         }

         .notification.warning .notification-icon {
             color: var(--warning);
         }

         .notification.error .notification-icon {
             color: var(--danger);
         }

         .notification.info .notification-icon {
             color: var(--info);
         }

         .notification-content {
             flex: 1;
         }

         .notification-title {
             font-weight: 600;
             margin-bottom: var(--spacing-xs);
             color: var(--dark-gray);
         }

         .notification-message {
             font-size: var(--font-size-sm);
             color: var(--gray);
         }

         .notification-close {
             background: none;
             border: none;
             color: var(--gray);
             cursor: pointer;
             padding: var(--spacing-xs);
             border-radius: var(--radius-sm);
             transition: all var(--transition-fast);
         }

         .notification-close:hover {
             color: var(--danger);
             background: var(--danger-alpha);
         }

         /* 响应式设计补充 */
         @media (max-width: 768px) {
             .header-center {
                 display: none;
             }
             
             .sidebar-toggle {
                 display: block;
             }
             
             .sidebar {
                 width: 100%;
             }
             
             .login-card {
                 padding: var(--spacing-xl);
                 margin: var(--spacing-md);
             }
             
             .welcome-banner h1 {
                 font-size: var(--font-size-2xl);
             }
             
             .welcome-banner p {
                 font-size: var(--font-size-md);
             }
             
             .quick-stats {
                 grid-template-columns: 1fr;
             }
             
             .stat-card {
                 padding: var(--spacing-lg);
             }
             
             .notification-container {
                 left: var(--spacing-md);
                 right: var(--spacing-md);
                 max-width: none;
             }
         }

         @media (max-width: 480px) {
             .header-content {
                 padding: 0 var(--spacing-md);
             }
             
             .container {
                 padding: 0 var(--spacing-md);
             }
             
             .login-container {
                 padding: var(--spacing-md);
             }
             
             .welcome-banner {
                 padding: var(--spacing-lg) 0;
             }
             
             .welcome-banner h1 {
                 font-size: var(--font-size-xl);
             }
             
             .stat-card {
                 flex-direction: column;
                 text-align: center;
                 gap: var(--spacing-md);
             }
         }
         </style>
</head>
<body>
    <!-- 页面加载动画 -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">
                <i class="fas fa-water"></i>
            </div>
            <div class="loading-text">流体力学学习平台</div>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- 主容器 -->
    <div id="app" class="app-container">
        <!-- 头部导航 -->
        <header id="header" class="header">
            <div class="header-content">
                <div class="header-left">
                    <button id="sidebarToggle" class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="logo">
                        <i class="fas fa-water"></i>
                        <span>流体力学学习平台</span>
                    </div>
                </div>
                
                <div class="header-center">
                    <nav class="main-nav">
                        <a href="#home" class="nav-link active" data-section="home">
                            <i class="fas fa-home"></i>
                            <span>首页</span>
                        </a>
                        <a href="#study" class="nav-link" data-section="study">
                            <i class="fas fa-book"></i>
                            <span>学习</span>
                        </a>
                        <a href="#exercises" class="nav-link" data-section="exercises">
                            <i class="fas fa-tasks"></i>
                            <span>题库</span>
                        </a>
                        <a href="#videos" class="nav-link" data-section="videos">
                            <i class="fas fa-video"></i>
                            <span>视频</span>
                        </a>
                        <a href="#ai-assistant" class="nav-link" data-section="ai-assistant">
                            <i class="fas fa-robot"></i>
                            <span>AI助手</span>
                        </a>
                        <a href="#upload" class="nav-link" data-section="upload">
                            <i class="fas fa-upload"></i>
                            <span>上传</span>
                        </a>
                        <a href="#profile" class="nav-link" data-section="profile">
                            <i class="fas fa-user"></i>
                            <span>个人</span>
                        </a>
                    </nav>
                </div>
                
                <div class="header-right">
                    <div class="user-info">
                        <span id="userDisplay" class="user-name">未登录</span>
                        <button id="logoutBtn" class="btn btn-outline btn-sm d-none">
                            <i class="fas fa-sign-out-alt"></i>
                            退出
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- 侧边栏 -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    <h3>快速导航</h3>
                    <button id="sidebarClose" class="sidebar-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <nav class="sidebar-nav">
                    <div class="nav-section">
                        <h4>学习模块</h4>
                        <a href="#fluid-basics" class="sidebar-link">
                            <i class="fas fa-tint"></i>
                            流体基础
                        </a>
                        <a href="#hydrodynamics" class="sidebar-link">
                            <i class="fas fa-wave-square"></i>
                            流体动力学
                        </a>
                        <a href="#turbulence" class="sidebar-link">
                            <i class="fas fa-wind"></i>
                            湍流理论
                        </a>
                        <a href="#boundary-layer" class="sidebar-link">
                            <i class="fas fa-layer-group"></i>
                            边界层理论
                        </a>
                    </div>
                    
                    <div class="nav-section">
                        <h4>练习系统</h4>
                        <a href="#daily-exercises" class="sidebar-link">
                            <i class="fas fa-calendar-day"></i>
                            每日练习
                        </a>
                        <a href="#mock-exams" class="sidebar-link">
                            <i class="fas fa-file-alt"></i>
                            模拟考试
                        </a>
                        <a href="#progress-track" class="sidebar-link">
                            <i class="fas fa-chart-line"></i>
                            进度跟踪
                        </a>
                    </div>
                    
                    <div class="nav-section">
                        <h4>资源中心</h4>
                        <a href="#video-library" class="sidebar-link">
                            <i class="fas fa-play-circle"></i>
                            视频库
                        </a>
                        <a href="#document-library" class="sidebar-link">
                            <i class="fas fa-file-pdf"></i>
                            文档库
                        </a>
                        <a href="#formula-sheet" class="sidebar-link">
                            <i class="fas fa-square-root-alt"></i>
                            公式表
                        </a>
                    </div>
                </nav>
            </div>
        </aside>

        <!-- 主内容区域 -->
        <main id="main" class="main-content">
            <!-- 登录界面 -->
            <section id="loginSection" class="section active">
                <div class="login-container">
                    <div class="login-card">
                        <div class="login-header">
                            <div class="login-logo">
                                <i class="fas fa-water"></i>
                            </div>
                            <h1>流体力学学习平台</h1>
                            <p>中国海洋大学 - 专业学习系统</p>
                        </div>
                        
                        <form id="loginForm" class="login-form">
                            <div class="form-group">
                                <label for="username" class="form-label">用户名</label>
                                <input type="text" id="username" name="username" class="form-control" 
                                       placeholder="请输入用户名" autocomplete="username" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="password" class="form-label">密码</label>
                                <input type="password" id="password" name="password" class="form-control" 
                                       placeholder="请输入密码" autocomplete="current-password" required>
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" id="loginButton" class="btn btn-primary w-100">
                                    <span id="loginButtonText">登录</span>
                                    <div id="loginButtonSpinner" class="loading d-none"></div>
                                </button>
                            </div>
                        </form>
                        
                        <div id="loginMessage" class="message"></div>
                        
                        <div class="login-footer">
                            <p>首次使用？请联系管理员获取账号</p>
                            <p class="version-info">版本 2.0.0 | 更新时间: 2024-01-15</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 首页 -->
            <section id="homeSection" class="section">
                <div class="container">
                    <div class="welcome-banner">
                        <h1>欢迎来到流体力学学习平台</h1>
                        <p>专业的流体力学学习系统，助您掌握核心知识</p>
                    </div>
                    
                    <div class="quick-stats">
                        <div class="stat-card">
                            <i class="fas fa-book-open"></i>
                            <div class="stat-content">
                                <h3 id="totalLessons">0</h3>
                                <p>学习课程</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-tasks"></i>
                            <div class="stat-content">
                                <h3 id="totalExercises">0</h3>
                                <p>练习题目</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-video"></i>
                            <div class="stat-content">
                                <h3 id="totalVideos">0</h3>
                                <p>教学视频</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-chart-line"></i>
                            <div class="stat-content">
                                <h3 id="studyProgress">0%</h3>
                                <p>学习进度</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recent-activities">
                        <h2>最近活动</h2>
                        <div id="recentActivitiesList" class="activities-list">
                            <!-- 动态生成最近活动 -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- 学习模块 -->
            <section id="studySection" class="section">
                <div class="container">
                    <h1>学习中心</h1>
                    <div class="study-modules">
                        <!-- 学习模块内容将在JavaScript中动态生成 -->
                    </div>
                </div>
            </section>

            <!-- 题库模块 -->
            <section id="exercisesSection" class="section">
                <div class="container">
                    <h1>练习题库</h1>
                    <div class="exercises-container">
                        <!-- 题库内容将在JavaScript中动态生成 -->
                    </div>
                </div>
            </section>

            <!-- 视频模块 -->
            <section id="videosSection" class="section">
                <div class="container">
                    <h1>教学视频</h1>
                    <div class="videos-container">
                        <!-- 视频内容将在JavaScript中动态生成 -->
                    </div>
                </div>
            </section>

            <!-- AI助手模块 -->
            <section id="aiAssistantSection" class="section">
                <div class="container">
                    <h1>AI智能助手</h1>
                    <div class="ai-assistant-container">
                        <!-- AI助手内容将在JavaScript中动态生成 -->
                    </div>
                </div>
            </section>

            <!-- 上传模块 -->
            <section id="uploadSection" class="section">
                <div class="container">
                    <h1>资源上传</h1>
                    <div class="upload-container">
                        <!-- 上传功能内容将在JavaScript中动态生成 -->
                    </div>
                </div>
            </section>

            <!-- 个人中心 -->
            <section id="profileSection" class="section">
                <div class="container">
                    <h1>个人中心</h1>
                    <div class="profile-container">
                        <!-- 个人中心内容将在JavaScript中动态生成 -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 模态框容器 -->
    <div id="modalContainer" class="modal-container"></div>

    <!-- 通知容器 -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- 基础JavaScript -->
    <script>
        // 基础配置和工具函数
        const CONFIG = {
            APP_NAME: '流体力学学习平台',
            VERSION: '2.0.0',
            API_BASE_URL: '/api',
            STORAGE_PREFIX: 'fluid_dynamic_',
            MAX_FILE_SIZE: 100 * 1024 * 1024, // 100MB
            SUPPORTED_VIDEO_FORMATS: ['mp4', 'webm', 'ogg', 'mov'],
            SUPPORTED_IMAGE_FORMATS: ['jpg', 'jpeg', 'png', 'gif', 'webp'],
            SUPPORTED_DOCUMENT_FORMATS: ['pdf', 'doc', 'docx', 'ppt', 'pptx', 'xls', 'xlsx'],
            DEFAULT_VIDEO_QUALITY: '720p',
            DEFAULT_VIDEO_SPEED: 1,
            MAX_LOGIN_ATTEMPTS: 5,
            LOCKOUT_DURATION: 15 * 60 * 1000, // 15分钟
            SESSION_TIMEOUT: 30 * 60 * 1000, // 30分钟
            AUTO_SAVE_INTERVAL: 30 * 1000, // 30秒
            MAX_UPLOAD_RETRIES: 3,
            CHUNK_SIZE: 1024 * 1024, // 1MB
            ENABLE_OFFLINE_MODE: true,
            ENABLE_PWA: true,
            ENABLE_AI_FEATURES: true,
            ENABLE_VIDEO_PROCESSING: true,
            ENABLE_OCR_FEATURES: true,
            ENABLE_REAL_TIME_COLLABORATION: false,
            DEBUG_MODE: false
        };

        // 全局状态管理
        const APP_STATE = {
            currentUser: null,
            isLoggedIn: false,
            currentSection: 'home',
            loginAttempts: 0,
            lockoutEndTime: null,
            sessionStartTime: null,
            lastActivityTime: null,
            isOffline: false,
            isFullscreen: false,
            currentVideoPlayer: null,
            currentExercise: null,
            currentQuestion: 0,
            userAnswers: [],
            exerciseStartTime: null,
            questionTimer: null,
            autoSaveTimer: null,
            uploadQueue: [],
            processingQueue: [],
            notifications: [],
            settings: {
                theme: 'light',
                language: 'zh-CN',
                videoQuality: CONFIG.DEFAULT_VIDEO_QUALITY,
                videoSpeed: CONFIG.DEFAULT_VIDEO_SPEED,
                autoSave: true,
                notifications: true,
                sound: true,
                accessibility: false
            }
        };

        // 用户账户数据
        const USER_ACCOUNTS = {
            'admin': {
                password: 'admin123',
                name: '管理员',
                role: 'admin',
                permissions: ['all'],
                avatar: '👨‍💼',
                lastLogin: null,
                preferences: {}
            },
            'student1': {
                password: 'student123',
                name: '学生1',
                role: 'student',
                permissions: ['study', 'exercises', 'videos', 'ai-assistant'],
                avatar: '👨‍🎓',
                lastLogin: null,
                preferences: {}
            },
            'student2': {
                password: 'student123',
                name: '学生2',
                role: 'student',
                permissions: ['study', 'exercises', 'videos', 'ai-assistant'],
                avatar: '👩‍🎓',
                lastLogin: null,
                preferences: {}
            },
            'teacher1': {
                password: 'teacher123',
                name: '教师1',
                role: 'teacher',
                permissions: ['study', 'exercises', 'videos', 'upload', 'manage', 'ai-assistant'],
                avatar: '👨‍🏫',
                lastLogin: null,
                preferences: {}
            },
            'teacher2': {
                password: 'teacher123',
                name: '教师2',
                role: 'teacher',
                permissions: ['study', 'exercises', 'videos', 'upload', 'manage', 'ai-assistant'],
                avatar: '👩‍🏫',
                lastLogin: null,
                preferences: {}
            }
        };

        // 流体力学题库数据
        const EXERCISES_DATA = {
            categories: [
                {
                    id: 'fluid-basics',
                    name: '流体基础',
                    description: '流体力学基本概念和原理',
                    icon: 'fas fa-tint',
                    color: '#1e6fa8',
                    questions: [
                        {
                            id: 'fb-001',
                            type: 'choice',
                            difficulty: 'easy',
                            question: '下列哪个不是流体的基本特性？',
                            options: ['连续性', '粘性', '可压缩性', '刚性'],
                            correct: 3,
                            explanation: '刚性是固体的特性，流体具有流动性，不具有刚性。',
                            tags: ['基本概念', '流体特性'],
                            points: 5
                        },
                        {
                            id: 'fb-002',
                            type: 'choice',
                            difficulty: 'medium',
                            question: '流体的密度定义为：',
                            options: [
                                '质量与体积的比值',
                                '重量与体积的比值',
                                '质量与重量的比值',
                                '体积与质量的比值'
                            ],
                            correct: 0,
                            explanation: '密度ρ = m/V，即质量与体积的比值。',
                            tags: ['密度', '基本定义'],
                            points: 5
                        },
                        {
                            id: 'fb-003',
                            type: 'fill',
                            difficulty: 'easy',
                            question: '流体的粘性系数μ的单位是____。',
                            answer: 'Pa·s',
                            explanation: '粘性系数的国际单位是帕斯卡·秒(Pa·s)。',
                            tags: ['粘性', '单位'],
                            points: 5
                        },
                        {
                            id: 'fb-004',
                            type: 'calculation',
                            difficulty: 'hard',
                            question: '某流体的密度为1000 kg/m³，体积为2 m³，求其质量。',
                            answer: '2000',
                            unit: 'kg',
                            explanation: 'm = ρV = 1000 × 2 = 2000 kg',
                            tags: ['密度', '计算'],
                            points: 10
                        }
                    ]
                },
                {
                    id: 'hydrodynamics',
                    name: '流体动力学',
                    description: '流体运动的基本规律和方程',
                    icon: 'fas fa-wave-square',
                    color: '#2c9ab7',
                    questions: [
                        {
                            id: 'hd-001',
                            type: 'choice',
                            difficulty: 'medium',
                            question: '伯努利方程适用于：',
                            options: [
                                '理想流体稳定流动',
                                '粘性流体不稳定流动',
                                '可压缩流体',
                                '所有流体'
                            ],
                            correct: 0,
                            explanation: '伯努利方程适用于理想流体的稳定流动。',
                            tags: ['伯努利方程', '理想流体'],
                            points: 8
                        },
                        {
                            id: 'hd-002',
                            type: 'choice',
                            difficulty: 'hard',
                            question: '连续性方程反映了：',
                            options: [
                                '质量守恒',
                                '动量守恒',
                                '能量守恒',
                                '角动量守恒'
                            ],
                            correct: 0,
                            explanation: '连续性方程反映了质量守恒定律。',
                            tags: ['连续性方程', '质量守恒'],
                            points: 8
                        }
                    ]
                },
                {
                    id: 'turbulence',
                    name: '湍流理论',
                    description: '湍流的基本理论和应用',
                    icon: 'fas fa-wind',
                    color: '#4db8d6',
                    questions: [
                        {
                            id: 'tb-001',
                            type: 'choice',
                            difficulty: 'hard',
                            question: '雷诺数Re = ρVD/μ中，D代表：',
                            options: ['密度', '速度', '特征长度', '粘性系数'],
                            correct: 2,
                            explanation: 'D代表特征长度，如管道直径。',
                            tags: ['雷诺数', '特征长度'],
                            points: 8
                        }
                    ]
                }
            ]
        };

        // 视频数据
        const VIDEOS_DATA = [
            {
                id: 'v001',
                title: '流体力学基础概念',
                description: '介绍流体力学的基本概念和原理',
                duration: '45:30',
                thumbnail: '/videos/thumbnails/v001.jpg',
                url: '/videos/v001.mp4',
                category: 'fluid-basics',
                tags: ['基础', '概念', '原理'],
                uploadDate: '2024-01-10',
                views: 1250,
                likes: 89,
                instructor: '张教授',
                difficulty: 'beginner',
                quality: ['480p', '720p', '1080p'],
                chapters: [
                    { time: '00:00', title: '课程介绍' },
                    { time: '05:30', title: '流体的定义' },
                    { time: '15:20', title: '流体特性' },
                    { time: '30:45', title: '总结' }
                ]
            },
            {
                id: 'v002',
                title: '伯努利方程详解',
                description: '深入讲解伯努利方程的推导和应用',
                duration: '52:15',
                thumbnail: '/videos/thumbnails/v002.jpg',
                url: '/videos/v002.mp4',
                category: 'hydrodynamics',
                tags: ['伯努利方程', '推导', '应用'],
                uploadDate: '2024-01-12',
                views: 980,
                likes: 67,
                instructor: '李教授',
                difficulty: 'intermediate',
                quality: ['480p', '720p', '1080p'],
                chapters: [
                    { time: '00:00', title: '方程介绍' },
                    { time: '08:15', title: '数学推导' },
                    { time: '25:30', title: '物理意义' },
                    { time: '40:20', title: '实际应用' }
                ]
            },
            {
                id: 'v003',
                title: '湍流现象分析',
                description: '分析湍流现象的产生机制和特征',
                duration: '38:45',
                thumbnail: '/videos/thumbnails/v003.jpg',
                url: '/videos/v003.mp4',
                category: 'turbulence',
                tags: ['湍流', '现象', '分析'],
                uploadDate: '2024-01-15',
                views: 756,
                likes: 45,
                instructor: '王教授',
                difficulty: 'advanced',
                quality: ['480p', '720p', '1080p'],
                chapters: [
                    { time: '00:00', title: '湍流概述' },
                    { time: '10:30', title: '产生机制' },
                    { time: '20:15', title: '特征分析' },
                    { time: '30:45', title: '控制方法' }
                ]
            }
        ];

        // 学习模块数据
        const STUDY_MODULES = [
            {
                id: 'module-1',
                title: '流体力学基础',
                description: '学习流体力学的基本概念和原理',
                icon: 'fas fa-tint',
                color: '#1e6fa8',
                chapters: [
                    {
                        id: 'ch1-1',
                        title: '流体的定义和特性',
                        content: '本章介绍流体的基本定义、分类和主要特性...',
                        duration: '45分钟',
                        completed: false,
                        progress: 0
                    },
                    {
                        id: 'ch1-2',
                        title: '流体静力学',
                        content: '学习流体在静止状态下的力学性质...',
                        duration: '60分钟',
                        completed: false,
                        progress: 0
                    }
                ],
                totalChapters: 2,
                completedChapters: 0,
                progress: 0
            },
            {
                id: 'module-2',
                title: '流体动力学',
                description: '研究流体运动的基本规律',
                icon: 'fas fa-wave-square',
                color: '#2c9ab7',
                chapters: [
                    {
                        id: 'ch2-1',
                        title: '连续性方程',
                        content: '学习质量守恒在流体中的应用...',
                        duration: '50分钟',
                        completed: false,
                        progress: 0
                    },
                    {
                        id: 'ch2-2',
                        title: '伯努利方程',
                        content: '理解能量守恒在流体中的应用...',
                        duration: '55分钟',
                        completed: false,
                        progress: 0
                    }
                ],
                totalChapters: 2,
                completedChapters: 0,
                progress: 0
            }
        ];

        // AI助手知识库
        const AI_KNOWLEDGE_BASE = {
            fluid_mechanics: {
                concepts: [
                    {
                        term: '流体',
                        definition: '流体是能够流动的物质，包括液体和气体。流体具有连续性、粘性和可压缩性等特性。',
                        examples: ['水', '空气', '油'],
                        related: ['液体', '气体', '连续性', '粘性']
                    },
                    {
                        term: '密度',
                        definition: '密度是单位体积物质的质量，用ρ表示，单位是kg/m³。',
                        formula: 'ρ = m/V',
                        examples: ['水的密度约为1000 kg/m³', '空气密度约为1.225 kg/m³'],
                        related: ['质量', '体积', '比重']
                    },
                    {
                        term: '粘性',
                        definition: '粘性是流体抵抗剪切变形的能力，反映了流体内部的摩擦力。',
                        formula: 'τ = μ(du/dy)',
                        examples: ['蜂蜜比水更粘稠', '温度升高时液体粘性降低'],
                        related: ['粘性系数', '剪切应力', '牛顿流体']
                    }
                ],
                equations: [
                    {
                        name: '连续性方程',
                        formula: '∂ρ/∂t + ∇·(ρv) = 0',
                        description: '描述质量守恒的微分方程',
                        application: '用于分析流体流动中的质量变化'
                    },
                    {
                        name: '伯努利方程',
                        formula: 'p + 1/2ρv² + ρgh = 常数',
                        description: '描述理想流体稳定流动中能量守恒的方程',
                        application: '用于分析管道流动、翼型升力等'
                    },
                    {
                        name: '纳维-斯托克斯方程',
                        formula: 'ρ(Dv/Dt) = -∇p + μ∇²v + ρg',
                        description: '描述粘性流体运动的动量方程',
                        application: '是流体力学的基本方程，用于复杂流动分析'
                    }
                ],
                problems: [
                    {
                        type: 'calculation',
                        question: '如何计算管道中的压力损失？',
                        solution: '使用达西-魏斯巴赫公式：hf = f(L/D)(v²/2g)',
                        steps: [
                            '确定雷诺数Re = ρVD/μ',
                            '根据Re和相对粗糙度查摩擦系数f',
                            '计算压力损失hf'
                        ]
                    },
                    {
                        type: 'concept',
                        question: '什么是边界层？',
                        solution: '边界层是靠近固体壁面的薄层流体，其中粘性效应显著。',
                        details: [
                            '边界层厚度随距离增加而增加',
                            '边界层内速度梯度很大',
                            '边界层分离会导致阻力增加'
                        ]
                    }
                ]
            }
        };

        // 工具函数
        const Utils = {
            // 防抖函数
            debounce(func, wait, immediate = false) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        timeout = null;
                        if (!immediate) func(...args);
                    };
                    const callNow = immediate && !timeout;
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                    if (callNow) func(...args);
                };
            },

            // 节流函数
            throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },

            // 输入清理
            sanitizeInput(input, type = 'text') {
                if (typeof input !== 'string') return '';
                
                let sanitized = input.trim();
                
                switch (type) {
                    case 'html':
                        const div = document.createElement('div');
                        div.textContent = sanitized;
                        return div.innerHTML;
                    case 'url':
                        try {
                            const url = new URL(sanitized);
                            return url.toString();
                        } catch {
                            return '';
                        }
                    case 'email':
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        return emailRegex.test(sanitized) ? sanitized : '';
                    case 'number':
                        return isNaN(sanitized) ? '' : sanitized;
                    default:
                        return sanitized.replace(/[<>]/g, '');
                }
            },

            // 格式化文件大小
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },

            // 格式化时间
            formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                
                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                } else {
                    return `${minutes}:${secs.toString().padStart(2, '0')}`;
                }
            },

            // 生成唯一ID
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            },

            // 深拷贝
            deepClone(obj) {
                if (obj === null || typeof obj !== 'object') return obj;
                if (obj instanceof Date) return new Date(obj.getTime());
                if (obj instanceof Array) return obj.map(item => Utils.deepClone(item));
                if (typeof obj === 'object') {
                    const clonedObj = {};
                    for (const key in obj) {
                        if (obj.hasOwnProperty(key)) {
                            clonedObj[key] = Utils.deepClone(obj[key]);
                        }
                    }
                    return clonedObj;
                }
            },

            // 本地存储管理
            storage: {
                set(key, value) {
                    try {
                        const fullKey = CONFIG.STORAGE_PREFIX + key;
                        localStorage.setItem(fullKey, JSON.stringify(value));
                        return true;
                    } catch (error) {
                        console.error('Storage set error:', error);
                        return false;
                    }
                },

                get(key, defaultValue = null) {
                    try {
                        const fullKey = CONFIG.STORAGE_PREFIX + key;
                        const item = localStorage.getItem(fullKey);
                        return item ? JSON.parse(item) : defaultValue;
                    } catch (error) {
                        console.error('Storage get error:', error);
                        return defaultValue;
                    }
                },

                remove(key) {
                    try {
                        const fullKey = CONFIG.STORAGE_PREFIX + key;
                        localStorage.removeItem(fullKey);
                        return true;
                    } catch (error) {
                        console.error('Storage remove error:', error);
                        return false;
                    }
                },

                clear() {
                    try {
                        const keys = Object.keys(localStorage);
                        keys.forEach(key => {
                            if (key.startsWith(CONFIG.STORAGE_PREFIX)) {
                                localStorage.removeItem(key);
                            }
                        });
                        return true;
                    } catch (error) {
                        console.error('Storage clear error:', error);
                        return false;
                    }
                }
            },

            // 网络状态检测
            network: {
                isOnline() {
                    return navigator.onLine;
                },

                onStatusChange(callback) {
                    window.addEventListener('online', () => callback(true));
                    window.addEventListener('offline', () => callback(false));
                }
            },

            // 设备检测
            device: {
                isMobile() {
                    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                },

                isTablet() {
                    return /iPad|Android(?=.*\bMobile\b)(?=.*\bSafari\b)/i.test(navigator.userAgent);
                },

                isDesktop() {
                    return !this.isMobile() && !this.isTablet();
                },

                getScreenSize() {
                    return {
                        width: window.innerWidth,
                        height: window.innerHeight
                    };
                }
            }
        };

        // DOM元素缓存
        const DOM = {
            // 初始化时获取所有需要的DOM元素
            init() {
                this.loadingScreen = document.getElementById('loadingScreen');
                this.app = document.getElementById('app');
                this.header = document.getElementById('header');
                this.sidebar = document.getElementById('sidebar');
                this.main = document.getElementById('main');
                this.sidebarToggle = document.getElementById('sidebarToggle');
                this.sidebarClose = document.getElementById('sidebarClose');
                this.loginForm = document.getElementById('loginForm');
                this.username = document.getElementById('username');
                this.password = document.getElementById('password');
                this.loginButton = document.getElementById('loginButton');
                this.loginButtonText = document.getElementById('loginButtonText');
                this.loginButtonSpinner = document.getElementById('loginButtonSpinner');
                this.loginMessage = document.getElementById('loginMessage');
                this.userDisplay = document.getElementById('userDisplay');
                this.logoutBtn = document.getElementById('logoutBtn');
                this.modalContainer = document.getElementById('modalContainer');
                this.notificationContainer = document.getElementById('notificationContainer');
                
                // 导航链接
                this.navLinks = document.querySelectorAll('.nav-link');
                this.sidebarLinks = document.querySelectorAll('.sidebar-link');
                
                // 统计元素
                this.totalLessons = document.getElementById('totalLessons');
                this.totalExercises = document.getElementById('totalExercises');
                this.totalVideos = document.getElementById('totalVideos');
                this.studyProgress = document.getElementById('studyProgress');
                this.recentActivitiesList = document.getElementById('recentActivitiesList');
            }
        };

        // 消息系统
        const MessageSystem = {
            show(message, type = 'info', duration = 5000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <i class="notification-icon fas fa-${this.getIcon(type)}"></i>
                    <div class="notification-content">
                        <div class="notification-title">${this.getTitle(type)}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                DOM.notificationContainer.appendChild(notification);
                
                // 显示动画
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                // 自动移除
                if (duration > 0) {
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => {
                            if (notification.parentElement) {
                                notification.remove();
                            }
                        }, 300);
                    }, duration);
                }
                
                return notification;
            },

            getIcon(type) {
                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-circle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                };
                return icons[type] || 'info-circle';
            },

            getTitle(type) {
                const titles = {
                    success: '成功',
                    error: '错误',
                    warning: '警告',
                    info: '信息'
                };
                return titles[type] || '信息';
            },

            clear() {
                DOM.notificationContainer.innerHTML = '';
            }
        };

        // 模态框系统
        const ModalSystem = {
            show(options) {
                const {
                    title = '提示',
                    content = '',
                    size = 'medium',
                    showClose = true,
                    showFooter = true,
                    buttons = [],
                    onClose = null
                } = options;

                const modal = document.createElement('div');
                modal.className = `modal modal-${size}`;
                modal.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">${title}</h3>
                        ${showClose ? '<button class="modal-close" onclick="ModalSystem.close()"><i class="fas fa-times"></i></button>' : ''}
                    </div>
                    <div class="modal-body">
                        ${content}
                    </div>
                    ${showFooter ? `
                        <div class="modal-footer">
                            ${buttons.map(btn => `
                                <button class="btn btn-${btn.type || 'primary'}" onclick="${btn.onClick || 'ModalSystem.close()'}">
                                    ${btn.text}
                                </button>
                            `).join('')}
                        </div>
                    ` : ''}
                `;

                DOM.modalContainer.innerHTML = '';
                DOM.modalContainer.appendChild(modal);
                DOM.modalContainer.classList.add('show');

                this.currentModal = {
                    element: modal,
                    onClose: onClose
                };
            },

            close() {
                DOM.modalContainer.classList.remove('show');
                if (this.currentModal && this.currentModal.onClose) {
                    this.currentModal.onClose();
                }
                this.currentModal = null;
            },

            confirm(message, onConfirm, onCancel) {
                this.show({
                    title: '确认',
                    content: `<p>${message}</p>`,
                    buttons: [
                        {
                            text: '取消',
                            type: 'secondary',
                            onClick: 'ModalSystem.close()'
                        },
                        {
                            text: '确定',
                            type: 'primary',
                            onClick: () => {
                                ModalSystem.close();
                                if (onConfirm) onConfirm();
                            }
                        }
                    ]
                });
            }
        };

        // 登录系统
        const LoginSystem = {
            validateCredentials(username, password) {
                if (!username || !password) {
                    return { success: false, message: '请输入用户名和密码' };
                }

                const user = USER_ACCOUNTS[username];
                if (!user) {
                    return { success: false, message: '用户名不存在' };
                }

                if (user.password !== password) {
                    return { success: false, message: '密码错误' };
                }

                return { success: true, user: user };
            },

            async performLogin(username, password) {
                // 模拟登录延迟
                await new Promise(resolve => setTimeout(resolve, 1000));

                const result = this.validateCredentials(username, password);
                
                if (result.success) {
                    APP_STATE.currentUser = { username, ...result.user };
                    APP_STATE.isLoggedIn = true;
                    APP_STATE.loginAttempts = 0;
                    APP_STATE.lockoutEndTime = null;
                    APP_STATE.sessionStartTime = Date.now();
                    APP_STATE.lastActivityTime = Date.now();

                    // 保存用户信息到本地存储
                    Utils.storage.set('currentUser', APP_STATE.currentUser);
                    Utils.storage.set('sessionStartTime', APP_STATE.sessionStartTime);

                    MessageSystem.show('登录成功！', 'success');
                    this.showPlatform();
                } else {
                    APP_STATE.loginAttempts++;
                    
                    if (APP_STATE.loginAttempts >= CONFIG.MAX_LOGIN_ATTEMPTS) {
                        APP_STATE.lockoutEndTime = Date.now() + CONFIG.LOCKOUT_DURATION;
                        MessageSystem.show('登录失败次数过多，账户已被锁定15分钟', 'error');
                    } else {
                        const remainingAttempts = CONFIG.MAX_LOGIN_ATTEMPTS - APP_STATE.loginAttempts;
                        MessageSystem.show(`${result.message}，还剩${remainingAttempts}次尝试机会`, 'error');
                    }
                }

                return result;
            },

            showPlatform() {
                document.getElementById('loginSection').classList.remove('active');
                document.getElementById('homeSection').classList.add('active');
                
                this.updateUserDisplay();
                this.loadHomeData();
                this.startSessionTimer();
            },

            updateUserDisplay() {
                if (APP_STATE.currentUser) {
                    DOM.userDisplay.textContent = `${APP_STATE.currentUser.avatar} ${APP_STATE.currentUser.name} (${APP_STATE.currentUser.role})`;
                    DOM.logoutBtn.classList.remove('d-none');
                }
            },

            loadHomeData() {
                // 更新统计数据
                DOM.totalLessons.textContent = STUDY_MODULES.length;
                DOM.totalExercises.textContent = EXERCISES_DATA.categories.reduce((total, cat) => total + cat.questions.length, 0);
                DOM.totalVideos.textContent = VIDEOS_DATA.length;
                DOM.studyProgress.textContent = '35%';

                // 加载最近活动
                this.loadRecentActivities();
            },

            loadRecentActivities() {
                const activities = [
                    {
                        icon: 'fas fa-book-open',
                        title: '完成了"流体基础"第一章学习',
                        time: '2小时前'
                    },
                    {
                        icon: 'fas fa-tasks',
                        title: '完成了10道练习题',
                        time: '4小时前'
                    },
                    {
                        icon: 'fas fa-video',
                        title: '观看了"湍流理论"视频',
                        time: '1天前'
                    },
                    {
                        icon: 'fas fa-file-alt',
                        title: '参加了模拟考试',
                        time: '2天前'
                    }
                ];

                DOM.recentActivitiesList.innerHTML = activities.map(activity => `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="${activity.icon}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-time">${activity.time}</div>
                        </div>
                    </div>
                `).join('');
            },

            startSessionTimer() {
                // 检查会话超时
                setInterval(() => {
                    if (APP_STATE.sessionStartTime && 
                        Date.now() - APP_STATE.sessionStartTime > CONFIG.SESSION_TIMEOUT) {
                        this.logout('会话超时，请重新登录');
                    }
                }, 60000); // 每分钟检查一次

                // 更新最后活动时间
                document.addEventListener('click', () => {
                    APP_STATE.lastActivityTime = Date.now();
                });
            },

            logout(reason = null) {
                APP_STATE.currentUser = null;
                APP_STATE.isLoggedIn = false;
                APP_STATE.currentSection = 'home';
                APP_STATE.sessionStartTime = null;
                APP_STATE.lastActivityTime = null;

                // 清除本地存储
                Utils.storage.remove('currentUser');
                Utils.storage.remove('sessionStartTime');

                // 更新界面
                DOM.userDisplay.textContent = '未登录';
                DOM.logoutBtn.classList.add('d-none');
                
                document.getElementById('homeSection').classList.remove('active');
                document.getElementById('loginSection').classList.add('active');
                
                DOM.loginForm.reset();

                if (reason) {
                    MessageSystem.show(reason, 'warning');
                }
            }
        };

        // 导航系统
        const NavigationSystem = {
            showSection(sectionName) {
                // 隐藏所有section
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // 显示目标section
                const targetSection = document.getElementById(`${sectionName}Section`);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                
                // 更新导航状态
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                const activeLink = document.querySelector(`[data-section="${sectionName}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
                
                APP_STATE.currentSection = sectionName;

                // 加载对应内容
                this.loadSectionContent(sectionName);
            },

            loadSectionContent(sectionName) {
                switch (sectionName) {
                    case 'study':
                        StudySystem.loadStudyModules();
                        break;
                    case 'exercises':
                        ExerciseSystem.loadExerciseCategories();
                        break;
                    case 'videos':
                        VideoSystem.loadVideos();
                        break;
                    case 'ai-assistant':
                        AISystem.init();
                        break;
                    case 'upload':
                        UploadSystem.init();
                        break;
                    case 'profile':
                        ProfileSystem.loadProfile();
                        break;
                }
            },

            toggleSidebar() {
                DOM.sidebar.classList.toggle('open');
            },

            closeSidebar() {
                DOM.sidebar.classList.remove('open');
            }
        };

        // 学习系统
        const StudySystem = {
            loadStudyModules() {
                const container = document.querySelector('.study-modules');
                if (!container) return;

                container.innerHTML = STUDY_MODULES.map(module => `
                    <div class="card study-module-card" data-module-id="${module.id}">
                        <div class="card-header">
                            <div class="module-info">
                                <div class="module-icon" style="color: ${module.color}">
                                    <i class="${module.icon}"></i>
                                </div>
                                <div>
                                    <h3 class="card-title">${module.title}</h3>
                                    <p class="card-subtitle">${module.description}</p>
                                </div>
                            </div>
                            <div class="module-progress">
                                <div class="progress-circle" data-progress="${module.progress}">
                                    <span>${module.progress}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chapters-list">
                                ${module.chapters.map(chapter => `
                                    <div class="chapter-item ${chapter.completed ? 'completed' : ''}" data-chapter-id="${chapter.id}">
                                        <div class="chapter-info">
                                            <i class="fas fa-${chapter.completed ? 'check-circle' : 'circle'}"></i>
                                            <span>${chapter.title}</span>
                                        </div>
                                        <div class="chapter-duration">${chapter.duration}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" onclick="StudySystem.startModule('${module.id}')">
                                开始学习
                            </button>
                            <span class="progress-text">${module.completedChapters}/${module.totalChapters} 章节完成</span>
                        </div>
                    </div>
                `).join('');

                // 添加事件监听
                this.addStudyEventListeners();
            },

            addStudyEventListeners() {
                document.querySelectorAll('.study-module-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.btn')) {
                            const moduleId = card.dataset.moduleId;
                            this.showModuleDetails(moduleId);
                        }
                    });
                });

                document.querySelectorAll('.chapter-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const chapterId = item.dataset.chapterId;
                        this.startChapter(chapterId);
                    });
                });
            },

            startModule(moduleId) {
                const module = STUDY_MODULES.find(m => m.id === moduleId);
                if (!module) return;

                ModalSystem.show({
                    title: `开始学习 - ${module.title}`,
                    content: `
                        <p>您即将开始学习 <strong>${module.title}</strong></p>
                        <p>本模块包含 ${module.totalChapters} 个章节，预计学习时间 ${this.calculateTotalDuration(module)} 分钟</p>
                        <p>建议按顺序学习每个章节，确保理解后再进入下一章节。</p>
                    `,
                    buttons: [
                        {
                            text: '取消',
                            type: 'secondary',
                            onClick: 'ModalSystem.close()'
                        },
                        {
                            text: '开始学习',
                            type: 'primary',
                            onClick: () => {
                                ModalSystem.close();
                                this.showModuleDetails(moduleId);
                            }
                        }
                    ]
                });
            },

            showModuleDetails(moduleId) {
                const module = STUDY_MODULES.find(m => m.id === moduleId);
                if (!module) return;

                const container = document.querySelector('.study-modules');
                container.innerHTML = `
                    <div class="module-details">
                        <div class="module-header">
                            <button class="btn btn-ghost" onclick="StudySystem.loadStudyModules()">
                                <i class="fas fa-arrow-left"></i> 返回
                            </button>
                            <h2>${module.title}</h2>
                        </div>
                        <div class="module-content">
                            <div class="module-description">
                                <p>${module.description}</p>
                            </div>
                            <div class="chapters-container">
                                ${module.chapters.map((chapter, index) => `
                                    <div class="chapter-card ${chapter.completed ? 'completed' : ''}" data-chapter-id="${chapter.id}">
                                        <div class="chapter-header">
                                            <div class="chapter-number">${index + 1}</div>
                                            <div class="chapter-info">
                                                <h3>${chapter.title}</h3>
                                                <p>${chapter.content}</p>
                                            </div>
                                            <div class="chapter-status">
                                                ${chapter.completed ? 
                                                    '<i class="fas fa-check-circle text-success"></i>' : 
                                                    '<i class="fas fa-circle"></i>'
                                                }
                                            </div>
                                        </div>
                                        <div class="chapter-footer">
                                            <span class="chapter-duration">${chapter.duration}</span>
                                            <button class="btn btn-primary" onclick="StudySystem.startChapter('${chapter.id}')">
                                                ${chapter.completed ? '复习' : '开始学习'}
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            },

            startChapter(chapterId) {
                // 这里可以实现具体的章节学习逻辑
                MessageSystem.show('章节学习功能正在开发中...', 'info');
            },

            calculateTotalDuration(module) {
                return module.chapters.reduce((total, chapter) => {
                    const minutes = parseInt(chapter.duration);
                    return total + (isNaN(minutes) ? 0 : minutes);
                }, 0);
            }
        };

        // 题库系统
        const ExerciseSystem = {
            loadExerciseCategories() {
                const container = document.querySelector('.exercises-container');
                if (!container) return;

                container.innerHTML = `
                    <div class="exercise-categories">
                        ${EXERCISES_DATA.categories.map(category => `
                            <div class="card exercise-category-card" data-category-id="${category.id}">
                                <div class="card-header">
                                    <div class="category-info">
                                        <div class="category-icon" style="color: ${category.color}">
                                            <i class="${category.icon}"></i>
                                        </div>
                                        <div>
                                            <h3 class="card-title">${category.name}</h3>
                                            <p class="card-subtitle">${category.description}</p>
                                        </div>
                                    </div>
                                    <div class="category-stats">
                                        <span class="question-count">${category.questions.length} 题</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="difficulty-distribution">
                                        ${this.getDifficultyDistribution(category.questions)}
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-primary" onclick="ExerciseSystem.startCategory('${category.id}')">
                                        开始练习
                                    </button>
                                    <button class="btn btn-outline" onclick="ExerciseSystem.showCategoryDetails('${category.id}')">
                                        查看详情
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            },

            getDifficultyDistribution(questions) {
                const distribution = {
                    easy: questions.filter(q => q.difficulty === 'easy').length,
                    medium: questions.filter(q => q.difficulty === 'medium').length,
                    hard: questions.filter(q => q.difficulty === 'hard').length
                };

                return `
                    <div class="difficulty-bars">
                        <div class="difficulty-bar easy" style="width: ${(distribution.easy / questions.length) * 100}%">
                            <span>简单 ${distribution.easy}</span>
                        </div>
                        <div class="difficulty-bar medium" style="width: ${(distribution.medium / questions.length) * 100}%">
                            <span>中等 ${distribution.medium}</span>
                        </div>
                        <div class="difficulty-bar hard" style="width: ${(distribution.hard / questions.length) * 100}%">
                            <span>困难 ${distribution.hard}</span>
                        </div>
                    </div>
                `;
            },

            startCategory(categoryId) {
                const category = EXERCISES_DATA.categories.find(c => c.id === categoryId);
                if (!category) return;

                ModalSystem.show({
                    title: `开始练习 - ${category.name}`,
                    content: `
                        <p>您即将开始 <strong>${category.name}</strong> 的练习</p>
                        <p>本类别包含 ${category.questions.length} 道题目</p>
                        <div class="exercise-options">
                            <label class="form-check">
                                <input type="checkbox" id="randomOrder" checked>
                                <span>随机顺序</span>
                            </label>
                            <label class="form-check">
                                <input type="checkbox" id="showExplanation" checked>
                                <span>显示解析</span>
                            </label>
                            <label class="form-check">
                                <input type="checkbox" id="timeLimit">
                                <span>时间限制</span>
                            </label>
                        </div>
                    `,
                    buttons: [
                        {
                            text: '取消',
                            type: 'secondary',
                            onClick: 'ModalSystem.close()'
                        },
                        {
                            text: '开始练习',
                            type: 'primary',
                            onClick: () => {
                                ModalSystem.close();
                                this.startExercise(categoryId);
                            }
                        }
                    ]
                });
            },

            startExercise(categoryId) {
                const category = EXERCISES_DATA.categories.find(c => c.id === categoryId);
                if (!category) return;

                APP_STATE.currentExercise = {
                    categoryId: categoryId,
                    questions: [...category.questions],
                    currentIndex: 0,
                    answers: [],
                    startTime: Date.now(),
                    settings: {
                        randomOrder: document.getElementById('randomOrder')?.checked || false,
                        showExplanation: document.getElementById('showExplanation')?.checked || true,
                        timeLimit: document.getElementById('timeLimit')?.checked || false
                    }
                };

                if (APP_STATE.currentExercise.settings.randomOrder) {
                    this.shuffleArray(APP_STATE.currentExercise.questions);
                }

                this.showQuestion();
            },

            showQuestion() {
                const exercise = APP_STATE.currentExercise;
                if (!exercise || exercise.currentIndex >= exercise.questions.length) {
                    this.finishExercise();
                    return;
                }

                const question = exercise.questions[exercise.currentIndex];
                const container = document.querySelector('.exercises-container');

                container.innerHTML = `
                    <div class="exercise-question">
                        <div class="question-header">
                            <div class="question-progress">
                                题目 ${exercise.currentIndex + 1} / ${exercise.questions.length}
                            </div>
                            <div class="question-timer" id="questionTimer">
                                <i class="fas fa-clock"></i>
                                <span id="timerDisplay">00:00</span>
                            </div>
                        </div>
                        <div class="question-content">
                            <div class="question-text">
                                <h3>${question.question}</h3>
                            </div>
                            ${this.renderQuestionOptions(question)}
                        </div>
                        <div class="question-footer">
                            <button class="btn btn-secondary" onclick="ExerciseSystem.previousQuestion()" ${exercise.currentIndex === 0 ? 'disabled' : ''}>
                                <i class="fas fa-arrow-left"></i> 上一题
                            </button>
                            <div class="question-actions">
                                <button class="btn btn-outline" onclick="ExerciseSystem.showHint()">
                                    <i class="fas fa-lightbulb"></i> 提示
                                </button>
                                <button class="btn btn-outline" onclick="ExerciseSystem.showExplanation()">
                                    <i class="fas fa-eye"></i> 查看解析
                                </button>
                            </div>
                            <button class="btn btn-primary" onclick="ExerciseSystem.nextQuestion()">
                                ${exercise.currentIndex === exercise.questions.length - 1 ? '完成' : '下一题'} 
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                `;

                this.startQuestionTimer();
            },

            renderQuestionOptions(question) {
                switch (question.type) {
                    case 'choice':
                        return `
                            <div class="question-options">
                                ${question.options.map((option, index) => `
                                    <label class="option-item">
                                        <input type="radio" name="answer" value="${index}" ${this.isAnswered(index) ? 'checked' : ''}>
                                        <span class="option-text">${String.fromCharCode(65 + index)}. ${option}</span>
                                    </label>
                                `).join('')}
                            </div>
                        `;
                    case 'fill':
                        return `
                            <div class="question-answer">
                                <input type="text" class="form-control" placeholder="请输入答案" value="${this.getAnswer() || ''}">
                            </div>
                        `;
                    case 'calculation':
                        return `
                            <div class="question-answer">
                                <input type="number" class="form-control" placeholder="请输入数值" value="${this.getAnswer() || ''}">
                                <span class="unit">${question.unit || ''}</span>
                            </div>
                        `;
                    default:
                        return '';
                }
            },

            isAnswered(value) {
                const exercise = APP_STATE.currentExercise;
                if (!exercise) return false;
                return exercise.answers[exercise.currentIndex] === value;
            },

            getAnswer() {
                const exercise = APP_STATE.currentExercise;
                if (!exercise) return '';
                return exercise.answers[exercise.currentIndex] || '';
            },

            nextQuestion() {
                this.saveAnswer();
                
                const exercise = APP_STATE.currentExercise;
                if (exercise.currentIndex < exercise.questions.length - 1) {
                    exercise.currentIndex++;
                    this.showQuestion();
                } else {
                    this.finishExercise();
                }
            },

            previousQuestion() {
                this.saveAnswer();
                
                const exercise = APP_STATE.currentExercise;
                if (exercise.currentIndex > 0) {
                    exercise.currentIndex--;
                    this.showQuestion();
                }
            },

            saveAnswer() {
                const exercise = APP_STATE.currentExercise;
                if (!exercise) return;

                const answerInput = document.querySelector('input[name="answer"]:checked, input[type="text"], input[type="number"]');
                if (answerInput) {
                    exercise.answers[exercise.currentIndex] = answerInput.value;
                }
            },

            startQuestionTimer() {
                if (APP_STATE.questionTimer) {
                    clearInterval(APP_STATE.questionTimer);
                }

                let seconds = 0;
                APP_STATE.questionTimer = setInterval(() => {
                    seconds++;
                    const timerDisplay = document.getElementById('timerDisplay');
                    if (timerDisplay) {
                        timerDisplay.textContent = Utils.formatTime(seconds);
                    }
                }, 1000);
            },

            showHint() {
                const question = APP_STATE.currentExercise?.questions[APP_STATE.currentExercise.currentIndex];
                if (!question) return;

                ModalSystem.show({
                    title: '提示',
                    content: `<p>${question.explanation || '暂无提示'}</p>`,
                    buttons: [
                        {
                            text: '确定',
                            type: 'primary',
                            onClick: 'ModalSystem.close()'
                        }
                    ]
                });
            },

            showExplanation() {
                const question = APP_STATE.currentExercise?.questions[APP_STATE.currentExercise.currentIndex];
                if (!question) return;

                ModalSystem.show({
                    title: '题目解析',
                    content: `
                        <div class="explanation-content">
                            <h4>正确答案：</h4>
                            <p>${this.getCorrectAnswer(question)}</p>
                            <h4>解析：</h4>
                            <p>${question.explanation}</p>
                        </div>
                    `,
                    buttons: [
                        {
                            text: '确定',
                            type: 'primary',
                            onClick: 'ModalSystem.close()'
                        }
                    ]
                });
            },

            getCorrectAnswer(question) {
                switch (question.type) {
                    case 'choice':
                        return `${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}`;
                    case 'fill':
                    case 'calculation':
                        return question.answer + (question.unit || '');
                    default:
                        return '未知';
                }
            },

            finishExercise() {
                if (APP_STATE.questionTimer) {
                    clearInterval(APP_STATE.questionTimer);
                }

                const exercise = APP_STATE.currentExercise;
                if (!exercise) return;

                const results = this.calculateResults();
                this.showResults(results);
            },

            calculateResults() {
                const exercise = APP_STATE.currentExercise;
                if (!exercise) return null;

                let correct = 0;
                const details = [];

                exercise.questions.forEach((question, index) => {
                    const userAnswer = exercise.answers[index];
                    const isCorrect = this.checkAnswer(question, userAnswer);
                    
                    if (isCorrect) correct++;

                    details.push({
                        question: question.question,
                        userAnswer: userAnswer,
                        correctAnswer: this.getCorrectAnswer(question),
                        isCorrect: isCorrect,
                        explanation: question.explanation
                    });
                });

                return {
                    total: exercise.questions.length,
                    correct: correct,
                    score: Math.round((correct / exercise.questions.length) * 100),
                    timeSpent: Math.round((Date.now() - exercise.startTime) / 1000),
                    details: details
                };
            },

            checkAnswer(question, userAnswer) {
                switch (question.type) {
                    case 'choice':
                        return parseInt(userAnswer) === question.correct;
                    case 'fill':
                        return userAnswer?.toLowerCase().trim() === question.answer.toLowerCase().trim();
                    case 'calculation':
                        const userNum = parseFloat(userAnswer);
                        const correctNum = parseFloat(question.answer);
                        return !isNaN(userNum) && Math.abs(userNum - correctNum) < 0.01;
                    default:
                        return false;
                }
            },

            showResults(results) {
                const container = document.querySelector('.exercises-container');
                container.innerHTML = `
                    <div class="exercise-results">
                        <div class="results-header">
                            <h2>练习完成</h2>
                            <div class="score-display">
                                <div class="score-circle" data-score="${results.score}">
                                    <span class="score-number">${results.score}</span>
                                    <span class="score-label">分</span>
                                </div>
                            </div>
                        </div>
                        <div class="results-stats">
                            <div class="stat-item">
                                <i class="fas fa-check-circle text-success"></i>
                                <span>正确：${results.correct}/${results.total}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-clock"></i>
                                <span>用时：${Utils.formatTime(results.timeSpent)}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>平均速度：${Math.round(results.total / (results.timeSpent / 60))} 题/分钟</span>
                            </div>
                        </div>
                        <div class="results-actions">
                            <button class="btn btn-primary" onclick="ExerciseSystem.showDetailedResults()">
                                查看详细结果
                            </button>
                            <button class="btn btn-secondary" onclick="ExerciseSystem.loadExerciseCategories()">
                                返回题库
                            </button>
                            <button class="btn btn-outline" onclick="ExerciseSystem.retryExercise()">
                                重新练习
                            </button>
                        </div>
                    </div>
                `;
            },

            showDetailedResults() {
                const exercise = APP_STATE.currentExercise;
                if (!exercise) return;

                const results = this.calculateResults();
                const detailsHtml = results.details.map((detail, index) => `
                    <div class="result-detail ${detail.isCorrect ? 'correct' : 'incorrect'}">
                        <div class="detail-header">
                            <span class="question-number">第 ${index + 1} 题</span>
                            <span class="result-status">
                                ${detail.isCorrect ? 
                                    '<i class="fas fa-check text-success"></i>' : 
                                    '<i class="fas fa-times text-danger"></i>'
                                }
                            </span>
                        </div>
                        <div class="detail-content">
                            <p class="question-text">${detail.question}</p>
                            <div class="answer-comparison">
                                <div class="user-answer">
                                    <strong>您的答案：</strong> ${detail.userAnswer || '未作答'}
                                </div>
                                <div class="correct-answer">
                                    <strong>正确答案：</strong> ${detail.correctAnswer}
                                </div>
                            </div>
                            ${detail.explanation ? `
                                <div class="explanation">
                                    <strong>解析：</strong> ${detail.explanation}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');

                ModalSystem.show({
                    title: '详细结果',
                    content: `
                        <div class="detailed-results">
                            ${detailsHtml}
                        </div>
                    `,
                    size: 'large',
                    buttons: [
                        {
                            text: '关闭',
                            type: 'primary',
                            onClick: 'ModalSystem.close()'
                        }
                    ]
                });
            },

            retryExercise() {
                const exercise = APP_STATE.currentExercise;
                if (!exercise) return;

                exercise.currentIndex = 0;
                exercise.answers = [];
                exercise.startTime = Date.now();
                
                if (exercise.settings.randomOrder) {
                    this.shuffleArray(exercise.questions);
                }

                this.showQuestion();
            },

                         shuffleArray(array) {
                 for (let i = array.length - 1; i > 0; i--) {
                     const j = Math.floor(Math.random() * (i + 1));
                     [array[i], array[j]] = [array[j], array[i]];
                 }
             }
         };

        // 视频系统
        const VideoSystem = {
            loadVideos() {
                const container = document.querySelector('.videos-container');
                if (!container) return;

                container.innerHTML = `
                    <div class="videos-header">
                        <div class="videos-filters">
                            <select class="form-control" id="categoryFilter">
                                <option value="">所有分类</option>
                                <option value="fluid-basics">流体基础</option>
                                <option value="hydrodynamics">流体动力学</option>
                                <option value="turbulence">湍流理论</option>
                            </select>
                            <select class="form-control" id="difficultyFilter">
                                <option value="">所有难度</option>
                                <option value="beginner">初级</option>
                                <option value="intermediate">中级</option>
                                <option value="advanced">高级</option>
                            </select>
                            <input type="text" class="form-control" id="searchVideos" placeholder="搜索视频...">
                        </div>
                    </div>
                    <div class="videos-grid" id="videosGrid">
                        ${this.renderVideos(VIDEOS_DATA)}
                    </div>
                `;

                this.addVideoEventListeners();
            },

            renderVideos(videos) {
                return videos.map(video => `
                    <div class="video-card" data-video-id="${video.id}">
                        <div class="video-thumbnail">
                            <img src="${video.thumbnail}" alt="${video.title}" onerror="this.src='/videos/default-thumbnail.jpg'">
                            <div class="video-duration">${video.duration}</div>
                            <div class="video-overlay">
                                <button class="btn btn-primary play-btn" onclick="VideoSystem.playVideo('${video.id}')">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">${video.title}</h3>
                            <p class="video-description">${video.description}</p>
                            <div class="video-meta">
                                <span class="instructor">${video.instructor}</span>
                                <span class="views">${video.views} 次观看</span>
                                <span class="likes">${video.likes} 点赞</span>
                            </div>
                            <div class="video-tags">
                                ${video.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            addVideoEventListeners() {
                // 搜索功能
                const searchInput = document.getElementById('searchVideos');
                if (searchInput) {
                    searchInput.addEventListener('input', Utils.debounce(() => {
                        this.filterVideos();
                    }, 300));
                }

                // 分类筛选
                const categoryFilter = document.getElementById('categoryFilter');
                if (categoryFilter) {
                    categoryFilter.addEventListener('change', () => {
                        this.filterVideos();
                    });
                }

                // 难度筛选
                const difficultyFilter = document.getElementById('difficultyFilter');
                if (difficultyFilter) {
                    difficultyFilter.addEventListener('change', () => {
                        this.filterVideos();
                    });
                }
            },

            filterVideos() {
                const searchTerm = document.getElementById('searchVideos')?.value.toLowerCase() || '';
                const category = document.getElementById('categoryFilter')?.value || '';
                const difficulty = document.getElementById('difficultyFilter')?.value || '';

                const filteredVideos = VIDEOS_DATA.filter(video => {
                    const matchesSearch = video.title.toLowerCase().includes(searchTerm) ||
                                        video.description.toLowerCase().includes(searchTerm) ||
                                        video.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                    const matchesCategory = !category || video.category === category;
                    const matchesDifficulty = !difficulty || video.difficulty === difficulty;

                    return matchesSearch && matchesCategory && matchesDifficulty;
                });

                const videosGrid = document.getElementById('videosGrid');
                if (videosGrid) {
                    videosGrid.innerHTML = this.renderVideos(filteredVideos);
                }
            },

            playVideo(videoId) {
                const video = VIDEOS_DATA.find(v => v.id === videoId);
                if (!video) return;

                const container = document.querySelector('.videos-container');
                container.innerHTML = `
                    <div class="video-player-container">
                        <div class="video-player-header">
                            <button class="btn btn-ghost" onclick="VideoSystem.loadVideos()">
                                <i class="fas fa-arrow-left"></i> 返回视频列表
                            </button>
                            <h2>${video.title}</h2>
                        </div>
                        <div class="video-player-main">
                            <div class="video-player">
                                <video id="videoPlayer" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="400">
                                    <source src="${video.url}" type="video/mp4">
                                    <p class="vjs-no-js">您的浏览器不支持HTML5视频播放</p>
                                </video>
                            </div>
                            <div class="video-info-panel">
                                <div class="video-details">
                                    <h3>${video.title}</h3>
                                    <p>${video.description}</p>
                                    <div class="video-stats">
                                        <span><i class="fas fa-eye"></i> ${video.views} 次观看</span>
                                        <span><i class="fas fa-heart"></i> ${video.likes} 点赞</span>
                                        <span><i class="fas fa-calendar"></i> ${video.uploadDate}</span>
                                    </div>
                                    <div class="video-tags">
                                        ${video.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                    </div>
                                </div>
                                <div class="video-chapters">
                                    <h4>章节</h4>
                                    <div class="chapters-list">
                                        ${video.chapters.map(chapter => `
                                            <div class="chapter-item" onclick="VideoSystem.seekToTime('${chapter.time}')">
                                                <span class="chapter-time">${chapter.time}</span>
                                                <span class="chapter-title">${chapter.title}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // 初始化视频播放器
                this.initVideoPlayer();
            },

            initVideoPlayer() {
                const videoElement = document.getElementById('videoPlayer');
                if (!videoElement) return;

                // 使用Video.js初始化播放器
                if (typeof videojs !== 'undefined') {
                    const player = videojs(videoElement, {
                        controls: true,
                        autoplay: false,
                        preload: 'auto',
                        fluid: true,
                        responsive: true,
                        playbackRates: [0.5, 0.75, 1, 1.25, 1.5, 2],
                        controlBar: {
                            children: [
                                'playToggle',
                                'volumePanel',
                                'currentTimeDisplay',
                                'timeDivider',
                                'durationDisplay',
                                'progressControl',
                                'playbackRateMenuButton',
                                'qualitySelector',
                                'fullscreenToggle'
                            ]
                        }
                    });

                    APP_STATE.currentVideoPlayer = player;

                    // 添加事件监听
                    player.on('timeupdate', () => {
                        this.updateProgress(player.currentTime(), player.duration());
                    });

                    player.on('ended', () => {
                        this.onVideoEnded();
                    });

                    // 添加键盘快捷键
                    document.addEventListener('keydown', (e) => {
                        if (e.target.tagName === 'INPUT') return;
                        
                        switch (e.code) {
                            case 'Space':
                                e.preventDefault();
                                if (player.paused()) {
                                    player.play();
                                } else {
                                    player.pause();
                                }
                                break;
                            case 'ArrowLeft':
                                e.preventDefault();
                                player.currentTime(player.currentTime() - 10);
                                break;
                            case 'ArrowRight':
                                e.preventDefault();
                                player.currentTime(player.currentTime() + 10);
                                break;
                            case 'ArrowUp':
                                e.preventDefault();
                                player.volume(Math.min(player.volume() + 0.1, 1));
                                break;
                            case 'ArrowDown':
                                e.preventDefault();
                                player.volume(Math.max(player.volume() - 0.1, 0));
                                break;
                        }
                    });
                }
            },

            seekToTime(timeString) {
                const player = APP_STATE.currentVideoPlayer;
                if (!player) return;

                const time = this.parseTimeString(timeString);
                if (time !== null) {
                    player.currentTime(time);
                }
            },

            parseTimeString(timeString) {
                const parts = timeString.split(':').map(Number);
                if (parts.length === 2) {
                    return parts[0] * 60 + parts[1];
                } else if (parts.length === 3) {
                    return parts[0] * 3600 + parts[1] * 60 + parts[2];
                }
                return null;
            },

            updateProgress(currentTime, duration) {
                // 更新进度显示
                const progress = (currentTime / duration) * 100;
                // 这里可以添加进度条更新逻辑
            },

            onVideoEnded() {
                MessageSystem.show('视频播放完成！', 'success');
                // 这里可以添加播放完成后的逻辑，比如自动播放下一个视频
            }
        };

        // AI助手系统
        const AISystem = {
            init() {
                const container = document.querySelector('.ai-assistant-container');
                if (!container) return;

                container.innerHTML = `
                    <div class="ai-chat-interface">
                        <div class="ai-header">
                            <div class="ai-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="ai-info">
                                <h3>流体力学AI助手</h3>
                                <p>智能问答，专业解答</p>
                            </div>
                            <div class="ai-status">
                                <span class="status-indicator online"></span>
                                <span>在线</span>
                            </div>
                        </div>
                        <div class="ai-chat-messages" id="chatMessages">
                            <div class="message ai-message">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-text">
                                        您好！我是流体力学AI助手，很高兴为您服务。我可以帮助您：
                                        <ul>
                                            <li>解答流体力学相关问题</li>
                                            <li>解释公式和概念</li>
                                            <li>提供学习建议</li>
                                            <li>分析题目和计算</li>
                                        </ul>
                                        请随时向我提问！
                                    </div>
                                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                                </div>
                            </div>
                        </div>
                        <div class="ai-chat-input">
                            <div class="input-container">
                                <textarea id="chatInput" class="form-control" placeholder="请输入您的问题..." rows="2"></textarea>
                                <button id="sendMessage" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div class="quick-questions">
                                <button class="quick-question" onclick="AISystem.askQuickQuestion('什么是伯努利方程？')">
                                    什么是伯努利方程？
                                </button>
                                <button class="quick-question" onclick="AISystem.askQuickQuestion('如何计算雷诺数？')">
                                    如何计算雷诺数？
                                </button>
                                <button class="quick-question" onclick="AISystem.askQuickQuestion('流体的粘性是什么？')">
                                    流体的粘性是什么？
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                this.addChatEventListeners();
            },

            addChatEventListeners() {
                const chatInput = document.getElementById('chatInput');
                const sendButton = document.getElementById('sendMessage');

                if (chatInput && sendButton) {
                    // 发送按钮点击事件
                    sendButton.addEventListener('click', () => {
                        this.sendMessage();
                    });

                    // 回车发送消息
                    chatInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });

                    // 自动调整文本框高度
                    chatInput.addEventListener('input', () => {
                        chatInput.style.height = 'auto';
                        chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
                    });
                }
            },

            sendMessage() {
                const chatInput = document.getElementById('chatInput');
                const message = chatInput.value.trim();

                if (!message) return;

                // 添加用户消息
                this.addMessage(message, 'user');
                chatInput.value = '';
                chatInput.style.height = 'auto';

                // 显示AI正在输入状态
                this.showTypingIndicator();

                // 模拟AI响应延迟
                setTimeout(() => {
                    this.hideTypingIndicator();
                    const response = this.generateAIResponse(message);
                    this.addMessage(response, 'ai');
                }, 1000 + Math.random() * 2000);
            },

            askQuickQuestion(question) {
                const chatInput = document.getElementById('chatInput');
                if (chatInput) {
                    chatInput.value = question;
                    this.sendMessage();
                }
            },

            addMessage(content, sender) {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message`;
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-${sender === 'ai' ? 'robot' : 'user'}"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-text">${this.formatMessage(content)}</div>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;

                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            },

            formatMessage(content) {
                // 简单的消息格式化，支持换行和基本HTML
                return content
                    .replace(/\n/g, '<br>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code>$1</code>');
            },

            showTypingIndicator() {
                const chatMessages = document.getElementById('chatMessages');
                if (!chatMessages) return;

                const typingDiv = document.createElement('div');
                typingDiv.className = 'message ai-message typing';
                typingDiv.id = 'typingIndicator';
                typingDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                `;

                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            },

            hideTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            },

            generateAIResponse(userMessage) {
                const message = userMessage.toLowerCase();
                
                // 基于关键词的简单响应系统
                if (message.includes('伯努利') || message.includes('bernoulli')) {
                    return this.getBernoulliResponse();
                } else if (message.includes('雷诺') || message.includes('reynolds')) {
                    return this.getReynoldsResponse();
                } else if (message.includes('粘性') || message.includes('viscosity')) {
                    return this.getViscosityResponse();
                } else if (message.includes('密度') || message.includes('density')) {
                    return this.getDensityResponse();
                } else if (message.includes('压力') || message.includes('pressure')) {
                    return this.getPressureResponse();
                } else if (message.includes('流量') || message.includes('flow rate')) {
                    return this.getFlowRateResponse();
                } else if (message.includes('湍流') || message.includes('turbulence')) {
                    return this.getTurbulenceResponse();
                } else if (message.includes('层流') || message.includes('laminar')) {
                    return this.getLaminarResponse();
                } else if (message.includes('边界层') || message.includes('boundary layer')) {
                    return this.getBoundaryLayerResponse();
                } else if (message.includes('公式') || message.includes('equation')) {
                    return this.getFormulaResponse();
                } else if (message.includes('计算') || message.includes('calculate')) {
                    return this.getCalculationResponse();
                } else if (message.includes('学习') || message.includes('study')) {
                    return this.getStudyAdviceResponse();
                } else {
                    return this.getGeneralResponse();
                }
            },

            getBernoulliResponse() {
                return `
                    <strong>伯努利方程</strong>是流体力学中的重要方程，描述了理想流体稳定流动中的能量守恒。

                    <strong>方程形式：</strong>
                    p + 1/2ρv² + ρgh = 常数

                    <strong>各项含义：</strong>
                    • p：静压力
                    • 1/2ρv²：动压力（动能）
                    • ρgh：位压力（势能）

                    <strong>应用场景：</strong>
                    • 管道流动分析
                    • 翼型升力计算
                    • 文丘里管流量测量
                    • 皮托管速度测量

                    <strong>注意事项：</strong>
                    • 仅适用于理想流体
                    • 要求稳定流动
                    • 忽略粘性效应
                `;
            },

            getReynoldsResponse() {
                return `
                    <strong>雷诺数</strong>是判断流体流动状态的重要无量纲参数。

                    <strong>计算公式：</strong>
                    Re = ρVD/μ

                    <strong>参数说明：</strong>
                    • ρ：流体密度 (kg/m³)
                    • V：特征速度 (m/s)
                    • D：特征长度 (m)
                    • μ：动力粘性系数 (Pa·s)

                    <strong>流动状态判断：</strong>
                    • Re < 2300：层流
                    • 2300 ≤ Re ≤ 4000：过渡流
                    • Re > 4000：湍流

                    <strong>应用意义：</strong>
                    • 确定流动类型
                    • 选择计算方法
                    • 设计实验条件
                `;
            },

            getViscosityResponse() {
                return `
                    <strong>粘性</strong>是流体抵抗剪切变形的能力，反映了流体内部的摩擦力。

                    <strong>牛顿粘性定律：</strong>
                    τ = μ(du/dy)

                    <strong>参数说明：</strong>
                    • τ：剪切应力 (Pa)
                    • μ：动力粘性系数 (Pa·s)
                    • du/dy：速度梯度 (1/s)

                    <strong>粘性分类：</strong>
                    • 牛顿流体：μ为常数
                    • 非牛顿流体：μ随剪切率变化

                    <strong>影响因素：</strong>
                    • 温度：液体粘性随温度升高而降低
                    • 压力：对液体影响较小
                    • 流体性质：不同流体粘性差异很大

                    <strong>常见流体粘性：</strong>
                    • 水 (20°C)：1.002×10⁻³ Pa·s
                    • 空气 (20°C)：1.81×10⁻⁵ Pa·s
                    • 机油：0.1-1 Pa·s
                `;
            },

            getDensityResponse() {
                return `
                    <strong>密度</strong>是单位体积物质的质量，是流体的基本物理性质。

                    <strong>定义公式：</strong>
                    ρ = m/V

                    <strong>单位：</strong>
                    kg/m³ (国际单位)

                    <strong>常见流体密度：</strong>
                    • 水 (4°C)：1000 kg/m³
                    • 水 (20°C)：998 kg/m³
                    • 空气 (标准状态)：1.225 kg/m³
                    • 水银：13600 kg/m³
                    • 油：800-900 kg/m³

                    <strong>影响因素：</strong>
                    • 温度：大多数流体密度随温度升高而降低
                    • 压力：对液体影响较小，对气体影响显著
                    • 成分：不同成分的混合物密度不同

                    <strong>应用：</strong>
                    • 浮力计算
                    • 压力计算
                    • 流量计算
                    • 能量计算
                `;
            },

            getPressureResponse() {
                return `
                    <strong>压力</strong>是流体对单位面积的作用力，是流体力学中的核心概念。

                    <strong>定义：</strong>
                    p = F/A

                    <strong>单位：</strong>
                    Pa (帕斯卡) = N/m²

                    <strong>压力类型：</strong>
                    • 静压力：流体静止时的压力
                    • 动压力：流体运动产生的压力
                    • 总压力：静压力与动压力之和

                    <strong>静压力分布：</strong>
                    p = p₀ + ρgh

                    <strong>测量方法：</strong>
                    • 压力表
                    • 压力传感器
                    • U型管压力计
                    • 皮托管

                    <strong>应用：</strong>
                    • 管道设计
                    • 泵的选择
                    • 阀门设计
                    • 安全系统
                `;
            },

            getFlowRateResponse() {
                return `
                    <strong>流量</strong>是单位时间内通过某一截面的流体体积或质量。

                    <strong>体积流量：</strong>
                    Q = A·V

                    <strong>质量流量：</strong>
                    ṁ = ρ·Q = ρ·A·V

                    <strong>参数说明：</strong>
                    • Q：体积流量 (m³/s)
                    • ṁ：质量流量 (kg/s)
                    • A：截面积 (m²)
                    • V：平均速度 (m/s)
                    • ρ：流体密度 (kg/m³)

                    <strong>连续性方程：</strong>
                    对于不可压缩流体：Q₁ = Q₂
                    即：A₁V₁ = A₂V₂

                    <strong>测量方法：</strong>
                    • 文丘里管
                    • 孔板流量计
                    • 涡轮流量计
                    • 电磁流量计

                    <strong>应用：</strong>
                    • 管道设计
                    • 泵的选型
                    • 流量控制
                    • 能量计算
                `;
            },

            getTurbulenceResponse() {
                return `
                    <strong>湍流</strong>是流体的一种复杂流动状态，具有随机性和不规则性。

                    <strong>特征：</strong>
                    • 速度脉动
                    • 涡旋结构
                    • 能量耗散
                    • 混合增强

                    <strong>产生条件：</strong>
                    • 雷诺数足够大
                    • 存在扰动源
                    • 边界条件不稳定

                    <strong>湍流模型：</strong>
                    • k-ε模型
                    • k-ω模型
                    • RSM模型
                    • LES方法

                    <strong>工程应用：</strong>
                    • 传热传质
                    • 燃烧过程
                    • 混合过程
                    • 阻力计算

                    <strong>控制方法：</strong>
                    • 流线型设计
                    • 表面处理
                    • 添加剂
                    • 主动控制
                `;
            },

            getLaminarResponse() {
                return `
                    <strong>层流</strong>是流体的一种有序流动状态，流体质点沿平行层运动。

                    <strong>特征：</strong>
                    • 流线平行
                    • 无横向混合
                    • 速度分布规则
                    • 能量损失小

                    <strong>产生条件：</strong>
                    • 雷诺数较小
                    • 流动稳定
                    • 无强烈扰动

                    <strong>速度分布：</strong>
                    圆管层流：u = (Δp/4μL)(R²-r²)

                    <strong>流量计算：</strong>
                    圆管层流：Q = (πΔpR⁴)/(8μL)

                    <strong>应用：</strong>
                    • 微流体
                    • 精密测量
                    • 生物医学
                    • 润滑系统

                    <strong>优缺点：</strong>
                    优点：计算简单，能量损失小
                    缺点：传热传质能力差
                `;
            },

            getBoundaryLayerResponse() {
                return `
                    <strong>边界层</strong>是靠近固体壁面的薄层流体，其中粘性效应显著。

                    <strong>特征：</strong>
                    • 厚度随距离增加
                    • 速度梯度很大
                    • 粘性效应重要
                    • 外部为势流

                    <strong>边界层厚度：</strong>
                    δ ≈ 5√(νx/U)

                    <strong>参数说明：</strong>
                    • δ：边界层厚度
                    • ν：运动粘性系数
                    • x：距离前缘的距离
                    • U：外部流速

                    <strong>边界层类型：</strong>
                    • 层流边界层
                    • 湍流边界层
                    • 混合边界层

                    <strong>分离现象：</strong>
                    • 逆压梯度
                    • 壁面摩擦
                    • 流动分离
                    • 阻力增加

                    <strong>控制方法：</strong>
                    • 流线型设计
                    • 表面处理
                    • 抽吸/吹除
                    • 涡流发生器
                `;
            },

            getFormulaResponse() {
                return `
                    <strong>流体力学主要公式：</strong>

                    <strong>1. 连续性方程：</strong>
                    ∂ρ/∂t + ∇·(ρv) = 0

                    <strong>2. 伯努利方程：</strong>
                    p + 1/2ρv² + ρgh = 常数

                    <strong>3. 纳维-斯托克斯方程：</strong>
                    ρ(Dv/Dt) = -∇p + μ∇²v + ρg

                    <strong>4. 雷诺数：</strong>
                    Re = ρVD/μ

                    <strong>5. 达西-魏斯巴赫公式：</strong>
                    hf = f(L/D)(v²/2g)

                    <strong>6. 流量公式：</strong>
                    Q = A·V

                    <strong>7. 压力公式：</strong>
                    p = F/A

                    <strong>8. 密度公式：</strong>
                    ρ = m/V

                    <strong>9. 粘性定律：</strong>
                    τ = μ(du/dy)

                    <strong>10. 浮力公式：</strong>
                    Fb = ρgV
                `;
            },

            getCalculationResponse() {
                return `
                    <strong>流体力学计算步骤：</strong>

                    <strong>1. 问题分析：</strong>
                    • 确定流动类型
                    • 识别已知条件
                    • 明确求解目标

                    <strong>2. 选择方程：</strong>
                    • 连续性方程
                    • 伯努利方程
                    • 动量方程
                    • 能量方程

                    <strong>3. 计算步骤：</strong>
                    • 单位统一
                    • 参数代入
                    • 方程求解
                    • 结果验证

                    <strong>4. 常见计算：</strong>
                    • 流量计算
                    • 压力计算
                    • 速度计算
                    • 阻力计算

                    <strong>5. 注意事项：</strong>
                    • 单位一致性
                    • 精度要求
                    • 物理合理性
                    • 边界条件
                `;
            },

            getStudyAdviceResponse() {
                return `
                    <strong>流体力学学习建议：</strong>

                    <strong>1. 基础概念：</strong>
                    • 掌握基本定义
                    • 理解物理意义
                    • 熟悉单位系统

                    <strong>2. 数学基础：</strong>
                    • 微积分
                    • 向量分析
                    • 微分方程
                    • 数值方法

                    <strong>3. 学习方法：</strong>
                    • 理论结合实践
                    • 多做练习题
                    • 理解物理图像
                    • 掌握推导过程

                    <strong>4. 重点章节：</strong>
                    • 流体静力学
                    • 伯努利方程
                    • 动量方程
                    • 边界层理论

                    <strong>5. 实践应用：</strong>
                    • 实验观察
                    • 数值模拟
                    • 工程应用
                    • 案例分析
                `;
            },

                         getGeneralResponse() {
                 const responses = [
                     "这是一个很好的问题！让我为您详细解答...",
                     "在流体力学中，这个问题涉及到几个重要概念...",
                     "根据流体力学的基本原理，我们可以这样理解...",
                     "这个问题可以从多个角度来分析...",
                     "让我为您提供一个系统的解答...",
                     "在工程应用中，这个问题非常重要...",
                     "从理论角度来看，这个问题涉及...",
                     "根据实验和理论分析，我们可以得出...",
                     "这个问题在流体力学中具有典型性...",
                     "让我结合实例为您解释这个问题..."
                 ];
                 
                 return responses[Math.floor(Math.random() * responses.length)] + 
                        "\n\n如果您需要更具体的解答，请提供更多细节，我会为您提供更精确的答案。";
             }
         };

        // 上传系统
        const UploadSystem = {
            init() {
                const container = document.querySelector('.upload-container');
                if (!container) return;

                container.innerHTML = `
                    <div class="upload-interface">
                        <div class="upload-header">
                            <h2>文件上传中心</h2>
                            <p>支持视频、文档、图片等多种格式文件上传</p>
                        </div>
                        
                        <div class="upload-tabs">
                            <button class="tab-btn active" data-tab="video" onclick="UploadSystem.switchTab('video')">
                                <i class="fas fa-video"></i> 视频上传
                            </button>
                            <button class="tab-btn" data-tab="document" onclick="UploadSystem.switchTab('document')">
                                <i class="fas fa-file-alt"></i> 文档上传
                            </button>
                            <button class="tab-btn" data-tab="image" onclick="UploadSystem.switchTab('image')">
                                <i class="fas fa-image"></i> 图片上传
                            </button>
                            <button class="tab-btn" data-tab="batch" onclick="UploadSystem.switchTab('batch')">
                                <i class="fas fa-folder-open"></i> 批量上传
                            </button>
                        </div>

                        <div class="upload-content">
                            <!-- 视频上传 -->
                            <div class="upload-panel active" id="videoPanel">
                                <div class="upload-area" id="videoUploadArea">
                                    <div class="upload-icon">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <h3>拖拽视频文件到此处</h3>
                                    <p>或点击选择文件</p>
                                    <input type="file" id="videoFileInput" accept="video/*" multiple style="display: none;">
                                    <button class="btn btn-primary" onclick="document.getElementById('videoFileInput').click()">
                                        选择视频文件
                                    </button>
                                    <div class="supported-formats">
                                        <p>支持的格式：MP4, AVI, MOV, WMV, FLV, WebM</p>
                                        <p>最大文件大小：500MB</p>
                                    </div>
                                </div>
                                <div class="upload-settings">
                                    <h4>上传设置</h4>
                                    <div class="setting-group">
                                        <label class="form-check">
                                            <input type="checkbox" id="autoCompress" checked>
                                            <span>自动压缩</span>
                                        </label>
                                        <label class="form-check">
                                            <input type="checkbox" id="generateThumbnail" checked>
                                            <span>生成缩略图</span>
                                        </label>
                                        <label class="form-check">
                                            <input type="checkbox" id="extractAudio">
                                            <span>提取音频</span>
                                        </label>
                                    </div>
                                    <div class="quality-settings">
                                        <label>视频质量：</label>
                                        <select class="form-control" id="videoQuality">
                                            <option value="high">高质量</option>
                                            <option value="medium" selected>中等质量</option>
                                            <option value="low">低质量</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- 文档上传 -->
                            <div class="upload-panel" id="documentPanel">
                                <div class="upload-area" id="documentUploadArea">
                                    <div class="upload-icon">
                                        <i class="fas fa-file-upload"></i>
                                    </div>
                                    <h3>拖拽文档文件到此处</h3>
                                    <p>或点击选择文件</p>
                                    <input type="file" id="documentFileInput" accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt" multiple style="display: none;">
                                    <button class="btn btn-primary" onclick="document.getElementById('documentFileInput').click()">
                                        选择文档文件
                                    </button>
                                    <div class="supported-formats">
                                        <p>支持的格式：PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, TXT</p>
                                        <p>最大文件大小：100MB</p>
                                    </div>
                                </div>
                                <div class="upload-settings">
                                    <h4>文档处理</h4>
                                    <div class="setting-group">
                                        <label class="form-check">
                                            <input type="checkbox" id="extractText" checked>
                                            <span>提取文本</span>
                                        </label>
                                        <label class="form-check">
                                            <input type="checkbox" id="generateSummary">
                                            <span>生成摘要</span>
                                        </label>
                                        <label class="form-check">
                                            <input type="checkbox" id="ocrEnabled">
                                            <span>OCR识别</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- 图片上传 -->
                            <div class="upload-panel" id="imagePanel">
                                <div class="upload-area" id="imageUploadArea">
                                    <div class="upload-icon">
                                        <i class="fas fa-images"></i>
                                    </div>
                                    <h3>拖拽图片文件到此处</h3>
                                    <p>或点击选择文件</p>
                                    <input type="file" id="imageFileInput" accept="image/*" multiple style="display: none;">
                                    <button class="btn btn-primary" onclick="document.getElementById('imageFileInput').click()">
                                        选择图片文件
                                    </button>
                                    <div class="supported-formats">
                                        <p>支持的格式：JPG, PNG, GIF, BMP, TIFF, WebP</p>
                                        <p>最大文件大小：50MB</p>
                                    </div>
                                </div>
                                <div class="upload-settings">
                                    <h4>图片处理</h4>
                                    <div class="setting-group">
                                        <label class="form-check">
                                            <input type="checkbox" id="resizeImage" checked>
                                            <span>自动调整尺寸</span>
                                        </label>
                                        <label class="form-check">
                                            <input type="checkbox" id="compressImage" checked>
                                            <span>压缩图片</span>
                                        </label>
                                        <label class="form-check">
                                            <input type="checkbox" id="addWatermark">
                                            <span>添加水印</span>
                                        </label>
                                    </div>
                                    <div class="image-settings">
                                        <label>最大尺寸：</label>
                                        <select class="form-control" id="maxImageSize">
                                            <option value="1920x1080">1920×1080</option>
                                            <option value="1280x720" selected>1280×720</option>
                                            <option value="800x600">800×600</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- 批量上传 -->
                            <div class="upload-panel" id="batchPanel">
                                <div class="upload-area" id="batchUploadArea">
                                    <div class="upload-icon">
                                        <i class="fas fa-folder-plus"></i>
                                    </div>
                                    <h3>拖拽文件夹到此处</h3>
                                    <p>或点击选择文件夹</p>
                                    <input type="file" id="batchFileInput" webkitdirectory directory multiple style="display: none;">
                                    <button class="btn btn-primary" onclick="document.getElementById('batchFileInput').click()">
                                        选择文件夹
                                    </button>
                                    <div class="supported-formats">
                                        <p>支持批量上传多种格式文件</p>
                                        <p>最大总大小：2GB</p>
                                    </div>
                                </div>
                                <div class="batch-settings">
                                    <h4>批量处理设置</h4>
                                    <div class="setting-group">
                                        <label class="form-check">
                                            <input type="checkbox" id="batchCompress" checked>
                                            <span>批量压缩</span>
                                        </label>
                                        <label class="form-check">
                                            <input type="checkbox" id="batchRename">
                                            <span>批量重命名</span>
                                        </label>
                                        <label class="form-check">
                                            <input type="checkbox" id="batchOrganize">
                                            <span>自动整理</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="upload-progress" id="uploadProgress" style="display: none;">
                            <div class="progress-header">
                                <h4>上传进度</h4>
                                <button class="btn btn-ghost" onclick="UploadSystem.cancelUpload()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="progress-list" id="progressList">
                                <!-- 进度项将在这里动态添加 -->
                            </div>
                        </div>

                        <div class="upload-history">
                            <h4>最近上传</h4>
                            <div class="history-list" id="uploadHistory">
                                <!-- 历史记录将在这里显示 -->
                            </div>
                        </div>
                    </div>
                `;

                this.addUploadEventListeners();
                this.loadUploadHistory();
            },

            switchTab(tabName) {
                // 移除所有活动状态
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.upload-panel').forEach(panel => {
                    panel.classList.remove('active');
                });

                // 添加活动状态
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(`${tabName}Panel`).classList.add('active');
            },

            addUploadEventListeners() {
                // 视频上传
                this.setupFileUpload('videoFileInput', 'videoUploadArea', this.handleVideoUpload.bind(this));
                
                // 文档上传
                this.setupFileUpload('documentFileInput', 'documentUploadArea', this.handleDocumentUpload.bind(this));
                
                // 图片上传
                this.setupFileUpload('imageFileInput', 'imageUploadArea', this.handleImageUpload.bind(this));
                
                // 批量上传
                this.setupFileUpload('batchFileInput', 'batchUploadArea', this.handleBatchUpload.bind(this));

                // 拖拽上传
                this.setupDragAndDrop();
            },

            setupFileUpload(inputId, areaId, handler) {
                const input = document.getElementById(inputId);
                const area = document.getElementById(areaId);

                if (input) {
                    input.addEventListener('change', (e) => {
                        const files = Array.from(e.target.files);
                        handler(files);
                    });
                }

                if (area) {
                    area.addEventListener('click', () => {
                        input.click();
                    });
                }
            },

            setupDragAndDrop() {
                const uploadAreas = document.querySelectorAll('.upload-area');

                uploadAreas.forEach(area => {
                    area.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        area.classList.add('dragover');
                    });

                    area.addEventListener('dragleave', (e) => {
                        e.preventDefault();
                        area.classList.remove('dragover');
                    });

                    area.addEventListener('drop', (e) => {
                        e.preventDefault();
                        area.classList.remove('dragover');
                        
                        const files = Array.from(e.dataTransfer.files);
                        const panel = area.closest('.upload-panel');
                        
                        if (panel.id === 'videoPanel') {
                            this.handleVideoUpload(files);
                        } else if (panel.id === 'documentPanel') {
                            this.handleDocumentUpload(files);
                        } else if (panel.id === 'imagePanel') {
                            this.handleImageUpload(files);
                        } else if (panel.id === 'batchPanel') {
                            this.handleBatchUpload(files);
                        }
                    });
                });
            },

            handleVideoUpload(files) {
                const videoFiles = files.filter(file => file.type.startsWith('video/'));
                
                if (videoFiles.length === 0) {
                    MessageSystem.show('请选择有效的视频文件', 'warning');
                    return;
                }

                this.processFiles(videoFiles, 'video');
            },

            handleDocumentUpload(files) {
                const documentExtensions = ['.pdf', '.doc', '.docx', '.ppt', '.pptx', '.xls', '.xlsx', '.txt'];
                const documentFiles = files.filter(file => {
                    const extension = '.' + file.name.split('.').pop().toLowerCase();
                    return documentExtensions.includes(extension);
                });

                if (documentFiles.length === 0) {
                    MessageSystem.show('请选择有效的文档文件', 'warning');
                    return;
                }

                this.processFiles(documentFiles, 'document');
            },

            handleImageUpload(files) {
                const imageFiles = files.filter(file => file.type.startsWith('image/'));
                
                if (imageFiles.length === 0) {
                    MessageSystem.show('请选择有效的图片文件', 'warning');
                    return;
                }

                this.processFiles(imageFiles, 'image');
            },

            handleBatchUpload(files) {
                if (files.length === 0) {
                    MessageSystem.show('请选择有效的文件', 'warning');
                    return;
                }

                this.processFiles(files, 'batch');
            },

            processFiles(files, type) {
                const uploadQueue = files.map(file => ({
                    id: Utils.generateId(),
                    file: file,
                    type: type,
                    name: file.name,
                    size: file.size,
                    status: 'pending',
                    progress: 0,
                    startTime: Date.now()
                }));

                // 添加到全局上传队列
                APP_STATE.uploadQueue.push(...uploadQueue);

                // 显示进度面板
                this.showProgressPanel();
                this.updateProgressList();

                // 开始上传
                this.startUpload(uploadQueue);
            },

            showProgressPanel() {
                const progressPanel = document.getElementById('uploadProgress');
                if (progressPanel) {
                    progressPanel.style.display = 'block';
                }
            },

            updateProgressList() {
                const progressList = document.getElementById('progressList');
                if (!progressList) return;

                const queue = APP_STATE.uploadQueue;
                progressList.innerHTML = queue.map(item => `
                    <div class="progress-item" data-id="${item.id}">
                        <div class="progress-info">
                            <div class="file-info">
                                <i class="fas fa-${this.getFileIcon(item.type)}"></i>
                                <span class="file-name">${item.name}</span>
                                <span class="file-size">${Utils.formatFileSize(item.size)}</span>
                            </div>
                            <div class="progress-status">
                                <span class="status-text">${this.getStatusText(item.status)}</span>
                                <span class="progress-percentage">${item.progress}%</span>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${item.progress}%"></div>
                        </div>
                        <div class="progress-actions">
                            ${item.status === 'uploading' ? 
                                `<button class="btn btn-sm btn-warning" onclick="UploadSystem.pauseUpload('${item.id}')">
                                    <i class="fas fa-pause"></i>
                                </button>` : ''
                            }
                            ${item.status === 'paused' ? 
                                `<button class="btn btn-sm btn-success" onclick="UploadSystem.resumeUpload('${item.id}')">
                                    <i class="fas fa-play"></i>
                                </button>` : ''
                            }
                            <button class="btn btn-sm btn-danger" onclick="UploadSystem.removeUpload('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            },

            getFileIcon(type) {
                const icons = {
                    video: 'video',
                    document: 'file-alt',
                    image: 'image',
                    batch: 'folder'
                };
                return icons[type] || 'file';
            },

            getStatusText(status) {
                const statusTexts = {
                    pending: '等待中',
                    uploading: '上传中',
                    paused: '已暂停',
                    completed: '已完成',
                    failed: '上传失败'
                };
                return statusTexts[status] || '未知';
            },

            startUpload(uploadQueue) {
                uploadQueue.forEach(item => {
                    this.uploadFile(item);
                });
            },

            async uploadFile(item) {
                item.status = 'uploading';
                this.updateProgressList();

                try {
                    // 模拟上传过程
                    const totalChunks = Math.ceil(item.size / CONFIG.CHUNK_SIZE);
                    let uploadedChunks = 0;

                    for (let i = 0; i < totalChunks; i++) {
                        if (item.status === 'paused') {
                            return; // 暂停上传
                        }

                        // 模拟分块上传
                        await new Promise(resolve => {
                            setTimeout(() => {
                                uploadedChunks++;
                                item.progress = Math.round((uploadedChunks / totalChunks) * 100);
                                this.updateProgressList();
                                resolve();
                            }, 100 + Math.random() * 200);
                        });
                    }

                    // 上传完成
                    item.status = 'completed';
                    item.progress = 100;
                    this.updateProgressList();

                    // 处理文件
                    await this.processUploadedFile(item);

                    MessageSystem.show(`${item.name} 上传成功`, 'success');

                } catch (error) {
                    item.status = 'failed';
                    this.updateProgressList();
                    MessageSystem.show(`${item.name} 上传失败: ${error.message}`, 'error');
                }
            },

            async processUploadedFile(item) {
                // 根据文件类型进行不同的处理
                switch (item.type) {
                    case 'video':
                        await this.processVideo(item);
                        break;
                    case 'document':
                        await this.processDocument(item);
                        break;
                    case 'image':
                        await this.processImage(item);
                        break;
                    default:
                        await this.processGenericFile(item);
                }

                // 添加到历史记录
                this.addToHistory(item);
            },

            async processVideo(item) {
                // 模拟视频处理
                const settings = {
                    compress: document.getElementById('autoCompress')?.checked || false,
                    generateThumbnail: document.getElementById('generateThumbnail')?.checked || false,
                    extractAudio: document.getElementById('extractAudio')?.checked || false,
                    quality: document.getElementById('videoQuality')?.value || 'medium'
                };

                // 模拟处理时间
                await new Promise(resolve => setTimeout(resolve, 2000));

                // 这里可以添加实际的视频处理逻辑
                console.log('处理视频文件:', item.name, settings);
            },

            async processDocument(item) {
                // 模拟文档处理
                const settings = {
                    extractText: document.getElementById('extractText')?.checked || false,
                    generateSummary: document.getElementById('generateSummary')?.checked || false,
                    ocrEnabled: document.getElementById('ocrEnabled')?.checked || false
                };

                await new Promise(resolve => setTimeout(resolve, 1000));

                console.log('处理文档文件:', item.name, settings);
            },

            async processImage(item) {
                // 模拟图片处理
                const settings = {
                    resize: document.getElementById('resizeImage')?.checked || false,
                    compress: document.getElementById('compressImage')?.checked || false,
                    addWatermark: document.getElementById('addWatermark')?.checked || false,
                    maxSize: document.getElementById('maxImageSize')?.value || '1280x720'
                };

                await new Promise(resolve => setTimeout(resolve, 500));

                console.log('处理图片文件:', item.name, settings);
            },

            async processGenericFile(item) {
                await new Promise(resolve => setTimeout(resolve, 300));
                console.log('处理通用文件:', item.name);
            },

            pauseUpload(itemId) {
                const item = APP_STATE.uploadQueue.find(q => q.id === itemId);
                if (item) {
                    item.status = 'paused';
                    this.updateProgressList();
                }
            },

            resumeUpload(itemId) {
                const item = APP_STATE.uploadQueue.find(q => q.id === itemId);
                if (item && item.status === 'paused') {
                    this.uploadFile(item);
                }
            },

            removeUpload(itemId) {
                const index = APP_STATE.uploadQueue.findIndex(q => q.id === itemId);
                if (index !== -1) {
                    APP_STATE.uploadQueue.splice(index, 1);
                    this.updateProgressList();
                }
            },

            cancelUpload() {
                APP_STATE.uploadQueue = [];
                this.updateProgressList();
                document.getElementById('uploadProgress').style.display = 'none';
            },

            addToHistory(item) {
                const history = Utils.storage.get('uploadHistory') || [];
                const historyItem = {
                    id: item.id,
                    name: item.name,
                    type: item.type,
                    size: item.size,
                    uploadTime: new Date().toISOString(),
                    status: 'completed'
                };

                history.unshift(historyItem);
                
                // 只保留最近50条记录
                if (history.length > 50) {
                    history.splice(50);
                }

                Utils.storage.set('uploadHistory', history);
                this.loadUploadHistory();
            },

            loadUploadHistory() {
                const history = Utils.storage.get('uploadHistory') || [];
                const historyContainer = document.getElementById('uploadHistory');
                
                if (!historyContainer) return;

                if (history.length === 0) {
                    historyContainer.innerHTML = '<p class="no-history">暂无上传记录</p>';
                    return;
                }

                historyContainer.innerHTML = history.slice(0, 10).map(item => `
                    <div class="history-item">
                        <div class="history-icon">
                            <i class="fas fa-${this.getFileIcon(item.type)}"></i>
                        </div>
                        <div class="history-info">
                            <div class="history-name">${item.name}</div>
                            <div class="history-meta">
                                <span>${Utils.formatFileSize(item.size)}</span>
                                <span>${new Date(item.uploadTime).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="history-actions">
                            <button class="btn btn-sm btn-outline" onclick="UploadSystem.downloadFile('${item.id}')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="UploadSystem.deleteHistory('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            },

            downloadFile(itemId) {
                // 模拟下载
                MessageSystem.show('开始下载文件...', 'info');
            },

                         deleteHistory(itemId) {
                 const history = Utils.storage.get('uploadHistory') || [];
                 const index = history.findIndex(item => item.id === itemId);
                 
                 if (index !== -1) {
                     history.splice(index, 1);
                     Utils.storage.set('uploadHistory', history);
                     this.loadUploadHistory();
                     MessageSystem.show('记录已删除', 'success');
                 }
             }
         };

        // 用户资料系统
        const ProfileSystem = {
            loadProfile() {
                const container = document.querySelector('.profile-container');
                if (!container) return;

                const user = APP_STATE.currentUser;
                if (!user) {
                    container.innerHTML = '<p>请先登录</p>';
                    return;
                }

                container.innerHTML = `
                    <div class="profile-interface">
                        <div class="profile-header">
                            <div class="profile-avatar">
                                <img src="${user.avatar || '/images/default-avatar.jpg'}" alt="用户头像" id="profileAvatar">
                                <div class="avatar-upload">
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                                    <button class="btn btn-sm btn-outline" onclick="document.getElementById('avatarInput').click()">
                                        <i class="fas fa-camera"></i> 更换头像
                                    </button>
                                </div>
                            </div>
                            <div class="profile-info">
                                <h2>${user.name}</h2>
                                <p class="user-role">${user.role}</p>
                                <p class="user-email">${user.email}</p>
                                <div class="profile-stats">
                                    <div class="stat-item">
                                        <span class="stat-number">${user.studyHours || 0}</span>
                                        <span class="stat-label">学习时长(小时)</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number">${user.completedLessons || 0}</span>
                                        <span class="stat-label">完成课程</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number">${user.exerciseScore || 0}</span>
                                        <span class="stat-label">练习得分</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="profile-tabs">
                            <button class="tab-btn active" data-tab="basic" onclick="ProfileSystem.switchTab('basic')">
                                <i class="fas fa-user"></i> 基本信息
                            </button>
                            <button class="tab-btn" data-tab="security" onclick="ProfileSystem.switchTab('security')">
                                <i class="fas fa-shield-alt"></i> 安全设置
                            </button>
                            <button class="tab-btn" data-tab="preferences" onclick="ProfileSystem.switchTab('preferences')">
                                <i class="fas fa-cog"></i> 偏好设置
                            </button>
                            <button class="tab-btn" data-tab="achievements" onclick="ProfileSystem.switchTab('achievements')">
                                <i class="fas fa-trophy"></i> 成就记录
                            </button>
                            <button class="tab-btn" data-tab="activity" onclick="ProfileSystem.switchTab('activity')">
                                <i class="fas fa-chart-line"></i> 学习统计
                            </button>
                        </div>

                        <div class="profile-content">
                            <!-- 基本信息 -->
                            <div class="profile-panel active" id="basicPanel">
                                <form id="basicInfoForm" class="profile-form">
                                    <div class="form-group">
                                        <label>用户名</label>
                                        <input type="text" class="form-control" value="${user.username}" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>真实姓名</label>
                                        <input type="text" class="form-control" value="${user.name}" name="name">
                                    </div>
                                    <div class="form-group">
                                        <label>邮箱地址</label>
                                        <input type="email" class="form-control" value="${user.email}" name="email">
                                    </div>
                                    <div class="form-group">
                                        <label>手机号码</label>
                                        <input type="tel" class="form-control" value="${user.phone || ''}" name="phone">
                                    </div>
                                    <div class="form-group">
                                        <label>所在学校/机构</label>
                                        <input type="text" class="form-control" value="${user.institution || ''}" name="institution">
                                    </div>
                                    <div class="form-group">
                                        <label>专业/研究方向</label>
                                        <input type="text" class="form-control" value="${user.major || ''}" name="major">
                                    </div>
                                    <div class="form-group">
                                        <label>个人简介</label>
                                        <textarea class="form-control" rows="4" name="bio">${user.bio || ''}</textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">保存修改</button>
                                        <button type="reset" class="btn btn-secondary">重置</button>
                                    </div>
                                </form>
                            </div>

                            <!-- 安全设置 -->
                            <div class="profile-panel" id="securityPanel">
                                <div class="security-settings">
                                    <div class="security-item">
                                        <div class="security-info">
                                            <h4>修改密码</h4>
                                            <p>定期更换密码可以提高账户安全性</p>
                                        </div>
                                        <button class="btn btn-outline" onclick="ProfileSystem.showChangePassword()">
                                            修改密码
                                        </button>
                                    </div>
                                    <div class="security-item">
                                        <div class="security-info">
                                            <h4>两步验证</h4>
                                            <p>启用两步验证可以进一步提高账户安全性</p>
                                        </div>
                                        <label class="form-switch">
                                            <input type="checkbox" ${user.twoFactorEnabled ? 'checked' : ''}>
                                            <span class="switch-slider"></span>
                                        </label>
                                    </div>
                                    <div class="security-item">
                                        <div class="security-info">
                                            <h4>登录设备管理</h4>
                                            <p>查看和管理当前登录的设备</p>
                                        </div>
                                        <button class="btn btn-outline" onclick="ProfileSystem.showDeviceManagement()">
                                            管理设备
                                        </button>
                                    </div>
                                    <div class="security-item">
                                        <div class="security-info">
                                            <h4>账户注销</h4>
                                            <p>永久删除账户及其所有数据</p>
                                        </div>
                                        <button class="btn btn-danger" onclick="ProfileSystem.showDeleteAccount()">
                                            注销账户
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 偏好设置 -->
                            <div class="profile-panel" id="preferencesPanel">
                                <div class="preferences-settings">
                                    <div class="preference-group">
                                        <h4>界面设置</h4>
                                        <div class="preference-item">
                                            <label>主题模式</label>
                                            <select class="form-control" id="themeSelect">
                                                <option value="auto">跟随系统</option>
                                                <option value="light">浅色模式</option>
                                                <option value="dark">深色模式</option>
                                            </select>
                                        </div>
                                        <div class="preference-item">
                                            <label>语言设置</label>
                                            <select class="form-control" id="languageSelect">
                                                <option value="zh-CN">简体中文</option>
                                                <option value="en-US">English</option>
                                            </select>
                                        </div>
                                        <div class="preference-item">
                                            <label>字体大小</label>
                                            <select class="form-control" id="fontSizeSelect">
                                                <option value="small">小</option>
                                                <option value="medium" selected>中</option>
                                                <option value="large">大</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="preference-group">
                                        <h4>学习设置</h4>
                                        <div class="preference-item">
                                            <label class="form-check">
                                                <input type="checkbox" id="autoSave" checked>
                                                <span>自动保存学习进度</span>
                                            </label>
                                        </div>
                                        <div class="preference-item">
                                            <label class="form-check">
                                                <input type="checkbox" id="showHints" checked>
                                                <span>显示学习提示</span>
                                            </label>
                                        </div>
                                        <div class="preference-item">
                                            <label class="form-check">
                                                <input type="checkbox" id="enableNotifications" checked>
                                                <span>启用通知</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="preference-group">
                                        <h4>隐私设置</h4>
                                        <div class="preference-item">
                                            <label class="form-check">
                                                <input type="checkbox" id="publicProfile" checked>
                                                <span>公开个人资料</span>
                                            </label>
                                        </div>
                                        <div class="preference-item">
                                            <label class="form-check">
                                                <input type="checkbox" id="showProgress" checked>
                                                <span>显示学习进度</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-actions">
                                        <button class="btn btn-primary" onclick="ProfileSystem.savePreferences()">
                                            保存设置
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 成就记录 -->
                            <div class="profile-panel" id="achievementsPanel">
                                <div class="achievements-grid">
                                    ${this.renderAchievements()}
                                </div>
                            </div>

                            <!-- 学习统计 -->
                            <div class="profile-panel" id="activityPanel">
                                <div class="activity-stats">
                                    <div class="stats-overview">
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-clock"></i>
                                            </div>
                                            <div class="stat-content">
                                                <h3>${user.totalStudyTime || 0}</h3>
                                                <p>总学习时长(小时)</p>
                                            </div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-book"></i>
                                            </div>
                                            <div class="stat-content">
                                                <h3>${user.completedLessons || 0}</h3>
                                                <p>完成课程数</p>
                                            </div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-tasks"></i>
                                            </div>
                                            <div class="stat-content">
                                                <h3>${user.completedExercises || 0}</h3>
                                                <p>完成练习数</p>
                                            </div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <div class="stat-content">
                                                <h3>${user.averageScore || 0}</h3>
                                                <p>平均得分</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="activity-chart">
                                        <canvas id="activityChart" width="400" height="200"></canvas>
                                    </div>
                                    <div class="recent-activities">
                                        <h4>最近活动</h4>
                                        <div class="activity-list">
                                            ${this.renderRecentActivities()}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                this.addProfileEventListeners();
                this.loadUserPreferences();
                this.initActivityChart();
            },

            switchTab(tabName) {
                // 移除所有活动状态
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.profile-panel').forEach(panel => {
                    panel.classList.remove('active');
                });

                // 添加活动状态
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(`${tabName}Panel`).classList.add('active');
            },

            addProfileEventListeners() {
                // 头像上传
                const avatarInput = document.getElementById('avatarInput');
                if (avatarInput) {
                    avatarInput.addEventListener('change', (e) => {
                        this.handleAvatarUpload(e.target.files[0]);
                    });
                }

                // 基本信息表单
                const basicInfoForm = document.getElementById('basicInfoForm');
                if (basicInfoForm) {
                    basicInfoForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveBasicInfo();
                    });
                }
            },

            handleAvatarUpload(file) {
                if (!file) return;

                if (!file.type.startsWith('image/')) {
                    MessageSystem.show('请选择有效的图片文件', 'error');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) { // 5MB
                    MessageSystem.show('图片文件大小不能超过5MB', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const avatar = document.getElementById('profileAvatar');
                    if (avatar) {
                        avatar.src = e.target.result;
                    }
                    MessageSystem.show('头像更新成功', 'success');
                };
                reader.readAsDataURL(file);
            },

            saveBasicInfo() {
                const form = document.getElementById('basicInfoForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                // 更新用户信息
                Object.assign(APP_STATE.currentUser, data);
                Utils.storage.set('currentUser', APP_STATE.currentUser);

                MessageSystem.show('基本信息保存成功', 'success');
            },

            showChangePassword() {
                ModalSystem.show({
                    title: '修改密码',
                    content: `
                        <form id="changePasswordForm">
                            <div class="form-group">
                                <label>当前密码</label>
                                <input type="password" class="form-control" name="currentPassword" required>
                            </div>
                            <div class="form-group">
                                <label>新密码</label>
                                <input type="password" class="form-control" name="newPassword" required>
                            </div>
                            <div class="form-group">
                                <label>确认新密码</label>
                                <input type="password" class="form-control" name="confirmPassword" required>
                            </div>
                        </form>
                    `,
                    buttons: [
                        {
                            text: '取消',
                            type: 'secondary',
                            onClick: 'ModalSystem.close()'
                        },
                        {
                            text: '确认修改',
                            type: 'primary',
                            onClick: () => {
                                this.changePassword();
                            }
                        }
                    ]
                });
            },

            changePassword() {
                const form = document.getElementById('changePasswordForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                if (data.newPassword !== data.confirmPassword) {
                    MessageSystem.show('两次输入的新密码不一致', 'error');
                    return;
                }

                if (data.newPassword.length < 6) {
                    MessageSystem.show('新密码长度不能少于6位', 'error');
                    return;
                }

                // 模拟密码修改
                MessageSystem.show('密码修改成功', 'success');
                ModalSystem.close();
            },

            showDeviceManagement() {
                const devices = [
                    { id: 1, name: 'Chrome on Windows', location: '北京', lastActive: '2024-01-15 14:30' },
                    { id: 2, name: 'Safari on iPhone', location: '上海', lastActive: '2024-01-14 09:15' }
                ];

                ModalSystem.show({
                    title: '登录设备管理',
                    content: `
                        <div class="device-list">
                            ${devices.map(device => `
                                <div class="device-item">
                                    <div class="device-info">
                                        <div class="device-name">${device.name}</div>
                                        <div class="device-meta">
                                            <span>${device.location}</span>
                                            <span>最后活跃：${device.lastActive}</span>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-danger" onclick="ProfileSystem.removeDevice(${device.id})">
                                        移除
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    `,
                    buttons: [
                        {
                            text: '关闭',
                            type: 'primary',
                            onClick: 'ModalSystem.close()'
                        }
                    ]
                });
            },

            removeDevice(deviceId) {
                MessageSystem.show('设备已移除', 'success');
            },

            showDeleteAccount() {
                ModalSystem.confirm(
                    '确定要注销账户吗？此操作不可逆，所有数据将被永久删除。',
                    () => {
                        MessageSystem.show('账户注销功能正在开发中', 'info');
                    }
                );
            },

            renderAchievements() {
                const achievements = [
                    { id: 1, name: '初学者', description: '完成第一个课程', icon: 'fas fa-star', unlocked: true },
                    { id: 2, name: '勤奋学习者', description: '连续学习7天', icon: 'fas fa-calendar-check', unlocked: true },
                    { id: 3, name: '练习达人', description: '完成100道练习题', icon: 'fas fa-tasks', unlocked: false },
                    { id: 4, name: '高分选手', description: '获得满分成绩', icon: 'fas fa-trophy', unlocked: false },
                    { id: 5, name: '视频达人', description: '观看50个视频', icon: 'fas fa-video', unlocked: false },
                    { id: 6, name: '知识探索者', description: '完成所有基础课程', icon: 'fas fa-graduation-cap', unlocked: false }
                ];

                return achievements.map(achievement => `
                    <div class="achievement-item ${achievement.unlocked ? 'unlocked' : 'locked'}">
                        <div class="achievement-icon">
                            <i class="${achievement.icon}"></i>
                        </div>
                        <div class="achievement-info">
                            <h4>${achievement.name}</h4>
                            <p>${achievement.description}</p>
                        </div>
                        <div class="achievement-status">
                            ${achievement.unlocked ? 
                                '<i class="fas fa-check-circle text-success"></i>' : 
                                '<i class="fas fa-lock text-muted"></i>'
                            }
                        </div>
                    </div>
                `).join('');
            },

            renderRecentActivities() {
                const activities = [
                    { type: 'study', title: '完成了"流体基础"第一章', time: '2小时前' },
                    { type: 'exercise', title: '完成了10道练习题', time: '4小时前' },
                    { type: 'video', title: '观看了"湍流理论"视频', time: '1天前' },
                    { type: 'achievement', title: '获得了"初学者"成就', time: '2天前' }
                ];

                return activities.map(activity => `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-${this.getActivityIcon(activity.type)}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-time">${activity.time}</div>
                        </div>
                    </div>
                `).join('');
            },

            getActivityIcon(type) {
                const icons = {
                    study: 'book',
                    exercise: 'tasks',
                    video: 'video',
                    achievement: 'trophy'
                };
                return icons[type] || 'circle';
            },

            loadUserPreferences() {
                const preferences = Utils.storage.get('userPreferences') || {};
                
                // 加载偏好设置
                if (preferences.theme) {
                    document.getElementById('themeSelect').value = preferences.theme;
                }
                if (preferences.language) {
                    document.getElementById('languageSelect').value = preferences.language;
                }
                if (preferences.fontSize) {
                    document.getElementById('fontSizeSelect').value = preferences.fontSize;
                }
                if (preferences.autoSave !== undefined) {
                    document.getElementById('autoSave').checked = preferences.autoSave;
                }
                if (preferences.showHints !== undefined) {
                    document.getElementById('showHints').checked = preferences.showHints;
                }
                if (preferences.enableNotifications !== undefined) {
                    document.getElementById('enableNotifications').checked = preferences.enableNotifications;
                }
            },

            savePreferences() {
                const preferences = {
                    theme: document.getElementById('themeSelect').value,
                    language: document.getElementById('languageSelect').value,
                    fontSize: document.getElementById('fontSizeSelect').value,
                    autoSave: document.getElementById('autoSave').checked,
                    showHints: document.getElementById('showHints').checked,
                    enableNotifications: document.getElementById('enableNotifications').checked,
                    publicProfile: document.getElementById('publicProfile').checked,
                    showProgress: document.getElementById('showProgress').checked
                };

                Utils.storage.set('userPreferences', preferences);
                MessageSystem.show('偏好设置保存成功', 'success');
            },

            initActivityChart() {
                const canvas = document.getElementById('activityChart');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                
                // 模拟学习数据
                const data = {
                    labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                    datasets: [{
                        label: '学习时长(小时)',
                        data: [2, 3, 1.5, 4, 2.5, 3.5, 1],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2
                    }]
                };

                // 如果有Chart.js库，使用它来绘制图表
                if (typeof Chart !== 'undefined') {
                    new Chart(ctx, {
                        type: 'line',
                        data: data,
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                } else {
                    // 简单的Canvas绘制
                    this.drawSimpleChart(ctx, data);
                }
            },

            drawSimpleChart(ctx, data) {
                const width = ctx.canvas.width;
                const height = ctx.canvas.height;
                const padding = 40;

                // 清空画布
                ctx.clearRect(0, 0, width, height);

                // 绘制坐标轴
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.stroke();

                // 绘制数据点
                const maxValue = Math.max(...data.datasets[0].data);
                const xStep = (width - 2 * padding) / (data.labels.length - 1);
                const yScale = (height - 2 * padding) / maxValue;

                ctx.strokeStyle = '#36a2eb';
                ctx.lineWidth = 2;
                ctx.beginPath();

                data.datasets[0].data.forEach((value, index) => {
                    const x = padding + index * xStep;
                    const y = height - padding - value * yScale;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });

                ctx.stroke();
            }
        };

        // 应用程序初始化
        const App = {
            init() {
                console.log('流体力学学习平台初始化中...');
                
                // 初始化DOM缓存
                DOM.init();
                
                // 检查登录状态
                this.checkLoginStatus();
                
                // 绑定事件监听器
                this.bindEventListeners();
                
                // 初始化工具函数
                this.initUtils();
                
                // 启动应用程序
                this.startApp();
                
                console.log('应用程序初始化完成');
            },

            checkLoginStatus() {
                const savedUser = Utils.storage.get('currentUser');
                const sessionStartTime = Utils.storage.get('sessionStartTime');
                
                if (savedUser && sessionStartTime) {
                    const sessionAge = Date.now() - sessionStartTime;
                    
                    if (sessionAge < CONFIG.SESSION_TIMEOUT) {
                        // 会话仍然有效
                        APP_STATE.currentUser = savedUser;
                        APP_STATE.isLoggedIn = true;
                        APP_STATE.sessionStartTime = sessionStartTime;
                        APP_STATE.lastActivityTime = Date.now();
                        
                        LoginSystem.showPlatform();
                    } else {
                        // 会话已过期
                        Utils.storage.remove('currentUser');
                        Utils.storage.remove('sessionStartTime');
                        MessageSystem.show('会话已过期，请重新登录', 'warning');
                    }
                }
            },

            bindEventListeners() {
                // 登录表单提交
                if (DOM.loginForm) {
                    DOM.loginForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        const username = DOM.username.value.trim();
                        const password = DOM.password.value.trim();
                        
                        if (!username || !password) {
                            MessageSystem.show('请输入用户名和密码', 'warning');
                            return;
                        }
                        
                        // 检查账户锁定
                        if (APP_STATE.lockoutEndTime && Date.now() < APP_STATE.lockoutEndTime) {
                            const remainingTime = Math.ceil((APP_STATE.lockoutEndTime - Date.now()) / 1000 / 60);
                            MessageSystem.show(`账户已被锁定，请${remainingTime}分钟后重试`, 'error');
                            return;
                        }
                        
                        // 显示加载状态
                        DOM.loginButton.disabled = true;
                        DOM.loginButtonText.style.display = 'none';
                        DOM.loginButtonSpinner.style.display = 'inline-block';
                        
                        try {
                            await LoginSystem.performLogin(username, password);
                        } catch (error) {
                            console.error('登录失败:', error);
                            MessageSystem.show('登录过程中发生错误', 'error');
                        } finally {
                            // 恢复按钮状态
                            DOM.loginButton.disabled = false;
                            DOM.loginButtonText.style.display = 'inline';
                            DOM.loginButtonSpinner.style.display = 'none';
                        }
                    });
                }

                // 登出按钮
                if (DOM.logoutBtn) {
                    DOM.logoutBtn.addEventListener('click', () => {
                        LoginSystem.logout();
                    });
                }

                // 侧边栏切换
                if (DOM.sidebarToggle) {
                    DOM.sidebarToggle.addEventListener('click', () => {
                        NavigationSystem.toggleSidebar();
                    });
                }

                if (DOM.sidebarClose) {
                    DOM.sidebarClose.addEventListener('click', () => {
                        NavigationSystem.closeSidebar();
                    });
                }

                // 导航链接
                DOM.navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = link.dataset.section;
                        if (section) {
                            NavigationSystem.showSection(section);
                        }
                    });
                });

                DOM.sidebarLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = link.dataset.section;
                        if (section) {
                            NavigationSystem.showSection(section);
                            NavigationSystem.closeSidebar();
                        }
                    });
                });

                // 点击外部关闭侧边栏
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#sidebar') && 
                        !e.target.closest('#sidebarToggle') && 
                        DOM.sidebar.classList.contains('open')) {
                        NavigationSystem.closeSidebar();
                    }
                });

                // 键盘快捷键
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + K: 搜索
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        this.showSearch();
                    }
                    
                    // Ctrl/Cmd + B: 切换侧边栏
                    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                        e.preventDefault();
                        NavigationSystem.toggleSidebar();
                    }
                    
                    // Escape: 关闭模态框
                    if (e.key === 'Escape') {
                        ModalSystem.close();
                    }
                });

                // 窗口大小变化
                window.addEventListener('resize', Utils.debounce(() => {
                    this.handleResize();
                }, 250));

                // 页面可见性变化
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        APP_STATE.lastActivityTime = Date.now();
                    }
                });

                // 在线/离线状态
                window.addEventListener('online', () => {
                    APP_STATE.isOffline = false;
                    MessageSystem.show('网络连接已恢复', 'success');
                });

                window.addEventListener('offline', () => {
                    APP_STATE.isOffline = true;
                    MessageSystem.show('网络连接已断开', 'warning');
                });
            },

            initUtils() {
                // 初始化网络状态检测
                Utils.network.checkOnline();
                
                // 初始化设备检测
                Utils.device.detect();
                
                // 设置自动保存定时器
                if (CONFIG.AUTO_SAVE_INTERVAL > 0) {
                    setInterval(() => {
                        this.autoSave();
                    }, CONFIG.AUTO_SAVE_INTERVAL);
                }
            },

            startApp() {
                // 隐藏加载屏幕
                setTimeout(() => {
                    if (DOM.loadingScreen) {
                        DOM.loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            DOM.loadingScreen.style.display = 'none';
                        }, 500);
                    }
                }, 1000);

                // 显示欢迎消息
                if (APP_STATE.isLoggedIn) {
                    MessageSystem.show(`欢迎回来，${APP_STATE.currentUser.name}！`, 'success');
                } else {
                    MessageSystem.show('欢迎使用流体力学学习平台', 'info');
                }

                // 启动会话监控
                this.startSessionMonitoring();
            },

            handleResize() {
                // 在小屏幕上自动关闭侧边栏
                if (window.innerWidth <= 768 && DOM.sidebar.classList.contains('open')) {
                    NavigationSystem.closeSidebar();
                }
            },

            showSearch() {
                ModalSystem.show({
                    title: '搜索',
                    content: `
                        <div class="search-interface">
                            <input type="text" class="form-control" id="globalSearch" placeholder="搜索课程、视频、练习题...">
                            <div class="search-results" id="searchResults">
                                <!-- 搜索结果将在这里显示 -->
                            </div>
                        </div>
                    `,
                    size: 'large',
                    buttons: [
                        {
                            text: '关闭',
                            type: 'secondary',
                            onClick: 'ModalSystem.close()'
                        }
                    ]
                });

                // 聚焦搜索框
                setTimeout(() => {
                    const searchInput = document.getElementById('globalSearch');
                    if (searchInput) {
                        searchInput.focus();
                        searchInput.addEventListener('input', Utils.debounce(() => {
                            this.performSearch(searchInput.value);
                        }, 300));
                    }
                }, 100);
            },

            performSearch(query) {
                if (!query.trim()) {
                    document.getElementById('searchResults').innerHTML = '';
                    return;
                }

                const results = [];
                const searchTerm = query.toLowerCase();

                // 搜索课程
                STUDY_MODULES.forEach(module => {
                    if (module.title.toLowerCase().includes(searchTerm) ||
                        module.description.toLowerCase().includes(searchTerm)) {
                        results.push({
                            type: 'course',
                            title: module.title,
                            description: module.description,
                            icon: 'fas fa-book',
                            action: () => {
                                NavigationSystem.showSection('study');
                                ModalSystem.close();
                            }
                        });
                    }
                });

                // 搜索练习题
                EXERCISES_DATA.categories.forEach(category => {
                    if (category.name.toLowerCase().includes(searchTerm) ||
                        category.description.toLowerCase().includes(searchTerm)) {
                        results.push({
                            type: 'exercise',
                            title: category.name,
                            description: category.description,
                            icon: 'fas fa-tasks',
                            action: () => {
                                NavigationSystem.showSection('exercises');
                                ModalSystem.close();
                            }
                        });
                    }
                });

                // 搜索视频
                VIDEOS_DATA.forEach(video => {
                    if (video.title.toLowerCase().includes(searchTerm) ||
                        video.description.toLowerCase().includes(searchTerm)) {
                        results.push({
                            type: 'video',
                            title: video.title,
                            description: video.description,
                            icon: 'fas fa-video',
                            action: () => {
                                NavigationSystem.showSection('videos');
                                ModalSystem.close();
                            }
                        });
                    }
                });

                this.displaySearchResults(results);
            },

            displaySearchResults(results) {
                const resultsContainer = document.getElementById('searchResults');
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = '<p class="no-results">没有找到相关结果</p>';
                    return;
                }

                resultsContainer.innerHTML = results.map(result => `
                    <div class="search-result-item" onclick="App.executeSearchResult('${result.type}', '${result.title}')">
                        <div class="result-icon">
                            <i class="${result.icon}"></i>
                        </div>
                        <div class="result-content">
                            <div class="result-title">${result.title}</div>
                            <div class="result-description">${result.description}</div>
                            <div class="result-type">${this.getResultTypeName(result.type)}</div>
                        </div>
                    </div>
                `).join('');
            },

            getResultTypeName(type) {
                const typeNames = {
                    course: '课程',
                    exercise: '练习题',
                    video: '视频'
                };
                return typeNames[type] || '未知';
            },

            executeSearchResult(type, title) {
                // 这里可以根据类型和标题执行相应的操作
                console.log('执行搜索结果:', type, title);
            },

            autoSave() {
                if (!APP_STATE.isLoggedIn) return;

                const saveData = {
                    currentUser: APP_STATE.currentUser,
                    currentSection: APP_STATE.currentSection,
                    userAnswers: APP_STATE.userAnswers,
                    lastActivityTime: Date.now()
                };

                Utils.storage.set('autoSaveData', saveData);
                console.log('自动保存完成');
            },

            startSessionMonitoring() {
                // 监控用户活动
                const activityEvents = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
                
                activityEvents.forEach(event => {
                    document.addEventListener(event, () => {
                        APP_STATE.lastActivityTime = Date.now();
                    }, { passive: true });
                });

                // 定期检查会话状态
                setInterval(() => {
                    if (APP_STATE.isLoggedIn && APP_STATE.lastActivityTime) {
                        const idleTime = Date.now() - APP_STATE.lastActivityTime;
                        
                        if (idleTime > CONFIG.SESSION_TIMEOUT) {
                            LoginSystem.logout('会话超时，请重新登录');
                        } else if (idleTime > CONFIG.SESSION_TIMEOUT * 0.8) {
                            // 显示会话即将过期的警告
                            MessageSystem.show('会话即将过期，请及时保存工作', 'warning');
                        }
                    }
                }, 60000); // 每分钟检查一次
            },

            // 错误处理
            handleError(error, context = '') {
                console.error(`错误 [${context}]:`, error);
                
                let message = '发生未知错误';
                
                if (error.message) {
                    message = error.message;
                } else if (typeof error === 'string') {
                    message = error;
                }
                
                MessageSystem.show(message, 'error');
                
                // 记录错误到服务器（如果有的话）
                this.logError(error, context);
            },

            logError(error, context) {
                const errorLog = {
                    timestamp: new Date().toISOString(),
                    context: context,
                    message: error.message || error,
                    stack: error.stack,
                    userAgent: navigator.userAgent,
                    url: window.location.href,
                    userId: APP_STATE.currentUser?.username || 'anonymous'
                };

                // 这里可以发送错误日志到服务器
                console.log('错误日志:', errorLog);
                
                // 保存到本地存储作为备份
                const errorLogs = Utils.storage.get('errorLogs') || [];
                errorLogs.push(errorLog);
                
                // 只保留最近100条错误记录
                if (errorLogs.length > 100) {
                    errorLogs.splice(0, errorLogs.length - 100);
                }
                
                Utils.storage.set('errorLogs', errorLogs);
            },

            // 性能监控
            measurePerformance(name, fn) {
                const start = performance.now();
                try {
                    const result = fn();
                    const end = performance.now();
                    console.log(`性能测量 [${name}]: ${(end - start).toFixed(2)}ms`);
                    return result;
                } catch (error) {
                    const end = performance.now();
                    console.error(`性能测量 [${name}] 失败: ${(end - start).toFixed(2)}ms`, error);
                    throw error;
                }
            },

            // 数据导出
            exportUserData() {
                if (!APP_STATE.isLoggedIn) {
                    MessageSystem.show('请先登录', 'warning');
                    return;
                }

                const exportData = {
                    user: APP_STATE.currentUser,
                    preferences: Utils.storage.get('userPreferences'),
                    uploadHistory: Utils.storage.get('uploadHistory'),
                    errorLogs: Utils.storage.get('errorLogs'),
                    exportTime: new Date().toISOString()
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `user-data-${APP_STATE.currentUser.username}-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                MessageSystem.show('数据导出成功', 'success');
            },

            // 数据导入
            importUserData(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // 验证数据格式
                        if (!data.user || !data.exportTime) {
                            throw new Error('无效的数据格式');
                        }
                        
                        // 导入用户偏好设置
                        if (data.preferences) {
                            Utils.storage.set('userPreferences', data.preferences);
                        }
                        
                        MessageSystem.show('数据导入成功', 'success');
                        
                        // 重新加载用户偏好设置
                        if (APP_STATE.isLoggedIn) {
                            ProfileSystem.loadUserPreferences();
                        }
                        
                    } catch (error) {
                        MessageSystem.show('数据导入失败: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            },

            // 清理功能
            cleanup() {
                // 清理过期的本地存储数据
                const keys = Object.keys(localStorage);
                const prefix = CONFIG.STORAGE_PREFIX;
                
                keys.forEach(key => {
                    if (key.startsWith(prefix)) {
                        const data = localStorage.getItem(key);
                        if (data) {
                            try {
                                const parsed = JSON.parse(data);
                                // 检查数据是否过期（7天）
                                if (parsed.timestamp && 
                                    Date.now() - new Date(parsed.timestamp).getTime() > 7 * 24 * 60 * 60 * 1000) {
                                    localStorage.removeItem(key);
                                }
                            } catch (e) {
                                // 如果解析失败，删除该键
                                localStorage.removeItem(key);
                            }
                        }
                    }
                });
                
                console.log('数据清理完成');
            }
        };

        // 全局错误处理
        window.addEventListener('error', (event) => {
            App.handleError(event.error, 'Global Error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            App.handleError(event.reason, 'Unhandled Promise Rejection');
        });

        // 页面加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });

        // 页面卸载前保存数据
        window.addEventListener('beforeunload', () => {
            if (APP_STATE.isLoggedIn) {
                App.autoSave();
            }
        });

        // 定期清理数据
        setInterval(() => {
            App.cleanup();
        }, 24 * 60 * 60 * 1000); // 每24小时清理一次

        // 导出全局函数供HTML调用
        window.App = App;
        window.LoginSystem = LoginSystem;
        window.NavigationSystem = NavigationSystem;
        window.StudySystem = StudySystem;
        window.ExerciseSystem = ExerciseSystem;
        window.VideoSystem = VideoSystem;
        window.AISystem = AISystem;
        window.UploadSystem = UploadSystem;
        window.ProfileSystem = ProfileSystem;
        window.ModalSystem = ModalSystem;
        window.MessageSystem = MessageSystem;
        window.Utils = Utils;

        // 开发模式下的调试工具
        if (CONFIG.DEBUG_MODE) {
            window.DEBUG = {
                showState: () => console.log('APP_STATE:', APP_STATE),
                showConfig: () => console.log('CONFIG:', CONFIG),
                showUserAccounts: () => console.log('USER_ACCOUNTS:', USER_ACCOUNTS),
                showExercises: () => console.log('EXERCISES_DATA:', EXERCISES_DATA),
                showVideos: () => console.log('VIDEOS_DATA:', VIDEOS_DATA),
                showModules: () => console.log('STUDY_MODULES:', STUDY_MODULES),
                clearStorage: () => {
                    localStorage.clear();
                    console.log('本地存储已清空');
                },
                resetApp: () => {
                    localStorage.clear();
                    location.reload();
                }
            };
            
            console.log('调试模式已启用，使用 window.DEBUG 访问调试工具');
        }

        // 数据分析系统
        const AnalyticsSystem = {
            events: [],
            metrics: {},
            sessionStart: Date.now(),

            init() {
                this.setupEventListeners();
                this.startPeriodicReporting();
                console.log('数据分析系统已初始化');
            },

            trackEvent(eventName, properties = {}) {
                const event = {
                    id: Utils.generateId(),
                    name: eventName,
                    properties: {
                        ...properties,
                        timestamp: new Date().toISOString(),
                        userId: APP_STATE.currentUser?.username || 'anonymous',
                        sessionId: this.getSessionId(),
                        userAgent: navigator.userAgent,
                        url: window.location.href,
                        screenSize: `${window.innerWidth}x${window.innerHeight}`,
                        timeOnPage: Date.now() - this.sessionStart
                    }
                };

                this.events.push(event);
                this.updateMetrics(eventName, properties);

                // 发送到分析服务器（如果有的话）
                this.sendToAnalytics(event);

                return event;
            },

            trackPageView(pageName, properties = {}) {
                this.trackEvent('page_view', {
                    page: pageName,
                    referrer: document.referrer,
                    ...properties
                });
            },

            trackUserAction(action, target, properties = {}) {
                this.trackEvent('user_action', {
                    action: action,
                    target: target,
                    ...properties
                });
            },

            trackError(error, context = '') {
                this.trackEvent('error', {
                    message: error.message || error,
                    stack: error.stack,
                    context: context,
                    severity: 'error'
                });
            },

            trackPerformance(metricName, value, properties = {}) {
                this.trackEvent('performance', {
                    metric: metricName,
                    value: value,
                    ...properties
                });
            },

            updateMetrics(eventName, properties) {
                if (!this.metrics[eventName]) {
                    this.metrics[eventName] = {
                        count: 0,
                        firstSeen: new Date().toISOString(),
                        lastSeen: new Date().toISOString(),
                        properties: {}
                    };
                }

                this.metrics[eventName].count++;
                this.metrics[eventName].lastSeen = new Date().toISOString();

                // 合并属性
                Object.keys(properties).forEach(key => {
                    if (!this.metrics[eventName].properties[key]) {
                        this.metrics[eventName].properties[key] = [];
                    }
                    this.metrics[eventName].properties[key].push(properties[key]);
                });
            },

            getSessionId() {
                let sessionId = sessionStorage.getItem('analytics_session_id');
                if (!sessionId) {
                    sessionId = Utils.generateId();
                    sessionStorage.setItem('analytics_session_id', sessionId);
                }
                return sessionId;
            },

            setupEventListeners() {
                // 页面加载事件
                this.trackPageView('app_loaded');

                // 用户交互事件
                document.addEventListener('click', (e) => {
                    const target = e.target.closest('[data-analytics]');
                    if (target) {
                        const action = target.dataset.analytics;
                        const properties = {};
                        
                        // 收集自定义属性
                        Object.keys(target.dataset).forEach(key => {
                            if (key.startsWith('analytics_') && key !== 'analytics') {
                                const propName = key.replace('analytics_', '');
                                properties[propName] = target.dataset[key];
                            }
                        });

                        this.trackUserAction('click', action, properties);
                    }
                });

                // 表单提交事件
                document.addEventListener('submit', (e) => {
                    const form = e.target;
                    if (form.id) {
                        this.trackUserAction('form_submit', form.id, {
                            formAction: form.action,
                            formMethod: form.method
                        });
                    }
                });

                // 页面可见性变化
                document.addEventListener('visibilitychange', () => {
                    this.trackEvent('visibility_change', {
                        hidden: document.hidden,
                        timeOnPage: Date.now() - this.sessionStart
                    });
                });

                // 网络状态变化
                window.addEventListener('online', () => {
                    this.trackEvent('network_status', { status: 'online' });
                });

                window.addEventListener('offline', () => {
                    this.trackEvent('network_status', { status: 'offline' });
                });
            },

            startPeriodicReporting() {
                // 每分钟报告一次会话数据
                setInterval(() => {
                    this.reportSessionData();
                }, 60000);

                // 页面卸载时发送最终数据
                window.addEventListener('beforeunload', () => {
                    this.reportSessionData();
                });
            },

            reportSessionData() {
                const sessionData = {
                    sessionId: this.getSessionId(),
                    userId: APP_STATE.currentUser?.username || 'anonymous',
                    duration: Date.now() - this.sessionStart,
                    events: this.events.length,
                    metrics: this.metrics,
                    timestamp: new Date().toISOString()
                };

                this.sendToAnalytics({
                    type: 'session_report',
                    data: sessionData
                });

                // 清空事件缓存
                this.events = [];
            },

            sendToAnalytics(data) {
                // 这里可以发送数据到分析服务器
                // 目前只是记录到控制台
                if (CONFIG.DEBUG_MODE) {
                    console.log('Analytics Event:', data);
                }

                // 保存到本地存储作为备份
                const analyticsData = Utils.storage.get('analytics_data') || [];
                analyticsData.push({
                    ...data,
                    timestamp: new Date().toISOString()
                });

                // 只保留最近1000条记录
                if (analyticsData.length > 1000) {
                    analyticsData.splice(0, analyticsData.length - 1000);
                }

                Utils.storage.set('analytics_data', analyticsData);
            },

            getAnalyticsReport() {
                const report = {
                    sessionDuration: Date.now() - this.sessionStart,
                    totalEvents: this.events.length,
                    metrics: this.metrics,
                    topEvents: this.getTopEvents(),
                    userJourney: this.getUserJourney()
                };

                return report;
            },

            getTopEvents() {
                const eventCounts = {};
                this.events.forEach(event => {
                    eventCounts[event.name] = (eventCounts[event.name] || 0) + 1;
                });

                return Object.entries(eventCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 10)
                    .map(([event, count]) => ({ event, count }));
            },

            getUserJourney() {
                const pageViews = this.events.filter(e => e.name === 'page_view');
                return pageViews.map(e => ({
                    page: e.properties.page,
                    timestamp: e.properties.timestamp,
                    timeOnPage: e.properties.timeOnPage
                }));
            }
        };

        // 实时协作系统
        const CollaborationSystem = {
            connections: new Map(),
            messages: [],
            isConnected: false,
            reconnectAttempts: 0,
            maxReconnectAttempts: 5,

            init() {
                this.setupWebSocket();
                this.setupEventListeners();
                console.log('实时协作系统已初始化');
            },

            setupWebSocket() {
                // 模拟WebSocket连接
                this.simulateWebSocket();
            },

            simulateWebSocket() {
                // 模拟连接延迟
                setTimeout(() => {
                    this.isConnected = true;
                    this.onConnect();
                    
                    // 模拟接收消息
                    setInterval(() => {
                        if (this.isConnected && Math.random() < 0.1) {
                            this.onMessage({
                                type: 'user_activity',
                                data: {
                                    userId: 'user_' + Math.floor(Math.random() * 100),
                                    action: 'viewing_page',
                                    page: ['home', 'study', 'exercises', 'videos'][Math.floor(Math.random() * 4)],
                                    timestamp: new Date().toISOString()
                                }
                            });
                        }
                    }, 5000);
                }, 1000);
            },

            onConnect() {
                console.log('协作系统已连接');
                this.reconnectAttempts = 0;
                this.broadcastMessage({
                    type: 'user_joined',
                    data: {
                        userId: APP_STATE.currentUser?.username || 'anonymous',
                        timestamp: new Date().toISOString()
                    }
                });
            },

            onMessage(message) {
                this.messages.push(message);
                
                switch (message.type) {
                    case 'user_activity':
                        this.handleUserActivity(message.data);
                        break;
                    case 'chat_message':
                        this.handleChatMessage(message.data);
                        break;
                    case 'collaboration_update':
                        this.handleCollaborationUpdate(message.data);
                        break;
                    default:
                        console.log('未知消息类型:', message.type);
                }
            },

            handleUserActivity(data) {
                // 显示用户活动通知
                if (data.action === 'viewing_page' && data.userId !== APP_STATE.currentUser?.username) {
                    MessageSystem.show(`${data.userId} 正在浏览 ${this.getPageName(data.page)}`, 'info', 3000);
                }
            },

            handleChatMessage(data) {
                // 处理聊天消息
                console.log('收到聊天消息:', data);
            },

            handleCollaborationUpdate(data) {
                // 处理协作更新
                console.log('收到协作更新:', data);
            },

            broadcastMessage(message) {
                if (!this.isConnected) {
                    console.warn('协作系统未连接，无法发送消息');
                    return;
                }

                // 模拟发送消息
                console.log('发送消息:', message);
                
                // 添加到本地消息历史
                this.messages.push({
                    ...message,
                    sent: true,
                    timestamp: new Date().toISOString()
                });
            },

            sendChatMessage(content, targetUserId = null) {
                this.broadcastMessage({
                    type: 'chat_message',
                    data: {
                        content: content,
                        senderId: APP_STATE.currentUser?.username || 'anonymous',
                        targetUserId: targetUserId,
                        timestamp: new Date().toISOString()
                    }
                });
            },

            updateCollaborationStatus(status) {
                this.broadcastMessage({
                    type: 'collaboration_update',
                    data: {
                        userId: APP_STATE.currentUser?.username || 'anonymous',
                        status: status,
                        timestamp: new Date().toISOString()
                    }
                });
            },

            setupEventListeners() {
                // 监听页面变化
                const observer = new MutationObserver(() => {
                    if (this.isConnected) {
                        this.updateCollaborationStatus({
                            currentPage: APP_STATE.currentSection,
                            lastActivity: new Date().toISOString()
                        });
                    }
                });

                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            },

            getPageName(page) {
                const pageNames = {
                    home: '首页',
                    study: '学习模块',
                    exercises: '练习题',
                    videos: '视频中心',
                    'ai-assistant': 'AI助手',
                    upload: '文件上传',
                    profile: '用户资料'
                };
                return pageNames[page] || page;
            },

            getConnectionStatus() {
                return {
                    connected: this.isConnected,
                    reconnectAttempts: this.reconnectAttempts,
                    messageCount: this.messages.length
                };
            },

            getRecentMessages(limit = 10) {
                return this.messages.slice(-limit);
            }
        };

        // 高级搜索系统
        const AdvancedSearchSystem = {
            searchIndex: new Map(),
            searchHistory: [],
            searchSuggestions: [],

            init() {
                this.buildSearchIndex();
                this.loadSearchHistory();
                this.setupEventListeners();
                console.log('高级搜索系统已初始化');
            },

            buildSearchIndex() {
                // 索引课程数据
                STUDY_MODULES.forEach(module => {
                    this.indexDocument('course', module.id, {
                        title: module.title,
                        description: module.description,
                        tags: module.tags || [],
                        content: module.chapters.map(ch => ch.title + ' ' + ch.content).join(' ')
                    });
                });

                // 索引练习题数据
                EXERCISES_DATA.categories.forEach(category => {
                    this.indexDocument('exercise', category.id, {
                        title: category.name,
                        description: category.description,
                        tags: category.tags || [],
                        content: category.questions.map(q => q.question + ' ' + (q.explanation || '')).join(' ')
                    });
                });

                // 索引视频数据
                VIDEOS_DATA.forEach(video => {
                    this.indexDocument('video', video.id, {
                        title: video.title,
                        description: video.description,
                        tags: video.tags,
                        instructor: video.instructor,
                        content: video.chapters.map(ch => ch.title).join(' ')
                    });
                });

                console.log('搜索索引构建完成');
            },

            indexDocument(type, id, content) {
                const document = {
                    type: type,
                    id: id,
                    ...content,
                    indexedAt: new Date().toISOString()
                };

                // 创建倒排索引
                const text = `${content.title} ${content.description} ${content.content || ''}`.toLowerCase();
                const words = this.tokenize(text);
                
                words.forEach(word => {
                    if (!this.searchIndex.has(word)) {
                        this.searchIndex.set(word, []);
                    }
                    this.searchIndex.get(word).push(document);
                });

                // 存储完整文档
                if (!this.searchIndex.has('_documents')) {
                    this.searchIndex.set('_documents', new Map());
                }
                this.searchIndex.get('_documents').set(id, document);
            },

            tokenize(text) {
                // 简单的分词处理
                return text
                    .replace(/[^\w\s\u4e00-\u9fff]/g, ' ')
                    .split(/\s+/)
                    .filter(word => word.length > 1)
                    .map(word => word.toLowerCase());
            },

            search(query, options = {}) {
                const {
                    type = null,
                    limit = 20,
                    fuzzy = true,
                    highlight = true
                } = options;

                if (!query.trim()) {
                    return [];
                }

                const startTime = performance.now();
                const results = this.performSearch(query, type, fuzzy);
                const endTime = performance.now();

                // 记录搜索历史
                this.addToSearchHistory(query, results.length, endTime - startTime);

                // 限制结果数量
                const limitedResults = results.slice(0, limit);

                // 高亮处理
                if (highlight) {
                    limitedResults.forEach(result => {
                        result.highlightedTitle = this.highlightText(result.title, query);
                        result.highlightedDescription = this.highlightText(result.description, query);
                    });
                }

                return limitedResults;
            },

            performSearch(query, type, fuzzy) {
                const queryWords = this.tokenize(query);
                const documentScores = new Map();

                queryWords.forEach(word => {
                    const matchingDocs = this.searchIndex.get(word) || [];
                    
                    matchingDocs.forEach(doc => {
                        if (type && doc.type !== type) return;

                        const score = documentScores.get(doc.id) || 0;
                        documentScores.set(doc.id, score + 1);
                    });

                    // 模糊搜索
                    if (fuzzy) {
                        this.searchIndex.forEach((docs, indexedWord) => {
                            if (this.calculateSimilarity(word, indexedWord) > 0.7) {
                                docs.forEach(doc => {
                                    if (type && doc.type !== type) return;
                                    
                                    const score = documentScores.get(doc.id) || 0;
                                    documentScores.set(doc.id, score + 0.5);
                                });
                            }
                        });
                    }
                });

                // 转换为结果数组并排序
                const results = [];
                documentScores.forEach((score, docId) => {
                    const doc = this.searchIndex.get('_documents').get(docId);
                    if (doc) {
                        results.push({
                            ...doc,
                            score: score,
                            relevance: this.calculateRelevance(score, queryWords.length)
                        });
                    }
                });

                return results.sort((a, b) => b.score - a.score);
            },

            calculateSimilarity(word1, word2) {
                // 简单的字符串相似度计算
                const longer = word1.length > word2.length ? word1 : word2;
                const shorter = word1.length > word2.length ? word2 : word1;
                
                if (longer.length === 0) return 1.0;
                
                const editDistance = this.levenshteinDistance(longer, shorter);
                return (longer.length - editDistance) / longer.length;
            },

            levenshteinDistance(str1, str2) {
                const matrix = [];
                
                for (let i = 0; i <= str2.length; i++) {
                    matrix[i] = [i];
                }
                
                for (let j = 0; j <= str1.length; j++) {
                    matrix[0][j] = j;
                }
                
                for (let i = 1; i <= str2.length; i++) {
                    for (let j = 1; j <= str1.length; j++) {
                        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                            matrix[i][j] = matrix[i - 1][j - 1];
                        } else {
                            matrix[i][j] = Math.min(
                                matrix[i - 1][j - 1] + 1,
                                matrix[i][j - 1] + 1,
                                matrix[i - 1][j] + 1
                            );
                        }
                    }
                }
                
                return matrix[str2.length][str1.length];
            },

            calculateRelevance(score, queryLength) {
                const maxScore = queryLength;
                return Math.min(score / maxScore, 1);
            },

            highlightText(text, query) {
                if (!text) return '';
                
                const queryWords = this.tokenize(query);
                let highlightedText = text;
                
                queryWords.forEach(word => {
                    const regex = new RegExp(`(${word})`, 'gi');
                    highlightedText = highlightedText.replace(regex, '<mark>$1</mark>');
                });
                
                return highlightedText;
            },

            addToSearchHistory(query, resultCount, searchTime) {
                const searchRecord = {
                    query: query,
                    resultCount: resultCount,
                    searchTime: searchTime,
                    timestamp: new Date().toISOString(),
                    userId: APP_STATE.currentUser?.username || 'anonymous'
                };

                this.searchHistory.unshift(searchRecord);
                
                // 只保留最近100条搜索记录
                if (this.searchHistory.length > 100) {
                    this.searchHistory.splice(100);
                }

                Utils.storage.set('search_history', this.searchHistory);
            },

            loadSearchHistory() {
                this.searchHistory = Utils.storage.get('search_history') || [];
            },

            getSearchSuggestions(query) {
                if (!query.trim()) {
                    return this.getPopularSearches();
                }

                const suggestions = [];
                const queryWords = this.tokenize(query);

                // 基于搜索历史的建议
                this.searchHistory.forEach(record => {
                    if (record.query.toLowerCase().includes(query.toLowerCase())) {
                        suggestions.push({
                            type: 'history',
                            text: record.query,
                            count: 1
                        });
                    }
                });

                // 基于索引的建议
                this.searchIndex.forEach((docs, word) => {
                    if (word.toLowerCase().includes(query.toLowerCase())) {
                        suggestions.push({
                            type: 'index',
                            text: word,
                            count: docs.length
                        });
                    }
                });

                // 去重并排序
                const uniqueSuggestions = [];
                const seen = new Set();

                suggestions.forEach(suggestion => {
                    if (!seen.has(suggestion.text)) {
                        seen.add(suggestion.text);
                        uniqueSuggestions.push(suggestion);
                    }
                });

                return uniqueSuggestions
                    .sort((a, b) => b.count - a.count)
                    .slice(0, 10);
            },

            getPopularSearches() {
                const searchCounts = {};
                
                this.searchHistory.forEach(record => {
                    searchCounts[record.query] = (searchCounts[record.query] || 0) + 1;
                });

                return Object.entries(searchCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 10)
                    .map(([query, count]) => ({
                        type: 'popular',
                        text: query,
                        count: count
                    }));
            },

            setupEventListeners() {
                // 监听搜索框输入
                document.addEventListener('input', (e) => {
                    if (e.target.matches('#globalSearch, .search-input')) {
                        const query = e.target.value.trim();
                        if (query.length > 1) {
                            this.showSearchSuggestions(query, e.target);
                        }
                    }
                });
            },

            showSearchSuggestions(query, inputElement) {
                const suggestions = this.getSearchSuggestions(query);
                
                // 这里可以实现搜索建议的UI显示
                console.log('搜索建议:', suggestions);
            },

            getSearchStatistics() {
                const totalSearches = this.searchHistory.length;
                const uniqueQueries = new Set(this.searchHistory.map(r => r.query)).size;
                const avgSearchTime = this.searchHistory.reduce((sum, r) => sum + r.searchTime, 0) / totalSearches;

                return {
                    totalSearches,
                    uniqueQueries,
                    avgSearchTime,
                    recentSearches: this.searchHistory.slice(0, 10)
                };
            }
        };

        // 性能监控系统
        const PerformanceMonitor = {
            metrics: {
                pageLoad: {},
                userInteractions: [],
                resourceTiming: [],
                errors: []
            },
            observers: [],

            init() {
                this.setupPerformanceObservers();
                this.setupErrorTracking();
                this.startPeriodicReporting();
                console.log('性能监控系统已初始化');
            },

            setupPerformanceObservers() {
                // 页面加载性能
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        this.measurePageLoadPerformance();
                    }, 0);
                });

                // 用户交互性能
                this.observeUserInteractions();

                // 资源加载性能
                this.observeResourceTiming();

                // 长任务监控
                this.observeLongTasks();
            },

            measurePageLoadPerformance() {
                const navigation = performance.getEntriesByType('navigation')[0];
                const paint = performance.getEntriesByType('paint');

                this.metrics.pageLoad = {
                    timestamp: new Date().toISOString(),
                    domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
                    loadComplete: navigation.loadEventEnd - navigation.loadEventStart,
                    firstPaint: paint.find(p => p.name === 'first-paint')?.startTime || 0,
                    firstContentfulPaint: paint.find(p => p.name === 'first-contentful-paint')?.startTime || 0,
                    totalLoadTime: navigation.loadEventEnd - navigation.fetchStart,
                    url: window.location.href
                };

                // 记录到分析系统
                AnalyticsSystem.trackPerformance('page_load', this.metrics.pageLoad.totalLoadTime, this.metrics.pageLoad);
            },

            observeUserInteractions() {
                let interactionStart = 0;
                let isInteracting = false;

                const events = ['mousedown', 'keydown', 'touchstart'];
                
                events.forEach(eventType => {
                    document.addEventListener(eventType, (e) => {
                        if (!isInteracting) {
                            interactionStart = performance.now();
                            isInteracting = true;
                        }
                    }, { passive: true });

                    document.addEventListener(eventType.replace('start', 'end'), (e) => {
                        if (isInteracting) {
                            const interactionTime = performance.now() - interactionStart;
                            
                            this.metrics.userInteractions.push({
                                type: eventType,
                                duration: interactionTime,
                                timestamp: new Date().toISOString(),
                                target: e.target.tagName + (e.target.id ? '#' + e.target.id : '')
                            });

                            isInteracting = false;
                        }
                    }, { passive: true });
                });
            },

            observeResourceTiming() {
                const observer = new PerformanceObserver((list) => {
                    list.getEntries().forEach(entry => {
                        if (entry.initiatorType === 'img' || entry.initiatorType === 'script' || entry.initiatorType === 'css') {
                            this.metrics.resourceTiming.push({
                                name: entry.name,
                                type: entry.initiatorType,
                                duration: entry.duration,
                                size: entry.transferSize || 0,
                                timestamp: new Date().toISOString()
                            });
                        }
                    });
                });

                observer.observe({ entryTypes: ['resource'] });
            },

            observeLongTasks() {
                const observer = new PerformanceObserver((list) => {
                    list.getEntries().forEach(entry => {
                        if (entry.duration > 50) { // 超过50ms的任务
                            this.metrics.userInteractions.push({
                                type: 'long_task',
                                duration: entry.duration,
                                timestamp: new Date().toISOString(),
                                startTime: entry.startTime
                            });
                        }
                    });
                });

                observer.observe({ entryTypes: ['longtask'] });
            },

            setupErrorTracking() {
                // JavaScript错误
                window.addEventListener('error', (e) => {
                    this.metrics.errors.push({
                        type: 'javascript_error',
                        message: e.message,
                        filename: e.filename,
                        lineno: e.lineno,
                        colno: e.colno,
                        timestamp: new Date().toISOString()
                    });
                });

                // Promise拒绝
                window.addEventListener('unhandledrejection', (e) => {
                    this.metrics.errors.push({
                        type: 'promise_rejection',
                        reason: e.reason,
                        timestamp: new Date().toISOString()
                    });
                });

                // 资源加载错误
                window.addEventListener('error', (e) => {
                    if (e.target && e.target.tagName) {
                        this.metrics.errors.push({
                            type: 'resource_error',
                            resource: e.target.src || e.target.href,
                            tagName: e.target.tagName,
                            timestamp: new Date().toISOString()
                        });
                    }
                }, true);
            },

            startPeriodicReporting() {
                // 每分钟报告一次性能数据
                setInterval(() => {
                    this.reportPerformanceData();
                }, 60000);
            },

            reportPerformanceData() {
                const report = {
                    timestamp: new Date().toISOString(),
                    pageLoad: this.metrics.pageLoad,
                    userInteractions: this.metrics.userInteractions.slice(-50), // 最近50次交互
                    resourceTiming: this.metrics.resourceTiming.slice(-20), // 最近20个资源
                    errors: this.metrics.errors.slice(-10), // 最近10个错误
                    memory: this.getMemoryInfo(),
                    network: this.getNetworkInfo()
                };

                // 发送到分析系统
                AnalyticsSystem.trackEvent('performance_report', report);

                // 清理旧数据
                this.cleanupOldData();
            },

            getMemoryInfo() {
                if (performance.memory) {
                    return {
                        usedJSHeapSize: performance.memory.usedJSHeapSize,
                        totalJSHeapSize: performance.memory.totalJSHeapSize,
                        jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
                    };
                }
                return null;
            },

            getNetworkInfo() {
                if (navigator.connection) {
                    return {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink,
                        rtt: navigator.connection.rtt
                    };
                }
                return null;
            },

            cleanupOldData() {
                const oneHourAgo = Date.now() - 60 * 60 * 1000;
                
                this.metrics.userInteractions = this.metrics.userInteractions.filter(
                    interaction => new Date(interaction.timestamp).getTime() > oneHourAgo
                );
                
                this.metrics.resourceTiming = this.metrics.resourceTiming.filter(
                    resource => new Date(resource.timestamp).getTime() > oneHourAgo
                );
                
                this.metrics.errors = this.metrics.errors.filter(
                    error => new Date(error.timestamp).getTime() > oneHourAgo
                );
            },

            measureFunction(name, fn) {
                const start = performance.now();
                try {
                    const result = fn();
                    const end = performance.now();
                    const duration = end - start;
                    
                    this.metrics.userInteractions.push({
                        type: 'function_call',
                        name: name,
                        duration: duration,
                        timestamp: new Date().toISOString()
                    });
                    
                    return result;
                } catch (error) {
                    const end = performance.now();
                    const duration = end - start;
                    
                    this.metrics.errors.push({
                        type: 'function_error',
                        name: name,
                        duration: duration,
                        error: error.message,
                        timestamp: new Date().toISOString()
                    });
                    
                    throw error;
                }
            },

            getPerformanceReport() {
                return {
                    pageLoad: this.metrics.pageLoad,
                    averageInteractionTime: this.calculateAverageInteractionTime(),
                    errorRate: this.calculateErrorRate(),
                    resourceLoadTimes: this.calculateResourceLoadTimes(),
                    memoryUsage: this.getMemoryInfo(),
                    networkInfo: this.getNetworkInfo()
                };
            },

            calculateAverageInteractionTime() {
                if (this.metrics.userInteractions.length === 0) return 0;
                
                const totalTime = this.metrics.userInteractions.reduce((sum, interaction) => sum + interaction.duration, 0);
                return totalTime / this.metrics.userInteractions.length;
            },

            calculateErrorRate() {
                const totalInteractions = this.metrics.userInteractions.length;
                const totalErrors = this.metrics.errors.length;
                
                return totalInteractions > 0 ? (totalErrors / totalInteractions) * 100 : 0;
            },

            calculateResourceLoadTimes() {
                const resourceTypes = {};
                
                this.metrics.resourceTiming.forEach(resource => {
                    if (!resourceTypes[resource.type]) {
                        resourceTypes[resource.type] = [];
                    }
                    resourceTypes[resource.type].push(resource.duration);
                });

                const averages = {};
                Object.keys(resourceTypes).forEach(type => {
                    const times = resourceTypes[type];
                    averages[type] = times.reduce((sum, time) => sum + time, 0) / times.length;
                });

                return averages;
            }
        };

        // 缓存管理系统
        const CacheManager = {
            caches: new Map(),
            maxSize: 50 * 1024 * 1024, // 50MB
            currentSize: 0,

            init() {
                this.loadCacheFromStorage();
                this.setupCacheCleanup();
                console.log('缓存管理系统已初始化');
            },

            set(key, value, options = {}) {
                const {
                    ttl = 3600000, // 默认1小时
                    priority = 'normal',
                    size = this.estimateSize(value)
                } = options;

                const cacheEntry = {
                    key: key,
                    value: value,
                    size: size,
                    priority: priority,
                    createdAt: Date.now(),
                    expiresAt: Date.now() + ttl,
                    accessCount: 0,
                    lastAccessed: Date.now()
                };

                // 检查缓存大小限制
                if (this.currentSize + size > this.maxSize) {
                    this.evictCache(size);
                }

                this.caches.set(key, cacheEntry);
                this.currentSize += size;
                this.saveCacheToStorage();

                return cacheEntry;
            },

            get(key) {
                const entry = this.caches.get(key);
                
                if (!entry) {
                    return null;
                }

                // 检查是否过期
                if (Date.now() > entry.expiresAt) {
                    this.delete(key);
                    return null;
                }

                // 更新访问统计
                entry.accessCount++;
                entry.lastAccessed = Date.now();
                this.caches.set(key, entry);

                return entry.value;
            },

            delete(key) {
                const entry = this.caches.get(key);
                if (entry) {
                    this.currentSize -= entry.size;
                    this.caches.delete(key);
                    this.saveCacheToStorage();
                }
            },

            clear() {
                this.caches.clear();
                this.currentSize = 0;
                this.saveCacheToStorage();
            },

            has(key) {
                const entry = this.caches.get(key);
                return entry && Date.now() <= entry.expiresAt;
            },

            estimateSize(value) {
                const str = JSON.stringify(value);
                return new Blob([str]).size;
            },

            evictCache(requiredSize) {
                // 按优先级和访问时间排序
                const entries = Array.from(this.caches.values()).sort((a, b) => {
                    // 首先按优先级排序
                    const priorityOrder = { high: 3, normal: 2, low: 1 };
                    const priorityDiff = priorityOrder[b.priority] - priorityOrder[a.priority];
                    
                    if (priorityDiff !== 0) {
                        return priorityDiff;
                    }
                    
                    // 然后按最后访问时间排序
                    return a.lastAccessed - b.lastAccessed;
                });

                let freedSize = 0;
                const toDelete = [];

                for (const entry of entries) {
                    if (freedSize >= requiredSize) break;
                    
                    toDelete.push(entry.key);
                    freedSize += entry.size;
                }

                toDelete.forEach(key => this.delete(key));
            },

            loadCacheFromStorage() {
                try {
                    const cached = Utils.storage.get('app_cache');
                    if (cached) {
                        const data = JSON.parse(cached);
                        this.caches = new Map(data.entries);
                        this.currentSize = data.currentSize;
                    }
                } catch (error) {
                    console.warn('加载缓存失败:', error);
                    this.clear();
                }
            },

            saveCacheToStorage() {
                try {
                    const data = {
                        entries: Array.from(this.caches.entries()),
                        currentSize: this.currentSize,
                        timestamp: Date.now()
                    };
                    Utils.storage.set('app_cache', JSON.stringify(data));
                } catch (error) {
                    console.warn('保存缓存失败:', error);
                }
            },

            setupCacheCleanup() {
                // 每小时清理过期缓存
                setInterval(() => {
                    this.cleanupExpired();
                }, 60 * 60 * 1000);
            },

            cleanupExpired() {
                const now = Date.now();
                const toDelete = [];

                this.caches.forEach((entry, key) => {
                    if (now > entry.expiresAt) {
                        toDelete.push(key);
                    }
                });

                toDelete.forEach(key => this.delete(key));
                
                if (toDelete.length > 0) {
                    console.log(`清理了 ${toDelete.length} 个过期缓存项`);
                }
            },

            getCacheStats() {
                const stats = {
                    totalEntries: this.caches.size,
                    totalSize: this.currentSize,
                    maxSize: this.maxSize,
                    utilization: (this.currentSize / this.maxSize) * 100,
                    priorityDistribution: { high: 0, normal: 0, low: 0 },
                    expiredEntries: 0
                };

                const now = Date.now();
                this.caches.forEach(entry => {
                    stats.priorityDistribution[entry.priority]++;
                    if (now > entry.expiresAt) {
                        stats.expiredEntries++;
                    }
                });

                return stats;
            },

            // 预加载常用数据
            preloadData() {
                // 预加载用户偏好设置
                this.set('user_preferences', Utils.storage.get('userPreferences'), {
                    priority: 'high',
                    ttl: 24 * 60 * 60 * 1000 // 24小时
                });

                // 预加载搜索历史
                this.set('search_history', Utils.storage.get('search_history'), {
                    priority: 'normal',
                    ttl: 7 * 24 * 60 * 60 * 1000 // 7天
                });

                // 预加载分析数据
                this.set('analytics_data', Utils.storage.get('analytics_data'), {
                    priority: 'low',
                    ttl: 24 * 60 * 60 * 1000 // 24小时
                });
            }
        };

        // 初始化所有企业级系统
        document.addEventListener('DOMContentLoaded', () => {
            // 在应用初始化后启动企业级系统
            setTimeout(() => {
                AnalyticsSystem.init();
                CollaborationSystem.init();
                AdvancedSearchSystem.init();
                PerformanceMonitor.init();
                CacheManager.init();
                
                // 预加载数据
                CacheManager.preloadData();
                
                console.log('所有企业级系统已启动');
            }, 1000);
        });

        // 企业级仪表板系统
        const DashboardSystem = {
            init() {
                this.createDashboard();
                this.setupEventListeners();
                this.startRealTimeUpdates();
                console.log('企业级仪表板系统已初始化');
            },

            createDashboard() {
                const dashboardContainer = document.createElement('div');
                dashboardContainer.className = 'enterprise-dashboard';
                dashboardContainer.id = 'enterpriseDashboard';
                dashboardContainer.style.display = 'none';

                dashboardContainer.innerHTML = `
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-line"></i> 性能监控</h3>
                        <div class="performance-metrics" id="performanceMetrics">
                            <!-- 性能指标将在这里动态添加 -->
                        </div>
                        <div class="chart-container" id="performanceChart">
                            <canvas width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-users"></i> 实时协作</h3>
                        <div class="system-status" id="collaborationStatus">
                            <!-- 协作状态将在这里显示 -->
                        </div>
                        <div class="online-users" id="onlineUsers">
                            <!-- 在线用户将在这里显示 -->
                        </div>
                        <div class="collaboration-messages" id="collaborationMessages">
                            <!-- 协作消息将在这里显示 -->
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-search"></i> 搜索分析</h3>
                        <div class="analytics-metrics" id="searchMetrics">
                            <!-- 搜索指标将在这里显示 -->
                        </div>
                        <div class="analytics-chart" id="searchChart">
                            <canvas width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-database"></i> 缓存管理</h3>
                        <div class="cache-stats" id="cacheStats">
                            <!-- 缓存统计将在这里显示 -->
                        </div>
                        <div class="cache-progress">
                            <div class="cache-progress-bar">
                                <div class="cache-progress-fill" id="cacheProgressFill"></div>
                            </div>
                            <div class="cache-progress-text" id="cacheProgressText">
                                <!-- 缓存进度文本将在这里显示 -->
                            </div>
                        </div>
                    </div>
                `;

                // 添加到主内容区域
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    mainContent.appendChild(dashboardContainer);
                }
            },

            setupEventListeners() {
                // 添加仪表板切换按钮到导航
                const navContainer = document.querySelector('.nav-links');
                if (navContainer) {
                    const dashboardLink = document.createElement('a');
                    dashboardLink.href = '#';
                    dashboardLink.className = 'nav-link';
                    dashboardLink.dataset.section = 'dashboard';
                    dashboardLink.innerHTML = '<i class="fas fa-tachometer-alt"></i> 仪表板';
                    navContainer.appendChild(dashboardLink);
                }

                // 添加仪表板切换按钮到侧边栏
                const sidebarContainer = document.querySelector('.sidebar-links');
                if (sidebarContainer) {
                    const dashboardSidebarLink = document.createElement('a');
                    dashboardSidebarLink.href = '#';
                    dashboardSidebarLink.className = 'sidebar-link';
                    dashboardSidebarLink.dataset.section = 'dashboard';
                    dashboardSidebarLink.innerHTML = '<i class="fas fa-tachometer-alt"></i> 仪表板';
                    sidebarContainer.appendChild(dashboardSidebarLink);
                }
            },

            showDashboard() {
                const dashboard = document.getElementById('enterpriseDashboard');
                if (dashboard) {
                    dashboard.style.display = 'grid';
                    this.updateDashboard();
                }
            },

            hideDashboard() {
                const dashboard = document.getElementById('enterpriseDashboard');
                if (dashboard) {
                    dashboard.style.display = 'none';
                }
            },

            updateDashboard() {
                this.updatePerformanceMetrics();
                this.updateCollaborationStatus();
                this.updateSearchMetrics();
                this.updateCacheStats();
            },

            updatePerformanceMetrics() {
                const container = document.getElementById('performanceMetrics');
                if (!container) return;

                const report = PerformanceMonitor.getPerformanceReport();
                
                container.innerHTML = `
                    <div class="performance-metric ${this.getPerformanceClass(report.averageInteractionTime)}">
                        <div class="performance-value">${report.averageInteractionTime.toFixed(2)}ms</div>
                        <div class="performance-label">平均交互时间</div>
                    </div>
                    <div class="performance-metric ${this.getPerformanceClass(report.errorRate)}">
                        <div class="performance-value">${report.errorRate.toFixed(2)}%</div>
                        <div class="performance-label">错误率</div>
                    </div>
                    <div class="performance-metric ${this.getPerformanceClass(report.pageLoad?.totalLoadTime || 0)}">
                        <div class="performance-value">${((report.pageLoad?.totalLoadTime || 0) / 1000).toFixed(2)}s</div>
                        <div class="performance-label">页面加载时间</div>
                    </div>
                    <div class="performance-metric">
                        <div class="performance-value">${this.getMemoryUsageText(report.memoryUsage)}</div>
                        <div class="performance-label">内存使用</div>
                    </div>
                `;
            },

            updateCollaborationStatus() {
                const statusContainer = document.getElementById('collaborationStatus');
                const usersContainer = document.getElementById('onlineUsers');
                const messagesContainer = document.getElementById('collaborationMessages');

                if (statusContainer) {
                    const status = CollaborationSystem.getConnectionStatus();
                    statusContainer.innerHTML = `
                        <div class="status-indicator ${status.connected ? 'online' : 'offline'}">
                            <div class="status-dot"></div>
                            <span>协作系统 ${status.connected ? '在线' : '离线'}</span>
                        </div>
                        <div class="status-indicator">
                            <div class="status-dot"></div>
                            <span>${status.messageCount} 条消息</span>
                        </div>
                    `;
                }

                if (usersContainer) {
                    // 模拟在线用户
                    const onlineUsers = [
                        { id: 1, name: '张三', avatar: 'ZS' },
                        { id: 2, name: '李四', avatar: 'LS' },
                        { id: 3, name: '王五', avatar: 'WW' }
                    ];

                    usersContainer.innerHTML = onlineUsers.map(user => `
                        <div class="online-user">
                            <div class="online-user-avatar">${user.avatar}</div>
                            <span>${user.name}</span>
                        </div>
                    `).join('');
                }

                if (messagesContainer) {
                    const messages = CollaborationSystem.getRecentMessages(5);
                    messagesContainer.innerHTML = messages.map(msg => `
                        <div class="collaboration-message">
                            <div class="collaboration-message-avatar">
                                ${msg.data?.senderId?.charAt(0) || 'U'}
                            </div>
                            <div class="collaboration-message-content">
                                <div class="collaboration-message-user">
                                    ${msg.data?.senderId || 'Unknown'}
                                </div>
                                <div class="collaboration-message-text">
                                    ${this.getCollaborationMessageText(msg)}
                                </div>
                                <div class="collaboration-message-time">
                                    ${new Date(msg.timestamp).toLocaleTimeString()}
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            },

            updateSearchMetrics() {
                const container = document.getElementById('searchMetrics');
                if (!container) return;

                const stats = AdvancedSearchSystem.getSearchStatistics();
                
                container.innerHTML = `
                    <div class="analytics-metric">
                        <div class="analytics-metric-value">${stats.totalSearches}</div>
                        <div class="analytics-metric-label">总搜索次数</div>
                    </div>
                    <div class="analytics-metric">
                        <div class="analytics-metric-value">${stats.uniqueQueries}</div>
                        <div class="analytics-metric-label">唯一查询</div>
                    </div>
                    <div class="analytics-metric">
                        <div class="analytics-metric-value">${stats.avgSearchTime.toFixed(2)}ms</div>
                        <div class="analytics-metric-label">平均搜索时间</div>
                    </div>
                    <div class="analytics-metric">
                        <div class="analytics-metric-value">${this.getSearchIndexSize()}</div>
                        <div class="analytics-metric-label">索引大小</div>
                    </div>
                `;
            },

            updateCacheStats() {
                const container = document.getElementById('cacheStats');
                const progressFill = document.getElementById('cacheProgressFill');
                const progressText = document.getElementById('cacheProgressText');

                if (!container) return;

                const stats = CacheManager.getCacheStats();
                
                container.innerHTML = `
                    <div class="cache-stat">
                        <div class="cache-stat-value">${stats.totalEntries}</div>
                        <div class="cache-stat-label">缓存条目</div>
                    </div>
                    <div class="cache-stat">
                        <div class="cache-stat-value">${this.formatBytes(stats.totalSize)}</div>
                        <div class="cache-stat-label">缓存大小</div>
                    </div>
                    <div class="cache-stat">
                        <div class="cache-stat-value">${stats.utilization.toFixed(1)}%</div>
                        <div class="cache-stat-label">使用率</div>
                    </div>
                    <div class="cache-stat">
                        <div class="cache-stat-value">${stats.expiredEntries}</div>
                        <div class="cache-stat-label">过期条目</div>
                    </div>
                `;

                if (progressFill) {
                    progressFill.style.width = `${stats.utilization}%`;
                }

                if (progressText) {
                    progressText.innerHTML = `
                        <span>已使用: ${this.formatBytes(stats.totalSize)}</span>
                        <span>总容量: ${this.formatBytes(stats.maxSize)}</span>
                    `;
                }
            },

            startRealTimeUpdates() {
                // 每5秒更新一次仪表板
                setInterval(() => {
                    if (document.getElementById('enterpriseDashboard')?.style.display !== 'none') {
                        this.updateDashboard();
                    }
                }, 5000);
            },

            getPerformanceClass(value) {
                if (value < 100) return 'good';
                if (value < 500) return 'warning';
                return 'poor';
            },

            getMemoryUsageText(memory) {
                if (!memory) return 'N/A';
                const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
                const totalMB = (memory.totalJSHeapSize / 1024 / 1024).toFixed(1);
                return `${usedMB}MB / ${totalMB}MB`;
            },

            getCollaborationMessageText(message) {
                switch (message.type) {
                    case 'user_joined':
                        return '加入了协作';
                    case 'user_activity':
                        return `正在浏览 ${this.getPageName(message.data?.page)}`;
                    case 'chat_message':
                        return message.data?.content || '发送了消息';
                    default:
                        return '执行了操作';
                }
            },

            getPageName(page) {
                const pageNames = {
                    home: '首页',
                    study: '学习模块',
                    exercises: '练习题',
                    videos: '视频中心',
                    'ai-assistant': 'AI助手',
                    upload: '文件上传',
                    profile: '用户资料'
                };
                return pageNames[page] || page;
            },

            getSearchIndexSize() {
                return AdvancedSearchSystem.searchIndex.size;
            },

            formatBytes(bytes) {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        };

        // 扩展导航系统以支持仪表板
        const originalShowSection = NavigationSystem.showSection;
        NavigationSystem.showSection = function(section) {
            if (section === 'dashboard') {
                // 隐藏所有其他部分
                document.querySelectorAll('.main-content > section').forEach(s => {
                    s.style.display = 'none';
                });
                
                // 显示仪表板
                DashboardSystem.showDashboard();
                
                // 更新当前部分
                APP_STATE.currentSection = section;
                
                // 更新导航状态
                document.querySelectorAll('.nav-link, .sidebar-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                document.querySelectorAll(`[data-section="${section}"]`).forEach(link => {
                    link.classList.add('active');
                });
            } else {
                // 隐藏仪表板
                DashboardSystem.hideDashboard();
                
                // 调用原始方法
                originalShowSection.call(this, section);
            }
        };

        // 初始化仪表板系统
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                DashboardSystem.init();
            }, 2000);
        });
</script>
</body>
</html>