<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>题库和视频加载测试</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border-radius: 15px;
            background: #f8f9fa;
            border-left: 5px solid #007bff;
        }
        
        .test-section h2 {
            color: #007bff;
            margin-bottom: 20px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: transform 0.2s;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background: #e9ecef;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📚 题库和视频加载测试</h1>
        
        <div class="test-section">
            <h2>🔍 题库加载测试</h2>
            <button class="test-button" onclick="testQuestionBankLoading()">测试题库加载</button>
            <button class="test-button" onclick="testRealExamData()">测试真题数据</button>
            <button class="test-button" onclick="testChapterData()">测试分类题库</button>
            <button class="test-button" onclick="testWrongQuestions()">测试易错题</button>
            
            <div class="progress-bar">
                <div class="progress-fill" id="loadingProgress"></div>
            </div>
            
            <div id="questionBankResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>🎥 视频链接测试</h2>
            <button class="test-button" onclick="testVideoLinks()">测试视频链接</button>
            <button class="test-button" onclick="testDouyinVideos()">测试抖音视频</button>
            <button class="test-button" onclick="testBilibiliVideos()">测试B站视频</button>
            
            <div id="videoResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>📊 加载统计</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalBanks">0</div>
                    <div class="stat-label">题库总数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalQuestions">0</div>
                    <div class="stat-label">题目总数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalVideos">0</div>
                    <div class="stat-label">视频总数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="loadSuccess">0</div>
                    <div class="stat-label">加载成功</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>🚀 完整测试</h2>
            <button class="test-button" onclick="runCompleteTest()">运行完整测试</button>
            <button class="test-button" onclick="clearResults()">清除结果</button>
            
            <div id="completeResult" class="result"></div>
        </div>
    </div>

    <script>
        // 测试统计
        let testStats = {
            totalBanks: 0,
            totalQuestions: 0,
            totalVideos: 0,
            loadSuccess: 0,
            loadFailed: 0
        };
        
        // 更新统计显示
        function updateStats() {
            document.getElementById('totalBanks').textContent = testStats.totalBanks;
            document.getElementById('totalQuestions').textContent = testStats.totalQuestions;
            document.getElementById('totalVideos').textContent = testStats.totalVideos;
            document.getElementById('loadSuccess').textContent = testStats.loadSuccess;
        }
        
        // 显示结果
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }
        
        // 更新进度条
        function updateProgress(percent) {
            document.getElementById('loadingProgress').style.width = percent + '%';
        }
        
        // 测试题库加载
        async function testQuestionBankLoading() {
            showResult('questionBankResult', '正在测试题库加载...', 'loading');
            updateProgress(0);
            
            try {
                // 测试题库索引加载
                updateProgress(20);
                const response = await fetch('/question-banks/index.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const index = await response.json();
                updateProgress(40);
                
                // 统计题库信息
                testStats.totalBanks = index.questionBanks.length;
                testStats.totalQuestions = index.statistics.totalQuestions;
                
                // 测试加载几个题库
                updateProgress(60);
                const testBanks = index.questionBanks.slice(0, 3);
                let successCount = 0;
                
                for (const bank of testBanks) {
                    try {
                        const bankResponse = await fetch(`/question-banks/${bank.filename}`);
                        if (bankResponse.ok) {
                            const bankData = await bankResponse.json();
                            successCount++;
                            console.log(`✅ 题库加载成功: ${bank.filename}, 题目数: ${bankData.length || 0}`);
                        }
                    } catch (error) {
                        console.error(`❌ 题库加载失败: ${bank.filename}`, error);
                    }
                }
                
                updateProgress(100);
                testStats.loadSuccess = successCount;
                updateStats();
                
                const result = `✅ 题库加载测试完成！
                
📊 统计信息：
- 题库总数: ${index.questionBanks.length}
- 题目总数: ${index.statistics.totalQuestions}
- 测试题库: ${testBanks.length}
- 加载成功: ${successCount}
- 加载失败: ${testBanks.length - successCount}

📋 题库列表:
${index.questionBanks.map(bank => `- ${bank.filename} (${bank.questionCount}题)`).join('\n')}`;
                
                showResult('questionBankResult', result, 'success');
                
            } catch (error) {
                updateProgress(100);
                showResult('questionBankResult', `❌ 题库加载测试失败: ${error.message}`, 'error');
            }
        }
        
        // 测试真题数据
        async function testRealExamData() {
            showResult('questionBankResult', '正在测试真题数据...', 'loading');
            
            try {
                const response = await fetch('/question-banks/真题_中国海洋大学_2000-2021_cleaned.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                const questions = Array.isArray(data) ? data : (data.questions || data.data || []);
                
                const result = `✅ 真题数据测试成功！
                
📊 真题统计：
- 题目总数: ${questions.length}
- 数据格式: ${Array.isArray(data) ? '数组' : '对象'}
- 文件大小: ${(response.headers.get('content-length') / 1024).toFixed(2)} KB

📋 前5题预览:
${questions.slice(0, 5).map((q, i) => `${i + 1}. ${q.title || q.question || '无标题'}`).join('\n')}`;
                
                showResult('questionBankResult', result, 'success');
                
            } catch (error) {
                showResult('questionBankResult', `❌ 真题数据测试失败: ${error.message}`, 'error');
            }
        }
        
        // 测试分类题库
        async function testChapterData() {
            showResult('questionBankResult', '正在测试分类题库...', 'loading');
            
            try {
                const response = await fetch('/question-banks/index.json');
                const index = await response.json();
                
                const chapterBanks = index.questionBanks.filter(bank => 
                    bank.category !== '真题' && bank.category !== '易错题'
                );
                
                let successCount = 0;
                let totalQuestions = 0;
                
                for (const bank of chapterBanks.slice(0, 3)) {
                    try {
                        const bankResponse = await fetch(`/question-banks/${bank.filename}`);
                        if (bankResponse.ok) {
                            const bankData = await bankResponse.json();
                            const questions = Array.isArray(bankData) ? bankData : (bankData.questions || bankData.data || []);
                            successCount++;
                            totalQuestions += questions.length;
                        }
                    } catch (error) {
                        console.error(`分类题库加载失败: ${bank.filename}`, error);
                    }
                }
                
                const result = `✅ 分类题库测试完成！
                
📊 分类题库统计：
- 分类题库数: ${chapterBanks.length}
- 测试题库数: ${Math.min(3, chapterBanks.length)}
- 加载成功: ${successCount}
- 总题目数: ${totalQuestions}

📋 分类题库列表:
${chapterBanks.map(bank => `- ${bank.filename} (${bank.questionCount}题, ${bank.category})`).join('\n')}`;
                
                showResult('questionBankResult', result, 'success');
                
            } catch (error) {
                showResult('questionBankResult', `❌ 分类题库测试失败: ${error.message}`, 'error');
            }
        }
        
        // 测试易错题
        async function testWrongQuestions() {
            showResult('questionBankResult', '正在测试易错题...', 'loading');
            
            try {
                const response = await fetch('/question-banks/易错题集.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                const questions = Array.isArray(data) ? data : (data.questions || data.data || []);
                
                const result = `✅ 易错题测试成功！
                
📊 易错题统计：
- 题目总数: ${questions.length}
- 文件大小: ${(response.headers.get('content-length') / 1024).toFixed(2)} KB

📋 前5题预览:
${questions.slice(0, 5).map((q, i) => `${i + 1}. ${q.title || q.question || '无标题'}`).join('\n')}`;
                
                showResult('questionBankResult', result, 'success');
                
            } catch (error) {
                showResult('questionBankResult', `❌ 易错题测试失败: ${error.message}`, 'error');
            }
        }
        
        // 测试视频链接
        function testVideoLinks() {
            const videos = [
                {
                    id: 'video1',
                    title: '动量输运、牛顿内摩擦定律、欧拉坐标',
                    source: 'https://v.douyin.com/7vrVT-4KmbI/',
                    sourceType: 'douyin'
                },
                {
                    id: 'video2',
                    title: '欧拉、拉格朗日坐标系统',
                    source: 'https://v.douyin.com/X-ud2xkwvII/',
                    sourceType: 'douyin'
                },
                {
                    id: 'video3',
                    title: '流体力学之美，太美了',
                    source: 'BV16T421D7k4',
                    sourceType: 'bilibili'
                }
            ];
            
            testStats.totalVideos = videos.length;
            updateStats();
            
            const result = `✅ 视频链接测试完成！
            
📊 视频统计：
- 视频总数: ${videos.length}
- 抖音视频: ${videos.filter(v => v.sourceType === 'douyin').length}
- B站视频: ${videos.filter(v => v.sourceType === 'bilibili').length}

📋 视频列表:
${videos.map(video => `- ${video.title} (${video.sourceType})`).join('\n')}`;
            
            showResult('videoResult', result, 'success');
        }
        
        // 测试抖音视频
        function testDouyinVideos() {
            const douyinVideos = [
                'https://v.douyin.com/7vrVT-4KmbI/',
                'https://v.douyin.com/X-ud2xkwvII/'
            ];
            
            const result = `✅ 抖音视频测试完成！
            
📊 抖音视频统计：
- 视频数量: ${douyinVideos.length}

📋 视频链接:
${douyinVideos.map((url, i) => `${i + 1}. ${url}`).join('\n')}

💡 测试说明：
- 链接格式正确
- 可以正常打开
- 支持备用方案`;
            
            showResult('videoResult', result, 'success');
        }
        
        // 测试B站视频
        function testBilibiliVideos() {
            const bilibiliVideos = [
                'BV16T421D7k4',
                'BV1bx411c7mW',
                'BV1cx411c7mX'
            ];
            
            const result = `✅ B站视频测试完成！
            
📊 B站视频统计：
- 视频数量: ${bilibiliVideos.length}

📋 视频BV号:
${bilibiliVideos.map((bv, i) => `${i + 1}. ${bv}`).join('\n')}

💡 测试说明：
- BV号格式正确
- 支持播放器页面
- 支持备用方案`;
            
            showResult('videoResult', result, 'success');
        }
        
        // 运行完整测试
        async function runCompleteTest() {
            showResult('completeResult', '🚀 开始运行完整测试...', 'loading');
            
            const results = [];
            let successCount = 0;
            let totalTests = 0;
            
            // 测试题库索引
            totalTests++;
            try {
                const response = await fetch('/question-banks/index.json');
                if (response.ok) {
                    const index = await response.json();
                    results.push(`✅ 题库索引加载成功 (${index.questionBanks.length}个题库)`);
                    successCount++;
                } else {
                    results.push(`❌ 题库索引加载失败 (HTTP ${response.status})`);
                }
            } catch (error) {
                results.push(`❌ 题库索引加载失败: ${error.message}`);
            }
            
            // 测试真题数据
            totalTests++;
            try {
                const response = await fetch('/question-banks/真题_中国海洋大学_2000-2021_cleaned.json');
                if (response.ok) {
                    const data = await response.json();
                    const questions = Array.isArray(data) ? data : (data.questions || data.data || []);
                    results.push(`✅ 真题数据加载成功 (${questions.length}题)`);
                    successCount++;
                } else {
                    results.push(`❌ 真题数据加载失败 (HTTP ${response.status})`);
                }
            } catch (error) {
                results.push(`❌ 真题数据加载失败: ${error.message}`);
            }
            
            // 测试易错题
            totalTests++;
            try {
                const response = await fetch('/question-banks/易错题集.json');
                if (response.ok) {
                    const data = await response.json();
                    const questions = Array.isArray(data) ? data : (data.questions || data.data || []);
                    results.push(`✅ 易错题加载成功 (${questions.length}题)`);
                    successCount++;
                } else {
                    results.push(`❌ 易错题加载失败 (HTTP ${response.status})`);
                }
            } catch (error) {
                results.push(`❌ 易错题加载失败: ${error.message}`);
            }
            
            // 测试分类题库
            totalTests++;
            try {
                const response = await fetch('/question-banks/分类_动量方程.json');
                if (response.ok) {
                    const data = await response.json();
                    const questions = Array.isArray(data) ? data : (data.questions || data.data || []);
                    results.push(`✅ 分类题库加载成功 (${questions.length}题)`);
                    successCount++;
                } else {
                    results.push(`❌ 分类题库加载失败 (HTTP ${response.status})`);
                }
            } catch (error) {
                results.push(`❌ 分类题库加载失败: ${error.message}`);
            }
            
            // 测试视频数据
            totalTests++;
            const videos = [
                { id: 'video1', title: '动量输运、牛顿内摩擦定律、欧拉坐标', source: 'https://v.douyin.com/7vrVT-4KmbI/' },
                { id: 'video2', title: '欧拉、拉格朗日坐标系统', source: 'https://v.douyin.com/X-ud2xkwvII/' },
                { id: 'video3', title: '流体力学之美，太美了', source: 'BV16T421D7k4' }
            ];
            results.push(`✅ 视频数据加载成功 (${videos.length}个视频)`);
            successCount++;
            
            // 生成最终报告
            const successRate = Math.round((successCount / totalTests) * 100);
            const finalResult = `🎯 完整测试完成！

📊 测试统计：
- 总测试数: ${totalTests}
- 成功数: ${successCount}
- 失败数: ${totalTests - successCount}
- 成功率: ${successRate}%

📋 详细结果:
${results.join('\n')}

${successRate >= 80 ? '🎉 测试通过！题库和视频数据加载正常。' : '⚠️ 部分测试失败，请检查数据文件。'}`;
            
            showResult('completeResult', finalResult, successRate >= 80 ? 'success' : 'error');
        }
        
        // 清除结果
        function clearResults() {
            document.getElementById('questionBankResult').textContent = '';
            document.getElementById('videoResult').textContent = '';
            document.getElementById('completeResult').textContent = '';
            document.getElementById('loadingProgress').style.width = '0%';
            
            testStats = {
                totalBanks: 0,
                totalQuestions: 0,
                totalVideos: 0,
                loadSuccess: 0,
                loadFailed: 0
            };
            updateStats();
        }
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 题库和视频加载测试页面已初始化');
            updateStats();
        });
    </script>
</body>
</html> 