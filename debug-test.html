<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è°ƒè¯•æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h2>
        <ul>
            <li>âœ… JavaScriptè¯­æ³•é”™è¯¯ä¿®å¤</li>
            <li>âœ… basicLoginå‡½æ•°å®šä¹‰</li>
            <li>âœ… HTTPå¤´éƒ¨ä¼˜åŒ–</li>
            <li>âœ… æµè§ˆå™¨å…¼å®¹æ€§</li>
            <li>âœ… ç™»å½•åŠŸèƒ½æµ‹è¯•</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” ç™»å½•åŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testLogin()">æµ‹è¯•ç™»å½•åŠŸèƒ½</button>
        <button onclick="testBasicLogin()">æµ‹è¯•basicLoginå‡½æ•°</button>
        <button onclick="testAccounts()">æµ‹è¯•è´¦å·æ•°æ®</button>
        <button onclick="clearStorage()">æ¸…é™¤ç™»å½•çŠ¶æ€</button>
        <div id="loginResult"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸŒ HTTPå¤´éƒ¨æµ‹è¯•</h2>
        <button onclick="testHeaders()">æµ‹è¯•HTTPå¤´éƒ¨</button>
        <button onclick="testServiceWorker()">æµ‹è¯•Service Worker</button>
        <div id="headerResult"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š è°ƒè¯•ä¿¡æ¯</h2>
        <button onclick="showDebugInfo()">æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</button>
        <pre id="debugInfo"></pre>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”— é¡µé¢é“¾æ¥</h2>
        <p><a href="/simple-login.html" target="_blank">ğŸ” ç®€å•ç™»å½•é¡µé¢</a></p>
        <p><a href="/test-login.html" target="_blank">ğŸ§ª ç™»å½•æµ‹è¯•é¡µé¢</a></p>
        <p><a href="/fluid_dynamic_2.html" target="_blank">ğŸ“š ä¸»å­¦ä¹ å¹³å°</a></p>
        <p><a href="/index.html" target="_blank">ğŸ  ä¸»é¡µå…¥å£</a></p>
    </div>

    <script>
        // æµ‹è¯•è´¦å·æ•°æ®
        const testAccounts = {
            'liuguanghui6330156': { name: 'åˆ˜å…‰è¾‰', role: 'teacher', password: 'Ll700306' },
            'student1': { name: 'å­¦ç”Ÿè´¦å·', role: 'student', password: '123456' },
            'niwenxuan': { name: 'å€ªæ–‡è½©', role: 'student', password: 'niwenxuan2025' },
            'hanwenxu': { name: 'éŸ©æ–‡æ—­', role: 'student', password: 'hanwenxu2025' }
        };
        
        function log(message, type = 'info') {
            const result = document.getElementById('loginResult');
            const timestamp = new Date().toLocaleTimeString();
            result.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
        }
        
        function testLogin() {
            log('ğŸ” å¼€å§‹æµ‹è¯•ç™»å½•åŠŸèƒ½...', 'info');
            
            // æµ‹è¯•è´¦å·æ•°æ®
            if (testAccounts) {
                log(`âœ… è´¦å·æ•°æ®æ­£å¸¸ï¼Œå…± ${Object.keys(testAccounts).length} ä¸ªè´¦å·`, 'success');
            } else {
                log('âŒ è´¦å·æ•°æ®å¼‚å¸¸', 'error');
            }
            
            // æµ‹è¯•localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                log('âœ… localStorageåŠŸèƒ½æ­£å¸¸', 'success');
            } catch (e) {
                log(`âŒ localStorageåŠŸèƒ½å¼‚å¸¸: ${e.message}`, 'error');
            }
            
            // æµ‹è¯•ç™»å½•çŠ¶æ€
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                log(`âœ… æ£€æµ‹åˆ°å·²ç™»å½•ç”¨æˆ·: ${currentUser}`, 'success');
            } else {
                log('â„¹ï¸ æœªæ£€æµ‹åˆ°ç™»å½•çŠ¶æ€', 'info');
            }
        }
        
        function testBasicLogin() {
            log('ğŸ”§ æµ‹è¯•basicLoginå‡½æ•°...', 'info');
            
            if (typeof window.basicLogin === 'function') {
                log('âœ… basicLoginå‡½æ•°å·²å®šä¹‰', 'success');
            } else {
                log('âŒ basicLoginå‡½æ•°æœªå®šä¹‰', 'error');
            }
            
            if (typeof basicLogin === 'function') {
                log('âœ… basicLoginå‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸå¯ç”¨', 'success');
            } else {
                log('âŒ basicLoginå‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸä¸å¯ç”¨', 'error');
            }
        }
        
        function testAccounts() {
            log('ğŸ“Š æµ‹è¯•è´¦å·æ•°æ®...', 'info');
            
            Object.keys(testAccounts).forEach(username => {
                const account = testAccounts[username];
                log(`ğŸ“ ${username}: ${account.name} (${account.role})`, 'info');
            });
        }
        
        function clearStorage() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userRole');
            localStorage.removeItem('userName');
            localStorage.removeItem('loginTime');
            log('ğŸ—‘ï¸ å·²æ¸…é™¤æ‰€æœ‰ç™»å½•çŠ¶æ€', 'success');
        }
        
        function testHeaders() {
            log('ğŸŒ æµ‹è¯•HTTPå¤´éƒ¨...', 'info');
            
            // æµ‹è¯•fetchè¯·æ±‚
            fetch('/manifest.json')
                .then(response => {
                    log(`âœ… è¯·æ±‚æˆåŠŸï¼ŒçŠ¶æ€ç : ${response.status}`, 'success');
                    
                    // æ£€æŸ¥å®‰å…¨å¤´éƒ¨
                    const headers = response.headers;
                    const securityHeaders = [
                        'x-content-type-options',
                        'referrer-policy',
                        'permissions-policy'
                    ];
                    
                    securityHeaders.forEach(header => {
                        if (headers.get(header)) {
                            log(`âœ… ${header} å¤´éƒ¨å·²è®¾ç½®`, 'success');
                        } else {
                            log(`âš ï¸ ${header} å¤´éƒ¨æœªè®¾ç½®`, 'warning');
                        }
                    });
                })
                .catch(error => {
                    log(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                });
        }
        
        function testServiceWorker() {
            log('ğŸ”§ æµ‹è¯•Service Worker...', 'info');
            
            if ('serviceWorker' in navigator) {
                log('âœ… Service Worker API å¯ç”¨', 'success');
                
                navigator.serviceWorker.getRegistrations()
                    .then(registrations => {
                        if (registrations.length > 0) {
                            log(`âœ… æ‰¾åˆ° ${registrations.length} ä¸ªService Worker`, 'success');
                            registrations.forEach((registration, index) => {
                                log(`ğŸ“‹ Service Worker ${index + 1}: ${registration.scope}`, 'info');
                            });
                        } else {
                            log('âš ï¸ æœªæ‰¾åˆ°Service Worker', 'warning');
                        }
                    })
                    .catch(error => {
                        log(`âŒ Service Workeræ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                    });
            } else {
                log('âŒ Service Worker API ä¸å¯ç”¨', 'error');
            }
        }
        
        function showDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            const info = {
                userAgent: navigator.userAgent,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                localStorage: typeof localStorage !== 'undefined',
                sessionStorage: typeof sessionStorage !== 'undefined',
                serviceWorker: 'serviceWorker' in navigator,
                currentUser: localStorage.getItem('currentUser'),
                userRole: localStorage.getItem('userRole'),
                userName: localStorage.getItem('userName'),
                loginTime: localStorage.getItem('loginTime'),
                accounts: Object.keys(testAccounts),
                windowSize: `${window.innerWidth}x${window.innerHeight}`,
                screenSize: `${screen.width}x${screen.height}`,
                colorDepth: screen.colorDepth,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
            
            debugInfo.textContent = JSON.stringify(info, null, 2);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€äº›æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info');
            testBasicLogin();
            testAccounts();
        });
    </script>
</body>
</html>