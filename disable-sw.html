<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦ç”¨ Service Worker - æµä½“åŠ›å­¦å­¦ä¹ å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .status {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .button {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
            text-decoration: none;
            display: inline-block;
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(39, 174, 96, 0.4);
        }

        .button.primary {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            box-shadow: 0 10px 30px rgba(33, 150, 243, 0.3);
        }

        .button.primary:hover {
            box-shadow: 0 15px 40px rgba(33, 150, 243, 0.4);
        }

        .step {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: left;
        }

        .step h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .countdown {
            font-size: 2em;
            font-weight: bold;
            color: #e74c3c;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Service Worker é—®é¢˜ä¿®å¤</h1>
        
        <div class="warning">
            <h3>âš ï¸ æ£€æµ‹åˆ° Service Worker é—®é¢˜</h3>
            <p>æ‚¨çš„é¡µé¢é‡åˆ°äº† "Failed to fetch" é”™è¯¯ï¼Œè¿™é€šå¸¸æ˜¯ç”±äº Service Worker ç¼“å­˜é—®é¢˜å¯¼è‡´çš„ã€‚æˆ‘ä»¬æ­£åœ¨ä¸ºæ‚¨è‡ªåŠ¨ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</p>
        </div>

        <div class="status">
            <h3>ğŸ“Š ä¿®å¤è¿›åº¦</h3>
            <div id="progress">æ­£åœ¨å¸è½½ Service Worker...</div>
        </div>

        <div class="countdown" id="countdown">5</div>

        <div class="step">
            <h3>ğŸ” é—®é¢˜åŸå› </h3>
            <ul>
                <li>Service Worker ç¼“å­˜äº†é”™è¯¯çš„å“åº”</li>
                <li>ç½‘ç»œè¯·æ±‚è¢« Service Worker æ‹¦æˆªå¹¶å¤±è´¥</li>
                <li>æµè§ˆå™¨ç¼“å­˜ä¸æœåŠ¡å™¨å†…å®¹ä¸åŒ¹é…</li>
            </ul>
        </div>

        <div class="step">
            <h3>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h3>
            <ol>
                <li><strong>å¸è½½ Service Worker</strong> - å®Œå…¨ç§»é™¤æœ‰é—®é¢˜çš„ Service Worker</li>
                <li><strong>æ¸…é™¤ç¼“å­˜</strong> - æ¸…é™¤æ‰€æœ‰ç›¸å…³çš„æµè§ˆå™¨ç¼“å­˜</li>
                <li><strong>é‡æ–°åŠ è½½</strong> - åˆ·æ–°é¡µé¢ä»¥åº”ç”¨ä¿®å¤</li>
            </ol>
        </div>

        <a href="ultimate-beautiful-formulas.html" class="button primary" id="goButton" style="display: none;">ğŸš€ å‰å¾€å…¬å¼å±•ç¤ºé¡µé¢</a>
        <a href="index.html" class="button">ğŸ  è¿”å›é¦–é¡µ</a>
        <a href="fix-service-worker.html" class="button">ğŸ”§ æ›´å¤šä¿®å¤é€‰é¡¹</a>
    </div>

    <script>
        let countdown = 5;
        const countdownElement = document.getElementById('countdown');
        const progressElement = document.getElementById('progress');
        const goButton = document.getElementById('goButton');

        async function disableServiceWorker() {
            try {
                // æ£€æŸ¥æ˜¯å¦æ”¯æŒ Service Worker
                if ('serviceWorker' in navigator) {
                    progressElement.innerHTML = 'æ­£åœ¨æ£€æŸ¥ Service Worker æ³¨å†Œ...';
                    
                    // è·å–æ‰€æœ‰ Service Worker æ³¨å†Œ
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    progressElement.innerHTML = `æ‰¾åˆ° ${registrations.length} ä¸ª Service Worker æ³¨å†Œ`;
                    
                    // å¸è½½æ‰€æœ‰ Service Worker
                    for (const registration of registrations) {
                        const unregistered = await registration.unregister();
                        progressElement.innerHTML = `Service Worker å¸è½½ç»“æœ: ${unregistered ? 'æˆåŠŸ' : 'å¤±è´¥'}`;
                    }
                    
                    // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
                    progressElement.innerHTML = 'æ­£åœ¨æ¸…é™¤ç¼“å­˜...';
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        await caches.delete(cacheName);
                    }
                    progressElement.innerHTML = `å·²æ¸…é™¤ ${cacheNames.length} ä¸ªç¼“å­˜`;
                    
                } else {
                    progressElement.innerHTML = 'æµè§ˆå™¨ä¸æ”¯æŒ Service Worker';
                }
                
                progressElement.innerHTML = 'âœ… ä¿®å¤å®Œæˆï¼æ­£åœ¨é‡å®šå‘...';
                
                // å¼€å§‹å€’è®¡æ—¶
                const timer = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(timer);
                        goButton.style.display = 'inline-block';
                        countdownElement.style.display = 'none';
                        progressElement.innerHTML = 'ğŸ‰ ä¿®å¤å®Œæˆï¼æ‚¨ç°åœ¨å¯ä»¥æ­£å¸¸è®¿é—®é¡µé¢äº†ã€‚';
                    }
                }, 1000);
                
            } catch (error) {
                progressElement.innerHTML = `âŒ ä¿®å¤è¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`;
                goButton.style.display = 'inline-block';
                countdownElement.style.display = 'none';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å¼€å§‹ä¿®å¤
        window.addEventListener('load', () => {
            disableServiceWorker();
        });

        // æ·»åŠ é¡µé¢å¯è§æ€§æ£€æµ‹
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // é¡µé¢é‡æ–°å¯è§æ—¶ï¼Œé‡æ–°æ£€æŸ¥
                disableServiceWorker();
            }
        });
    </script>
</body>
</html> 